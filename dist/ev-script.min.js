!function(e,t){"function"==typeof define&&define.amd?define(["jquery","plupload","jquery-ui","jquery.plupload.queue"],t):e.EV=t(e.$,e.plupload)}(this,function(e,t){var i,n,s;return function(e){function t(e,t){return w.call(e,t)}function r(e,t){var i,n,s,r,a,o,l,c,h,u,d,p=t&&t.split("/"),f=b.map,v=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),a=e.length-1,b.nodeIdCompat&&x.test(e[a])&&(e[a]=e[a].replace(x,"")),e=p.slice(0,p.length-1).concat(e),h=0;h<e.length;h+=1)if(d=e[h],"."===d)e.splice(h,1),h-=1;else if(".."===d){if(1===h&&(".."===e[2]||".."===e[0]))break;h>0&&(e.splice(h-1,2),h-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||v)&&f){for(i=e.split("/"),h=i.length;h>0;h-=1){if(n=i.slice(0,h).join("/"),p)for(u=p.length;u>0;u-=1)if(s=f[p.slice(0,u).join("/")],s&&(s=s[n])){r=s,o=h;break}if(r)break;!l&&v&&v[n]&&(l=v[n],c=h)}!r&&l&&(r=l,o=c),r&&(i.splice(0,o,r),e=i.join("/"))}return e}function a(t,i){return function(){var n=k.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(e,n.concat([t,i]))}}function o(e){return function(t){return r(t,e)}}function l(e){return function(t){m[e]=t}}function c(i){if(t(g,i)){var n=g[i];delete g[i],y[i]=!0,d.apply(e,n)}if(!t(m,i)&&!t(y,i))throw new Error("No "+i);return m[i]}function h(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function u(e){return function(){return b&&b.config&&b.config[e]||{}}}var d,p,f,v,m={},g={},b={},y={},w=Object.prototype.hasOwnProperty,k=[].slice,x=/\.js$/;f=function(e,t){var i,n=h(e),s=n[0];return e=n[1],s&&(s=r(s,t),i=c(s)),s?e=i&&i.normalize?i.normalize(e,o(t)):r(e,t):(e=r(e,t),n=h(e),s=n[0],e=n[1],s&&(i=c(s))),{f:s?s+"!"+e:e,n:e,pr:s,p:i}},v={require:function(e){return a(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:u(e)}}},d=function(i,n,s,r){var o,h,u,d,p,b,w=[],k=typeof s;if(r=r||i,"undefined"===k||"function"===k){for(n=!n.length&&s.length?["require","exports","module"]:n,p=0;p<n.length;p+=1)if(d=f(n[p],r),h=d.f,"require"===h)w[p]=v.require(i);else if("exports"===h)w[p]=v.exports(i),b=!0;else if("module"===h)o=w[p]=v.module(i);else if(t(m,h)||t(g,h)||t(y,h))w[p]=c(h);else{if(!d.p)throw new Error(i+" missing "+h);d.p.load(d.n,a(r,!0),l(h),{}),w[p]=m[h]}u=s?s.apply(m[i],w):void 0,i&&(o&&o.exports!==e&&o.exports!==m[i]?m[i]=o.exports:u===e&&b||(m[i]=u))}else i&&(m[i]=s)},i=n=p=function(t,i,n,s,r){if("string"==typeof t)return v[t]?v[t](i):c(f(t,i).f);if(!t.splice){if(b=t,b.deps&&p(b.deps,b.callback),!i)return;i.splice?(t=i,i=n,n=null):t=e}return i=i||function(){},"function"==typeof n&&(n=s,s=r),s?d(e,t,i,n):setTimeout(function(){d(e,t,i,n)},4),p},p.config=function(e){return p(e)},i._defined=m,s=function(e,i,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");i.splice||(n=i,i=[]),t(m,e)||t(g,e)||(g[e]=[e,i,n])},s.amd={jQuery:!0}}(),s("bower_components/almond/almond",function(){}),function(){function e(e){function t(t,i,n,s,r,a){for(;r>=0&&a>r;r+=e){var o=s?s[r]:r;n=i(n,t[o],o,t)}return n}return function(i,n,s,r){n=w(n,r,4);var a=!j(i)&&y.keys(i),o=(a||i).length,l=e>0?0:o-1;return arguments.length<3&&(s=i[a?a[l]:l],l+=e),t(i,n,s,a,l,o)}}function t(e){return function(t,i,n){i=k(i,n);for(var s=$(t),r=e>0?0:s-1;r>=0&&s>r;r+=e)if(i(t[r],r,t))return r;return-1}}function i(e,t,i){return function(n,s,r){var a=0,o=$(n);if("number"==typeof r)e>0?a=r>=0?r:Math.max(r+o,a):o=r>=0?Math.min(r+1,o):r+o+1;else if(i&&r&&o)return r=i(n,s),n[r]===s?r:-1;if(s!==s)return r=t(u.call(n,a,o),y.isNaN),r>=0?r+a:-1;for(r=e>0?a:o-1;r>=0&&o>r;r+=e)if(n[r]===s)return r;return-1}}function n(e,t){var i=P.length,n=e.constructor,s=y.isFunction(n)&&n.prototype||l,r="constructor";for(y.has(e,r)&&!y.contains(t,r)&&t.push(r);i--;)r=P[i],r in e&&e[r]!==s[r]&&!y.contains(t,r)&&t.push(r)}var r=this,a=r._,o=Array.prototype,l=Object.prototype,c=Function.prototype,h=o.push,u=o.slice,d=l.toString,p=l.hasOwnProperty,f=Array.isArray,v=Object.keys,m=c.bind,g=Object.create,b=function(){},y=function(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):r._=y,y.VERSION="1.8.3";var w=function(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,s){return e.call(t,i,n,s)};case 4:return function(i,n,s,r){return e.call(t,i,n,s,r)}}return function(){return e.apply(t,arguments)}},k=function(e,t,i){return null==e?y.identity:y.isFunction(e)?w(e,t,i):y.isObject(e)?y.matcher(e):y.property(e)};y.iteratee=function(e,t){return k(e,t,1/0)};var x=function(e,t){return function(i){var n=arguments.length;if(2>n||null==i)return i;for(var s=1;n>s;s++)for(var r=arguments[s],a=e(r),o=a.length,l=0;o>l;l++){var c=a[l];t&&void 0!==i[c]||(i[c]=r[c])}return i}},I=function(e){if(!y.isObject(e))return{};if(g)return g(e);b.prototype=e;var t=new b;return b.prototype=null,t},C=function(e){return function(t){return null==t?void 0:t[e]}},S=Math.pow(2,53)-1,$=C("length"),j=function(e){var t=$(e);return"number"==typeof t&&t>=0&&S>=t};y.each=y.forEach=function(e,t,i){t=w(t,i);var n,s;if(j(e))for(n=0,s=e.length;s>n;n++)t(e[n],n,e);else{var r=y.keys(e);for(n=0,s=r.length;s>n;n++)t(e[r[n]],r[n],e)}return e},y.map=y.collect=function(e,t,i){t=k(t,i);for(var n=!j(e)&&y.keys(e),s=(n||e).length,r=Array(s),a=0;s>a;a++){var o=n?n[a]:a;r[a]=t(e[o],o,e)}return r},y.reduce=y.foldl=y.inject=e(1),y.reduceRight=y.foldr=e(-1),y.find=y.detect=function(e,t,i){var n;return n=j(e)?y.findIndex(e,t,i):y.findKey(e,t,i),void 0!==n&&-1!==n?e[n]:void 0},y.filter=y.select=function(e,t,i){var n=[];return t=k(t,i),y.each(e,function(e,i,s){t(e,i,s)&&n.push(e)}),n},y.reject=function(e,t,i){return y.filter(e,y.negate(k(t)),i)},y.every=y.all=function(e,t,i){t=k(t,i);for(var n=!j(e)&&y.keys(e),s=(n||e).length,r=0;s>r;r++){var a=n?n[r]:r;if(!t(e[a],a,e))return!1}return!0},y.some=y.any=function(e,t,i){t=k(t,i);for(var n=!j(e)&&y.keys(e),s=(n||e).length,r=0;s>r;r++){var a=n?n[r]:r;if(t(e[a],a,e))return!0}return!1},y.contains=y.includes=y.include=function(e,t,i,n){return j(e)||(e=y.values(e)),("number"!=typeof i||n)&&(i=0),y.indexOf(e,t,i)>=0},y.invoke=function(e,t){var i=u.call(arguments,2),n=y.isFunction(t);return y.map(e,function(e){var s=n?t:e[t];return null==s?s:s.apply(e,i)})},y.pluck=function(e,t){return y.map(e,y.property(t))},y.where=function(e,t){return y.filter(e,y.matcher(t))},y.findWhere=function(e,t){return y.find(e,y.matcher(t))},y.max=function(e,t,i){var n,s,r=-(1/0),a=-(1/0);if(null==t&&null!=e){e=j(e)?e:y.values(e);for(var o=0,l=e.length;l>o;o++)n=e[o],n>r&&(r=n)}else t=k(t,i),y.each(e,function(e,i,n){s=t(e,i,n),(s>a||s===-(1/0)&&r===-(1/0))&&(r=e,a=s)});return r},y.min=function(e,t,i){var n,s,r=1/0,a=1/0;if(null==t&&null!=e){e=j(e)?e:y.values(e);for(var o=0,l=e.length;l>o;o++)n=e[o],r>n&&(r=n)}else t=k(t,i),y.each(e,function(e,i,n){s=t(e,i,n),(a>s||s===1/0&&r===1/0)&&(r=e,a=s)});return r},y.shuffle=function(e){for(var t,i=j(e)?e:y.values(e),n=i.length,s=Array(n),r=0;n>r;r++)t=y.random(0,r),t!==r&&(s[r]=s[t]),s[t]=i[r];return s},y.sample=function(e,t,i){return null==t||i?(j(e)||(e=y.values(e)),e[y.random(e.length-1)]):y.shuffle(e).slice(0,Math.max(0,t))},y.sortBy=function(e,t,i){return t=k(t,i),y.pluck(y.map(e,function(e,i,n){return{value:e,index:i,criteria:t(e,i,n)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index-t.index}),"value")};var _=function(e){return function(t,i,n){var s={};return i=k(i,n),y.each(t,function(n,r){var a=i(n,r,t);e(s,n,a)}),s}};y.groupBy=_(function(e,t,i){y.has(e,i)?e[i].push(t):e[i]=[t]}),y.indexBy=_(function(e,t,i){e[i]=t}),y.countBy=_(function(e,t,i){y.has(e,i)?e[i]++:e[i]=1}),y.toArray=function(e){return e?y.isArray(e)?u.call(e):j(e)?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:j(e)?e.length:y.keys(e).length},y.partition=function(e,t,i){t=k(t,i);var n=[],s=[];return y.each(e,function(e,i,r){(t(e,i,r)?n:s).push(e)}),[n,s]},y.first=y.head=y.take=function(e,t,i){return null!=e?null==t||i?e[0]:y.initial(e,e.length-t):void 0},y.initial=function(e,t,i){return u.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},y.last=function(e,t,i){return null!=e?null==t||i?e[e.length-1]:y.rest(e,Math.max(0,e.length-t)):void 0},y.rest=y.tail=y.drop=function(e,t,i){return u.call(e,null==t||i?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var E=function(e,t,i,n){for(var s=[],r=0,a=n||0,o=$(e);o>a;a++){var l=e[a];if(j(l)&&(y.isArray(l)||y.isArguments(l))){t||(l=E(l,t,i));var c=0,h=l.length;for(s.length+=h;h>c;)s[r++]=l[c++]}else i||(s[r++]=l)}return s};y.flatten=function(e,t){return E(e,t,!1)},y.without=function(e){return y.difference(e,u.call(arguments,1))},y.uniq=y.unique=function(e,t,i,n){y.isBoolean(t)||(n=i,i=t,t=!1),null!=i&&(i=k(i,n));for(var s=[],r=[],a=0,o=$(e);o>a;a++){var l=e[a],c=i?i(l,a,e):l;t?(a&&r===c||s.push(l),r=c):i?y.contains(r,c)||(r.push(c),s.push(l)):y.contains(s,l)||s.push(l)}return s},y.union=function(){return y.uniq(E(arguments,!0,!0))},y.intersection=function(e){for(var t=[],i=arguments.length,n=0,s=$(e);s>n;n++){var r=e[n];if(!y.contains(t,r)){for(var a=1;i>a&&y.contains(arguments[a],r);a++);a===i&&t.push(r)}}return t},y.difference=function(e){var t=E(arguments,!0,!0,1);return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(e){for(var t=e&&y.max(e,$).length||0,i=Array(t),n=0;t>n;n++)i[n]=y.pluck(e,n);return i},y.object=function(e,t){for(var i={},n=0,s=$(e);s>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},y.findIndex=t(1),y.findLastIndex=t(-1),y.sortedIndex=function(e,t,i,n){i=k(i,n,1);for(var s=i(t),r=0,a=$(e);a>r;){var o=Math.floor((r+a)/2);i(e[o])<s?r=o+1:a=o}return r},y.indexOf=i(1,y.findIndex,y.sortedIndex),y.lastIndexOf=i(-1,y.findLastIndex),y.range=function(e,t,i){null==t&&(t=e||0,e=0),i=i||1;for(var n=Math.max(Math.ceil((t-e)/i),0),s=Array(n),r=0;n>r;r++,e+=i)s[r]=e;return s};var A=function(e,t,i,n,s){if(!(n instanceof t))return e.apply(i,s);var r=I(e.prototype),a=e.apply(r,s);return y.isObject(a)?a:r};y.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,u.call(arguments,1));if(!y.isFunction(e))throw new TypeError("Bind must be called on a function");var i=u.call(arguments,2),n=function(){return A(e,n,t,this,i.concat(u.call(arguments)))};return n},y.partial=function(e){var t=u.call(arguments,1),i=function(){for(var n=0,s=t.length,r=Array(s),a=0;s>a;a++)r[a]=t[a]===y?arguments[n++]:t[a];for(;n<arguments.length;)r.push(arguments[n++]);return A(e,i,this,this,r)};return i},y.bindAll=function(e){var t,i,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(t=1;n>t;t++)i=arguments[t],e[i]=y.bind(e[i],e);return e},y.memoize=function(e,t){var i=function(n){var s=i.cache,r=""+(t?t.apply(this,arguments):n);return y.has(s,r)||(s[r]=e.apply(this,arguments)),s[r]};return i.cache={},i},y.delay=function(e,t){var i=u.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},y.defer=y.partial(y.delay,y,1),y.throttle=function(e,t,i){var n,s,r,a=null,o=0;i||(i={});var l=function(){o=i.leading===!1?0:y.now(),a=null,r=e.apply(n,s),a||(n=s=null)};return function(){var c=y.now();o||i.leading!==!1||(o=c);var h=t-(c-o);return n=this,s=arguments,0>=h||h>t?(a&&(clearTimeout(a),a=null),o=c,r=e.apply(n,s),a||(n=s=null)):a||i.trailing===!1||(a=setTimeout(l,h)),r}},y.debounce=function(e,t,i){var n,s,r,a,o,l=function(){var c=y.now()-a;t>c&&c>=0?n=setTimeout(l,t-c):(n=null,i||(o=e.apply(r,s),n||(r=s=null)))};return function(){r=this,s=arguments,a=y.now();var c=i&&!n;return n||(n=setTimeout(l,t)),c&&(o=e.apply(r,s),r=s=null),o}},y.wrap=function(e,t){return y.partial(t,e)},y.negate=function(e){return function(){return!e.apply(this,arguments)}},y.compose=function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},y.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},y.before=function(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),1>=e&&(t=null),i}},y.once=y.partial(y.before,2);var z=!{toString:null}.propertyIsEnumerable("toString"),P=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(e){if(!y.isObject(e))return[];if(v)return v(e);var t=[];for(var i in e)y.has(e,i)&&t.push(i);return z&&n(e,t),t},y.allKeys=function(e){if(!y.isObject(e))return[];var t=[];for(var i in e)t.push(i);return z&&n(e,t),t},y.values=function(e){for(var t=y.keys(e),i=t.length,n=Array(i),s=0;i>s;s++)n[s]=e[t[s]];return n},y.mapObject=function(e,t,i){t=k(t,i);for(var n,s=y.keys(e),r=s.length,a={},o=0;r>o;o++)n=s[o],a[n]=t(e[n],n,e);return a},y.pairs=function(e){for(var t=y.keys(e),i=t.length,n=Array(i),s=0;i>s;s++)n[s]=[t[s],e[t[s]]];return n},y.invert=function(e){for(var t={},i=y.keys(e),n=0,s=i.length;s>n;n++)t[e[i[n]]]=i[n];return t},y.functions=y.methods=function(e){var t=[];for(var i in e)y.isFunction(e[i])&&t.push(i);return t.sort()},y.extend=x(y.allKeys),y.extendOwn=y.assign=x(y.keys),y.findKey=function(e,t,i){t=k(t,i);for(var n,s=y.keys(e),r=0,a=s.length;a>r;r++)if(n=s[r],t(e[n],n,e))return n},y.pick=function(e,t,i){var n,s,r={},a=e;if(null==a)return r;y.isFunction(t)?(s=y.allKeys(a),n=w(t,i)):(s=E(arguments,!1,!1,1),n=function(e,t,i){return t in i},a=Object(a));for(var o=0,l=s.length;l>o;o++){var c=s[o],h=a[c];n(h,c,a)&&(r[c]=h)}return r},y.omit=function(e,t,i){if(y.isFunction(t))t=y.negate(t);else{var n=y.map(E(arguments,!1,!1,1),String);t=function(e,t){return!y.contains(n,t)}}return y.pick(e,t,i)},y.defaults=x(y.allKeys,!0),y.create=function(e,t){var i=I(e);return t&&y.extendOwn(i,t),i},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e},y.isMatch=function(e,t){var i=y.keys(t),n=i.length;if(null==e)return!n;for(var s=Object(e),r=0;n>r;r++){var a=i[r];if(t[a]!==s[a]||!(a in s))return!1}return!0};var T=function(e,t,i,n){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var s=d.call(e);if(s!==d.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var r="[object Array]"===s;if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,o=t.constructor;if(a!==o&&!(y.isFunction(a)&&a instanceof a&&y.isFunction(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===e)return n[l]===t;if(i.push(e),n.push(t),r){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!T(e[l],t[l],i,n))return!1}else{var c,h=y.keys(e);if(l=h.length,y.keys(t).length!==l)return!1;for(;l--;)if(c=h[l],!y.has(t,c)||!T(e[c],t[c],i,n))return!1}return i.pop(),n.pop(),!0};y.isEqual=function(e,t){return T(e,t)},y.isEmpty=function(e){return null==e?!0:j(e)&&(y.isArray(e)||y.isString(e)||y.isArguments(e))?0===e.length:0===y.keys(e).length},y.isElement=function(e){return!(!e||1!==e.nodeType)},y.isArray=f||function(e){return"[object Array]"===d.call(e)},y.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return d.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return y.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(y.isFunction=function(e){return"function"==typeof e||!1}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!==+e},y.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===d.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return void 0===e},y.has=function(e,t){return null!=e&&p.call(e,t)},y.noConflict=function(){return r._=a,this},y.identity=function(e){return e},y.constant=function(e){return function(){return e}},y.noop=function(){},y.property=C,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(e,t,i){var n=Array(Math.max(0,e));t=w(t,i,1);for(var s=0;e>s;s++)n[s]=t(s);return n},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},y.now=Date.now||function(){return(new Date).getTime()};var q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},U=y.invert(q),L=function(e){var t=function(t){return e[t]},i="(?:"+y.keys(e).join("|")+")",n=RegExp(i),s=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(s,t):e}};y.escape=L(q),y.unescape=L(U),y.result=function(e,t,i){var n=null==e?void 0:e[t];return void 0===n&&(n=i),y.isFunction(n)?n.call(e):n};var O=0;y.uniqueId=function(e){var t=++O+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\u2028|\u2029/g,V=function(e){return"\\"+M[e]};y.template=function(e,t,i){!t&&i&&(t=i),t=y.defaults({},t,y.templateSettings);var n=RegExp([(t.escape||D).source,(t.interpolate||D).source,(t.evaluate||D).source].join("|")+"|$","g"),s=0,r="__p+='";e.replace(n,function(t,i,n,a,o){return r+=e.slice(s,o).replace(H,V),s=o+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),t}),r+="';\n",t.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var a=new Function(t.variable||"obj","_",r)}catch(o){throw o.source=r,o}var l=function(e){return a.call(this,e,y)},c=t.variable||"obj";return l.source="function("+c+"){\n"+r+"}",l},y.chain=function(e){var t=y(e);return t._chain=!0,t};var R=function(e,t){return e._chain?y(t).chain():t};y.mixin=function(e){y.each(y.functions(e),function(t){var i=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return h.apply(e,arguments),R(this,i.apply(y,e))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];y.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0],R(this,i)}}),y.each(["concat","join","slice"],function(e){var t=o[e];y.prototype[e]=function(){return R(this,t.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof s&&s.amd&&s("underscore",[],function(){return y})}.call(this),function(e){var t="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof s&&s.amd)s("backbone",["underscore","jquery","exports"],function(i,n,s){t.Backbone=e(t,s,i,n)});else if("undefined"!=typeof exports){var i,r=n("underscore");try{i=n("jquery")}catch(a){}e(t,exports,r,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,i,n){var s=e.Backbone,r=Array.prototype.slice;t.VERSION="1.2.3",t.$=n,t.noConflict=function(){return e.Backbone=s,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=function(e,t,n){switch(e){case 1:return function(){return i[t](this[n])};case 2:return function(e){return i[t](this[n],e)};case 3:return function(e,s){return i[t](this[n],l(e,this),s)};case 4:return function(e,s,r){return i[t](this[n],l(e,this),s,r)};default:return function(){var e=r.call(arguments);return e.unshift(this[n]),i[t].apply(i,e)}}},o=function(e,t,n){i.each(t,function(t,s){i[s]&&(e.prototype[s]=a(t,s,n))})},l=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?c(e):i.isString(e)?function(t){return t.get(e)}:e},c=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},h=t.Events={},u=/\s+/,d=function(e,t,n,s,r){var a,o=0;if(n&&"object"==typeof n){void 0!==s&&"context"in r&&void 0===r.context&&(r.context=s);for(a=i.keys(n);o<a.length;o++)t=d(e,t,a[o],n[a[o]],r)}else if(n&&u.test(n))for(a=n.split(u);o<a.length;o++)t=e(t,a[o],s,r);else t=e(t,n,s,r);return t};h.on=function(e,t,i){return p(this,e,t,i)};var p=function(e,t,i,n,s){if(e._events=d(f,e._events||{},t,i,{context:n,ctx:e,listening:s}),s){var r=e._listeners||(e._listeners={});r[s.id]=s}return e};h.listenTo=function(e,t,n){if(!e)return this;var s=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),a=r[s];if(!a){var o=this._listenId||(this._listenId=i.uniqueId("l"));a=r[s]={obj:e,objId:s,id:o,listeningTo:r,count:0}}return p(e,t,n,this,a),this};var f=function(e,t,i,n){if(i){var s=e[t]||(e[t]=[]),r=n.context,a=n.ctx,o=n.listening;o&&o.count++,s.push({callback:i,context:r,ctx:r||a,listening:o})}return e};h.off=function(e,t,i){return this._events?(this._events=d(v,this._events,e,t,{context:i,listeners:this._listeners}),this):this},h.stopListening=function(e,t,n){var s=this._listeningTo;if(!s)return this;for(var r=e?[e._listenId]:i.keys(s),a=0;a<r.length;a++){var o=s[r[a]];if(!o)break;o.obj.off(t,n,this)}return i.isEmpty(s)&&(this._listeningTo=void 0),this};var v=function(e,t,n,s){if(e){var r,a=0,o=s.context,l=s.listeners;if(t||n||o){for(var c=t?[t]:i.keys(e);a<c.length;a++){t=c[a];var h=e[t];if(!h)break;for(var u=[],d=0;d<h.length;d++){var p=h[d];n&&n!==p.callback&&n!==p.callback._callback||o&&o!==p.context?u.push(p):(r=p.listening,r&&0===--r.count&&(delete l[r.id],delete r.listeningTo[r.objId]))}u.length?e[t]=u:delete e[t]}return i.size(e)?e:void 0}for(var f=i.keys(l);a<f.length;a++)r=l[f[a]],delete l[r.id],delete r.listeningTo[r.objId]}};h.once=function(e,t,n){var s=d(m,{},e,t,i.bind(this.off,this));return this.on(s,void 0,n)},h.listenToOnce=function(e,t,n){var s=d(m,{},t,n,i.bind(this.stopListening,this,e));return this.listenTo(e,s)};var m=function(e,t,n,s){if(n){var r=e[t]=i.once(function(){s(t,r),n.apply(this,arguments)});r._callback=n}return e};h.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;t>n;n++)i[n]=arguments[n+1];return d(g,this._events,e,void 0,i),this};var g=function(e,t,i,n){if(e){var s=e[t],r=e.all;s&&r&&(r=r.slice()),s&&b(s,n),r&&b(r,[t].concat(n))}return e},b=function(e,t){var i,n=-1,s=e.length,r=t[0],a=t[1],o=t[2];switch(t.length){case 0:for(;++n<s;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,a);return;case 3:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,a,o);return;default:for(;++n<s;)(i=e[n]).callback.apply(i.ctx,t);return}};h.bind=h.on,h.unbind=h.off,i.extend(t,h);var y=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,h,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var s;if("object"==typeof e?(s=e,n=t):(s={})[e]=t,n||(n={}),!this._validate(s,n))return!1;var r=n.unset,a=n.silent,o=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,h=this.changed,u=this._previousAttributes;for(var d in s)t=s[d],i.isEqual(c[d],t)||o.push(d),i.isEqual(u[d],t)?delete h[d]:h[d]=t,r?delete c[d]:c[d]=t;if(this.id=this.get(this.idAttribute),!a){o.length&&(this._pending=n);for(var p=0;p<o.length;p++)this.trigger("change:"+o[p],this,c[o[p]],n)}if(l)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t=this._changing?this._previousAttributes:this.attributes,n={};for(var s in e){var r=e[s];i.isEqual(t[s],r)||(n[s]=r)}return i.size(n)?n:!1},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var s=e.parse?t.parse(i,e):i;return t.set(s,e)?(n&&n.call(e.context,t,i,e),void t.trigger("sync",t,i,e)):!1},V(this,e),this.sync("read",this,e)},save:function(e,t,n){var s;null==e||"object"==typeof e?(s=e,n=t):(s={})[e]=t,n=i.extend({validate:!0,parse:!0},n);var r=n.wait;if(s&&!r){if(!this.set(s,n))return!1}else if(!this._validate(s,n))return!1;var a=this,o=n.success,l=this.attributes;n.success=function(e){a.attributes=l;var t=n.parse?a.parse(e,n):e;return r&&(t=i.extend({},s,t)),t&&!a.set(t,n)?!1:(o&&o.call(n.context,a,e,n),void a.trigger("sync",a,e,n))},V(this,n),s&&r&&(this.attributes=i.extend({},l,s));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=s);var h=this.sync(c,this,n);return this.attributes=l,h},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,s=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){s&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var a=!1;return this.isNew()?i.defer(e.success):(V(this,e),a=this.sync("delete",this,e)),s||r(),a},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||H();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.defaults({validate:!0},e))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1):!0}});var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};o(y,w,"attributes");var k=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},x={add:!0,remove:!0,merge:!0},I={add:!0,remove:!1},C=function(e,t,i){i=Math.min(Math.max(i,0),e.length);for(var n=Array(e.length-i),s=t.length,r=0;r<n.length;r++)n[r]=e[r+i];for(r=0;s>r;r++)e[r+i]=t[r];for(r=0;r<n.length;r++)e[r+s+i]=n[r]};i.extend(k.prototype,h,{model:y,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,I))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:i.clone(e);var s=this._removeModels(e,t);return!t.silent&&s&&this.trigger("update",this,t),n?s[0]:s},set:function(e,t){if(null!=e){t=i.defaults({},t,x),t.parse&&!this._isModel(e)&&(e=this.parse(e,t));var n=!i.isArray(e);e=n?[e]:e.slice();var s=t.at;null!=s&&(s=+s),0>s&&(s+=this.length+1);for(var r,a=[],o=[],l=[],c={},h=t.add,u=t.merge,d=t.remove,p=!1,f=this.comparator&&null==s&&t.sort!==!1,v=i.isString(this.comparator)?this.comparator:null,m=0;m<e.length;m++){r=e[m];var g=this.get(r);if(g){if(u&&r!==g){var b=this._isModel(r)?r.attributes:r;t.parse&&(b=g.parse(b,t)),g.set(b,t),f&&!p&&(p=g.hasChanged(v))}c[g.cid]||(c[g.cid]=!0,a.push(g)),e[m]=g}else h&&(r=e[m]=this._prepareModel(r,t),r&&(o.push(r),this._addReference(r,t),c[r.cid]=!0,a.push(r)))}if(d){for(m=0;m<this.length;m++)r=this.models[m],c[r.cid]||l.push(r);l.length&&this._removeModels(l,t)}var y=!1,w=!f&&h&&d;if(a.length&&w?(y=this.length!=a.length||i.some(this.models,function(e,t){return e!==a[t]}),this.models.length=0,C(this.models,a,0),this.length=this.models.length):o.length&&(f&&(p=!0),C(this.models,o,null==s?this.length:s),this.length=this.models.length),p&&this.sort({silent:!0}),!t.silent){for(m=0;m<o.length;m++)null!=s&&(t.index=s+m),r=o[m],r.trigger("add",r,this,t);(p||y)&&this.trigger("sort",this,t),(o.length||l.length)&&this.trigger("update",this,t)}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e){var t=this.modelId(this._isModel(e)?e.attributes:e);return this._byId[e]||this._byId[t]||this._byId[e.cid]}},at:function(e){return 0>e&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=i.bind(t,this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){e=i.extend({parse:!0},e);var t=e.success,n=this;return e.success=function(i){var s=e.reset?"reset":"set";n[s](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},V(this,e),this.sync("read",this,e)},create:function(e,t){t=t?i.clone(t):{};var n=t.wait;if(e=this._prepareModel(e,t),!e)return!1;n||this.add(e,t);var s=this,r=t.success;return t.success=function(e,t,i){n&&s.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var s=this.get(e[n]);if(s){var r=this.indexOf(s);this.models.splice(r,1),this.length--,t.silent||(t.index=r,s.trigger("remove",s,this,t)),i.push(s),this._removeReference(s,t)}}return i.length?i:!1},_isModel:function(e){return e instanceof y},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){
delete this._byId[e.cid];var i=this.modelId(e.attributes);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if("add"!==e&&"remove"!==e||i===this){if("destroy"===e&&this.remove(t,n),"change"===e){var s=this.modelId(t.previousAttributes()),r=this.modelId(t.attributes);s!==r&&(null!=s&&delete this._byId[s],null!=r&&(this._byId[r]=t))}this.trigger.apply(this,arguments)}}});var S={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};o(k,S,"models");var $=t.View=function(e){this.cid=i.uniqueId("view"),i.extend(this,i.pick(e,_)),this._ensureElement(),this.initialize.apply(this,arguments)},j=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];i.extend($.prototype,h,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var s=t.match(j);this.delegate(s[1],s[2],i.bind(n,this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,n,s){var r=E[e];i.defaults(s||(s={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(s.url||(a.url=i.result(n,"url")||H()),null!=s.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(s.attrs||n.toJSON(s))),s.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),s.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",s.emulateJSON&&(a.data._method=r);var o=s.beforeSend;s.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",r),o?o.apply(this,arguments):void 0}}"GET"===a.type||s.emulateJSON||(a.processData=!1);var l=s.error;s.error=function(e,t,i){s.textStatus=t,s.errorThrown=i,l&&l.call(s.context,e,t,i)};var c=s.xhr=t.ajax(i.extend(a,s));return n.trigger("request",n,c,s),c};var E={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var A=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,T=/\*\w+/g,q=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(A.prototype,h,{initialize:function(){},route:function(e,n,s){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(s=n,n=""),s||(s=this[n]);var r=this;return t.history.route(e,function(i){var a=r._extractParameters(e,i);r.execute(s,a,n)!==!1&&(r.trigger.apply(r,["route:"+n].concat(a)),r.trigger("route",n,a),t.history.trigger("route",r,n,a))}),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(q,"\\$&").replace(z,"(?:$1)?").replace(P,function(e,t){return t?e:"([^/?]+)"}).replace(T,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var U=t.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,D=/#.*$/;U.started=!1,i.extend(U.prototype,h,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(L,"")},start:function(e){if(U.started)throw new Error("Backbone.history has already been started");if(U.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(O,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,s=n.insertBefore(this.iframe,n.firstChild).contentWindow;s.document.open(),s.document.close(),s.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};return this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),U.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),i.some(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})):!1},navigate:function(e,t){if(!U.started)return!1;t&&t!==!0||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;(""===e||"?"===e.charAt(0))&&(i=i.slice(0,-1)||"/");var n=i+e;if(e=this.decodeFragment(e.replace(D,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;t.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new U;var M=function(e,t){var n,s=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},i.extend(n,s,t);var r=function(){this.constructor=n};return r.prototype=s.prototype,n.prototype=new r,e&&i.extend(n.prototype,e),n.__super__=s.prototype,n};y.extend=k.extend=A.extend=$.extend=U.extend=M;var H=function(){throw new Error('A "url" property or function must be specified')},V=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}),s("ev-script/models/video-settings",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"video",width:"640",height:"360",showtitle:!0,autoplay:!1,showcaptions:!1,hidecontrols:!1,socialsharing:!1,annotations:!0,captionsearch:!0,attachments:!0,links:!0,metadata:!0,dateproduced:!0,embedcode:!1,download:!1,search:"",sourceId:"content"}})}),s("ev-script/models/playlist-settings",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"playlist",width:"800",height:"1000",layout:"playlist",playlistLayout:{playlistSortBy:"videoDate",playlistSortDirection:"desc"},showcaseLayout:{categoryList:!0,categoryOrientation:"horizontal"},embedcode:!1,statistics:!0,duration:!0,attachments:!0,annotations:!0,links:!0,credits:!0,socialsharing:!1,autoplay:!1,showcaptions:!1,dateproduced:!0,audiopreviewimage:!1,captionsearch:!0,search:""}})}),s("ev-script/util/events",["require","underscore","backbone"],function(e){"use strict";var t=[],i=e("underscore"),n=e("backbone");return t.global=i.extend({},n.Events),{initEvents:function(e){return t[e]=i.extend({},n.Events)},getEvents:function(e){var i;return i=e?t[e]:t.global}}}),s("ev-script/util/cache",["require","jquery","underscore","backbone"],function(e){"use strict";var t=(e("jquery"),e("underscore"),e("backbone"),function(){return this.cache=[],this.get=function(e){return e?this.cache[e]:null},this.set=function(e,t){return e?this.cache[e]=t:null},this}),i=new t,n=function(e){var n=i.get(e);return n||(n=i.set(e,new t)),n},s=function(e,t){return n(e).set("config",t)},r=function(e){return n(e).get("config")},a=function(e,t){return n(e).set("auth",t)},o=function(e){return n(e).get("auth")},l=function(e,t){return n(e).set("info",t)},c=function(e){return n(e).get("info")},h=function(e,n){var s=i.get(e);s||(s=i.set(e,new t));var r=s.get(n);return r||(r=s.set(n,new t)),r};return{Cache:t,caches:i,setAppConfig:s,getAppConfig:r,setAppAuth:a,getAppAuth:o,setAppInfo:l,getAppInfo:c,getUserCache:h}}),s("ev-script/views/base",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache"],function(e){"use strict";var t=e("jquery"),i=(e("underscore"),e("backbone")),n=this,s=e("ev-script/util/events"),r=e("ev-script/util/cache");return i.View.extend({initialize:function(e){this.appId=e.appId,this.config=r.getAppConfig(this.appId),this.auth=r.getAppAuth(this.appId),this.info=r.getAppInfo(this.appId),this.appEvents=s.getEvents(this.appId),this.globalEvents=s.getEvents("global")},ajaxError:function(e,t){401===e.status?this.auth.handleUnauthorized(this.el,t):500===e.status?n.alert("It appears there is an issue with the Ensemble Video installation."):404===e.status?n.alert("Could not find requested resource.  This is likely a problem with the configured Ensemble Video base url."):0!==e.status&&n.alert("An unexpected error occurred.  Check the server log for more details.")},unencode:function(e){return t("<span/>").html(e).text()}})}),s("text",["module"],function(e){"use strict";var t,i,s,r,a,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,h="undefined"!=typeof location&&location.href,u=h&&location.protocol&&location.protocol.replace(/\:/,""),d=h&&location.hostname,p=h&&(location.port||void 0),f={},v=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(l,"");var t=e.match(c);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=o[t];try{e=new ActiveXObject(i)}catch(n){}if(e){o=[i];break}}return e},parseName:function(e){var t,i,n,s=!1,r=e.lastIndexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!a||r>1)?(t=e.substring(0,r),i=e.substring(r+1)):t=e,n=i||t,r=n.indexOf("!"),-1!==r&&(s="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:t=n),{moduleName:t,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,s){var r,a,o,l=t.xdRegExp.exec(e);return l?(r=l[2],a=l[3],a=a.split(":"),o=a[1],a=a[0],!(r&&r!==i||a&&a.toLowerCase()!==n.toLowerCase()||(o||a)&&o!==s)):!0},finishLoad:function(e,i,n,s){n=i?t.strip(n):n,v.isBuild&&(f[e]=n),s(n)},load:function(e,i,n,s){if(s&&s.isBuild&&!s.inlineText)return void n();v.isBuild=s&&s.isBuild;var r=t.parseName(e),a=r.moduleName+(r.ext?"."+r.ext:""),o=i.toUrl(a),l=v.useXhr||t.useXhr;return 0===o.indexOf("empty:")?void n():void(!h||l(o,u,d,p)?t.get(o,function(i){t.finishLoad(e,r.strip,i,n)},function(e){n.error&&n.error(e)}):i([a],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,n)}))},write:function(e,i,n,s){if(f.hasOwnProperty(i)){var r=t.jsEscape(f[i]);n.asModule(e+"!"+i,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,i,n,s,r){var a=t.parseName(i),o=a.ext?"."+a.ext:"",l=a.moduleName+o,c=n.toUrl(a.moduleName+o)+".js";t.load(l,n,function(i){var n=function(e){return s(c,e)};n.asModule=function(e,t){return s.asModule(e,c,t)},t.write(e,l,n,r)},r)}},"node"===v.env||!v.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=n.nodeRequire("fs"),t.get=function(e,t,n){try{var s=i.readFileSync(e,"utf8");"\ufeff"===s[0]&&(s=s.substring(1)),t(s)}catch(r){n&&n(r)}}):"xhr"===v.env||!v.env&&t.createXhr()?t.get=function(e,i,n,s){var r,a=t.createXhr();if(a.open("GET",e,!0),s)for(r in s)s.hasOwnProperty(r)&&a.setRequestHeader(r.toLowerCase(),s[r]);v.onXhr&&v.onXhr(a,e),a.onreadystatechange=function(t){var s,r;4===a.readyState&&(s=a.status||0,s>399&&600>s?(r=new Error(e+" HTTP status: "+s),r.xhr=a,n&&n(r)):i(a.responseText),v.onXhrComplete&&v.onXhrComplete(a,e))},a.send(null)}:"rhino"===v.env||!v.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,s="utf-8",r=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),s)),l="";try{for(i=new java.lang.StringBuffer,n=o.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=o.readLine());)i.append(a),i.append(n);l=String(i.toString())}finally{o.close()}t(l)}:("xpconnect"===v.env||!v.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(s=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in s,t.get=function(e,t){var i,n,o,l={};a&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{i=s["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),i.init(o,1,0,!1),n=s["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),n.init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),n.readString(i.available(),l),n.close(),i.close(),t(l.value)}catch(c){throw new Error((o&&o.path||"")+": "+c)}}),t}),s("text!ev-script/templates/hider.html",[],function(){return'<a class="action-hide" href="#" title="Hide Picker">Hide</a>\n<% if (showLogout) { %>\n    <a class="action-logout" href="#" title="Logout <%= username %>">Logout</a>\n<% } %>\n'}),s("ev-script/views/hider",["require","underscore","ev-script/views/base","text!ev-script/templates/hider.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/hider.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"hideHandler","logoutHandler","authHandler","render"),this.globalEvents.on("loggedIn",this.authHandler),this.globalEvents.on("loggedOut",this.authHandler),this.field=e.field},events:{"click a.action-hide":"hideHandler","click a.action-logout":"logoutHandler"},authHandler:function(e){e===this.config.ensembleUrl&&this.render()},render:function(){var e="";this.info.get("ApplicationVersion")&&this.auth.isAuthenticated()&&(e=this.auth.getUser().get("UserName")),this.$el.html(this.template({showLogout:this.auth.isAuthenticated()&&"none"!==this.config.authType,username:e}))},hideHandler:function(e){this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},logoutHandler:function(e){this.auth.logout().always(this.appEvents.trigger("hidePickers")),e.preventDefault()}})}),s("text!ev-script/templates/picker.html",[],function(){return'<div id="<%= id %>-hider" class="ev-hider"></div>\n<div id="<%= id %>-filter-block" class="ev-filter-block">\n    <div class="loader"></div>\n</div>\n<div id="<%= id %>-results" class="ev-results clearfix"></div>\n'}),s("ev-script/views/picker",["require","jquery","underscore","ev-script/views/base","ev-script/views/hider","text!ev-script/templates/picker.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/base"),s=e("ev-script/views/hider");return n.extend({template:i.template(e("text!ev-script/templates/picker.html")),initialize:function(e){n.prototype.initialize.call(this,e),i.bindAll(this,"chooseItem","hidePicker","showPicker","setHeight","resizeResults"),this.$el.hide(),this.$el.html(this.template({id:this.id})),this.field=e.field,this.hider=new s({el:this.$("div.ev-hider"),field:this.field,appId:this.appId});var r=this.$("div.loader");t(window.document).on("ajaxSend",i.bind(function(e,t,i){this===i.picker&&r.addClass("loading")},this)).on("ajaxComplete",i.bind(function(e,t,i){this===i.picker&&r.removeClass("loading")},this)),this.appEvents.on("hidePickers",function(e){e&&this.field.id===e||this.hidePicker()},this),this.appEvents.on("showPicker",function(e){this.field.id===e&&this.$el.is(":hidden")&&this.showPicker()},this),this.appEvents.on("hidePicker",function(e){this.field.id===e&&this.hidePicker()},this),this.hider.render()},chooseItem:function(e){var i=t(e.currentTarget).attr("rel"),n=this.resultsView.collection.get(i);this.model.set({id:i,content:n.toJSON()}),this.field.model.set(this.model.attributes),this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},hidePicker:function(){this.$el.hide()},showPicker:function(){this.hider.render(),this.$el.show()},setHeight:function(e){this.$el.height(e),this.resizeResults()},resizeResults:function(){}})}),s("text!ev-script/templates/search.html",[],function(){return'<label for="<%= id %>">Search:</label>\n<input id="<%= id %>" type="search" class="form-text search" value="<%- searchVal %>" title="Search Media" />\n<input type="submit" value="Go" class="form-submit" />\n'}),s("ev-script/views/search",["require","underscore","ev-script/views/base","text!ev-script/templates/search.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/search.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"searchHandler","doSearch","autoSearch"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"submit form":"searchHandler","keyup .search":"autoSearch"},render:function(){this.$el.html(this.template({id:this.id+"-input",searchVal:this.picker.model.get("search")}))},doSearch:function(){this.picker.model.set({search:this.$(".search").val()}),this.callback()},searchHandler:function(e){this.doSearch(),e.preventDefault()},autoSearch:function(e){var i=e.target.value;i!==this.lastValue&&(this.lastValue=i,this.submitTimeout&&clearTimeout(this.submitTimeout),this.submitTimeout=setTimeout(t.bind(function(){this.doSearch()},this),1e3))}})}),s("text!ev-script/templates/library-type-select.html",[],function(){return'<div>\n  <label for="<%= id %>">Type:</label>\n  <select id="<%= id %>" class="form-select source" title="Select Library Type">\n    <option value="content" <% if (sourceId === \'content\') { print(\'selected="selected"\'); } %>>Media Library</option>\n    <option value="shared" <% if (sourceId === \'shared\') { print(\'selected="selected"\'); } %>>Shared Library</option>\n  </select>\n  <input type="submit" value="Go" class="form-submit" />\n</div>\n'}),s("ev-script/views/library-type-select",["require","underscore","ev-script/views/base","text!ev-script/templates/library-type-select.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/library-type-select.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"changeHandler"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"change .source":"changeHandler"},render:function(){this.$el.html(this.template({id:this.id+"-select",sourceId:this.picker.model.get("sourceId")}))},changeHandler:function(e){this.picker.model.set({sourceId:this.$(".source").val()}),this.callback(),e.preventDefault()}})}),s("text!ev-script/templates/options.html",[],function(){return"<% collection.each(function(item) { %>\n    <option value=\"<%= item.id %>\" <% if (selectedId === item.id) { print('selected=\"selected\"'); } %>><%- item.get('Name') %></option>\n<% }); %>\n"}),s("ev-script/views/organization-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("organizationId")||this.auth.getUser().get("OrganizationID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),s("ev-script/collections/base",["require","jquery","underscore","backbone","ev-script/util/cache"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),s=e("ev-script/util/cache");return n.Collection.extend({initialize:function(e,t){this.requiresAuth=!0,this.appId=t.appId,this.config=s.getAppConfig(this.appId),this.auth=s.getAppAuth(this.appId),this.info=s.getAppInfo(this.appId)},model:n.Model.extend({idAttribute:"ID"}),getCached:function(e){},setCached:function(e,t){},clearCache:function(e){},parse:function(e){return e.Data},fetch:function(e){return e&&e.success&&(e.success=i.wrap(e.success,i.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),n.Collection.prototype.fetch.call(this,e)},sync:function(e,s,r){if(i.defaults(r||(r={}),{xhrFields:{withCredentials:!0}}),"read"===e){var a=this.getCached(r.cacheKey);if(a){var o=t.Deferred();return r.success&&o.done(r.success),o.resolve(a).promise()}return r.success=r.success||function(e,t,i){},r.success=i.wrap(r.success,i.bind(function(e){this.setCached(r.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),n.Collection.prototype.sync.call(this,e,s,r)}return n.Collection.prototype.sync.call(this,e,s,r)}})}),s("ev-script/collections/organizations",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),i=e("ev-script/util/cache");return t.extend({initialize:function(e,i){t.prototype.initialize.call(this,e,i)},_cache:function(e,t){var n=this.auth.getUser(),s=n?i.getUserCache(this.config.ensembleUrl,n.id):null;return s?s[t?"set":"get"](e,t):null},getCached:function(e){return this._cache("orgs")},setCached:function(e,t){return this._cache("orgs",t)},url:function(){var e=this.config.ensembleUrl+"/api/Organizations",t="PageSize=9999",i="PageIndex=1",n=e+"?"+t+"&"+i;return this.config.urlCallback?this.config.urlCallback(n):n}})}),s("ev-script/views/library-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("libraryId")||this.auth.getUser().get("LibraryID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),s("ev-script/collections/libraries",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),i=e("ev-script/util/cache");return t.extend({initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.filterValue=i.organizationId||""},_cache:function(e,t){var n=null,s=this.auth.getUser(),r=s?i.getUserCache(this.config.ensembleUrl,s.id):null;if(r){var a=r.get("libs");a||r.set("libs",a=new i.Cache),n=a[t?"set":"get"](e,t)}return n},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Libraries",t="PageSize=9999",i="PageIndex=1",n="FilterOn=OrganizationId",s="FilterValue="+encodeURIComponent(this.filterValue),r=e+"?"+t+"&"+i+"&"+n+"&"+s;return this.config.urlCallback?this.config.urlCallback(r):r}})}),s("text!ev-script/templates/unit-selects.html",[],function(){return'<div id="<%= formId %>" class="unit-selects">\n    <label for="<%= orgSelectId %>">Organization:</label><select id="<%= orgSelectId %>" class="form-select organizations" title="Select Organization"></select><label for="<%= libSelectId %>">Library:</label><select id="<%= libSelectId %>" class="form-select libraries" title="Select Library"></select><input type="submit" value="Go" class="form-submit" />\n</div>\n'}),s("ev-script/views/unit-selects",["require","jquery","underscore","ev-script/views/base","ev-script/views/organization-select","ev-script/collections/organizations","ev-script/views/library-select","ev-script/collections/libraries","text!ev-script/templates/unit-selects.html"],function(e){"use strict";var t=(e("jquery"),e("underscore")),i=e("ev-script/views/base"),n=e("ev-script/views/organization-select"),s=e("ev-script/collections/organizations"),r=e("ev-script/views/library-select"),a=e("ev-script/collections/libraries");return i.extend({template:t.template(e("text!ev-script/templates/unit-selects.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"loadOrgs","loadLibraries","changeOrganization","changeLibrary"),this.picker=e.picker,this.id=e.id,this.$el.html(this.template({formId:this.id+"-unit-selects",orgSelectId:this.id+"-org-select",libSelectId:this.id+"-lib-select"})),this.orgSelect=new n({el:this.$(".organizations"),picker:this.picker,appId:this.appId,collection:new s({},{appId:this.appId})}),this.libSelect=new r({el:this.$(".libraries"),picker:this.picker,appId:this.appId,collection:new a({},{appId:this.appId})})},events:{"change select.organizations":"changeOrganization","change select.libraries":"changeLibrary"},changeOrganization:function(e){this.picker.model.set({organizationId:e.target.value}),this.loadLibraries()},changeLibrary:function(e){this.picker.model.set({libraryId:e.target.value})},loadOrgs:function(){var e=new s({},{appId:this.appId});e.fetch({picker:this.picker,success:t.bind(function(e,t,i){this.orgSelect.collection.reset(e.models)},this),error:t.bind(function(e,i,n){this.ajaxError(i,t.bind(function(){this.loadOrgs()},this))},this)})},loadLibraries:function(){var e=this.picker.model.get("organizationId"),i=new a({},{organizationId:e,appId:this.appId});i.fetch({picker:this.picker,cacheKey:e,success:t.bind(function(e,t,i){this.libSelect.collection.reset(e.models)},this),error:t.bind(function(e,i,n){this.ajaxError(i,t.bind(function(){this.loadLibraries()},this))},this)})}})}),function(e){"use strict";"function"==typeof s&&s.amd?s("ev-scroll-loader",["jquery"],e):e("object"==typeof module&&"object"==typeof module.exports?n("jquery"):jQuery)}(function(e){"use strict";var t={onScrolled:function(){}},i={init:function(i){var n=e.extend({},t,i);return this.each(function(){var t=e(this),i=t.wrap('<div class="scrollWrap"/>').closest(".scrollWrap");t.addClass("scroll-content"),i.append('<div class="loader"></div>'),i.css({position:"relative",height:n.height?"number"==typeof n.height?n.height+"px":n.height:"100%","max-height":t[0].scrollHeight+"px","overflow-y":"scroll"}),i.scroll(function(){i.scrollTop()>=i[0].scrollHeight-i.height()-1&&n.onScrolled.call(t)})})},showLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).show(),this},hideLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).hide(),this}};e.fn.evScrollLoader=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:i.init.apply(this,arguments)}}),s("text!ev-script/templates/results.html",[],function(){return'<div class="total">Search returned <%= totalResults %> results.</div>\n<div class="results">\n    <table class="content-list"></table>\n</div>\n'}),s("text!ev-script/templates/no-results.html",[],function(){return'<tr class="odd"><td colspan="2">No results available.</td></tr>\n'}),s("ev-script/views/results",["require","jquery","underscore","ev-script/views/base","ev-scroll-loader","text!ev-script/templates/results.html","text!ev-script/templates/no-results.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/base");return e("ev-scroll-loader"),n.extend({resultsTemplate:i.template(e("text!ev-script/templates/results.html")),emptyTemplate:i.template(e("text!ev-script/templates/no-results.html")),initialize:function(e){n.prototype.initialize.call(this,e),i.bindAll(this,"render","loadMore","addHandler","previewItem","setHeight","resizeResults"),this.picker=e.picker,this.appId=e.appId,this.loadLock=!1},events:{"click a.action-preview":"previewItem"},getItemHtml:function(e,t){return this.resultTemplate?this.resultTemplate({item:e,index:t}):void 0},previewItem:function(e){var i=e.currentTarget,n=t(i).attr("rel"),s=this.collection.get(n),r={id:n,content:s.toJSON(),appId:this.appId};new this.previewClass({
el:i,model:new this.modelClass(r),appId:this.appId,picker:this.picker});e.stopPropagation(),e.preventDefault()},loadMore:function(){this.collection.hasMore&&!this.loadLock&&(this.loadLock=!0,this.collection.fetch({remove:!1,picker:this.picker,success:i.bind(function(e,t,n){i.size(t.Data)<this.config.pageSize?(e.hasMore=!1,this.$scrollLoader.evScrollLoader("hideLoader")):(e.hasMore=!0,e.pageIndex+=1),this.loadLock=!1},this),error:i.bind(function(e,t,n){this.ajaxError(t,i.bind(function(){this.loadMore()},this)),this.loadLock=!1},this)}))},addHandler:function(e,i,n){var s=t(this.getItemHtml(e,i.indexOf(e)));this.decorate(s),this.$(".content-list").append(s)},decorate:function(e){},render:function(){this.$el.html(this.resultsTemplate({totalResults:this.collection.totalResults})),this.$total=this.$(".total"),this.$results=this.$(".results"),this.resizeResults();var e=this.$(".content-list");this.collection.isEmpty()?e.append(this.emptyTemplate()):this.collection.each(function(i,n){var s=t(this.getItemHtml(i,n));this.decorate(s),e.append(s)},this);var i=this.config.scrollHeight;this.$scrollLoader=e.evScrollLoader({height:i,onScrolled:this.loadMore}),this.collection.hasMore||this.$scrollLoader.evScrollLoader("hideLoader"),this.collection.off("add",this.addHandler).on("add",this.addHandler)},setHeight:function(e){this.$el.height(e),this.resizeResults()},resizeResults:function(){this.config.fitToParent&&this.$results&&(this.$results.height(this.$el.height()-this.$total.outerHeight(!0)),this.$(".resultItem").each(i.bind(function(e,i){this.decorate(t(i))},this)))}})}),s("ev-script/views/preview",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","jquery-ui"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/base"),s=e("ev-script/models/video-settings");return e("jquery-ui"),n.extend({initialize:function(e){n.prototype.initialize.call(this,e);var r,a,o,l,c=t('<div class="dialogWrap ev-preview"></div>'),h=this.model.get("content")||{Title:this.model.get("id")},u=new this.model.constructor(this.model.toJSON()),d={width:this.model.get("width"),height:this.model.get("height")},p={},f=50,v=this.info.useLegacyEmbeds()?140:100;if(this.$el.after(c),p.width=Math.min(d.width+f,t(window).width()-this.config.dialogMargin),p.height=Math.min(d.height+v,t(window).height()-this.config.dialogMargin),this.model instanceof s){for(a=p.width-f,o=p.height-v;d.width>a||d.height>o;)r=d.width>a?a/d.width:o/d.height,d.width=d.width*r,d.height=d.height*r;d.width=Math.ceil(d.width),d.height=Math.ceil(d.height)}u.set("width",d.width),u.set("height",d.height),l=c.dialog({title:this.unencode(h.Title||h.Name),modal:!0,width:p.width,height:p.height,draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:i.bind(function(e,t){var i=new this.embedClass({model:u,appId:this.appId});c.html(i.$el)},this),close:function(e,t){c.dialog("destroy").remove()}})}})}),s("text!ev-script/templates/video-embed.html",[],function(){return'<iframe src="<%- ensembleUrl %>/app/plugin/embed.aspx?ID=<%- id %>&autoPlay=<%- autoPlay %>&displayTitle=<%- displayTitle %>&displaySharing=<%- displaySharing %>&displayAnnotations=<%- displayAnnotations %>&displayCaptionSearch=<%- displayCaptionSearch %>&displayAttachments=<%- displayAttachments %>&displayLinks=<%- displayLinks %>&displayMetaData=<%- displayMetaData %>&displayDateProduced=<%- displayDateProduced %>&displayEmbedCode=<%- displayEmbedCode %>&displayDownloadIcon=<%- displayDownloadIcon %>&hideControls=true&showCaptions=<%- showCaptions %>&width=<%- width %>&height=<%- height %>&isNewPluginEmbed=true"\n        frameborder="0"\n        width="<%- width %>"\n        height="<%- (parseInt(height, 10) + 40) %>"\n        allowfullscreen>\n</iframe>\n'}),s("text!ev-script/templates/video-embed-legacy.html",[],function(){return'<iframe src="<%- ensembleUrl %>/app/plugin/embed.aspx?ID=<%- id %>&autoPlay=<%- autoPlay %>&displayTitle=<%- displayTitle %>&hideControls=<%- hideControls %>&showCaptions=<%- showCaptions %>&width=<%- width %>&height=<%- height %>"\n        frameborder="0"\n        style="width: <%- width %>px;height:<%- (parseInt(height, 10) + 56) %>px;"\n        allowfullscreen>\n</iframe>\n'}),s("ev-script/views/video-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/video-embed.html","text!ev-script/templates/video-embed-legacy.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/video-embed.html")),legacyTemplate:t.template(e("text!ev-script/templates/video-embed-legacy.html")),initialize:function(e){i.prototype.initialize.call(this,e);var t=this.model.get("width")?this.model.get("width"):"640",n=this.model.get("height")?this.model.get("height"):"360",s=this.model.get("showtitle"),r="";r=this.info.useLegacyEmbeds()?this.legacyTemplate({ensembleUrl:this.config.ensembleUrl,id:this.model.get("id"),autoPlay:this.model.get("autoplay"),displayTitle:s,hideControls:this.model.get("hidecontrols"),showCaptions:this.model.get("showcaptions"),width:t,height:s?n+25:n}):this.template({ensembleUrl:this.config.ensembleUrl,id:this.model.get("id"),autoPlay:this.model.get("autoplay"),displayTitle:s,displaySharing:this.model.get("socialsharing"),displayAnnotations:this.model.get("annotations"),displayCaptionSearch:this.model.get("captionsearch"),displayAttachments:this.model.get("attachments"),displayLinks:this.model.get("links"),displayMetaData:this.model.get("metadata"),displayDateProduced:this.model.get("dateproduced"),displayEmbedCode:this.model.get("embedcode"),displayDownloadIcon:this.model.get("download"),showCaptions:this.model.get("showcaptions"),width:t,height:n}),this.$el.html(r)}})}),s("ev-script/models/base",["require","jquery","underscore","backbone","ev-script/util/cache","ev-script/collections/base"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),s=e("ev-script/util/cache");e("ev-script/collections/base");return n.Model.extend({initialize:function(e,t){this.appId=t.appId,this.config=s.getAppConfig(this.appId)},getCached:function(){},setCached:function(){},fetch:function(e){return e&&e.success&&(e.success=i.wrap(e.success,i.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),n.Model.prototype.fetch.call(this,e)},sync:function(e,s,r){if(i.defaults(r||(r={}),{xhrFields:{withCredentials:!0}}),"read"===e){var a=this.getCached(r.cacheKey);if(a){var o=t.Deferred();return r.success&&o.done(r.success),o.resolve(a).promise()}return r.success=r.success||function(e,t,i){},r.success=i.wrap(r.success,i.bind(function(e){this.setCached(r.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),n.Model.prototype.sync.call(this,e,s,r)}return n.Model.prototype.sync.call(this,e,s,r)}})}),s("ev-script/models/video-encoding",["require","backbone","ev-script/models/base","underscore","ev-script/util/cache"],function(e){"use strict";var t=e("backbone"),i=e("ev-script/models/base"),n=e("underscore");e("ev-script/util/cache");return i.extend({idAttribute:"videoID",initialize:function(e,t){i.prototype.initialize.call(this,e,t),this.requiresAuth=!1},getCached:function(e){},setCached:function(e,t){},url:function(){var e=this.config.ensembleUrl+"/app/api/content/show.json/"+this.get("fetchId");return this.config.urlCallback?this.config.urlCallback(e):e},getDims:function(){var e=this.get("dimensions")||"640x360",t=e.split("x"),i=[];return i[0]=this.isAudio()?400:parseInt(t[0],10)||640,i[1]=this.isAudio()?26:parseInt(t[1],10)||360,i},getRatio:function(){var e=this.getDims();return e[0]/e[1]},getWidth:function(){return this.getDims()[0]},getHeight:function(){return this.getDims()[1]},isAudio:function(){return/^audio/i.test(this.get("contentType")||"")},parse:function(e){return n.isArray(e.dataSet.encodings)?n.max(e.dataSet.encodings,function(e,t,i){return parseInt(e.bitRate,10)}):e.dataSet.encodings},sync:function(e,i,s){return n.extend(s,{dataFilter:function(e){var t=e.match(/\{[\s\S]*\}/);return t?t[0]:e}}),t.sync.call(this,e,i,s)}})}),s("ev-script/views/video-preview",["require","underscore","ev-script/views/preview","ev-script/views/video-embed","ev-script/models/video-encoding"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/preview"),n=e("ev-script/views/video-embed"),s=e("ev-script/models/video-encoding");return i.extend({embedClass:n,initialize:function(e){this.appId=e.appId,this.encoding=e.encoding||new s({fetchId:this.model.id},{appId:this.appId}),this.picker=e.picker;var n=t.bind(function(){this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()}),i.prototype.initialize.call(this,e)},this);this.encoding.isNew()?this.encoding.fetch({success:n,picker:this.picker}):n()}})}),function(e){var t=/(\s*\S+|\s)$/;e.truncate=function(t,i){return e("<div></div>").append(t).truncate(i).html()},e.fn.truncate=function(i){e.isNumeric(i)&&(i={length:i});var n=e.extend({},e.truncate.defaults,i);return this.each(function(){var i=e(this);n.noBreaks&&i.find("br").replaceWith(" ");var s=i.text(),r=s.length-n.length;n.stripTags&&i.text(s),n.words&&r>0&&(r=s.length-s.slice(0,n.length).replace(t,"").length-1),0>r||!r&&!n.truncated||e.each(i.contents().get().reverse(),function(t,i){var s=e(i),a=s.text(),o=a.length;return r>=o?(n.truncated=!0,r-=o,void s.remove()):3===i.nodeType?(e(i.splitText(o-r-1)).replaceWith(n.ellipsis),!1):(s.truncate(e.extend(n,{length:o-r})),!1)})})},e.truncate.defaults={stripTags:!1,words:!1,noBreaks:!1,length:1/0,ellipsis:"…"}}(jQuery),s("jquery-truncate-html",function(){}),s("text!ev-script/templates/video-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %> resultItem">\n    <td class="content-actions">\n        <div class="thumbnail-wrap">\n            <img class="thumbnail" src="<%= item.get(\'ThumbnailUrl\').replace(/width=100/i, \'width=200\') %>" alt="<%= item.get(\'Title\') %> thumbnail image"/>\n            <% if (item.get(\'IsCaptioned\')) { %>\n            <i class="ccbadge fa fa-cc fa-lg text-dark5" title="CC" alt="CC"></i>\n            <% } %>\n        </div>\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%= item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><i class="fa fa-plus-circle fa-lg"></i><span>Choose</span></a>\n            <a class="action-preview" href="#" title="Preview: <%= item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><i class="fa fa-play-circle fa-lg"></i><span>Preview: <%= item.get(\'Title\') %></span></a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <table class="content-item">\n            <tbody>\n                <tr class="title">\n                    <td colspan="2">\n                        <a class="action-preview" title="Preview: <%= item.get(\'Title\') %>" href="#" rel="<%= item.get(\'ID\') %>"><%= item.get(\'Title\') %></a>\n                    </td>\n                </tr>\n                <tr class="trunc"><td class="label">Description</td><td class="value"><%= item.get(\'Description\') %></td></tr>\n                <tr><td class="label">Date Added</td><td class="value"><%- new Date(item.get(\'AddedOn\')).toLocaleString() %></td></tr>\n                <tr class="trunc"><td class="label">Keywords</td><td class="value"><%= item.get(\'Keywords\') %></td></tr>\n                <tr><td class="label">Library</td><td class="value"><%- item.get(\'LibraryName\') %></td></tr>\n            </tbody>\n        </table>\n    </td>\n</tr>\n'}),s("ev-script/views/video-results",["require","jquery","underscore","ev-script/views/results","ev-script/models/video-settings","ev-script/views/video-preview","jquery-truncate-html","text!ev-script/templates/video-result.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/results"),s=e("ev-script/models/video-settings"),r=e("ev-script/views/video-preview");return e("jquery-truncate-html"),n.extend({modelClass:s,previewClass:r,resultTemplate:i.template(e("text!ev-script/templates/video-result.html")),initialize:function(e){n.prototype.initialize.call(this,e)},decorate:function(e){t(".trunc .value",e).each(function(e){var i,n,s=t(this),r=100,a=s.data("fullText")||s.html(),o=t.truncate(a,{length:r,stripTags:!0,noBreaks:!0});if(s.empty(),t(window).width()<1100&&a.length>r){s.data("fullText",a),i=t("<span>"+a+"</span>"),n=t("<span>"+o+"</span>");var l=t('<a href="#">Less</a>').click(function(e){i.hide(),n.show(),e.preventDefault()}),c=t('<a href="#">More</a>').click(function(e){n.hide(),i.show(),e.preventDefault()});i.hide().append(l),n.append(c),s.append(n).append(i)}else s.append(a)})}})}),s("ev-script/collections/videos",["require","ev-script/collections/base","ev-script/util/cache","underscore"],function(e){"use strict";var t=e("ev-script/collections/base"),i=e("ev-script/util/cache"),n=e("underscore");return t.extend({initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.libraryId=i.libraryId||"",this.filterOn=i.filterOn||"",this.filterValue=i.filterValue||"",this.info.checkVersion(">=4.1.0")?this.sourceUrl="shared"===i.sourceId?"/api/SharedLibrary":"/api/MediaLibrary":this.sourceUrl="shared"===i.sourceId?"/api/SharedContent":"/api/Content",this.pageIndex=1},_cache:function(e,t){var n=null,s=this.auth.getUser(),r=s?i.getUserCache(this.config.ensembleUrl,s.id):null;if(r){var a=r.get("videos");a||r.set("videos",a=new i.Cache),n=a[t?"set":"get"](e,t)}return n},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},clearCache:function(){var e=this.auth.getUser(),t=e?i.getUserCache(this.config.ensembleUrl,e.id):null;t&&t.set("videos",null)},url:function(){var e=this.config.ensembleUrl+this.sourceUrl,t="PageSize="+this.config.pageSize,i="PageIndex="+this.pageIndex,n="FilterOn="+encodeURIComponent(this.filterOn),s="FilterValue="+encodeURIComponent(this.filterValue),r=e+"/"+this.libraryId+"?"+t+"&"+i+"&"+n+"&"+s;return this.config.urlCallback?this.config.urlCallback(r):r},parse:function(e){var t=e.Data;return n.each(t,function(e){e.Description=n.unescape(e.Description),e.Keywords=n.unescape(e.Keywords)}),t}})}),s("ev-script/collections/media-workflows",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),i=e("ev-script/util/cache");return t.extend({initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.filterValue=i.libraryId||""},_cache:function(e,t){var n=null,s=this.auth.getUser(),r=s?i.getUserCache(this.config.ensembleUrl,s.id):null;if(r){var a=r.get("workflows");a||r.set("workflows",a=new i.Cache),n=a[t?"set":"get"](e,t)}return n},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/MediaWorkflows",t="PageSize=9999",i="PageIndex=1",n="FilterOn=LibraryId",s="FilterValue="+encodeURIComponent(this.filterValue),r=e+"?"+t+"&"+i+"&"+n+"&"+s;return this.config.urlCallback?this.config.urlCallback(r):r},parse:function(e){return this.settings=e.Settings,e.Data}})}),s("ev-script/views/workflow-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.$el.html('<option value="-1">Loading...</option>'),this.render()},render:function(){var e=this.collection.findWhere({IsDefault:!0})||this.collection.at(0);this.$el.html(this.template({selectedId:e.id,collection:this.collection}))},getSelected:function(){return this.collection.get(this.$("option:selected").val())}})}),s("text!ev-script/templates/upload.html",[],function(){return'<form class="upload-form" method="POST" action="">\n    <select class="form-select" name="MediaWorkflowID"></select>\n    <div class="fieldWrap">\n        <label for="Title">Title *</label>\n        <input class="form-text" type="text" name="Title" id="Title" />\n    </div>\n    <div class="fieldWrap">\n        <label for="Description">Description</label>\n        <textarea class="form-text" name="Description" id="Description" />\n    </div>\n    <div class="upload"></div>\n</form>\n'}),s("ev-script/views/upload",["require","jquery","underscore","plupload","ev-script/views/base","backbone","ev-script/views/workflow-select","ev-script/models/video-settings","jquery.plupload.queue","text!ev-script/templates/upload.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("plupload"),s=e("ev-script/views/base"),r=(e("backbone"),e("ev-script/views/workflow-select"));e("ev-script/models/video-settings");return e("jquery.plupload.queue"),s.extend({template:i.template(e("text!ev-script/templates/upload.html")),events:{"change select":"handleSelect"},initialize:function(e){s.prototype.initialize.call(this,e),i.bindAll(this,"render","decorateUploader","closeDialog","handleSelect"),this.field=e.field,this.$anchor=this.$el,this.setElement(this.template()),this.$upload=this.$(".upload"),this.workflows=e.workflows,this.workflowSelect=new r({appId:this.appId,el:this.$("select")[0],collection:this.workflows}),this.render(),this.decorateUploader(),this.appEvents.on("hidePickers",this.closeDialog)},getWidth:function(){return Math.min(600,t(window).width()-this.config.dialogMargin)},getHeight:function(){return Math.min(400,t(window).height()-this.config.dialogMargin)},decorateUploader:function(){var e="",s=this.workflowSelect.getSelected(),r=parseInt(s.get("MaxUploadSize"),10);this.workflows.settings.SupportedVideo&&(e+=this.workflows.settings.SupportedVideo.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.workflows.settings.SupportedAudio&&(e+=this.workflows.settings.SupportedAudio.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.$upload.pluploadQueue()&&this.$upload.pluploadQueue().destroy(),this.$upload.pluploadQueue({url:this.workflows.settings.SubmitUrl,runtimes:"html5,html4,flash",max_file_size:r>0?r+"gb":"12gb",max_file_count:1,max_retries:5,chunk_size:"2mb",unique_names:!1,multiple_queues:!1,multi_selection:!1,drag_drop:!0,multipart:!0,flash_swf_url:this.config.pluploadFlashPath,preinit:{Init:i.bind(function(e,i){t(".plupload_container",this.$upload).removeAttr("title"),t(".plupload_add",this.$upload).text("Add file")},this),PostInit:i.bind(function(e,i){t(".plupload_droptext",this.$upload).text("Drag file here.")},this),UploadFile:i.bind(function(e,t){e.settings.multipart_params={Title:this.$("#Title").val(),Description:this.$("#Description").val(),MediaWorkflowID:this.$("select").val()}},this)},init:{StateChanged:i.bind(function(e){switch(e.state){case n.STARTED:e.state===n.STARTED&&(0===t(".plupload_cancel",this.$upload).length&&(this.$cancel=t('<a class="plupload_button plupload_cancel" href="#">Cancel upload</a>').insertBefore(t(".plupload_filelist_footer .plupload_clearer",this.$upload)).click(i.bind(function(){e.stop(),this.decorateUploader()},this))),this.$cancel&&this.$cancel.show());break;case n.STOPPED:this.$cancel&&this.$cancel.hide()}},this),BeforeUpload:i.bind(function(e,i){var n=this.$("#Title"),s=n.val();s&&""!==s.trim()||(n.focus(),e.stop(),t(".plupload_upload_status",this.$upload).hide(),t(".plupload_buttons",this.$upload).show())},this),FilesAdded:i.bind(function(t,s){var r=e.split(",");i.each(s,function(e){var s=e.name.split("."),a=s[s.length-1];i.contains(r,a.toLowerCase())||(t.removeFile(e),t.trigger("Error",{code:n.FILE_EXTENSION_ERROR,message:n.translate("File extension error."),file:e}))}),t.files.length>1&&t.splice(0,t.files.length-1)},this),UploadComplete:i.bind(function(){this.closeDialog()},this),FileUploaded:i.bind(function(e,t,i){this.appEvents.trigger("fileUploaded")},this)}}),this.$upload.pluploadQueue().bind("refresh",function(){t("div.upload > div.plupload").css({"z-index":"0"}),t(".plupload_button").css({"z-index":"1"})}),this.$upload.pluploadQueue().refresh()},closeDialog:function(){this.$dialog&&this.$dialog.dialog("close")},handleSelect:function(e){this.decorateUploader()},render:function(){var e=t('<div class="dialogWrap"></div>');this.$anchor.after(e),this.$dialog=e.dialog({title:"Upload Media to Ensemble",modal:!0,width:this.getWidth(),height:this.getHeight(),draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:i.bind(function(t,i){e.html(this.$el)},this),close:i.bind(function(t,i){this.$upload.pluploadQueue().destroy(),e.dialog("destroy").remove(),this.appEvents.off("hidePickers",this.closeDialog),this.$dialog=null},this)})}})}),s("ev-script/views/video-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/search","ev-script/views/library-type-select","ev-script/views/unit-selects","ev-script/views/video-results","ev-script/collections/videos","ev-script/collections/media-workflows","ev-script/views/upload"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/picker"),s=e("ev-script/views/search"),r=e("ev-script/views/library-type-select"),a=e("ev-script/views/unit-selects"),o=e("ev-script/views/video-results"),l=e("ev-script/collections/videos"),c=e("ev-script/collections/media-workflows"),h=e("ev-script/views/upload");return n.extend({initialize:function(e){n.prototype.initialize.call(this,e),i.bindAll(this,"loadVideos","loadWorkflows","changeLibrary","handleSubmit","uploadHandler");var l=i.bind(function(){this.loadVideos()},this);this.$filterBlock=this.$("div.ev-filter-block"),this.info.get("ApplicationVersion")&&(this.$record=t('<div class="ev-actions"><button type="button" class="action-record" title="Record"><i class="fa fa-circle fa-fw"></i><span>Record<span></button></div>').css("display","none"),this.$filterBlock.prepend(this.$record),this.$upload=t('<div class="ev-actions"><button type="button" class="action-upload" title="Upload"><i class="fa fa-upload fa-fw"></i><span>Upload<span></button></div>').css("display","none"),this.$filterBlock.prepend(this.$upload)),this.searchView=new s({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:l}),this.$filterBlock.prepend(this.searchView.$el),this.searchView.render(),this.typeSelectView=new r({id:this.id+"-type-select",tagName:"div",className:"ev-type-select",picker:this,appId:this.appId,callback:l}),this.$filterBlock.prepend(this.typeSelectView.$el),this.typeSelectView.render(),this.info.get("ApplicationVersion")&&(this.unitSelects=new a({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$filterBlock.prepend(this.unitSelects.$el)),this.resultsView=new o({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click .action-add":"chooseItem","click .action-upload":"uploadHandler","click .action-record":"recordHandler","change .unit-selects select.libraries":"changeLibrary","submit .unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadVideos(),this.loadWorkflows()},handleSubmit:function(e){this.loadVideos(),e.preventDefault()},uploadHandler:function(e){new h({appId:this.appId,field:this.field,workflows:this.workflows});e.preventDefault()},recordHandler:function(e){window.alert("record"),e.preventDefault()},showPicker:function(){n.prototype.showPicker.call(this),this.info.get("ApplicationVersion")?(this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()):(this.searchView.$('input[type="text"]').focus(),this.loadVideos())},loadVideos:function(){var e=t.trim(this.model.get("search").toLowerCase()),n=this.model.get("sourceId"),s=this.model.get("libraryId"),r=n+s+e,a=new l({},{sourceId:n,libraryId:s,filterOn:"",filterValue:e,appId:this.appId}),o=i.bind(function(){a.clearCache(),this.loadVideos()},this);a.fetch({picker:this,cacheKey:r,success:i.bind(function(e,t,n){var s=e.totalResults=parseInt(t.Pager.TotalRecords,10),r=i.size(t.Data);r===s?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render()},this),error:i.bind(function(e,t,n){this.ajaxError(t,i.bind(function(){this.loadVideos()},this))},this)}),this.appEvents.off("fileUploaded").on("fileUploaded",o)},loadWorkflows:function(){this.workflows=new c({},{appId:this.appId}),this.workflows.filterValue=this.model.get("libraryId"),this.workflows.fetch({cacheKey:this.workflows.filterValue,success:i.bind(function(e,t,i){var n=this.auth.getUser(),s=this.info.anthemEnabled&&n&&n.get("CanUseAnthem");e.isEmpty()?(this.$upload.css("display","none"),this.$record.css("display","none")):(this.$upload.css("display","inline-block"),s&&this.$record.css("display","inline-block")),this.resizeResults()},this),error:i.bind(function(e,t,n){this.ajaxError(t,i.bind(function(){this.loadWorkflows()},this))},this),reset:!0})},resizeResults:function(){this.config.fitToParent&&this.resultsView.setHeight(this.$el.height()-this.hider.$el.outerHeight(!0)-this.$filterBlock.outerHeight(!0))}})}),s("ev-script/views/settings",["require","underscore","ev-script/views/base","jquery-ui"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return e("jquery-ui"),i.extend({initialize:function(e){i.prototype.initialize.call(this,e),t.bindAll(this,"show","cancelHandler","submitHandler"),this.field=e.field},events:{submit:"submitHandler","click .action-cancel":"cancelHandler"},show:function(){this.render(),this.$el.dialog("open")},cancelHandler:function(e){this.$el.dialog("close"),e.preventDefault()},submitHandler:function(e){this.updateModel(),this.$el.dialog("close"),e.preventDefault()},updateModel:function(){}})}),s("text!ev-script/templates/video-settings.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size" <% if (isAudio) { print(\'disabled\'); } %> >\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div>\n            <div class="fieldWrap">\n                <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n                <label for="showtitle">Title</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="socialsharing" class="form-checkbox" <% if (model.get(\'socialsharing\')) { print(\'checked="checked"\'); } %> name="socialsharing" type="checkbox"/>\n                <label for="socialsharing">Social Tools</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="annotations" class="form-checkbox" <% if (model.get(\'annotations\')) { print(\'checked="checked"\'); } %> name="annotations" type="checkbox"/>\n                <label for="annotations">Annotations</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="captionsearch" class="form-checkbox" <% if (model.get(\'captionsearch\')) { print(\'checked="checked"\'); } %> name="captionsearch" type="checkbox"/>\n                <label for="captionsearch">Caption Search</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n                <label for="autoplay">Auto Play (PC Only)</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="attachments" class="form-checkbox" <% if (model.get(\'attachments\')) { print(\'checked="checked"\'); } %> name="attachments" type="checkbox"/>\n                <label for="attachments">Attachments</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="links" class="form-checkbox" <% if (model.get(\'links\')) { print(\'checked="checked"\'); } %> name="links" type="checkbox"/>\n                <label for="links">Links</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="metadata" class="form-checkbox" <% if (model.get(\'metadata\')) { print(\'checked="checked"\'); } %> name="metadata" type="checkbox"/>\n                <label for="metadata">Meta Data</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="dateproduced" class="form-checkbox" <% if (model.get(\'dateproduced\')) { print(\'checked="checked"\'); } %> name="dateproduced" type="checkbox"/>\n                <label for="dateproduced">Date Produced</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="embedcode" class="form-checkbox" <% if (model.get(\'embedcode\')) { print(\'checked="checked"\'); } %> name="embedcode" type="checkbox"/>\n                <label for="embedcode">Embed Code</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="download" class="form-checkbox" <% if (model.get(\'download\')) { print(\'checked="checked"\'); } %> name="download" type="checkbox"/>\n                <label for="download">Download Link</label>\n            </div>\n            <div class="fieldWrap">\n                <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox"/>\n                <label for="showcaptions">Captions "On" By Default</label>\n            </div>\n        </div>\n        <div class="form-actions">\n            <button type="submit" class="form-submit action-submit" value="Submit"><i class="fa fa-save"></i><span>Save</span></button>\n            <button type="button" class="form-submit action-cancel" value="Cancel"><i class="fa fa-times"></i><span>Cancel</span></button>\n        </div>\n    </fieldset>\n</form>\n'}),s("text!ev-script/templates/video-settings-legacy.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size" <% if (isAudio) { print(\'disabled\'); } %> >\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div class="fieldWrap">\n            <label for="showtitle">Show Title</label>\n            <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="autoplay">Auto Play</label>\n            <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="showcaptions">Show Captions</label>\n            <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="fieldWrap">\n            <label for="hidecontrols">Hide Controls</label>\n            <input id="hidecontrols" class="form-checkbox" <% if (model.get(\'hidecontrols\')) { print(\'checked="checked"\'); } %>  name="hidecontrols" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="form-actions">\n            <input type="button" class="form-submit action-cancel" value="Cancel"/>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),s("text!ev-script/templates/sizes.html",[],function(){return'<% _.each(sizes, function(size) { %>\n    <option value="<%= size %>" <% if (size === target) { print(\'selected="selected"\'); } %>><%= size %></option>\n<% }); %>\n';
}),s("ev-script/views/video-settings",["require","jquery","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/video-settings.html","text!ev-script/templates/video-settings-legacy.html","text!ev-script/templates/sizes.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/settings");return e("jquery-ui"),n.extend({template:i.template(e("text!ev-script/templates/video-settings.html")),legacyTemplate:i.template(e("text!ev-script/templates/video-settings-legacy.html")),sizesTemplate:i.template(e("text!ev-script/templates/sizes.html")),initialize:function(e){n.prototype.initialize.call(this,e),this.encoding=e.encoding,this.encoding.on("change:id",i.bind(function(){this.render()},this))},updateModel:function(){var e={showtitle:this.$("#showtitle").is(":checked"),autoplay:this.$("#autoplay").is(":checked"),showcaptions:this.$("#showcaptions").is(":checked"),hidecontrols:this.$("#hidecontrols").is(":checked")};this.info.useLegacyEmbeds()||(e=i.extend(e,{socialsharing:this.$("#socialsharing").is(":checked"),annotations:this.$("#annotations").is(":checked"),captionsearch:this.$("#captionsearch").is(":checked"),attachments:this.$("#attachments").is(":checked"),links:this.$("#links").is(":checked"),metadata:this.$("#metadata").is(":checked"),dateproduced:this.$("#dateproduced").is(":checked"),embedcode:this.$("#embedcode").is(":checked"),download:this.$("#download").is(":checked")}));var t=this.$("#size").val();if(t&&"original"!==t){var n=t.split("x");i.extend(e,{width:parseInt(n[0],10),height:parseInt(n[1],10)})}else this.encoding&&!this.encoding.isNew()&&i.extend(e,{width:this.encoding.getWidth(),height:this.encoding.getHeight()});this.field.model.set(e)},renderSize:function(){var e=this.field.model.get("width"),t=this.field.model.get("height"),n=16/9,s=["1280x720","1024x576","848x480","720x405","640x360","610x344","560x315","480x270","400x225","320x180","240x135","160x90"];e&&t?n=e/t:this.encoding.id&&(e=this.encoding.getWidth(),t=this.encoding.getHeight(),n=this.encoding.getRatio()),Math.ceil(10*n)/10===Math.ceil(4/3*10)/10&&(s=["1280x960","1024x770","848x636","720x540","640x480","610x460","560x420","480x360","400x300","320x240","240x180","160x120"]);var r=e+"x"+t;if(this.config.defaultVideoWidth){var a=i.find(s,i.bind(function(e){return new RegExp("^"+this.config.defaultVideoWidth).test(e)},this));r=a||r}this.$(".size").append(this.sizesTemplate({sizes:s,target:r}))},render:function(){var e="";e=this.info.useLegacyEmbeds()?this.legacyTemplate({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio()}):this.template({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio()}),this.$el.html(e),this.encoding&&!this.encoding.isAudio()&&this.renderSize();var i=this.field.model.get("content");this.$el.dialog({title:this.unencode(i?i.Title:this.field.model.get("id")),modal:!0,autoOpen:!1,draggable:!1,resizable:!1,dialogClass:"ev-dialog",width:Math.min(680,t(window).width()-this.config.dialogMargin),height:Math.min(240,t(window).height()-this.config.dialogMargin)})}})}),s("text!ev-script/templates/playlist-embed.html",[],function(){return'<iframe src="<%- ensembleUrl %>/app/plugin/embed.aspx?DestinationID=<%- modelId %>&playlistEmbed=true&isNewPluginEmbed=true&hideControls=true&displayTitle=true&displayEmbedCode=<%- displayEmbedCode %>&displayStatistics=<%- displayStatistics %>&displayVideoDuration=<%- displayDuration %>&displayAttachments=<%- displayAttachments %>&displayAnnotations=<%- displayAnnotations %>&displayLinks=<%- displayLinks %>&displayCredits=<%- displayCredits %>&displaySharing=<%- displaySharing %>&autoPlay=<%- autoPlay %>&showCaptions=<%- showCaptions %>&displayDateProduced=<%- displayDateProduced %>&audioPreviewImage=<%- audioPreviewImage %>&displayCaptionSearch=<%- displayCaptionSearch %>&<% if (isShowcase) { print(showcaseParams); } else { print(playlistParams); } %>"\n        frameborder="0"\n        style="width:<%- width %>px;height:<%- height %>px;"\n        width="<%- width %>"\n        height="<%- height %>"\n        allowfullscreen>\n</iframe>\n'}),s("text!ev-script/templates/playlist-embed-legacy.html",[],function(){return'<iframe src="<%- ensembleUrl %>/app/plugin/embed.aspx?DestinationID=<%- modelId %>"\n        frameborder="0"\n        style="width:<%- width %>px;height:<%- height %>px;"\n        width="<%- width %>"\n        height="<%- height %>"\n        allowfullscreen>\n</iframe>\n'}),s("text!ev-script/templates/playlist-embed-playlist-params.html",[],function(){return"orderBy=<%- playlistSortBy %>&orderByDirection=<%- playlistSortDirection %>\n"}),s("text!ev-script/templates/playlist-embed-showcase-params.html",[],function(){return"displayShowcase=true<% if (categoryList) { %>&displayCategoryList=true&categoryOrientation=<%- categoryOrientation %><% } %>\n"}),s("ev-script/views/playlist-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/playlist-embed.html","text!ev-script/templates/playlist-embed-legacy.html","text!ev-script/templates/playlist-embed-playlist-params.html","text!ev-script/templates/playlist-embed-showcase-params.html"],function(e){"use strict";var t=e("underscore"),i=e("ev-script/views/base");return i.extend({template:t.template(e("text!ev-script/templates/playlist-embed.html")),legacyTemplate:t.template(e("text!ev-script/templates/playlist-embed-legacy.html")),playlistParamsTemplate:t.template(e("text!ev-script/templates/playlist-embed-playlist-params.html")),showcaseParamsTemplate:t.template(e("text!ev-script/templates/playlist-embed-showcase-params.html")),initialize:function(e){i.prototype.initialize.call(this,e);var n="";if(this.info.useLegacyEmbeds())n=this.legacyTemplate({modelId:this.model.get("id"),width:this.model.get("width"),height:this.model.get("height"),ensembleUrl:this.config.ensembleUrl});else{var s={modelId:this.model.get("id"),width:this.model.get("width"),height:this.model.get("height"),ensembleUrl:this.config.ensembleUrl,displayEmbedCode:this.model.get("embedcode"),displayStatistics:this.model.get("statistics"),displayDuration:this.model.get("duration"),displayAttachments:this.model.get("attachments"),displayAnnotations:this.model.get("annotations"),displayLinks:this.model.get("links"),displayCredits:this.model.get("credits"),displaySharing:this.model.get("socialsharing"),autoPlay:this.model.get("autoplay"),showCaptions:this.model.get("showcaptions"),displayDateProduced:this.model.get("dateproduced"),audioPreviewImage:this.model.get("audiopreviewimage"),displayCaptionSearch:this.model.get("captionsearch")};if("showcase"===this.model.get("layout")){var r=this.model.get("showcaseLayout");s=t.extend(s,{isShowcase:!0,showcaseParams:this.showcaseParamsTemplate({categoryList:r.categoryList,categoryOrientation:r.categoryOrientation})})}else{var a=this.model.get("playlistLayout");s=t.extend(s,{isShowcase:!1,playlistParams:this.playlistParamsTemplate({playlistSortBy:a.playlistSortBy,playlistSortDirection:a.playlistSortDirection})})}n=this.template(s)}this.$el.html(n)}})}),s("ev-script/views/playlist-preview",["require","ev-script/views/preview","ev-script/views/playlist-embed"],function(e){"use strict";var t=e("ev-script/views/preview"),i=e("ev-script/views/playlist-embed");return t.extend({initialize:function(e){t.prototype.initialize.call(this,e)},embedClass:i})}),s("text!ev-script/templates/playlist-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <i class="fa fa-plus-circle fa-lg"></i><span>Choose</span>\n            </a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <i class="fa fa-play-circle fa-lg"></i><span>Preview: <%- item.get(\'Name\') %></span>\n            </a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <% if (item.get(\'IsSecure\')) { print(\'<span class="item-security"><i class="fa fa-lock fa-lg"></i></span>\'); } %>\n        <span><%- item.get(\'Name\') %></span>\n    </td>\n</tr>\n'}),s("ev-script/views/playlist-results",["require","underscore","jquery","ev-script/views/results","ev-script/models/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/playlist-result.html"],function(e){"use strict";var t=e("underscore"),i=(e("jquery"),e("ev-script/views/results")),n=e("ev-script/models/playlist-settings"),s=e("ev-script/views/playlist-preview");return i.extend({modelClass:n,previewClass:s,resultTemplate:t.template(e("text!ev-script/templates/playlist-result.html")),initialize:function(e){i.prototype.initialize.call(this,e)}})}),s("ev-script/collections/playlists",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),i=e("ev-script/util/cache");return t.extend({initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.libraryId=i.libraryId||"",this.filterValue=i.filterValue||"",this.pageIndex=1},_cache:function(e,t){var n=null,s=this.auth.getUser(),r=s?i.getUserCache(this.config.ensembleUrl,s.id):null;if(r){var a=r.get("playlists");a||r.set("playlists",a=new i.Cache),n=a[t?"set":"get"](e,t)}return n},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e,t,i,n=this.config.ensembleUrl+"/api/Playlists",s="PageSize="+this.config.pageSize,r="PageIndex="+this.pageIndex;return this.info.get("ApplicationVersion")?(t="FilterOn=Name",i="FilterValue="+encodeURIComponent(this.filterValue),e=n+"/"+encodeURIComponent(this.libraryId)+"?"+s+"&"+r+(this.filterValue?"&"+t+"&"+i:"")):(t="FilterOn=LibraryId",i="FilterValue="+encodeURIComponent(this.libraryId),e=n+"?"+s+"&"+r+"&"+t+"&"+i),this.config.urlCallback?this.config.urlCallback(e):e}})}),s("ev-script/views/playlist-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/unit-selects","ev-script/views/search","ev-script/views/playlist-results","ev-script/collections/playlists"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/picker"),s=e("ev-script/views/unit-selects"),r=e("ev-script/views/search"),a=e("ev-script/views/playlist-results"),o=e("ev-script/collections/playlists");return n.extend({initialize:function(e){n.prototype.initialize.call(this,e),i.bindAll(this,"loadPlaylists","changeLibrary","handleSubmit"),this.$filterBlock=this.$("div.ev-filter-block"),this.info.get("ApplicationVersion")&&(this.searchView=new r({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:i.bind(function(){this.loadPlaylists()},this)}),this.$filterBlock.prepend(this.searchView.$el),this.searchView.render()),this.unitSelects=new s({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$filterBlock.prepend(this.unitSelects.$el),this.resultsView=new a({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click a.action-add":"chooseItem","change .unit-selects select.libraries":"changeLibrary","submit .unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadPlaylists()},handleSubmit:function(e){this.loadPlaylists(),e.preventDefault()},showPicker:function(){n.prototype.showPicker.call(this),this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()},loadPlaylists:function(){var e=t.trim(this.model.get("search").toLowerCase()),n=this.model.get("libraryId"),s=new o({},{libraryId:n,filterValue:e,appId:this.appId});s.fetch({picker:this,cacheKey:n+e,success:i.bind(function(e,t,n){var s=e.totalResults=parseInt(t.Pager.TotalRecords,10),r=i.size(t.Data);r===s?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render(),this.resizeResults()},this),error:i.bind(function(e,t,n){this.ajaxError(t,i.bind(function(){this.loadPlaylists()},this))},this)})},resizeResults:function(){this.config.fitToParent&&this.resultsView.setHeight(this.$el.height()-this.hider.$el.outerHeight(!0)-this.$filterBlock.outerHeight(!0))}})}),s("text!ev-script/templates/playlist-settings.html",[],function(){return'<form>\n    <fieldset>\n        <div class="accordion">\n            <h4>Choose Layout</h4>\n            <div>\n                <div class="fieldWrap">\n                    <input id="playlist" class="form-radio" <% if (model.get(\'layout\') === \'playlist\') { print(\'checked="checked"\'); } %> name="layout" value="playlist" type="radio"/>\n                    <label for="playlist">Playlist</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="showcase" class="form-radio" <% if (model.get(\'layout\') === \'showcase\') { print(\'checked="checked"\'); } %> name="layout" value="showcase" type="radio"/>\n                    <label for="showcase">Showcase</label>\n                </div>\n            </div>\n            <h4>Layout Options</h4>\n            <div>\n                <div class="playlistOptions" <% if (model.get(\'layout\') === \'showcase\') { print(\'style="display:none;"\'); } %>>\n                    <div class="fieldWrap">\n                        <label for="playlistSortBy">Sort By</label>\n                        <select id="playlistSortBy" class="form-select">\n                            <option value="videoDate" <% if (model.get(\'playlistLayout\').playlistSortBy === \'videoDate\') { print(\'selected="selected"\'); } %>>Date Added</option>\n                            <option value="videoDateProduced" <% if (model.get(\'playlistLayout\').playlistSortBy === \'videoDateProduced\') { print(\'selected="selected"\'); } %>>Date Produced</option>\n                            <option value="videoDescription" <% if (model.get(\'playlistLayout\').playlistSortBy === \'videoDescription\') { print(\'selected="selected"\'); } %>>Description</option>\n                            <option value="videoTitle" <% if (model.get(\'playlistLayout\').playlistSortBy === \'videoTitle\') { print(\'selected="selected"\'); } %>>Title</option>\n                            <option value="videoDuration" <% if (model.get(\'playlistLayout\').playlistSortBy === \'videoDuration\') { print(\'selected="selected"\'); } %>>Duration</option>\n                            <option value="videoKeywords" <% if (model.get(\'playlistLayout\').playlistSortBy === \'videoKeywords\') { print(\'selected="selected"\'); } %>>Keywords</option>\n                            <!-- <option value="videoCustomPosition">Custom Order</option> -->\n                        </select>\n                    </div>\n                    <div>\n                        <div class="fieldWrap">\n                            <input id="playlistSortDirectionAsc" class="form-radio" <% if (model.get(\'playlistLayout\').playlistSortDirection === \'asc\') { print(\'checked="checked"\'); } %> name="playlistSortDirection" value="asc" type="radio"/>\n                            <label for="playlist">Ascending</label>\n                        </div>\n                        <div class="fieldWrap">\n                            <input id="playlistSortDirectionDesc" class="form-radio" <% if (model.get(\'playlistLayout\').playlistSortDirection === \'desc\') { print(\'checked="checked"\'); } %> name="playlistSortDirection" value="desc" type="radio"/>\n                            <label for="playlist">Descending</label>\n                        </div>\n                    </div>\n                </div>\n                <div class="showcaseOptions" <% if (model.get(\'layout\') === \'playlist\') { print(\'style="display:none;"\'); } %>>\n<!--\n                    <div class="fieldWrap">\n                        <input id="featuredContent" class="form-checkbox" type="checkbox" name="featuredContent" <% if (model.get(\'showcaseLayout\').featuredContent) { print(\'checked="checked"\'); } %>/>\n                        <label for="featuredContent">Featured Content</label>\n                    </div>\n -->\n                    <div class="fieldWrap">\n                        <input id="categoryList" class="form-checkbox" type="checkbox" name="categoryList" <% if (model.get(\'showcaseLayout\').categoryList) { print(\'checked="checked"\'); } %>/>\n                        <label for="categoryList">Category List</label>\n                    </div>\n                    <div>\n                        <div class="fieldWrap">\n                            <input id="categoryOrientationHorizontal" class="form-radio" <% if (model.get(\'showcaseLayout\').categoryOrientation === \'horizontal\') { print(\'checked="checked"\'); } %> <% if (!model.get(\'showcaseLayout\').categoryList) { print(\'disabled\'); } %> name="categoryOrientation" value="horizontal" type="radio"/>\n                            <label for="playlist">Horizontal</label>\n                        </div>\n                        <div class="fieldWrap">\n                            <input id="categoryOrientationVertical" class="form-radio" <% if (model.get(\'showcaseLayout\').categoryOrientation === \'vertical\') { print(\'checked="checked"\'); } %> <% if (!model.get(\'showcaseLayout\').categoryList) { print(\'disabled\'); } %> name="categoryOrientation" value="vertical" type="radio"/>\n                            <label for="playlist">Vertical</label>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <h4>Content Details</h4>\n            <div>\n                <div class="fieldWrap">\n                    <input id="embedcode" class="form-checkbox" <% if (!isSecure && model.get(\'embedcode\')) { print(\'checked="checked"\'); } %> name="embedcode" type="checkbox" <% if (isSecure) { print(\'disabled\') } %> />\n                    <label for="embedcode">Embed Code</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="statistics" class="form-checkbox" <% if (model.get(\'statistics\')) { print(\'checked="checked"\'); } %> name="statistics" type="checkbox"/>\n                    <label for="statistics">Statistics</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="duration" class="form-checkbox" <% if (model.get(\'duration\')) { print(\'checked="checked"\'); } %> name="duration" type="checkbox"/>\n                    <label for="duration">Duration</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="attachments" class="form-checkbox" <% if (model.get(\'attachments\')) { print(\'checked="checked"\'); } %> name="attachments" type="checkbox"/>\n                    <label for="attachments">Attachments</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="annotations" class="form-checkbox" <% if (model.get(\'annotations\')) { print(\'checked="checked"\'); } %> name="annotations" type="checkbox"/>\n                    <label for="annotations">Annotations</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="links" class="form-checkbox" <% if (model.get(\'links\')) { print(\'checked="checked"\'); } %> name="links" type="checkbox"/>\n                    <label for="links">Links</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="credits" class="form-checkbox" <% if (model.get(\'credits\')) { print(\'checked="checked"\'); } %> name="credits" type="checkbox"/>\n                    <label for="credits">Credits</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="socialsharing" class="form-checkbox" <% if (!isSecure && model.get(\'socialsharing\')) { print(\'checked="checked"\'); } %> name="socialsharing" type="checkbox" <% if (isSecure) { print(\'disabled\') } %> />\n                    <label for="socialsharing">Social Tools</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n                    <label for="autoplay">Auto Play (PC Only)</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox"/>\n                    <label for="showcaptions">Captions "On" By Default</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="dateproduced" class="form-checkbox" <% if (model.get(\'dateproduced\')) { print(\'checked="checked"\'); } %> name="dateproduced" type="checkbox"/>\n                    <label for="dateproduced">Date Produced</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="audiopreviewimage" class="form-checkbox" <% if (model.get(\'audiopreviewimage\')) { print(\'checked="checked"\'); } %> name="audiopreviewimage" type="checkbox"/>\n                    <label for="audiopreviewimage">Audio Preview Image</label>\n                </div>\n                <div class="fieldWrap">\n                    <input id="captionsearch" class="form-checkbox" <% if (model.get(\'captionsearch\')) { print(\'checked="checked"\'); } %> name="captionsearch" type="checkbox"/>\n                    <label for="captionsearch">Caption Search</label>\n                </div>\n            </div>\n        </div>\n        <div class="form-actions">\n            <button type="submit" class="form-submit action-submit" value="Submit"><i class="fa fa-save"></i><span>Save</span></button>\n            <button type="button" class="form-submit action-cancel" value="Cancel"><i class="fa fa-times"></i><span>Cancel</span></button>\n        </div>\n    </fieldset>\n</form>\n'}),s("ev-script/views/playlist-settings",["require","jquery","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/playlist-settings.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/settings");return e("jquery-ui"),n.extend({template:i.template(e("text!ev-script/templates/playlist-settings.html")),initialize:function(e){n.prototype.initialize.call(this,e),i.bindAll(this,"changeLayout","changeCategoryList")},events:{submit:"submitHandler","click .action-cancel":"cancelHandler",'change input[name="layout"]':"changeLayout",'change input[name="categoryList"]':"changeCategoryList"},updateModel:function(){var e=this.field.model.get("content"),t={layout:this.$('input[name="layout"]:checked').val(),embedcode:e&&e.IsSecure?!1:this.$("#embedcode").is(":checked"),statistics:this.$("#statistics").is(":checked"),duration:this.$("#duration").is(":checked"),attachments:this.$("#attachments").is(":checked"),annotations:this.$("#annotations").is(":checked"),links:this.$("#links").is(":checked"),credits:this.$("#credits").is(":checked"),socialsharing:e&&e.IsSecure?!1:this.$("#socialsharing").is(":checked"),autoplay:this.$("#autoplay").is(":checked"),showcaptions:this.$("#showcaptions").is(":checked"),dateproduced:this.$("#dateproduced").is(":checked"),audiopreviewimage:this.$("#audiopreviewimage").is(":checked"),captionsearch:this.$("#captionsearch").is(":checked")};"playlist"===t.layout?t.playlistLayout={playlistSortBy:this.$("#playlistSortBy option:selected").val(),playlistSortDirection:this.$('input[name="playlistSortDirection"]:checked').val()}:t.showcaseLayout={categoryList:this.$("#categoryList").is(":checked"),categoryOrientation:this.$('input[name="categoryOrientation"]:checked').val()},this.field.model.set(t)},render:function(){var e=this.field.model.get("content"),i=this.template({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio(),isSecure:e&&e.IsSecure});this.$el.html(i),this.$(".accordion").accordion({active:2,heightStyle:"content",collapsible:!0}),this.$el.dialog({title:this.unencode(e?e.Name:this.field.model.get("id")),modal:!0,autoOpen:!1,draggable:!1,resizable:!1,dialogClass:"ev-dialog",width:Math.min(680,t(window).width()-this.config.dialogMargin),height:Math.min(420,t(window).height()-this.config.dialogMargin)})},changeLayout:function(e){"playlist"===e.currentTarget.value?(this.$(".playlistOptions").show(),this.$(".showcaseOptions").hide()):(this.$(".playlistOptions").hide(),this.$(".showcaseOptions").show())},changeCategoryList:function(e){t(e.currentTarget).is(":checked")?(this.$("#categoryOrientationHorizontal").attr("disabled",!1),this.$("#categoryOrientationVertical").attr("disabled",!1)):(this.$("#categoryOrientationHorizontal").attr("disabled",!0),this.$("#categoryOrientationVertical").attr("disabled",!0))}})}),s("text!ev-script/templates/field.html",[],function(){return'<div class="logo">\n    <a target="_blank" href="<%= ensembleUrl %>"><span>Ensemble Logo</span></a>\n</div>\n<% if (modelId) { %>\n    <% if (thumbnailUrl) { %>\n        <div class="thumbnail">\n            <img alt="Media thumbnail" src="<%= thumbnailUrl %>"/>\n        </div>\n    <% } %>\n    <div class="title"><%= name %></div>\n    <div class="ev-actions">\n        <a href="#" class="action-choose" title="Change <%= label %>"><i class="fa fa-folder-open fa-lg"></i><span>Change <%= label %><span></a>\n        <a href="#" class="action-preview" title="Preview: <%= name %>"><i class="fa fa-play-circle fa-lg"></i><span>Preview: <%= name %><span></a>\n        <% if (type === \'video\' || showPlaylistOptions) { %>\n            <a href="#" class="action-options" title="<%= label %> Embed Options"><i class="fa fa-cog fa-lg"></i><span><%= label %> Embed Options<span></a>\n        <% } %>\n        <a href="#" class="action-remove" title="Remove <%= label %>"><i class="fa fa-minus-circle fa-lg"></i><span>Remove <%= label %><span></a>\n    </div>\n<% } else { %>\n    <div class="title"><em>Add <%= label %></em></div>\n    <div class="ev-actions">\n        <a href="#" class="action-choose" title="Choose <%= label %>"><i class="fa fa-folder-open fa-lg"></i><span>Choose <%= label %><span></a>\n    </div>\n<% } %>\n'}),s("ev-script/views/field",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/video-picker","ev-script/views/video-settings","ev-script/views/video-preview","ev-script/models/video-encoding","ev-script/views/playlist-picker","ev-script/views/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/field.html"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/views/base"),s=e("ev-script/models/video-settings"),r=e("ev-script/models/playlist-settings"),a=e("ev-script/views/video-picker"),o=e("ev-script/views/video-settings"),l=e("ev-script/views/video-preview"),c=e("ev-script/models/video-encoding"),h=e("ev-script/views/playlist-picker"),u=e("ev-script/views/playlist-settings"),d=e("ev-script/views/playlist-preview");return n.extend({template:i.template(e("text!ev-script/templates/field.html")),initialize:function(e){n.prototype.initialize.call(this,e),i.bindAll(this,"chooseHandler","optionsHandler","removeHandler","previewHandler","resizePicker"),this.$field=e.$field,this.showChoose=!0;var t={id:this.id+"-picker",tagName:"div",className:"ev-"+this.model.get("type")+"-picker",field:this,appId:this.appId},p={id:this.id+"-settings",tagName:"div",className:"ev-settings",field:this,appId:this.appId};this.model instanceof s?(this.modelClass=s,this.pickerClass=a,this.settingsClass=o,this.previewClass=l,this.encoding=new c({},{appId:this.appId}),this.model.isNew()||(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch()),this.model.on("change:id",i.bind(function(){this.model.id?(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch({success:i.bind(function(e){this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()})},this)})):this.encoding.clear()},this)),i.extend(p,{encoding:this.encoding})):this.model instanceof r&&(this.modelClass=r,this.pickerClass=h,this.settingsClass=u,this.previewClass=d),this.picker=new this.pickerClass(i.extend({},t,{model:new this.modelClass(this.model.toJSON())})),this.settings=new this.settingsClass(p),this.$field.after(this.picker.$el),this.renderActions(),this.model.on("change",i.bind(function(){if(!this.model.isNew()){var e=this.model.toJSON();this.$field.val(JSON.stringify(e)),this.appEvents.trigger("fieldUpdated",this.$field,e),this.renderActions()}},this)),this.appEvents.on("showPicker",function(e){this.id===e&&(this.$(".action-choose").hide(),this.showChoose=!1,this.config.hidePickers&&this.appEvents.trigger("hidePickers",this.id),this.resizePicker())},this),this.appEvents.on("hidePicker",function(e){this.id===e&&(this.$(".action-choose").show(),this.showChoose=!0)},this),this.appEvents.on("hidePickers",function(e){e&&this.id===e||(this.$(".action-choose").show(),this.showChoose=!0)},this),this.appEvents.on("resize",i.bind(function(){this.resizePicker()},this))},events:{"click .action-choose":"chooseHandler","click .action-preview":"previewHandler","click .action-options":"optionsHandler","click .action-remove":"removeHandler"},chooseHandler:function(e){this.appEvents.trigger("showPicker",this.id),e.preventDefault()},optionsHandler:function(e){this.settings.show(),e.preventDefault()},removeHandler:function(e){this.model.clear(),this.$field.val(""),this.model.set(this.model.defaults,{silent:!0}),this.appEvents.trigger("fieldUpdated",this.$field),this.renderActions(),e.preventDefault()},previewHandler:function(e){var t=e.currentTarget;new this.previewClass({el:t,encoding:this.encoding,model:this.model,appId:this.appId});e.preventDefault()},renderActions:function(){var e,i,n,r,a=this.config.ensembleUrl;if(this.model instanceof s?(i="Media",n="video"):(i="Playlist",n="playlist"),this.model.id){e=this.model.id;var o=this.model.get("content");if(o){e=o.Name||o.Title;var l=new RegExp("^"+a.toLocaleLowerCase()+"/app/assets/");o.ThumbnailUrl&&l.test(o.ThumbnailUrl.toLocaleLowerCase())&&(r=o.ThumbnailUrl)}}this.$actions||(this.$actions=t('<div class="ev-field"/>'),this.$field.after(this.$actions)),this.$actions.html(this.template({ensembleUrl:a,modelId:this.model.id,label:i,type:n,name:e,thumbnailUrl:r,showPlaylistOptions:!this.info.useLegacyEmbeds()})),this.showChoose||this.$(".action-choose").hide()},resizePicker:function(){this.config.fitToParent&&this.picker.setHeight(this.$el.height()-this.$actions.outerHeight(!0))}})}),function(e){function t(e,t){if(e instanceof r)return e;if("string"!=typeof e)return null;if(e.length>F)return null;var i=t?X[he]:X[oe];if(!i.test(e))return null;try{return new r(e,t)}catch(n){return null}}function i(e,i){var n=t(e,i);return n?n.version:null}function n(e,i){var n=t(e.trim().replace(/^[=v]+/,""),i);return n?n.version:null}function r(e,t){if(e instanceof r){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>F)throw new TypeError("version is longer than "+F+" characters");if(!(this instanceof r))return new r(e,t);this.loose=t;var i=e.trim().match(t?X[he]:X[oe]);if(!i)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>B||this.major<0)throw new TypeError("Invalid major version");if(this.minor>B||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>B||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&B>t)return t}return e}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],
this.format()}function a(e,t,i,n){"string"==typeof i&&(n=i,i=void 0);try{return new r(e,i).inc(t,n).version}catch(s){return null}}function o(e,i){if(w(e,i))return null;var n=t(e),s=t(i);if(n.prerelease.length||s.prerelease.length){for(var r in n)if(("major"===r||"minor"===r||"patch"===r)&&n[r]!==s[r])return"pre"+r;return"prerelease"}for(var r in n)if(("major"===r||"minor"===r||"patch"===r)&&n[r]!==s[r])return r}function l(e,t){var i=Le.test(e),n=Le.test(t);return i&&n&&(e=+e,t=+t),i&&!n?-1:n&&!i?1:t>e?-1:e>t?1:0}function c(e,t){return l(t,e)}function h(e,t){return new r(e,t).major}function u(e,t){return new r(e,t).minor}function d(e,t){return new r(e,t).patch}function p(e,t,i){return new r(e,i).compare(t)}function f(e,t){return p(e,t,!0)}function v(e,t,i){return p(t,e,i)}function m(t,i){return t.sort(function(t,n){return e.compare(t,n,i)})}function g(t,i){return t.sort(function(t,n){return e.rcompare(t,n,i)})}function b(e,t,i){return p(e,t,i)>0}function y(e,t,i){return p(e,t,i)<0}function w(e,t,i){return 0===p(e,t,i)}function k(e,t,i){return 0!==p(e,t,i)}function x(e,t,i){return p(e,t,i)>=0}function I(e,t,i){return p(e,t,i)<=0}function C(e,t,i,n){var s;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),s=e===i;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),s=e!==i;break;case"":case"=":case"==":s=w(e,i,n);break;case"!=":s=k(e,i,n);break;case">":s=b(e,i,n);break;case">=":s=x(e,i,n);break;case"<":s=y(e,i,n);break;case"<=":s=I(e,i,n);break;default:throw new TypeError("Invalid operator: "+t)}return s}function S(e,t){if(e instanceof S){if(e.loose===t)return e;e=e.value}return this instanceof S?(this.loose=t,this.parse(e),void(this.semver===Oe?this.value="":this.value=this.operator+this.semver.version)):new S(e,t)}function $(e,t){if(e instanceof $&&e.loose===t)return e;if(!(this instanceof $))return new $(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function j(e,t){return new $(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})}function _(e,t){return e=P(e,t),e=A(e,t),e=q(e,t),e=L(e,t)}function E(e){return!e||"x"===e.toLowerCase()||"*"===e}function A(e,t){return e.trim().split(/\s+/).map(function(e){return z(e,t)}).join(" ")}function z(e,t){var i=t?X[xe]:X[ke];return e.replace(i,function(e,t,i,n,s){var r;return E(t)?r="":E(i)?r=">="+t+".0.0 <"+(+t+1)+".0.0":E(n)?r=">="+t+"."+i+".0 <"+t+"."+(+i+1)+".0":s?("-"!==s.charAt(0)&&(s="-"+s),r=">="+t+"."+i+"."+n+s+" <"+t+"."+(+i+1)+".0"):r=">="+t+"."+i+"."+n+" <"+t+"."+(+i+1)+".0",r})}function P(e,t){return e.trim().split(/\s+/).map(function(e){return T(e,t)}).join(" ")}function T(e,t){var i=t?X[je]:X[$e];return e.replace(i,function(e,t,i,n,s){var r;return E(t)?r="":E(i)?r=">="+t+".0.0 <"+(+t+1)+".0.0":E(n)?r="0"===t?">="+t+"."+i+".0 <"+t+"."+(+i+1)+".0":">="+t+"."+i+".0 <"+(+t+1)+".0.0":s?("-"!==s.charAt(0)&&(s="-"+s),r="0"===t?"0"===i?">="+t+"."+i+"."+n+s+" <"+t+"."+i+"."+(+n+1):">="+t+"."+i+"."+n+s+" <"+t+"."+(+i+1)+".0":">="+t+"."+i+"."+n+s+" <"+(+t+1)+".0.0"):r="0"===t?"0"===i?">="+t+"."+i+"."+n+" <"+t+"."+i+"."+(+n+1):">="+t+"."+i+"."+n+" <"+t+"."+(+i+1)+".0":">="+t+"."+i+"."+n+" <"+(+t+1)+".0.0",r})}function q(e,t){return e.split(/\s+/).map(function(e){return U(e,t)}).join(" ")}function U(e,t){e=e.trim();var i=t?X[ge]:X[me];return e.replace(i,function(e,t,i,n,s,r){var a=E(i),o=a||E(n),l=o||E(s),c=l;return"="===t&&c&&(t=""),a?e=">"===t||"<"===t?"<0.0.0":"*":t&&c?(o&&(n=0),l&&(s=0),">"===t?(t=">=",o?(i=+i+1,n=0,s=0):l&&(n=+n+1,s=0)):"<="===t&&(t="<",o?i=+i+1:n=+n+1),e=t+i+"."+n+"."+s):o?e=">="+i+".0.0 <"+(+i+1)+".0.0":l&&(e=">="+i+"."+n+".0 <"+i+"."+(+n+1)+".0"),e})}function L(e,t){return e.trim().replace(X[qe],"")}function O(e,t,i,n,s,r,a,o,l,c,h,u,d){return t=E(i)?"":E(n)?">="+i+".0.0":E(s)?">="+i+"."+n+".0":">="+t,o=E(l)?"":E(c)?"<"+(+l+1)+".0.0":E(h)?"<"+l+"."+(+c+1)+".0":u?"<="+l+"."+c+"."+h+"-"+u:"<="+o,(t+" "+o).trim()}function D(e,t){for(var i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length){for(var i=0;i<e.length;i++){if(e[i].semver===Oe)return!0;if(e[i].semver.prerelease.length>0){var n=e[i].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}}return!1}return!0}function M(e,t,i){try{t=new $(t,i)}catch(n){return!1}return t.test(e)}function H(e,t,i){return e.filter(function(e){return M(e,t,i)}).sort(function(e,t){return v(e,t,i)})[0]||null}function V(e,t){try{return new $(e,t).range||"*"}catch(i){return null}}function R(e,t,i){return W(e,t,"<",i)}function N(e,t,i){return W(e,t,">",i)}function W(e,t,i,n){e=new r(e,n),t=new $(t,n);var s,a,o,l,c;switch(i){case">":s=b,a=I,o=y,l=">",c=">=";break;case"<":s=y,a=x,o=b,l="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(M(e,t,n))return!1;for(var h=0;h<t.set.length;++h){var u=t.set[h],d=null,p=null;if(u.forEach(function(e){d=d||e,p=p||e,s(e.semver,d.semver,n)?d=e:o(e.semver,p.semver,n)&&(p=e)}),d.operator===l||d.operator===c)return!1;if((!p.operator||p.operator===l)&&a(e,p.semver))return!1;if(p.operator===c&&o(e,p.semver))return!1}return!0}"object"==typeof module&&module.exports===e&&(e=module.exports=r),e.SEMVER_SPEC_VERSION="2.0.0";var F=256,B=Number.MAX_SAFE_INTEGER||9007199254740991,X=e.re=[],K=e.src=[],J=0,Q=J++;K[Q]="0|[1-9]\\d*";var G=J++;K[G]="[0-9]+";var Z=J++;K[Z]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var Y=J++;K[Y]="("+K[Q]+")\\.("+K[Q]+")\\.("+K[Q]+")";var ee=J++;K[ee]="("+K[G]+")\\.("+K[G]+")\\.("+K[G]+")";var te=J++;K[te]="(?:"+K[Q]+"|"+K[Z]+")";var ie=J++;K[ie]="(?:"+K[G]+"|"+K[Z]+")";var ne=J++;K[ne]="(?:-("+K[te]+"(?:\\."+K[te]+")*))";var se=J++;K[se]="(?:-?("+K[ie]+"(?:\\."+K[ie]+")*))";var re=J++;K[re]="[0-9A-Za-z-]+";var ae=J++;K[ae]="(?:\\+("+K[re]+"(?:\\."+K[re]+")*))";var oe=J++,le="v?"+K[Y]+K[ne]+"?"+K[ae]+"?";K[oe]="^"+le+"$";var ce="[v=\\s]*"+K[ee]+K[se]+"?"+K[ae]+"?",he=J++;K[he]="^"+ce+"$";var ue=J++;K[ue]="((?:<|>)?=?)";var de=J++;K[de]=K[G]+"|x|X|\\*";var pe=J++;K[pe]=K[Q]+"|x|X|\\*";var fe=J++;K[fe]="[v=\\s]*("+K[pe]+")(?:\\.("+K[pe]+")(?:\\.("+K[pe]+")(?:"+K[ne]+")?"+K[ae]+"?)?)?";var ve=J++;K[ve]="[v=\\s]*("+K[de]+")(?:\\.("+K[de]+")(?:\\.("+K[de]+")(?:"+K[se]+")?"+K[ae]+"?)?)?";var me=J++;K[me]="^"+K[ue]+"\\s*"+K[fe]+"$";var ge=J++;K[ge]="^"+K[ue]+"\\s*"+K[ve]+"$";var be=J++;K[be]="(?:~>?)";var ye=J++;K[ye]="(\\s*)"+K[be]+"\\s+",X[ye]=new RegExp(K[ye],"g");var we="$1~",ke=J++;K[ke]="^"+K[be]+K[fe]+"$";var xe=J++;K[xe]="^"+K[be]+K[ve]+"$";var Ie=J++;K[Ie]="(?:\\^)";var Ce=J++;K[Ce]="(\\s*)"+K[Ie]+"\\s+",X[Ce]=new RegExp(K[Ce],"g");var Se="$1^",$e=J++;K[$e]="^"+K[Ie]+K[fe]+"$";var je=J++;K[je]="^"+K[Ie]+K[ve]+"$";var _e=J++;K[_e]="^"+K[ue]+"\\s*("+ce+")$|^$";var Ee=J++;K[Ee]="^"+K[ue]+"\\s*("+le+")$|^$";var Ae=J++;K[Ae]="(\\s*)"+K[ue]+"\\s*("+ce+"|"+K[fe]+")",X[Ae]=new RegExp(K[Ae],"g");var ze="$1$2$3",Pe=J++;K[Pe]="^\\s*("+K[fe]+")\\s+-\\s+("+K[fe]+")\\s*$";var Te=J++;K[Te]="^\\s*("+K[ve]+")\\s+-\\s+("+K[ve]+")\\s*$";var qe=J++;K[qe]="(<|>)?=?\\s*\\*";for(var Ue=0;J>Ue;Ue++)X[Ue]||(X[Ue]=new RegExp(K[Ue]));e.parse=t,e.valid=i,e.clean=n,e.SemVer=r,r.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},r.prototype.inspect=function(){return'<SemVer "'+this+'">'},r.prototype.toString=function(){return this.version},r.prototype.compare=function(e){return e instanceof r||(e=new r(e,this.loose)),this.compareMain(e)||this.comparePre(e)},r.prototype.compareMain=function(e){return e instanceof r||(e=new r(e,this.loose)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)},r.prototype.comparePre=function(e){if(e instanceof r||(e=new r(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var i=this.prerelease[t],n=e.prerelease[t];if(void 0===i&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===i)return-1;if(i!==n)return l(i,n)}while(++t)},r.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var i=this.prerelease.length;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);-1===i&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this},e.inc=a,e.diff=o,e.compareIdentifiers=l;var Le=/^[0-9]+$/;e.rcompareIdentifiers=c,e.major=h,e.minor=u,e.patch=d,e.compare=p,e.compareLoose=f,e.rcompare=v,e.sort=m,e.rsort=g,e.gt=b,e.lt=y,e.eq=w,e.neq=k,e.gte=x,e.lte=I,e.cmp=C,e.Comparator=S;var Oe={};S.prototype.parse=function(e){var t=this.loose?X[_e]:X[Ee],i=e.match(t);if(!i)throw new TypeError("Invalid comparator: "+e);this.operator=i[1],"="===this.operator&&(this.operator=""),i[2]?this.semver=new r(i[2],this.loose):this.semver=Oe},S.prototype.inspect=function(){return'<SemVer Comparator "'+this+'">'},S.prototype.toString=function(){return this.value},S.prototype.test=function(e){return this.semver===Oe?!0:("string"==typeof e&&(e=new r(e,this.loose)),C(e,this.operator,this.semver,this.loose))},e.Range=$,$.prototype.inspect=function(){return'<SemVer Range "'+this.range+'">'},$.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},$.prototype.toString=function(){return this.range},$.prototype.parseRange=function(e){var t=this.loose;e=e.trim();var i=t?X[Te]:X[Pe];e=e.replace(i,O),e=e.replace(X[Ae],ze),e=e.replace(X[ye],we),e=e.replace(X[Ce],Se),e=e.split(/\s+/).join(" ");var n=t?X[_e]:X[Ee],s=e.split(" ").map(function(e){return _(e,t)}).join(" ").split(/\s+/);return this.loose&&(s=s.filter(function(e){return!!e.match(n)})),s=s.map(function(e){return new S(e,t)})},e.toComparators=j,$.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new r(e,this.loose));for(var t=0;t<this.set.length;t++)if(D(this.set[t],e))return!0;return!1},e.satisfies=M,e.maxSatisfying=H,e.validRange=V,e.ltr=R,e.gtr=N,e.outside=W,"function"==typeof s&&s.amd&&s("semver",e)}("object"==typeof exports?exports:"function"==typeof s&&s.amd?{}:semver={}),s("ev-script/models/app-info",["require","underscore","semver","ev-script/models/base"],function(e){"use strict";var t=(e("underscore"),e("semver")),i=e("ev-script/models/base");return i.extend({initialize:function(e,t){i.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/Info";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e},checkVersion:function(e){var i=this.get("ApplicationVersion");return i&&t.satisfies(i,e)},useLegacyEmbeds:function(){return this.checkVersion("<3.12.0")},anthemEnabled:function(){return this.checkVersion(">=4.2.0")}})}),s("ev-script/models/current-user",["require","underscore","ev-script/models/base"],function(e){"use strict";var t=(e("underscore"),e("ev-script/models/base"));return t.extend({idAttribute:"ID",initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/CurrentUser";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e.Data[0]}})}),s("ev-script/auth/base/auth",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache","ev-script/models/current-user"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),s=e("ev-script/util/events"),r=e("ev-script/util/cache"),a=e("ev-script/models/current-user"),o=function(e){i.bindAll(this,"getUser","login","logout","isAuthenticated","handleUnauthorized"),this.appId=e,this.config=r.getAppConfig(e),this.info=r.getAppInfo(e),this.globalEvents=s.getEvents("global"),this.appEvents=s.getEvents(e),this.user=null,this.appEvents.on("appLoaded",function(){this.fetchUser()},this)};return o.extend=n.Model.extend,i.extend(o.prototype,{fetchUser:function(){var e=new a({},{appId:this.appId});return e.fetch({success:i.bind(function(e,t,i){this.user=e,this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:i.bind(function(e,t,i){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},getUser:function(){return this.user},login:function(e){return t.Deferred().reject().promise()},logout:function(){return t.Deferred().reject().promise()},isAuthenticated:function(){return null!=this.user},handleUnauthorized:function(e,t){}}),o}),function(e){"function"==typeof s&&s.amd?s("jquery.cookie",["jquery"],e):e("object"==typeof exports?n("jquery"):jQuery)}(function(e){function t(e){return o.raw?e:encodeURIComponent(e)}function i(e){return o.raw?e:decodeURIComponent(e)}function n(e){return t(o.json?JSON.stringify(e):String(e))}function s(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(a," ")),o.json?JSON.parse(e):e}catch(t){}}function r(t,i){var n=o.raw?t:s(t);return e.isFunction(i)?i(n):n}var a=/\+/g,o=e.cookie=function(s,a,l){if(void 0!==a&&!e.isFunction(a)){if(l=e.extend({},o.defaults,l),"number"==typeof l.expires){var c=l.expires,h=l.expires=new Date;h.setTime(+h+864e5*c)}return document.cookie=[t(s),"=",n(a),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var u=s?void 0:{},d=document.cookie?document.cookie.split("; "):[],p=0,f=d.length;f>p;p++){var v=d[p].split("="),m=i(v.shift()),g=v.join("=");if(s&&s===m){u=r(g,a);break}s||void 0===(g=r(g))||(u[m]=g)}return u};o.defaults={},e.removeCookie=function(t,i){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},i,{expires:-1})),!e.cookie(t))}}),s("text!ev-script/auth/basic/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text"type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text"type="password"/>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),s("ev-script/auth/basic/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/basic/template.html"],function(e,t){"use strict";var i=e("jquery"),n=e("underscore"),s=e("backbone"),r=e("ev-script/util/cache"),a=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),s.View.extend({template:n.template(e("text!ev-script/auth/basic/template.html")),initialize:function(e){this.appId=e.appId,this.config=r.getAppConfig(this.appId),this.appEvents=a.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=this.template();this.$dialog=i('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,i(window).width()-this.config.dialogMargin),height:Math.min(250,i(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:n.bind(function(t,i){this.$dialog.html(e)},this),close:n.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),i("form",this.$dialog).submit(n.bind(function(e){var t=i(e.target),n=i("#username",t).val(),s=i("#password",t).val();n&&s&&(this.auth.login({username:n,password:s}).always(this.submitCallback),this.$dialog.dialog("destroy").remove()),e.preventDefault()},this))}})}),s("ev-script/auth/basic/auth",["require","jquery","underscore","backbone","ev-script/auth/base/auth","ev-script/auth/basic/view","ev-script/collections/organizations"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("backbone"),s=e("ev-script/auth/base/auth"),r=e("ev-script/auth/basic/view"),a=e("ev-script/collections/organizations"),o=s.extend({constructor:function(e){o.__super__.constructor.call(this,e)},fetchUser:function(){if(this.info.get("ApplicationVersion"))return o.__super__.fetchUser.call(this);var e=new a({},{appId:this.appId});return e.requiresAuth=!1,e.fetch({success:i.bind(function(e,t,i){this.user=new n.Model({id:Math.floor(1e16*Math.random()).toString(16)}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:i.bind(function(e,t,i){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},login:function(e){var n={path:this.config.authPath};return t.cookie(this.config.ensembleUrl+"-user",e.username,i.extend({},n)),t.cookie(this.config.ensembleUrl+"-pass",e.password,i.extend({},n)),this.fetchUser()},logout:function(){var e=t.Deferred(),n={path:this.config.authPath};return t.removeCookie(this.config.ensembleUrl+"-user",i.extend({},n)),t.removeCookie(this.config.ensembleUrl+"-pass",i.extend({},n)),this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),e.resolve(),e.promise()},handleUnauthorized:function(e,t){this.logout();var i=new r({el:e,submitCallback:t,appId:this.appId,auth:this});i.render()}});return o}),s("text!ev-script/auth/forms/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text" type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text" type="password"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="provider">Identity Provider</label>\n            <select id="provider" name="provider" class="form-select"></select>\n        </div>\n        <div class="fieldWrap">\n            <label for="remember">Remember Me</label>\n            <input id="remember" name="remember" type="checkbox"></input>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n            <div class="loader"></div>\n        </div>\n    </fieldset>\n</form>\n'}),s("ev-script/auth/forms/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/forms/template.html","text!ev-script/templates/options.html"],function(e,t){"use strict";var i=e("jquery"),n=e("underscore"),s=e("backbone"),r=e("ev-script/util/cache"),a=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),s.View.extend({template:n.template(e("text!ev-script/auth/forms/template.html")),optionsTemplate:n.template(e("text!ev-script/templates/options.html")),initialize:function(e){this.appId=e.appId,this.config=r.getAppConfig(this.appId),this.appEvents=a.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=i(this.template());i("#provider",e).append(this.optionsTemplate({collection:this.collection,selectedId:this.config.defaultProvider}));this.$dialog=i('<div class="ev-auth"></div>'),this.$el.after(this.$dialog);var t=i("div.loader",e),s=n.bind(function(e,i,n){t.addClass("loading")},this),r=n.bind(function(e,i,n){t.removeClass("loading")},this);i(window.document).on("ajaxSend",s).on("ajaxComplete",r),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,i(window).width()-this.config.dialogMargin),height:Math.min(250,i(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:n.bind(function(t,i){this.$dialog.html(e)},this),close:n.bind(function(e,t){i(window.document).off("ajaxSend",s).off("ajaxComplete",r),this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),i("form",this.$dialog).submit(n.bind(function(e){var t=i(e.target),s=i("#username",t).val(),r=i("#password",t).val();s&&r&&this.auth.login({username:s,password:r,authSourceId:i("#provider :selected",t).val(),persist:i("#remember",t).is(":checked")}).then(n.bind(function(){this.$dialog.dialog("destroy").remove(),this.submitCallback()},this)),e.preventDefault()},this))}})}),s("ev-script/collections/identity-providers",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),i=e("ev-script/util/cache"),n=new i.Cache;return t.extend({initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.requiresAuth=!1},getCached:function(e){return n.get(this.config.ensembleUrl)},setCached:function(e,t){return n.set(this.config.ensembleUrl,t)},url:function(){var e=this.config.ensembleUrl+"/api/IdentityProviders";return this.config.urlCallback?this.config.urlCallback(e):e}})}),s("ev-script/auth/forms/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/models/current-user","ev-script/auth/forms/view","ev-script/collections/identity-providers"],function(e){"use strict";var t=e("jquery"),i=e("underscore"),n=e("ev-script/auth/base/auth"),s=e("ev-script/models/current-user"),r=e("ev-script/auth/forms/view"),a=e("ev-script/collections/identity-providers"),o=n.extend({constructor:function(e){n.prototype.constructor.call(this,e),this.identityProviders=new a({},{appId:e}),this.asPromise=this.identityProviders.fetch()},login:function(e){var n=this.config.ensembleUrl+"/api/Login";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(n):n,type:"POST",dataType:"json",data:{user:e.username,password:e.password,identityProviderId:e.authSourceId,persist:e.persist},xhrFields:{withCredentials:!0},success:i.bind(function(e,t,i){this.user=new s(e.Data[0],{appId:this.appId}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this)}).promise()},logout:function(){var e=this.config.ensembleUrl+"/api/Logout";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(e):e,type:"POST",xhrFields:{withCredentials:!0},success:i.bind(function(e,t,i){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),this.asPromise.done(i.bind(function(){var i=new r({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});i.render()},this))}});return o}),s("text!ev-script/auth/none/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <h3>You are unauthorized to access this content.</h3>\n</form>\n'}),s("ev-script/auth/none/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery-ui","text!ev-script/auth/none/template.html"],function(e,t){"use strict";var i=e("jquery"),n=e("underscore"),s=e("backbone"),r=e("ev-script/util/cache"),a=e("ev-script/util/events");return e("jquery-ui"),s.View.extend({template:n.template(e("text!ev-script/auth/none/template.html")),initialize:function(e){this.appId=e.appId,this.config=r.getAppConfig(this.appId),this.appEvents=a.getEvents(this.appId)},render:function(){var e=i(this.template());this.$dialog=i('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,i(window).width()-this.config.dialogMargin),height:Math.min(250,i(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:n.bind(function(t,i){this.$dialog.html(e)},this),close:n.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)})}})}),s("ev-script/auth/none/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/auth/none/view"],function(e){"use strict";var t=(e("jquery"),e("underscore"),e("ev-script/auth/base/auth")),i=e("ev-script/auth/none/view"),n=t.extend({constructor:function(e){t.prototype.constructor.call(this,e)},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl);var n=new i({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()}});return n}),s("ev-script",["require","backbone","underscore","jquery","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/field","ev-script/views/video-embed","ev-script/views/playlist-embed","ev-script/models/app-info","ev-script/auth/basic/auth","ev-script/auth/forms/auth","ev-script/auth/none/auth","ev-script/util/events","ev-script/util/cache"],function(e){"use strict";var t=(e("backbone"),e("underscore")),i=e("jquery"),n=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),r=e("ev-script/views/field"),a=e("ev-script/views/video-embed"),o=e("ev-script/views/playlist-embed"),l=e("ev-script/models/app-info"),c=e("ev-script/auth/basic/auth"),h=e("ev-script/auth/forms/auth"),u=e("ev-script/auth/none/auth"),d=e("ev-script/util/events"),p=e("ev-script/util/cache"),f=function(e){var f=Math.floor(1e16*Math.random()).toString(16),v=p.caches.get(e.ensembleUrl);v||(v=p.caches.set(e.ensembleUrl,new p.Cache));var m={ensembleUrl:"",authPath:"",urlCallback:function(e){return e},pageSize:100,scrollHeight:null,fitToParent:!1,hidePickers:!0,dialogMargin:40,authType:"basic",defaultProvider:"",defaultVideoWidth:"",pluploadFlashPath:""},g=p.setAppConfig(f,t.extend({},m,e));d.initEvents(f),this.appEvents=d.getEvents(f),this.globalEvents=d.getEvents();var b=i.Deferred();t.extend(this,b.promise());var y=new l({},{appId:f});p.setAppInfo(f,y),y.fetch({}).always(t.bind(function(){if(y.get("ApplicationVersion")||"forms"!==g.authType){var e;switch(g.authType){case"forms":e=new h(f);break;case"none":e=new u(f);break;default:e=new c(f)}p.setAppAuth(f,e),this.handleField=function(e,t,n){var s=i(n,e);new r({id:e.id||f,el:e,model:t,$field:s,appId:f})},this.handleEmbed=function(e,t){if(t instanceof n){new a({el:e,model:t,appId:f})}else{new o({el:e,model:t,appId:f})}},this.getEmbedCode=function(e){var t=i("<div/>");return"video"===e.type?this.handleEmbed(t[0],new n(e)):this.handleEmbed(t[0],new s(e)),t.html()},this.appEvents.trigger("appLoaded"),b.resolve()}else b.reject("Configured to use forms authentication against a pre-3.6 API.")},this))};return{VideoSettings:n,PlaylistSettings:s,EnsembleApp:f}}),s("jquery",function(){return e||jQuery}),s("jquery-ui",["jquery"],function(){}),s("plupload",function(){return t}),s("jquery.plupload.queue",["jquery","plupload"],function(){}),n("ev-script")});
//# sourceMappingURL=ev-script.min.js.map