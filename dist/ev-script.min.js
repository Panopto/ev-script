/**
 * ev-script 1.1.0 2016-02-29
 * Ensemble Video Integration Library
 * https://github.com/ensembleVideo/ev-script
 * Copyright (c) 2016 Symphony Video, Inc.
 * Licensed (MIT AND GPL-2.0)
 */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * ev-scroll-loader 1.0.0 2016-02-24
 * Ensemble Video jQuery Scroll Loader Plugin
 * https://github.com/ensembleVideo/ev-scroll-loader
 * Copyright (c) 2016 Symphony Video, Inc.
 * Licensed (MIT AND GPL-2.0)
 */

/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

(function(e,t){typeof define=="function"&&define.amd?define(["jquery","plupload","jquery-ui","jquery.plupload.queue"],t):e.EV=t(e.$,e.plupload)})(this,function(e,t){var n,r,i;return function(e){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(n){if(v(f,n)){var r=f[n];delete f[n],c[n]=!0,t.apply(e,r)}if(!v(a,n)&&!v(c,n))throw new Error("No "+n);return a[n]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var t,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},t=function(t,n,r,i){var s,l,h,p,d,m=[],y=typeof r,E;i=i||t;if(y==="undefined"||y==="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(d=0;d<n.length;d+=1){p=o(n[d],i),l=p.f;if(l==="require")m[d]=u.require(t);else if(l==="exports")m[d]=u.exports(t),E=!0;else if(l==="module")s=m[d]=u.module(t);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=r?r.apply(a[t],m):undefined;if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!E)a[t]=h}else t&&(a[t]=r)},n=r=s=function(n,r,i,a,f){if(typeof n=="string")return u[n]?u[n](r):w(o(n,r).f);if(!n.splice){l=n,l.deps&&s(l.deps,l.callback);if(!r)return;r.splice?(n=r,r=i,i=null):n=e}return r=r||function(){},typeof i=="function"&&(i=a,a=f),a?t(e,n,r,i):setTimeout(function(){t(e,n,r,i)},4),s},s.config=function(e){return s(e)},n._defined=a,i=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},i.amd={jQuery:!0}}(),i("almond",function(){}),function(){function T(e){function t(t,n,r,i,s,o){for(;s>=0&&s<o;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=m(r,s,4);var o=!x(n)&&v.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function k(e){return function(t,n,r){n=g(n,r);var i=S(t),s=e>0?0:i-1;for(;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}function L(e,t,n){return function(r,i,s){var o=0,a=S(r);if(typeof s=="number")e>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(u.call(r,o,a),v.isNaN),s>=0?s+o:-1;for(s=e>0?o:a-1;s>=0&&s<a;s+=e)if(r[s]===i)return s;return-1}}function _(e,t){var n=M.length,i=e.constructor,s=v.isFunction(i)&&i.prototype||r,o="constructor";v.has(e,o)&&!v.contains(t,o)&&t.push(o);while(n--)o=M[n],o in e&&e[o]!==s[o]&&!v.contains(t,o)&&t.push(o)}var e=this,t=e._,n=Array.prototype,r=Object.prototype,s=Function.prototype,o=n.push,u=n.slice,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=s.bind,p=Object.create,d=function(){},v=function(e){if(e instanceof v)return e;if(!(this instanceof v))return new v(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=v),exports._=v):e._=v,v.VERSION="1.8.3";var m=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},g=function(e,t,n){return e==null?v.identity:v.isFunction(e)?m(e,t,n):v.isObject(e)?v.matcher(e):v.property(e)};v.iteratee=function(e,t){return g(e,t,Infinity)};var y=function(e,t){return function(n){var r=arguments.length;if(r<2||n==null)return n;for(var i=1;i<r;i++){var s=arguments[i],o=e(s),u=o.length;for(var a=0;a<u;a++){var f=o[a];if(!t||n[f]===void 0)n[f]=s[f]}}return n}},b=function(e){if(!v.isObject(e))return{};if(p)return p(e);d.prototype=e;var t=new d;return d.prototype=null,t},w=function(e){return function(t){return t==null?void 0:t[e]}},E=Math.pow(2,53)-1,S=w("length"),x=function(e){var t=S(e);return typeof t=="number"&&t>=0&&t<=E};v.each=v.forEach=function(e,t,n){t=m(t,n);var r,i;if(x(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=v.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},v.map=v.collect=function(e,t,n){t=g(t,n);var r=!x(e)&&v.keys(e),i=(r||e).length,s=Array(i);for(var o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},v.reduce=v.foldl=v.inject=T(1),v.reduceRight=v.foldr=T(-1),v.find=v.detect=function(e,t,n){var r;x(e)?r=v.findIndex(e,t,n):r=v.findKey(e,t,n);if(r!==void 0&&r!==-1)return e[r]},v.filter=v.select=function(e,t,n){var r=[];return t=g(t,n),v.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},v.reject=function(e,t,n){return v.filter(e,v.negate(g(t)),n)},v.every=v.all=function(e,t,n){t=g(t,n);var r=!x(e)&&v.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},v.some=v.any=function(e,t,n){t=g(t,n);var r=!x(e)&&v.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},v.contains=v.includes=v.include=function(e,t,n,r){x(e)||(e=v.values(e));if(typeof n!="number"||r)n=0;return v.indexOf(e,t,n)>=0},v.invoke=function(e,t){var n=u.call(arguments,2),r=v.isFunction(t);return v.map(e,function(e){var i=r?t:e[t];return i==null?i:i.apply(e,n)})},v.pluck=function(e,t){return v.map(e,v.property(t))},v.where=function(e,t){return v.filter(e,v.matcher(t))},v.findWhere=function(e,t){return v.find(e,v.matcher(t))},v.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=x(e)?e:v.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=g(t,n),v.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},v.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=x(e)?e:v.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=g(t,n),v.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},v.shuffle=function(e){var t=x(e)?e:v.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=v.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},v.sample=function(e,t,n){return t==null||n?(x(e)||(e=v.values(e)),e[v.random(e.length-1)]):v.shuffle(e).slice(0,Math.max(0,t))},v.sortBy=function(e,t,n){return t=g(t,n),v.pluck(v.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var N=function(e){return function(t,n,r){var i={};return n=g(n,r),v.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};v.groupBy=N(function(e,t,n){v.has(e,n)?e[n].push(t):e[n]=[t]}),v.indexBy=N(function(e,t,n){e[n]=t}),v.countBy=N(function(e,t,n){v.has(e,n)?e[n]++:e[n]=1}),v.toArray=function(e){return e?v.isArray(e)?u.call(e):x(e)?v.map(e,v.identity):v.values(e):[]},v.size=function(e){return e==null?0:x(e)?e.length:v.keys(e).length},v.partition=function(e,t,n){t=g(t,n);var r=[],i=[];return v.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},v.first=v.head=v.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:v.initial(e,e.length-t)},v.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},v.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:v.rest(e,Math.max(0,e.length-t))},v.rest=v.tail=v.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},v.compact=function(e){return v.filter(e,v.identity)};var C=function(e,t,n,r){var i=[],s=0;for(var o=r||0,u=S(e);o<u;o++){var a=e[o];if(x(a)&&(v.isArray(a)||v.isArguments(a))){t||(a=C(a,t,n));var f=0,l=a.length;i.length+=l;while(f<l)i[s++]=a[f++]}else n||(i[s++]=a)}return i};v.flatten=function(e,t){return C(e,t,!1)},v.without=function(e){return v.difference(e,u.call(arguments,1))},v.uniq=v.unique=function(e,t,n,r){v.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=g(n,r));var i=[],s=[];for(var o=0,u=S(e);o<u;o++){var a=e[o],f=n?n(a,o,e):a;t?((!o||s!==f)&&i.push(a),s=f):n?v.contains(s,f)||(s.push(f),i.push(a)):v.contains(i,a)||i.push(a)}return i},v.union=function(){return v.uniq(C(arguments,!0,!0))},v.intersection=function(e){var t=[],n=arguments.length;for(var r=0,i=S(e);r<i;r++){var s=e[r];if(v.contains(t,s))continue;for(var o=1;o<n;o++)if(!v.contains(arguments[o],s))break;o===n&&t.push(s)}return t},v.difference=function(e){var t=C(arguments,!0,!0,1);return v.filter(e,function(e){return!v.contains(t,e)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(e){var t=e&&v.max(e,S).length||0,n=Array(t);for(var r=0;r<t;r++)n[r]=v.pluck(e,r);return n},v.object=function(e,t){var n={};for(var r=0,i=S(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},v.findIndex=k(1),v.findLastIndex=k(-1),v.sortedIndex=function(e,t,n,r){n=g(n,r,1);var i=n(t),s=0,o=S(e);while(s<o){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},v.indexOf=L(1,v.findIndex,v.sortedIndex),v.lastIndexOf=L(-1,v.findLastIndex),v.range=function(e,t,n){t==null&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var A=function(e,t,n,r,i){if(r instanceof t){var s=b(e.prototype),o=e.apply(s,i);return v.isObject(o)?o:s}return e.apply(n,i)};v.bind=function(e,t){if(h&&e.bind===h)return h.apply(e,u.call(arguments,1));if(!v.isFunction(e))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),r=function(){return A(e,r,t,this,n.concat(u.call(arguments)))};return r},v.partial=function(e){var t=u.call(arguments,1),n=function(){var r=0,i=t.length,s=Array(i);for(var o=0;o<i;o++)s[o]=t[o]===v?arguments[r++]:t[o];while(r<arguments.length)s.push(arguments[r++]);return A(e,n,this,this,s)};return n},v.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=v.bind(e[r],e);return e},v.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return v.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},v.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},v.defer=v.partial(v.delay,v,1),v.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:v.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=v.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},v.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=v.now()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=v.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},v.wrap=function(e,t){return v.partial(t,e)},v.negate=function(e){return function(){return!e.apply(this,arguments)}},v.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},v.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},v.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},v.once=v.partial(v.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];v.keys=function(e){if(!v.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)v.has(e,n)&&t.push(n);return O&&_(e,t),t},v.allKeys=function(e){if(!v.isObject(e))return[];var t=[];for(var n in e)t.push(n);return O&&_(e,t),t},v.values=function(e){var t=v.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},v.mapObject=function(e,t,n){t=g(t,n);var r=v.keys(e),i=r.length,s={},o;for(var u=0;u<i;u++)o=r[u],s[o]=t(e[o],o,e);return s},v.pairs=function(e){var t=v.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},v.invert=function(e){var t={},n=v.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},v.functions=v.methods=function(e){var t=[];for(var n in e)v.isFunction(e[n])&&t.push(n);return t.sort()},v.extend=y(v.allKeys),v.extendOwn=v.assign=y(v.keys),v.findKey=function(e,t,n){t=g(t,n);var r=v.keys(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s];if(t(e[i],i,e))return i}},v.pick=function(e,t,n){var r={},i=e,s,o;if(i==null)return r;v.isFunction(t)?(o=v.allKeys(i),s=m(t,n)):(o=C(arguments,!1,!1,1),s=function(e,t,n){return t in n},i=Object(i));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=i[f];s(l,f,i)&&(r[f]=l)}return r},v.omit=function(e,t,n){if(v.isFunction(t))t=v.negate(t);else{var r=v.map(C(arguments,!1,!1,1),String);t=function(e,t){return!v.contains(r,t)}}return v.pick(e,t,n)},v.defaults=y(v.allKeys,!0),v.create=function(e,t){var n=b(e);return t&&v.extendOwn(n,t),n},v.clone=function(e){return v.isObject(e)?v.isArray(e)?e.slice():v.extend({},e):e},v.tap=function(e,t){return t(e),e},v.isMatch=function(e,t){var n=v.keys(t),r=n.length;if(e==null)return!r;var i=Object(e);for(var s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var D=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof v&&(e=e._wrapped),t instanceof v&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s=i==="[object Array]";if(!s){if(typeof e!="object"||typeof t!="object")return!1;var o=e.constructor,u=t.constructor;if(o!==u&&!(v.isFunction(o)&&o instanceof o&&v.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];var f=n.length;while(f--)if(n[f]===e)return r[f]===t;n.push(e),r.push(t);if(s){f=e.length;if(f!==t.length)return!1;while(f--)if(!D(e[f],t[f],n,r))return!1}else{var l=v.keys(e),c;f=l.length;if(v.keys(t).length!==f)return!1;while(f--){c=l[f];if(!v.has(t,c)||!D(e[c],t[c],n,r))return!1}}return n.pop(),r.pop(),!0};v.isEqual=function(e,t){return D(e,t)},v.isEmpty=function(e){return e==null?!0:x(e)&&(v.isArray(e)||v.isString(e)||v.isArguments(e))?e.length===0:v.keys(e).length===0},v.isElement=function(e){return!!e&&e.nodeType===1},v.isArray=l||function(e){return a.call(e)==="[object Array]"},v.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){v["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),v.isArguments(arguments)||(v.isArguments=function(e){return v.has(e,"callee")}),typeof /./!="function"&&typeof Int8Array!="object"&&(v.isFunction=function(e){return typeof e=="function"||!1}),v.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},v.isNaN=function(e){return v.isNumber(e)&&e!==+e},v.isBoolean=function(e){return e===!0||e===!1||a.call(e)==="[object Boolean]"},v.isNull=function(e){return e===null},v.isUndefined=function(e){return e===void 0},v.has=function(e,t){return e!=null&&f.call(e,t)},v.noConflict=function(){return e._=t,this},v.identity=function(e){return e},v.constant=function(e){return function(){return e}},v.noop=function(){},v.property=w,v.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}},v.matcher=v.matches=function(e){return e=v.extendOwn({},e),function(t){return v.isMatch(t,e)}},v.times=function(e,t,n){var r=Array(Math.max(0,e));t=m(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},v.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},v.now=Date.now||function(){return(new Date).getTime()};var P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},H=v.invert(P),B=function(e){var t=function(t){return e[t]},n="(?:"+v.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};v.escape=B(P),v.unescape=B(H),v.result=function(e,t,n){var r=e==null?void 0:e[t];return r===void 0&&(r=n),v.isFunction(r)?r.call(e):r};var j=0;v.uniqueId=function(e){var t=++j+"";return e?e+t:t},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,R=function(e){return"\\"+I[e]};v.template=function(e,t,n){!t&&n&&(t=n),t=v.defaults({},t,v.templateSettings);var r=RegExp([(t.escape||F).source,(t.interpolate||F).source,(t.evaluate||F).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(q,R),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,v)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},v.chain=function(e){var t=v(e);return t._chain=!0,t};var U=function(e,t){return e._chain?v(t).chain():t};v.mixin=function(e){v.each(v.functions(e),function(t){var n=v[t]=e[t];v.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),U(this,n.apply(v,e))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];v.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],U(this,n)}}),v.each(["concat","join","slice"],function(e){var t=n[e];v.prototype[e]=function(){return U(this,t.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped},typeof i=="function"&&i.amd&&i("underscore",[],function(){return v})}.call(this),function(e){var t=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof i=="function"&&i.amd)i("backbone",["underscore","jquery","exports"],function(n,r,i){t.Backbone=e(t,i,n,r)});else if(typeof exports!="undefined"){var n=r("underscore"),s;try{s=r("jquery")}catch(o){}e(t,exports,n,s)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice;t.VERSION="1.2.3",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=function(e,t,r){switch(e){case 1:return function(){return n[t](this[r])};case 2:return function(e){return n[t](this[r],e)};case 3:return function(e,i){return n[t](this[r],a(e,this),i)};case 4:return function(e,i,s){return n[t](this[r],a(e,this),i,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[r]),n[t].apply(n,e)}}},u=function(e,t,r){n.each(t,function(t,i){n[i]&&(e.prototype[i]=o(t,i,r))})},a=function(e,t){return n.isFunction(e)?e:n.isObject(e)&&!t._isModel(e)?f(e):n.isString(e)?function(t){return t.get(e)}:e},f=function(e){var t=n.matches(e);return function(e){return t(e.attributes)}},l=t.Events={},c=/\s+/,h=function(e,t,r,i,s){var o=0,u;if(r&&typeof r=="object"){i!==void 0&&"context"in s&&s.context===void 0&&(s.context=i);for(u=n.keys(r);o<u.length;o++)t=h(e,t,u[o],r[u[o]],s)}else if(r&&c.test(r))for(u=r.split(c);o<u.length;o++)t=e(t,u[o],i,s);else t=e(t,r,i,s);return t};l.on=function(e,t,n){return p(this,e,t,n)};var p=function(e,t,n,r,i){e._events=h(d,e._events||{},t,n,{context:r,ctx:e,listening:i});if(i){var s=e._listeners||(e._listeners={});s[i.id]=i}return e};l.listenTo=function(e,t,r){if(!e)return this;var i=e._listenId||(e._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[i];if(!o){var u=this._listenId||(this._listenId=n.uniqueId("l"));o=s[i]={obj:e,objId:i,id:u,listeningTo:s,count:0}}return p(e,t,r,this,o),this};var d=function(e,t,n,r){if(n){var i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,u=r.listening;u&&u.count++,i.push({callback:n,context:s,ctx:s||o,listening:u})}return e};l.off=function(e,t,n){return this._events?(this._events=h(v,this._events,e,t,{context:n,listeners:this._listeners}),this):this},l.stopListening=function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=e?[e._listenId]:n.keys(i);for(var o=0;o<s.length;o++){var u=i[s[o]];if(!u)break;u.obj.off(t,r,this)}return n.isEmpty(i)&&(this._listeningTo=void 0),this};var v=function(e,t,r,i){if(!e)return;var s=0,o,u=i.context,a=i.listeners;if(!t&&!r&&!u){var f=n.keys(a);for(;s<f.length;s++)o=a[f[s]],delete a[o.id],delete o.listeningTo[o.objId];return}var l=t?[t]:n.keys(e);for(;s<l.length;s++){t=l[s];var c=e[t];if(!c)break;var h=[];for(var p=0;p<c.length;p++){var d=c[p];r&&r!==d.callback&&r!==d.callback._callback||u&&u!==d.context?h.push(d):(o=d.listening,o&&--o.count===0&&(delete a[o.id],delete o.listeningTo[o.objId]))}h.length?e[t]=h:delete e[t]}if(n.size(e))return e};l.once=function(e,t,r){var i=h(m,{},e,t,n.bind(this.off,this));return this.on(i,void 0,r)},l.listenToOnce=function(e,t,r){var i=h(m,{},t,r,n.bind(this.stopListening,this,e));return this.listenTo(e,i)};var m=function(e,t,r,i){if(r){var s=e[t]=n.once(function(){i(t,s),r.apply(this,arguments)});s._callback=r}return e};l.trigger=function(e){if(!this._events)return this;var t=Math.max(0,arguments.length-1),n=Array(t);for(var r=0;r<t;r++)n[r]=arguments[r+1];return h(g,this._events,e,void 0,n),this};var g=function(e,t,n,r){if(e){var i=e[t],s=e.all;i&&s&&(s=s.slice()),i&&y(i,r),s&&y(s,[t].concat(r))}return e},y=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}};l.bind=l.on,l.unbind=l.off,n.extend(t,l);var b=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(b.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,r){if(e==null)return this;var i;typeof e=="object"?(i=e,r=t):(i={})[e]=t,r||(r={});if(!this._validate(i,r))return!1;var s=r.unset,o=r.silent,u=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=n.clone(this.attributes),this.changed={});var f=this.attributes,l=this.changed,c=this._previousAttributes;for(var h in i)t=i[h],n.isEqual(f[h],t)||u.push(h),n.isEqual(c[h],t)?delete l[h]:l[h]=t,s?delete f[h]:f[h]=t;this.id=this.get(this.idAttribute);if(!o){u.length&&(this._pending=r);for(var p=0;p<u.length;p++)this.trigger("change:"+u[p],this,f[u[p]],r)}if(a)return this;if(!o)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t=this._changing?this._previousAttributes:this.attributes,r={};for(var i in e){var s=e[i];if(n.isEqual(t[i],s))continue;r[i]=s}return n.size(r)?r:!1},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=n.extend({parse:!0},e);var t=this,r=e.success;return e.success=function(n){var i=e.parse?t.parse(n,e):n;if(!t.set(i,e))return!1;r&&r.call(e.context,t,n,e),t.trigger("sync",t,n,e)},R(this,e),this.sync("read",this,e)},save:function(e,t,r){var i;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0,parse:!0},r);var s=r.wait;if(i&&!s){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;var o=this,u=r.success,a=this.attributes;r.success=function(e){o.attributes=a;var t=r.parse?o.parse(e,r):e;s&&(t=n.extend({},i,t));if(t&&!o.set(t,r))return!1;u&&u.call(r.context,o,e,r),o.trigger("sync",o,e,r)},R(this,r),i&&s&&(this.attributes=n.extend({},a,i));var f=this.isNew()?"create":r.patch?"patch":"update";f==="patch"&&!r.attrs&&(r.attrs=i);var l=this.sync(f,this,r);return this.attributes=a,l},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){i&&s(),r&&r.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var o=!1;return this.isNew()?n.defer(e.success):(R(this,e),o=this.sync("delete",this,e)),i||s(),o},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||q();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.defaults({validate:!0},e))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};u(b,w,"attributes");var E=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},S={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},T=function(e,t,n){n=Math.min(Math.max(n,0),e.length);var r=Array(e.length-n),i=t.length;for(var s=0;s<r.length;s++)r[s]=e[s+n];for(s=0;s<i;s++)e[s+n]=t[s];for(s=0;s<r.length;s++)e[s+i+n]=r[s]};n.extend(E.prototype,l,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,x))},remove:function(e,t){t=n.extend({},t);var r=!n.isArray(e);e=r?[e]:n.clone(e);var i=this._removeModels(e,t);return!t.silent&&i&&this.trigger("update",this,t),r?i[0]:i},set:function(e,t){if(e==null)return;t=n.defaults({},t,S),t.parse&&!this._isModel(e)&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?[e]:e.slice();var i=t.at;i!=null&&(i=+i),i<0&&(i+=this.length+1);var s=[],o=[],u=[],a={},f=t.add,l=t.merge,c=t.remove,h=!1,p=this.comparator&&i==null&&t.sort!==!1,d=n.isString(this.comparator)?this.comparator:null,v;for(var m=0;m<e.length;m++){v=e[m];var g=this.get(v);if(g){if(l&&v!==g){var y=this._isModel(v)?v.attributes:v;t.parse&&(y=g.parse(y,t)),g.set(y,t),p&&!h&&(h=g.hasChanged(d))}a[g.cid]||(a[g.cid]=!0,s.push(g)),e[m]=g}else f&&(v=e[m]=this._prepareModel(v,t),v&&(o.push(v),this._addReference(v,t),a[v.cid]=!0,s.push(v)))}if(c){for(m=0;m<this.length;m++)v=this.models[m],a[v.cid]||u.push(v);u.length&&this._removeModels(u,t)}var b=!1,w=!p&&f&&c;s.length&&w?(b=this.length!=s.length||n.some(this.models,function(e,t){return e!==s[t]}),this.models.length=0,T(this.models,s,0),this.length=this.models.length):o.length&&(p&&(h=!0),T(this.models,o,i==null?this.length:i),this.length=this.models.length),h&&this.sort({silent:!0});if(!t.silent){for(m=0;m<o.length;m++)i!=null&&(t.index=i+m),v=o[m],v.trigger("add",v,this,t);(h||b)&&this.trigger("sort",this,t),(o.length||u.length)&&this.trigger("update",this,t)}return r?e[0]:e},reset:function(e,t){t=t?n.clone(t):{};for(var r=0;r<this.models.length;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(e==null)return void 0;var t=this.modelId(this._isModel(e)?e.attributes:e);return this._byId[e]||this._byId[t]||this._byId[e.cid]},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var r=t.length;return n.isFunction(t)&&(t=n.bind(t,this)),r===1||n.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=n.extend({parse:!0},e);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t.call(e.context,r,n,e),r.trigger("sync",r,n,e)},R(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};var r=t.wait;e=this._prepareModel(e,t);if(!e)return!1;r||this.add(e,t);var i=this,s=t.success;return t.success=function(e,t,n){r&&i.add(e,n),s&&s.call(n.context,e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_removeModels:function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=this.get(e[r]);if(!i)continue;var s=this.indexOf(i);this.models.splice(s,1),this.length--,t.silent||(t.index=s,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n.length?n:!1},_isModel:function(e){return e instanceof b},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes);n!=null&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var n=this.modelId(e.attributes);n!=null&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r);if(e==="change"){var i=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);i!==s&&(i!=null&&delete this._byId[i],s!=null&&(this._byId[s]=t))}this.trigger.apply(this,arguments)}});var N={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};u(E,N,"models");var C=t.View=function(e){this.cid=n.uniqueId("view"),n.extend(this,n.pick(e,L)),this._ensureElement(),this.initialize.apply(this,arguments)},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];n.extend(C.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){e||(e=n.result(this,"events"));if(!e)return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[r]);if(!r)continue;var i=t.match(k);this.delegate(i[1],i[2],n.bind(r,this))}return this},delegate:function(e,t,n){return this.$el.on(e+".delegateEvents"+this.cid,t,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){return this.$el.off(e+".delegateEvents"+this.cid,t,n),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}else this.setElement(n.result(this,"el"))},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,r,i){var s=A[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||q()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1);var a=i.error;i.error=function(e,t,n){i.textStatus=t,i.errorThrown=n,a&&a.call(i.context,e,t,n)};var f=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,f,i),f};var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var O=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},M=/\((.*?)\)/g,_=/(\(\?)?:\w+/g,D=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(O.prototype,l,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o,r)!==!1&&(s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o))}),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(P,"\\$&").replace(M,"(?:$1)?").replace(_,function(e,t){return t?e:"([^/?]+)"}).replace(D,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var H=t.History=function(){this.handlers=[],this.checkUrl=n.bind(this.checkUrl,this),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},B=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,F=/#.*$/;H.started=!1,n.extend(H.prototype,l,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return e.charAt(0)==="/"?e.slice(1):e},getFragment:function(e){return e==null&&(this._usePushState||!this._wantsHashChange?e=this.getPath():e=this.getHash()),e.replace(B,"")},start:function(e){if(H.started)throw new Error("Backbone.history has already been started");H.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(document.documentMode===void 0||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!this.history&&!!this.history.pushState,this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(j,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var r=document.body,i=r.insertBefore(this.iframe,r.firstChild).contentWindow;i.document.open(),i.document.close(),i.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));if(!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),H.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),n.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})):!1},navigate:function(e,t){if(!H.started)return!1;if(!t||t===!0)t={trigger:!!t};e=this.getFragment(e||"");var n=this.root;if(e===""||e.charAt(0)==="?")n=n.slice(0,-1)||"/";var r=n+e;e=this.decodeFragment(e.replace(F,""));if(this.fragment===e)return;this.fragment=e;if(this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,e,t.replace);if(this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var i=this.iframe.contentWindow;t.replace||(i.document.open(),i.document.close()),this._updateHash(i.location,e,t.replace)}}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new H;var I=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};b.extend=E.extend=O.extend=C.extend=H.extend=I;var q=function(){throw new Error('A "url" property or function must be specified')},R=function(e,t){var n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}};return t}),i("ev-script/models/video-settings",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"video",showtitle:!0,autoplay:!1,showcaptions:!1,hidecontrols:!1,socialsharing:!1,annotations:!0,captionsearch:!0,attachments:!0,links:!0,metadata:!0,dateproduced:!0,embedcode:!1,download:!1,search:"",sourceId:"content"}})}),i("ev-script/models/playlist-settings",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"playlist",search:""}})}),i("ev-script/util/events",["require","underscore","backbone"],function(e){"use strict";var t=[],n=e("underscore"),r=e("backbone");return t.global=n.extend({},r.Events),{initEvents:function(e){return t[e]=n.extend({},r.Events)},getEvents:function(e){var n;return e?n=t[e]:n=t.global,n}}}),i("ev-script/util/cache",["require","jquery","underscore","backbone"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=function(){return this.cache=[],this.get=function(e){return e?this.cache[e]:null},this.set=function(e,t){return e?this.cache[e]=t:null},this},s=new i,o=function(e){var t=s.get(e);return t||(t=s.set(e,new i)),t},u=function(e,t){return o(e).set("config",t)},a=function(e){return o(e).get("config")},f=function(e,t){return o(e).set("auth",t)},l=function(e){return o(e).get("auth")},c=function(e,t){return o(e).set("info",t)},h=function(e){return o(e).get("info")},p=function(e,t){var n=s.get(e);n||(n=s.set(e,new i));var r=n.get(t);return r||(r=n.set(t,new i)),r};return{Cache:i,caches:s,setAppConfig:u,getAppConfig:a,setAppAuth:f,getAppAuth:l,setAppInfo:c,getAppInfo:h,getUserCache:p}}),i("ev-script/views/base",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=this,s=e("ev-script/util/events"),o=e("ev-script/util/cache");return r.View.extend({initialize:function(e){this.appId=e.appId,this.config=o.getAppConfig(this.appId),this.auth=o.getAppAuth(this.appId),this.info=o.getAppInfo(this.appId),this.appEvents=s.getEvents(this.appId),this.globalEvents=s.getEvents("global")},ajaxError:function(e,t){e.status===401?this.auth.handleUnauthorized(this.el,t):e.status===500?i.alert("It appears there is an issue with the Ensemble Video installation."):e.status===404?i.alert("Could not find requested resource.  This is likely a problem with the configured Ensemble Video base url."):e.status!==0&&i.alert("An unexpected error occurred.  Check the server log for more details.")},unencode:function(e){return t("<span/>").html(e).text()}})}),i("text",["module"],function(e){"use strict";var t,n,i,s,o,u=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l=typeof location!="undefined"&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,p=l&&(location.port||undefined),d={},v=e.config&&e.config()||{};t={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(f);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=u[t];try{e=new ActiveXObject(n)}catch(r){}if(e){u=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,v.isBuild&&(d[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}v.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=v.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!l||a(u,c,h,p)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(d.hasOwnProperty(n)){var s=t.jsEscape(d[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(v.env==="node"||!v.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])n=r.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="ï»¿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(v.env==="xhr"||!v.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);v.onXhr&&v.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),v.onXhrComplete&&v.onXhrComplete(s,e))},s.send(null)};else if(v.env==="rhino"||!v.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(v.env==="xpconnect"||!v.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)i=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,r,u,a={};o&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(u,1,0,!1),r=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(n.available(),a),r.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),i("text!ev-script/templates/hider.html",[],function(){return'<a class="action-hide" href="#" title="Hide Picker">Hide</a>\n<% if (showLogout) { %>\n    <a class="action-logout" href="#" title="Logout <%= username %>">Logout</a>\n<% } %>\n'}),i("ev-script/views/hider",["require","underscore","ev-script/views/base","text!ev-script/templates/hider.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/hider.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"hideHandler","logoutHandler","authHandler","render"),this.globalEvents.on("loggedIn",this.authHandler),this.globalEvents.on("loggedOut",this.authHandler),this.field=e.field},events:{"click a.action-hide":"hideHandler","click a.action-logout":"logoutHandler"},authHandler:function(e){e===this.config.ensembleUrl&&this.render()},render:function(){var e="";this.info.get("ApplicationVersion")&&this.auth.isAuthenticated()&&(e=this.auth.getUser().get("UserName")),this.$el.html(this.template({showLogout:this.auth.isAuthenticated()&&this.config.authType!=="none",username:e}))},hideHandler:function(e){this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},logoutHandler:function(e){this.auth.logout().always(this.appEvents.trigger("hidePickers")),e.preventDefault()}})}),i("text!ev-script/templates/picker.html",[],function(){return'<div id="<%= id %>-hider" class="ev-hider"></div>\n<div id="<%= id %>-filter-block" class="ev-filter-block">\n    <div class="loader"></div>\n</div>\n<div id="<%= id %>-results" class="ev-results clearfix"></div>\n'}),i("ev-script/views/picker",["require","jquery","underscore","ev-script/views/base","ev-script/views/hider","text!ev-script/templates/picker.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/hider");return r.extend({template:n.template(e("text!ev-script/templates/picker.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseItem","hidePicker","showPicker","setHeight","resizeResults"),this.$el.hide(),this.$el.html(this.template({id:this.id})),this.field=e.field,this.hider=new i({el:this.$("div.ev-hider"),field:this.field,appId:this.appId});var s=this.$("div.loader");t(window.document).on("ajaxSend",n.bind(function(e,t,n){this===n.picker&&s.addClass("loading")},this)).on("ajaxComplete",n.bind(function(e,t,n){this===n.picker&&s.removeClass("loading")},this)),this.appEvents.on("hidePickers",function(e){(!e||this.field.id!==e)&&this.hidePicker()},this),this.appEvents.on("showPicker",function(e){this.field.id===e&&this.$el.is(":hidden")&&this.showPicker()},this),this.appEvents.on("hidePicker",function(e){this.field.id===e&&this.hidePicker()},this),this.hider.render()},chooseItem:function(e){var n=t(e.currentTarget).attr("rel"),r=this.resultsView.collection.get(n);this.model.set({id:n,content:r.toJSON()}),this.field.model.set(this.model.attributes),this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},hidePicker:function(){this.$el.hide()},showPicker:function(){this.hider.render(),this.$el.show()},setHeight:function(e){this.$el.height(e),this.resizeResults()},resizeResults:function(){}})}),i("text!ev-script/templates/search.html",[],function(){return'<form>\n    <label for="<%= id %>">Search:</label>\n    <input id="<%= id %>" type="search" class="form-text search" value="<%- searchVal %>" title="Search Media" />\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),i("ev-script/views/search",["require","underscore","ev-script/views/base","text!ev-script/templates/search.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/search.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"searchHandler","doSearch","autoSearch"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"submit form":"searchHandler","keyup .search":"autoSearch"},render:function(){this.$el.html(this.template({id:this.id+"-input",searchVal:this.picker.model.get("search")}))},doSearch:function(){this.picker.model.set({search:this.$(".search").val()}),this.callback()},searchHandler:function(e){this.doSearch(),e.preventDefault()},autoSearch:function(e){var n=e.target.value;n!==this.lastValue&&(this.lastValue=n,this.submitTimeout&&clearTimeout(this.submitTimeout),this.submitTimeout=setTimeout(t.bind(function(){this.doSearch()},this),1e3))}})}),i("text!ev-script/templates/library-type-select.html",[],function(){return'<form>\n    <label for="<%= id %>">Type:</label>\n    <select id="<%= id %>" class="form-select source" title="Select Library Type">\n      <option value="content" <% if (sourceId === \'content\') { print(\'selected="selected"\'); } %>>Media Library</option>\n      <option value="shared" <% if (sourceId === \'shared\') { print(\'selected="selected"\'); } %>>Shared Library</option>\n    </select>\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),i("ev-script/views/library-type-select",["require","underscore","ev-script/views/base","text!ev-script/templates/library-type-select.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/library-type-select.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"changeHandler"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"change .source":"changeHandler"},render:function(){this.$el.html(this.template({id:this.id+"-select",sourceId:this.picker.model.get("sourceId")}))},changeHandler:function(e){this.picker.model.set({sourceId:this.$(".source").val()}),this.callback(),e.preventDefault()}})}),i("text!ev-script/templates/options.html",[],function(){return"<% collection.each(function(item) { %>\n    <option value=\"<%= item.id %>\" <% if (selectedId === item.id) { print('selected=\"selected\"'); } %>><%- item.get('Name') %></option>\n<% }); %>\n"}),i("ev-script/views/organization-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("organizationId")||this.auth.getUser().get("OrganizationID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),i("ev-script/collections/base",["require","jquery","underscore","backbone","ev-script/util/cache"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/cache");return r.Collection.extend({initialize:function(e,t){this.requiresAuth=!0,this.appId=t.appId,this.config=i.getAppConfig(this.appId),this.auth=i.getAppAuth(this.appId),this.info=i.getAppInfo(this.appId)},model:r.Model.extend({idAttribute:"ID"}),getCached:function(e){},setCached:function(e,t){},clearCache:function(e){},parse:function(e){return e.Data},fetch:function(e){return e&&e.success&&(e.success=n.wrap(e.success,n.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),r.Collection.prototype.fetch.call(this,e)},sync:function(e,i,s){n.defaults(s||(s={}),{xhrFields:{withCredentials:!0}});if(e==="read"){var o=this.getCached(s.cacheKey);if(o){var u=t.Deferred();return s.success&&u.done(s.success),u.resolve(o).promise()}return s.success=s.success||function(e,t,n){},s.success=n.wrap(s.success,n.bind(function(e){this.setCached(s.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),r.Collection.prototype.sync.call(this,e,i,s)}return r.Collection.prototype.sync.call(this,e,i,s)}})}),i("ev-script/collections/organizations",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n)},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;return s?s[t?"set":"get"](e,t):null},getCached:function(e){return this._cache("orgs")},setCached:function(e,t){return this._cache("orgs",t)},url:function(){var e=this.config.ensembleUrl+"/api/Organizations",t="PageSize=9999",n="PageIndex=1",r=e+"?"+t+"&"+n;return this.config.urlCallback?this.config.urlCallback(r):r}})}),i("ev-script/views/library-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("libraryId")||this.auth.getUser().get("LibraryID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),i("ev-script/collections/libraries",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.organizationId||""},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("libs");o||s.set("libs",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Libraries",t="PageSize=9999",n="PageIndex=1",r="FilterOn=OrganizationId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),i("text!ev-script/templates/unit-selects.html",[],function(){return'<form id="<%= formId %>" class="unit-selects">\n    <label for="<%= orgSelectId %>">Organization:</label>\n    <select id="<%= orgSelectId %>" class="form-select organizations" title="Select Organization"></select>\n    <label for="<%= libSelectId %>">Library:</label>\n    <select id="<%= libSelectId %>" class="form-select libraries" title="Select Library"></select>\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),i("ev-script/views/unit-selects",["require","jquery","underscore","ev-script/views/base","ev-script/views/organization-select","ev-script/collections/organizations","ev-script/views/library-select","ev-script/collections/libraries","text!ev-script/templates/unit-selects.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/organization-select"),s=e("ev-script/collections/organizations"),o=e("ev-script/views/library-select"),u=e("ev-script/collections/libraries");return r.extend({template:n.template(e("text!ev-script/templates/unit-selects.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadOrgs","loadLibraries","changeOrganization","changeLibrary"),this.picker=e.picker,this.id=e.id,this.$el.html(this.template({formId:this.id+"-unit-selects",orgSelectId:this.id+"-org-select",libSelectId:this.id+"-lib-select"})),this.orgSelect=new i({el:this.$(".organizations"),picker:this.picker,appId:this.appId,collection:new s({},{appId:this.appId})}),this.libSelect=new o({el:this.$(".libraries"),picker:this.picker,appId:this.appId,collection:new u({},{appId:this.appId})})},events:{"change select.organizations":"changeOrganization","change select.libraries":"changeLibrary"},changeOrganization:function(e){this.picker.model.set({organizationId:e.target.value}),this.loadLibraries()},changeLibrary:function(e){this.picker.model.set({libraryId:e.target.value})},loadOrgs:function(){var e=new s({},{appId:this.appId});e.fetch({picker:this.picker,success:n.bind(function(e,t,n){this.orgSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadOrgs()},this))},this)})},loadLibraries:function(){var e=this.picker.model.get("organizationId"),t=new u({},{organizationId:e,appId:this.appId});t.fetch({picker:this.picker,cacheKey:e,success:n.bind(function(e,t,n){this.libSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadLibraries()},this))},this)})}})}),function(e){"use strict";typeof i=="function"&&i.amd?i("ev-scroll-loader",["jquery"],e):typeof module=="object"&&typeof module.exports=="object"?e(r("jquery")):e(jQuery)}(function(e){"use strict";var t={onScrolled:function(){}},n={init:function(n){var r=e.extend({},t,n);return this.each(function(){var t=e(this),n=t.wrap('<div class="scrollWrap"/>').closest(".scrollWrap");t.addClass("scroll-content"),n.append('<div class="loader"></div>'),n.css({position:"relative",height:r.height?typeof r.height=="number"?r.height+"px":r.height:"100%","max-height":t[0].scrollHeight+"px","overflow-y":"scroll"}),n.scroll(function(){n.scrollTop()>=n[0].scrollHeight-n.height()-1&&r.onScrolled.call(t)})})},showLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).show(),this},hideLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).hide(),this}};e.fn.evScrollLoader=function(e){if(n[e])return n[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return n.init.apply(this,arguments)}}),i("text!ev-script/templates/results.html",[],function(){return'<div class="total">Search returned <%= totalResults %> results.</div>\n<div class="results">\n    <table class="content-list"></table>\n</div>\n'}),i("text!ev-script/templates/no-results.html",[],function(){return'<tr class="odd"><td colspan="2">No results available.</td></tr>\n'}),i("ev-script/views/results",["require","jquery","underscore","ev-script/views/base","ev-scroll-loader","text!ev-script/templates/results.html","text!ev-script/templates/no-results.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base");return e("ev-scroll-loader"),r.extend({resultsTemplate:n.template(e("text!ev-script/templates/results.html")),emptyTemplate:n.template(e("text!ev-script/templates/no-results.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"render","loadMore","addHandler","previewItem","setHeight","resizeResults"),this.picker=e.picker,this.appId=e.appId,this.loadLock=!1},events:{"click a.action-preview":"previewItem"},getItemHtml:function(e,t){if(this.resultTemplate)return this.resultTemplate({item:e,index:t})},previewItem:function(e){var n=e.currentTarget,r=t(n).attr("rel"),i=this.collection.get(r),s={id:r,content:i.toJSON(),appId:this.appId},o=new this.previewClass({el:n,model:new this.modelClass(s),appId:this.appId,picker:this.picker});e.stopPropagation(),e.preventDefault()},loadMore:function(){this.collection.hasMore&&!this.loadLock&&(this.loadLock=!0,this.collection.fetch({remove:!1,picker:this.picker,success:n.bind(function(e,t,r){n.size(t.Data)<this.config.pageSize?(e.hasMore=!1,this.$scrollLoader.evScrollLoader("hideLoader")):(e.hasMore=!0,e.pageIndex+=1),this.loadLock=!1},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadMore()},this)),this.loadLock=!1},this)}))},addHandler:function(e,n,r){var i=t(this.getItemHtml(e,n.indexOf(e)));this.decorate(i),this.$(".content-list").append(i)},decorate:function(e){},render:function(){this.$el.html(this.resultsTemplate({totalResults:this.collection.totalResults})),this.$total=this.$(".total"),this.$results=this.$(".results"),this.resizeResults();var e=this.$(".content-list");this.collection.isEmpty()?e.append(this.emptyTemplate()):this.collection.each(function(n,r){var i=t(this.getItemHtml(n,r));this.decorate(i),e.append(i)},this);var n=this.config.scrollHeight;this.$scrollLoader=e.evScrollLoader({height:n,onScrolled:this.loadMore}),this.collection.hasMore||this.$scrollLoader.evScrollLoader("hideLoader"),this.collection.off("add",this.addHandler).on("add",this.addHandler)},setHeight:function(e){this.$el.height(e),this.resizeResults()},resizeResults:function(){this.config.fitToParent&&this.$results&&(this.$results.height(this.$el.height()-this.$total.outerHeight(!0)),this.$(".resultItem").each(n.bind(function(e,n){this.decorate(t(n))},this)))}})}),i("ev-script/views/preview",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","jquery-ui"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings");return e("jquery-ui"),r.extend({initialize:function(e){r.prototype.initialize.call(this,e);var s=t('<div class="dialogWrap"></div>'),o=this.model.get("content")||{Title:this.model.get("id")},u=new this.model.constructor(this.model.toJSON()),a={width:this.model.get("width")||(this.model instanceof i?640:800),height:this.model.get("height")||(this.model instanceof i?360:850)},f={},l=50,c=140,h,p,d;this.$el.after(s),f.width=Math.min(a.width+l,t(window).width()-this.config.dialogMargin),f.height=Math.min(a.height+c,t(window).height()-this.config.dialogMargin),p=f.width-l,this.model instanceof i&&a.width>p&&(h=p/a.width,a.width=a.width*h,a.height=a.height*h),u.set("width",a.width),u.set("height",a.height),d=s.dialog({title:this.unencode(o.Title||o.Name),modal:!0,width:f.width,height:f.height,draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(e,t){var n=new this.embedClass({model:u,appId:this.appId});s.html(n.$el)},this),close:function(e,t){s.dialog("destroy").remove()}})}})}),i("text!ev-script/templates/video-embed.html",[],function(){return'<iframe src="<%= ensembleUrl %>/app/plugin/embed.aspx?ID=<%= id %>&autoPlay=<%= autoPlay %>&displayTitle=<%= displayTitle %>&displaySharing=<%= displaySharing %>&displayAnnotations=<%= displayAnnotations %>&displayCaptionSearch=<%= displayCaptionSearch %>&displayAttachments=<%= displayAttachments %>&displayLinks=<%= displayLinks %>&displayMetaData=<%= displayMetaData %>&displayDateProduced=<%= displayDateProduced %>&displayEmbedCode=<%= displayEmbedCode %>&displayDownloadIcon=<%= displayDownloadIcon %>&hideControls=true&showCaptions=<%= showCaptions %>&width=<%= width %>&height=<%= height %>&isNewPluginEmbed=true"\n        frameborder="0"\n        width="<%= width %>"\n        height="<%= (parseInt(height, 10) + 40) %>"\n        allowfullscreen>\n</iframe>\n'}),i("text!ev-script/templates/video-embed-legacy.html",[],function(){return'<iframe src="<%= ensembleUrl %>/app/plugin/embed.aspx?ID=<%= id %>&autoPlay=<%= autoPlay %>&displayTitle=<%= displayTitle %>&hideControls=<%= hideControls %>&showCaptions=<%= showCaptions %>&width=<%= width %>&height=<%= height %>"\n        frameborder="0"\n        style="width: <%= width %>px;height:<%= (parseInt(height, 10) + 56) %>px;"\n        allowfullscreen>\n</iframe>\n'}),i("ev-script/views/video-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/video-embed.html","text!ev-script/templates/video-embed-legacy.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/video-embed.html")),legacyTemplate:t.template(e("text!ev-script/templates/video-embed-legacy.html")),initialize:function(e){n.prototype.initialize.call(this,e);var t=this.model.get("width")?this.model.get("width"):"640",r=this.model.get("height")?this.model.get("height"):"360",i=this.model.get("showtitle"),s="";this.info.checkVersion(">=3.12.0")?s=this.template({ensembleUrl:this.config.ensembleUrl,id:this.model.get("id"),autoPlay:this.model.get("autoplay"),displayTitle:i,displaySharing:this.model.get("socialsharing"),displayAnnotations:this.model.get("annotations"),displayCaptionSearch:this.model.get("captionsearch"),displayAttachments:this.model.get("attachments"),displayLinks:this.model.get("links"),displayMetaData:this.model.get("metadata"),displayDateProduced:this.model.get("dateproduced"),displayEmbedCode:this.model.get("embedcode"),displayDownloadIcon:this.model.get("download"),showCaptions:this.model.get("showcaptions"),width:t,height:r}):s=this.legacyTemplate({ensembleUrl:this.config.ensembleUrl,id:this.model.get("id"),autoPlay:this.model.get("autoplay"),displayTitle:i,hideControls:this.model.get("hidecontrols"),showCaptions:this.model.get("showcaptions"),width:t,height:i?r+25:r}),this.$el.html(s)}})}),i("ev-script/models/base",["require","jquery","underscore","backbone","ev-script/util/cache","ev-script/collections/base"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/cache"),s=e("ev-script/collections/base");return r.Model.extend({initialize:function(e,t){this.appId=t.appId,this.config=i.getAppConfig(this.appId)},getCached:function(){},setCached:function(){},fetch:function(e){return e&&e.success&&(e.success=n.wrap(e.success,n.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),r.Model.prototype.fetch.call(this,e)},sync:function(e,i,s){n.defaults(s||(s={}),{xhrFields:{withCredentials:!0}});if(e==="read"){var o=this.getCached(s.cacheKey);if(o){var u=t.Deferred();return s.success&&u.done(s.success),u.resolve(o).promise()}return s.success=s.success||function(e,t,n){},s.success=n.wrap(s.success,n.bind(function(e){this.setCached(s.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),r.Model.prototype.sync.call(this,e,i,s)}return r.Model.prototype.sync.call(this,e,i,s)}})}),i("ev-script/models/video-encoding",["require","backbone","ev-script/models/base","underscore","ev-script/util/cache"],function(e){"use strict";var t=e("backbone"),n=e("ev-script/models/base"),r=e("underscore"),i=e("ev-script/util/cache");return n.extend({idAttribute:"videoID",initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},getCached:function(e){},setCached:function(e,t){},url:function(){var e=this.config.ensembleUrl+"/app/api/content/show.json/"+this.get("fetchId");return this.config.urlCallback?this.config.urlCallback(e):e},getDims:function(){var e=this.get("dimensions")||"640x360",t=e.split("x"),n=[];return n[0]=this.isAudio()?400:parseInt(t[0],10)||640,n[1]=this.isAudio()?26:parseInt(t[1],10)||360,n},getRatio:function(){var e=this.getDims();return e[0]/e[1]},getWidth:function(){return this.getDims()[0]},getHeight:function(){return this.getDims()[1]},isAudio:function(){return/^audio/i.test(this.get("contentType")||"")},parse:function(e){return r.isArray(e.dataSet.encodings)?r.max(e.dataSet.encodings,function(e,t,n){return parseInt(e.bitRate,10)}):e.dataSet.encodings},sync:function(e,n,i){return r.extend(i,{dataFilter:function(e){var t=e.match(/\{[\s\S]*\}/);return t?t[0]:e}}),t.sync.call(this,e,n,i)}})}),i("ev-script/views/video-preview",["require","underscore","ev-script/views/preview","ev-script/views/video-embed","ev-script/models/video-encoding"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/preview"),r=e("ev-script/views/video-embed"),i=e("ev-script/models/video-encoding");return n.extend({embedClass:r,initialize:function(e){this.appId=e.appId,this.encoding=e.encoding||new i({fetchId:this.model.id},{appId:this.appId}),this.picker=e.picker;var r=t.bind(function(){(!this.model.get("width")||!this.model.get("height"))&&this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()}),n.prototype.initialize.call(this,e)},this);this.encoding.isNew()?this.encoding.fetch({success:r,picker:this.picker}):r()}})}),function(e){var t=/(\s*\S+|\s)$/;e.truncate=function(t,n){return e("<div></div>").append(t).truncate(n).html()},e.fn.truncate=function(n){e.isNumeric(n)&&(n={length:n});var r=e.extend({},e.truncate.defaults,n);return this.each(function(){var n=e(this);r.noBreaks&&n.find("br").replaceWith(" ");var i=n.text(),s=i.length-r.length;r.stripTags&&n.text(i),r.words&&s>0&&(s=i.length-i.slice(0,r.length).replace(t,"").length-1);if(s<0||!s&&!r.truncated)return;e.each(n.contents().get().reverse(),function(t,n){var i=e(n),u=i.text(),a=u.length;if(a<=s){r.truncated=!0,s-=a,i.remove();return}return n.nodeType===3?(e(n.splitText(a-s-1)).replaceWith(r.ellipsis),!1):(i.truncate(e.extend(r,{length:a-s})),!1)})})},e.truncate.defaults={stripTags:!1,words:!1,noBreaks:!1,length:Infinity,ellipsis:"â¦"}}(jQuery),i("jquery-truncate-html",function(){}),i("text!ev-script/templates/video-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %> resultItem">\n    <td class="content-actions">\n        <img src="<%= item.get(\'ThumbnailUrl\').replace(/width=100/i, \'width=200\') %>" alt="<%= item.get(\'Title\') %> thumbnail image"/>\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%= item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><i class="fa fa-plus-circle fa-lg"></i><span>Choose</span></a>\n            <a class="action-preview" href="#" title="Preview: <%= item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><i class="fa fa-play-circle fa-lg"></i><span>Preview: <%= item.get(\'Title\') %></span></a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <table class="content-item">\n            <tbody>\n                <tr class="title">\n                    <td colspan="2">\n                        <a class="action-preview" title="Preview: <%= item.get(\'Title\') %>" href="#" rel="<%= item.get(\'ID\') %>"><%= item.get(\'Title\') %></a>\n                    </td>\n                </tr>\n                <tr class="trunc"><td class="label">Description</td><td class="value"><%= item.get(\'Description\') %></td></tr>\n                <tr><td class="label">Date Added</td><td class="value"><%- new Date(item.get(\'AddedOn\')).toLocaleString() %></td></tr>\n                <tr class="trunc"><td class="label">Keywords</td><td class="value"><%= item.get(\'Keywords\') %></td></tr>\n                <tr><td class="label">Library</td><td class="value"><%- item.get(\'LibraryName\') %></td></tr>\n            </tbody>\n        </table>\n    </td>\n</tr>\n'}),i("ev-script/views/video-results",["require","jquery","underscore","ev-script/views/results","ev-script/models/video-settings","ev-script/views/video-preview","jquery-truncate-html","text!ev-script/templates/video-result.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/results"),i=e("ev-script/models/video-settings"),s=e("ev-script/views/video-preview");return e("jquery-truncate-html"),r.extend({modelClass:i,previewClass:s,resultTemplate:n.template(e("text!ev-script/templates/video-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)},decorate:function(e){t(".trunc .value",e).each(function(e){var n=t(this),r,i,s=100,o=n.data("fullText")||n.html(),u=t.truncate(o,{length:s,stripTags:!0,noBreaks:!0});n.empty();if(t(window).width()<1100&&o.length>s){n.data("fullText",o),r=t("<span>"+o+"</span>"),i=t("<span>"+u+"</span>");var a=t('<a href="#">Less</a>').click(function(e){r.hide(),i.show(),e.preventDefault()}),f=t('<a href="#">More</a>').click(function(e){i.hide(),r.show(),e.preventDefault()});r.hide().append(a),i.append(f),n.append(i).append(r)}else n.append(o)})}})}),i("ev-script/collections/videos",["require","ev-script/collections/base","ev-script/util/cache","underscore"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache"),r=e("underscore");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.libraryId=n.libraryId||"",this.filterOn=n.filterOn||"",this.filterValue=n.filterValue||"",this.info.checkVersion(">=4.1.0")?this.sourceUrl=n.sourceId==="shared"?"/api/SharedLibrary":"/api/MediaLibrary":this.sourceUrl=n.sourceId==="shared"?"/api/SharedContent":"/api/Content",this.pageIndex=1},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("videos");o||s.set("videos",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},clearCache:function(){var e=this.auth.getUser(),t=e?n.getUserCache(this.config.ensembleUrl,e.id):null;t&&t.set("videos",null)},url:function(){var e=this.config.ensembleUrl+this.sourceUrl,t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r="FilterOn="+encodeURIComponent(this.filterOn),i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"/"+this.libraryId+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s},parse:function(e){var t=e.Data;return r.each(t,function(e){e.Description=r.unescape(e.Description),e.Keywords=r.unescape(e.Keywords)}),t}})}),i("ev-script/collections/media-workflows",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.libraryId||""},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("workflows");o||s.set("workflows",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/MediaWorkflows",t="PageSize=9999",n="PageIndex=1",r="FilterOn=LibraryId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s},parse:function(e){return this.settings=e.Settings,e.Data}})}),i("ev-script/views/workflow-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.$el.html('<option value="-1">Loading...</option>'),this.render()},render:function(){var e=this.collection.findWhere({IsDefault:!0})||this.collection.at(0);this.$el.html(this.template({selectedId:e.id,collection:this.collection}))},getSelected:function(){return this.collection.get(this.$("option:selected").val())}})}),i("text!ev-script/templates/upload.html",[],function(){return'<form class="upload-form" method="POST" action="">\n    <select class="form-select" name="MediaWorkflowID"></select>\n    <div class="fieldWrap">\n        <label for="Title">Title *</label>\n        <input class="form-text" type="text" name="Title" id="Title" />\n    </div>\n    <div class="fieldWrap">\n        <label for="Description">Description</label>\n        <textarea class="form-text" name="Description" id="Description" />\n    </div>\n    <div class="upload"></div>\n</form>\n'}),i("ev-script/views/upload",["require","jquery","underscore","plupload","ev-script/views/base","backbone","ev-script/views/workflow-select","ev-script/models/video-settings","jquery.plupload.queue","text!ev-script/templates/upload.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("plupload"),i=e("ev-script/views/base"),s=e("backbone"),o=e("ev-script/views/workflow-select"),u=e("ev-script/models/video-settings");return e("jquery.plupload.queue"),i.extend({template:n.template(e("text!ev-script/templates/upload.html")),events:{"change select":"handleSelect"},initialize:function(e){i.prototype.initialize.call(this,e),n.bindAll(this,"render","decorateUploader","closeDialog","handleSelect"),this.field=e.field,this.$anchor=this.$el,this.setElement(this.template()),this.$upload=this.$(".upload"),this.workflows=e.workflows,this.workflowSelect=new o({appId:this.appId,el:this.$("select")[0],collection:this.workflows}),this.render(),this.decorateUploader(),this.appEvents.on("hidePickers",this.closeDialog)},getWidth:function(){return Math.min(600,t(window).width()-this.config.dialogMargin)},getHeight:function(){return Math.min(400,t(window).height()-this.config.dialogMargin)},decorateUploader:function(){var e="",i=this.workflowSelect.getSelected(),s=parseInt(i.get("MaxUploadSize"),10);this.workflows.settings.SupportedVideo&&(e+=this.workflows.settings.SupportedVideo.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.workflows.settings.SupportedAudio&&(e+=this.workflows.settings.SupportedAudio.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.$upload.pluploadQueue()&&this.$upload.pluploadQueue().destroy(),this.$upload.pluploadQueue({url:this.workflows.settings.SubmitUrl,runtimes:"html5,html4,flash",max_file_size:s>0?s+"gb":"12gb",max_file_count:1,max_retries:5,chunk_size:"2mb",unique_names:!1,multiple_queues:!1,multi_selection:!1,drag_drop:!0,multipart:!0,flash_swf_url:this.config.pluploadFlashPath,preinit:{Init:n.bind(function(e,n){t(".plupload_container",this.$upload).removeAttr("title"),t(".plupload_add",this.$upload).text("Add file")},this),PostInit:n.bind(function(e,n){t(".plupload_droptext",this.$upload).text("Drag file here.")},this),UploadFile:n.bind(function(e,t){e.settings.multipart_params={Title:this.$("#Title").val(),Description:this.$("#Description").val(),MediaWorkflowID:this.$("select").val()}},this)},init:{StateChanged:n.bind(function(e){switch(e.state){case r.STARTED:e.state===r.STARTED&&(t(".plupload_cancel",this.$upload).length===0&&(this.$cancel=t('<a class="plupload_button plupload_cancel" href="#">Cancel upload</a>').insertBefore(t(".plupload_filelist_footer .plupload_clearer",this.$upload)).click(n.bind(function(){e.stop(),this.decorateUploader()},this))),this.$cancel&&this.$cancel.show());break;case r.STOPPED:this.$cancel&&this.$cancel.hide()}},this),BeforeUpload:n.bind(function(e,n){var r=this.$("#Title"),i=r.val();if(!i||i.trim()==="")r.focus(),e.stop(),t(".plupload_upload_status",this.$upload).hide(),t(".plupload_buttons",this.$upload).show()},this),FilesAdded:n.bind(function(t,i){var s=e.split(",");n.each(i,function(e){var i=e.name.split("."),o=i[i.length-1];n.contains(s,o.toLowerCase())||(t.removeFile(e),t.trigger("Error",{code:r.FILE_EXTENSION_ERROR,message:r.translate("File extension error."),file:e}))}),t.files.length>1&&t.splice(0,t.files.length-1)},this),UploadComplete:n.bind(function(){this.closeDialog()},this),FileUploaded:n.bind(function(e,t,n){this.appEvents.trigger("fileUploaded")},this)}}),this.$upload.pluploadQueue().bind("refresh",function(){t("div.upload > div.plupload").css({"z-index":"0"}),t(".plupload_button").css({"z-index":"1"})}),this.$upload.pluploadQueue().refresh()},closeDialog:function(){this.$dialog&&this.$dialog.dialog("close")},handleSelect:function(e){this.decorateUploader()},render:function(){var e=t('<div class="dialogWrap"></div>'),r;this.$anchor.after(e),this.$dialog=e.dialog({title:"Upload Media to Ensemble",modal:!0,width:this.getWidth(),height:this.getHeight(),draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(t,n){e.html(this.$el)},this),close:n.bind(function(t,n){this.$upload.pluploadQueue().destroy(),e.dialog("destroy").remove(),this.appEvents.off("hidePickers",this.closeDialog),this.$dialog=null},this)})}})}),i("ev-script/views/video-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/search","ev-script/views/library-type-select","ev-script/views/unit-selects","ev-script/views/video-results","ev-script/collections/videos","ev-script/collections/media-workflows","ev-script/views/upload"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/search"),s=e("ev-script/views/library-type-select"),o=e("ev-script/views/unit-selects"),u=e("ev-script/views/video-results"),a=e("ev-script/collections/videos"),f=e("ev-script/collections/media-workflows"),l=e("ev-script/views/upload");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadVideos","loadWorkflows","changeLibrary","handleSubmit","uploadHandler");var a=n.bind(function(){this.loadVideos()},this);this.$filterBlock=this.$("div.ev-filter-block"),this.info.get("ApplicationVersion")&&(this.$upload=t('<div class="ev-actions"><a href="#" class="action-upload" title="Upload"><i class="fa fa-upload fa-fw"></i><span>Upload<span></a></div>').css("display","none"),this.$filterBlock.prepend(this.$upload)),this.searchView=new i({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:a}),this.$filterBlock.prepend(this.searchView.$el),this.searchView.render(),this.typeSelectView=new s({id:this.id+"-type-select",tagName:"div",className:"ev-type-select",picker:this,appId:this.appId,callback:a}),this.$filterBlock.prepend(this.typeSelectView.$el),this.typeSelectView.render(),this.info.get("ApplicationVersion")&&(this.unitSelects=new o({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$filterBlock.prepend(this.unitSelects.$el)),this.resultsView=new u({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click .action-add":"chooseItem","click .action-upload":"uploadHandler","change form.unit-selects select.libraries":"changeLibrary","submit form.unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadVideos(),this.loadWorkflows()},handleSubmit:function(e){this.loadVideos(),e.preventDefault()},uploadHandler:function(e){var t=new l({appId:this.appId,field:this.field,workflows:this.workflows});e.preventDefault()},showPicker:function(){r.prototype.showPicker.call(this),this.info.get("ApplicationVersion")?(this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()):(this.searchView.$('input[type="text"]').focus(),this.loadVideos())},loadVideos:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("sourceId"),i=this.model.get("libraryId"),s=r+i+e,o=new a({},{sourceId:r,libraryId:i,filterOn:"",filterValue:e,appId:this.appId}),u=n.bind(function(){o.clearCache(),this.loadVideos()},this);o.fetch({picker:this,cacheKey:s,success:n.bind(function(e,t,r){var i=e.totalResults=parseInt(t.Pager.TotalRecords,10),s=n.size(t.Data);s===i?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadVideos()},this))},this)}),this.appEvents.off("fileUploaded").on("fileUploaded",u)},loadWorkflows:function(){this.workflows=new f({},{appId:this.appId}),this.workflows.filterValue=this.model.get("libraryId"),this.workflows.fetch({cacheKey:this.workflows.filterValue,success:n.bind(function(e,t,n){e.isEmpty()?this.$upload.css("display","none"):this.$upload.css("display","inline-block"),this.resizeResults()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadWorkflows()},this))},this),reset:!0})},resizeResults:function(){this.config.fitToParent&&this.resultsView.setHeight(this.$el.height()-this.hider.$el.outerHeight(!0)-this.$filterBlock.outerHeight(!0))}})}),i("ev-script/views/settings",["require","underscore","ev-script/views/base","jquery-ui"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return e("jquery-ui"),n.extend({initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"show","cancelHandler","submitHandler"),this.field=e.field},events:{submit:"submitHandler","click input.action-cancel":"cancelHandler"},show:function(){this.render(),this.$el.dialog("open")},cancelHandler:function(e){this.$el.dialog("close"),e.preventDefault()},submitHandler:function(e){this.updateModel(),this.$el.dialog("close"),e.preventDefault()},updateModel:function(){}})}),i("text!ev-script/templates/video-settings.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size" <% if (isAudio) { print(\'disabled\'); } %> >\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div class="fieldWrap">\n            <label for="showtitle">Title</label>\n            <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="socialsharing">Social Tools</label>\n            <input id="socialsharing" class="form-checkbox" <% if (model.get(\'socialsharing\')) { print(\'checked="checked"\'); } %> name="socialsharing" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="annotations">Annotations</label>\n            <input id="annotations" class="form-checkbox" <% if (model.get(\'annotations\')) { print(\'checked="checked"\'); } %> name="annotations" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="captionsearch">Caption Search</label>\n            <input id="captionsearch" class="form-checkbox" <% if (model.get(\'captionsearch\')) { print(\'checked="checked"\'); } %> name="captionsearch" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="autoplay">Auto Play (PC Only)</label>\n            <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="attachments">Attachments</label>\n            <input id="attachments" class="form-checkbox" <% if (model.get(\'attachments\')) { print(\'checked="checked"\'); } %> name="attachments" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="links">Links</label>\n            <input id="links" class="form-checkbox" <% if (model.get(\'links\')) { print(\'checked="checked"\'); } %> name="links" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="metadata">Meta Data</label>\n            <input id="metadata" class="form-checkbox" <% if (model.get(\'metadata\')) { print(\'checked="checked"\'); } %> name="metadata" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="dateproduced">Date Produced</label>\n            <input id="dateproduced" class="form-checkbox" <% if (model.get(\'dateproduced\')) { print(\'checked="checked"\'); } %> name="dateproduced" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="embedcode">Embed Code</label>\n            <input id="embedcode" class="form-checkbox" <% if (model.get(\'embedcode\')) { print(\'checked="checked"\'); } %> name="embedcode" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="download">Download Link</label>\n            <input id="download" class="form-checkbox" <% if (model.get(\'download\')) { print(\'checked="checked"\'); } %> name="download" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="showcaptions">Captions "On" By Default</label>\n            <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox"/>\n        </div>\n        <div class="form-actions">\n            <input type="button" class="form-submit action-cancel" value="Cancel"/>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),i("text!ev-script/templates/video-settings-legacy.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size" <% if (isAudio) { print(\'disabled\'); } %> >\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div class="fieldWrap">\n            <label for="showtitle">Show Title</label>\n            <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="autoplay">Auto Play</label>\n            <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="showcaptions">Show Captions</label>\n            <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="fieldWrap">\n            <label for="hidecontrols">Hide Controls</label>\n            <input id="hidecontrols" class="form-checkbox" <% if (model.get(\'hidecontrols\')) { print(\'checked="checked"\'); } %>  name="hidecontrols" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="form-actions">\n            <input type="button" class="form-submit action-cancel" value="Cancel"/>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),i("text!ev-script/templates/sizes.html",[],function(){return'<% _.each(sizes, function(size) { %>\n    <option value="<%= size %>" <% if (size === target) { print(\'selected="selected"\'); } %>><%= size %></option>\n<% }); %>\n'}),i("ev-script/views/video-settings",["require","jquery","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/video-settings.html","text!ev-script/templates/video-settings-legacy.html","text!ev-script/templates/sizes.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/settings");return e("jquery-ui"),r.extend({template:n.template(e("text!ev-script/templates/video-settings.html")),legacyTemplate:n.template(e("text!ev-script/templates/video-settings-legacy.html")),sizesTemplate:n.template(e("text!ev-script/templates/sizes.html")),initialize:function(e){r.prototype.initialize.call(this,e),this.encoding=e.encoding,this.encoding.on("change:id",n.bind(function(){this.render()},this))},updateModel:function(){var e={showtitle:this.$("#showtitle").is(":checked"),autoplay:this.$("#autoplay").is(":checked"),showcaptions:this.$("#showcaptions").is(":checked"),hidecontrols:this.$("#hidecontrols").is(":checked")};this.info.checkVersion(">=3.12.0")&&(e=n.extend(e,{socialsharing:this.$("#socialsharing").is(":checked"),annotations:this.$("#annotations").is(":checked"),captionsearch:this.$("#captionsearch").is(":checked"),attachments:this.$("#attachments").is(":checked"),links:this.$("#links").is(":checked"),metadata:this.$("#metadata").is(":checked"),dateproduced:this.$("#dateproduced").is(":checked"),embedcode:this.$("#embedcode").is(":checked"),download:this.$("#download").is(":checked")}));var t=this.$("#size").val();if(!t||t==="original")this.encoding&&!this.encoding.isNew()&&n.extend(e,{width:this.encoding.getWidth(),height:this.encoding.getHeight()});else{var r=t.split("x");n.extend(e,{width:parseInt(r[0],10),height:parseInt(r[1],10)})}this.field.model.set(e)},renderSize:function(){var e=this.field.model.get("width"),t=this.field.model.get("height"),n=16/9,r=["1280x720","1024x576","848x480","720x405","640x360","610x344","560x315","480x270","400x225","320x180","240x135","160x90"];e&&t?n=e/t:this.encoding.id&&(e=this.encoding.getWidth(),t=this.encoding.getHeight(),n=this.encoding.getRatio()),Math.ceil(n*10)/10===Math.ceil(4/3*10)/10&&(r=["1280x960","1024x770","848x636","720x540","640x480","610x460","560x420","480x360","400x300","320x240","240x180","160x120"]);var i=e+"x"+t;this.$(".size").append(this.sizesTemplate({sizes:r,target:i}))},render:function(){var e="";this.info.checkVersion(">=3.12.0")?e=this.template({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio()}):e=this.legacyTemplate({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio()}),this.$el.html(e),this.encoding&&!this.encoding.isAudio()&&this.renderSize();var n=this.field.model.get("content");this.$el.dialog({title:this.unencode(n?n.Title:this.field.model.get("id")),modal:!0,autoOpen:!1,draggable:!1,resizable:!1,dialogClass:"ev-dialog",width:Math.min(340,t(window).width()-this.config.dialogMargin),height:Math.min(480,t(window).height()-this.config.dialogMargin)})}})}),i("text!ev-script/templates/playlist-embed.html",[],function(){return'<iframe src="<%= ensembleUrl %>/app/plugin/embed.aspx?DestinationID=<%= modelId %>"\n        frameborder="0"\n        style="width:800px;height:850px;"\n        allowfullscreen>\n</iframe>\n'}),i("ev-script/views/playlist-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/playlist-embed.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/playlist-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e),this.$el.html(this.template({modelId:this.model.get("id"),ensembleUrl:this.config.ensembleUrl}))}})}),i("ev-script/views/playlist-preview",["require","ev-script/views/preview","ev-script/views/playlist-embed"],function(e){"use strict";var t=e("ev-script/views/preview"),n=e("ev-script/views/playlist-embed");return t.extend({initialize:function(e){t.prototype.initialize.call(this,e)},embedClass:n})}),i("text!ev-script/templates/playlist-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <i class="fa fa-plus-circle fa-lg"></i><span>Choose</span>\n            </a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <i class="fa fa-play-circle fa-lg"></i><span>Preview: <%- item.get(\'Name\') %></span>\n            </a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <span><%- item.get(\'Name\') %></span>\n    </td>\n</tr>\n'}),i("ev-script/views/playlist-results",["require","underscore","jquery","ev-script/views/results","ev-script/models/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/playlist-result.html"],function(e){"use strict";var t=e("underscore"),n=e("jquery"),r=e("ev-script/views/results"),i=e("ev-script/models/playlist-settings"),s=e("ev-script/views/playlist-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:t.template(e("text!ev-script/templates/playlist-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)}})}),i("ev-script/collections/playlists",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.libraryId=n.libraryId||"",this.filterValue=n.filterValue||"",this.pageIndex=1},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("playlists");o||s.set("playlists",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Playlists",t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r,i,s;return this.info.get("ApplicationVersion")?(i="FilterOn=Name",s="FilterValue="+encodeURIComponent(this.filterValue),r=e+"/"+encodeURIComponent(this.libraryId)+"?"+t+"&"+n+(this.filterValue?"&"+i+"&"+s:"")):(i="FilterOn=LibraryId",s="FilterValue="+encodeURIComponent(this.libraryId),r=e+"?"+t+"&"+n+"&"+i+"&"+s),this.config.urlCallback?this.config.urlCallback(r):r}})}),i("ev-script/views/playlist-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/unit-selects","ev-script/views/search","ev-script/views/playlist-results","ev-script/collections/playlists"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/unit-selects"),s=e("ev-script/views/search"),o=e("ev-script/views/playlist-results"),u=e("ev-script/collections/playlists");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadPlaylists","changeLibrary","handleSubmit"),this.$filterBlock=this.$("div.ev-filter-block"),this.info.get("ApplicationVersion")&&(this.searchView=new s({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:n.bind(function(){this.loadPlaylists()},this)}),this.$filterBlock.prepend(this.searchView.$el),this.searchView.render()),this.unitSelects=new i({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$filterBlock.prepend(this.unitSelects.$el),this.resultsView=new o({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click a.action-add":"chooseItem","change form.unit-selects select.libraries":"changeLibrary","submit form.unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadPlaylists()},handleSubmit:function(e){this.loadPlaylists(),e.preventDefault()},showPicker:function(){r.prototype.showPicker.call(this),this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()},loadPlaylists:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("libraryId"),i=new u({},{libraryId:r,filterValue:e,appId:this.appId});i.fetch({picker:this,cacheKey:r+e,success:n.bind(function(e,t,r){var i=e.totalResults=parseInt(t.Pager.TotalRecords,10),s=n.size(t.Data);s===i?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render(),this.resizeResults()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadPlaylists()},this))},this)})},resizeResults:function(){this.config.fitToParent&&this.resultsView.setHeight(this.$el.height()-this.hider.$el.outerHeight(!0)-this.$filterBlock.outerHeight(!0))}})}),i("text!ev-script/templates/playlist-settings.html",[],function(){return"<h3>TODO</h3>\n<p>\n    <%- json %>\n</p>\n"}),i("ev-script/views/playlist-settings",["require","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/playlist-settings.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/settings");return e("jquery-ui"),n.extend({template:t.template(e("text!ev-script/templates/playlist-settings.html")),initialize:function(e){n.prototype.initialize.call(this,e)},render:function(){this.$el.html(this.template({json:JSON.stringify(this.field.model.toJSON())})),this.$el.dialog({title:"Playlist Embed Settings",modal:!0,autoOpen:!1,dialogClass:"ev-dialog"})}})}),i("text!ev-script/templates/field.html",[],function(){return'<div class="logo">\n    <a target="_blank" href="<%= ensembleUrl %>"><span>Ensemble Logo</span></a>\n</div>\n<% if (modelId) { %>\n    <% if (thumbnailUrl) { %>\n        <div class="thumbnail">\n            <img alt="Media thumbnail" src="<%= thumbnailUrl %>"/>\n        </div>\n    <% } %>\n    <div class="title"><%= name %></div>\n    <div class="ev-actions">\n        <a href="#" class="action-choose" title="Change <%= label %>"><i class="fa fa-folder-open fa-lg"></i><span>Change <%= label %><span></a>\n        <a href="#" class="action-preview" title="Preview: <%= name %>"><i class="fa fa-play-circle fa-lg"></i><span>Preview: <%= name %><span></a>\n        <!-- TODO - temporarily disabled playlist settings until it is implemented -->\n        <% if (type === \'video\') { %>\n            <a href="#" class="action-options" title="<%= label %> Embed Options"><i class="fa fa-cog fa-lg"></i><span><%= label %> Embed Options<span></a>\n        <% } %>\n        <a href="#" class="action-remove" title="Remove <%= label %>"><i class="fa fa-minus-circle fa-lg"></i><span>Remove <%= label %><span></a>\n    </div>\n<% } else { %>\n    <div class="title"><em>Add <%= label %></em></div>\n    <div class="ev-actions">\n        <a href="#" class="action-choose" title="Choose <%= label %>"><i class="fa fa-folder-open fa-lg"></i><span>Choose <%= label %><span></a>\n    </div>\n<% } %>\n'}),i("ev-script/views/field",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/video-picker","ev-script/views/video-settings","ev-script/views/video-preview","ev-script/models/video-encoding","ev-script/views/playlist-picker","ev-script/views/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/field.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/video-picker"),u=e("ev-script/views/video-settings"),a=e("ev-script/views/video-preview"),f=e("ev-script/models/video-encoding"),l=e("ev-script/views/playlist-picker"),c=e("ev-script/views/playlist-settings"),h=e("ev-script/views/playlist-preview");return r.extend({template:n.template(e("text!ev-script/templates/field.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseHandler","optionsHandler","removeHandler","previewHandler","resizePicker"),this.$field=e.$field,this.showChoose=!0;var t={id:this.id+"-picker",tagName:"div",className:"ev-"+this.model.get("type")+"-picker",field:this,appId:this.appId},p={id:this.id+"-settings",tagName:"div",className:"ev-settings",field:this,appId:this.appId};this.model instanceof i?(this.modelClass=i,this.pickerClass=o,this.settingsClass=u,this.previewClass=a,this.encoding=new f({},{appId:this.appId}),this.model.isNew()||(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch()),this.model.on("change:id",n.bind(function(){this.model.id?(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch({success:n.bind(function(e){this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()})},this)})):this.encoding.clear()},this)),n.extend(p,{encoding:this.encoding})):this.model instanceof s&&(this.modelClass=s,this.pickerClass=l,this.settingsClass=c,this.previewClass=h),this.picker=new this.pickerClass(n.extend({},t,{model:new this.modelClass(this.model.toJSON())})),this.settings=new this.settingsClass(p),this.$field.after(this.picker.$el),this.renderActions(),this.model.on("change",n.bind(function(){if(!this.model.isNew()){var e=this.model.toJSON();this.$field.val(JSON.stringify(e)),this.appEvents.trigger("fieldUpdated",this.$field,e),this.renderActions()}},this)),this.appEvents.on("showPicker",function(e){this.id===e&&(this.$(".action-choose").hide(),this.showChoose=!1,this.config.hidePickers&&this.appEvents.trigger("hidePickers",this.id),this.resizePicker())},this),this.appEvents.on("hidePicker",function(e){this.id===e&&(this.$(".action-choose").show(),this.showChoose=!0)},this),this.appEvents.on("hidePickers",function(e){if(!e||this.id!==e)this.$(".action-choose").show(),this.showChoose=!0},this),this.appEvents.on("resize",n.bind(function(){this.resizePicker()},this))},events:{"click .action-choose":"chooseHandler","click .action-preview":"previewHandler","click .action-options":"optionsHandler","click .action-remove":"removeHandler"},chooseHandler:function(e){this.appEvents.trigger("showPicker",this.id),e.preventDefault()},optionsHandler:function(e){this.settings.show(),e.preventDefault()},removeHandler:function(e){this.model.clear(),this.$field.val(""),this.model.set(this.model.defaults,{silent:!0}),this.appEvents.trigger("fieldUpdated",this.$field),this.renderActions(),e.preventDefault()},previewHandler:function(e){var t=e.currentTarget,n=new this.previewClass({el:t,encoding:this.encoding,model:this.model,appId:this.appId});e.preventDefault()},renderActions:function(){var e=this.config.ensembleUrl,n,r,s,o;this.model instanceof i?(r="Media",s="video"):(r="Playlist",s="playlist");if(this.model.id){n=this.model.id;var u=this.model.get("content");if(u){n=u.Name||u.Title;var a=new RegExp("^"+e.toLocaleLowerCase()+"/app/assets/");u.ThumbnailUrl&&a.test(u.ThumbnailUrl.toLocaleLowerCase())&&(o=u.ThumbnailUrl)}}this.$actions||(this.$actions=t('<div class="ev-field"/>'),this.$field.after(this.$actions)),this.$actions.html(this.template({ensembleUrl:e,modelId:this.model.id,label:r,type:s,name:n,thumbnailUrl:o})),this.showChoose||this.$(".action-choose").hide()},resizePicker:function(){this.config.fitToParent&&this.picker.setHeight(this.$el.height()-this.$actions.outerHeight(!0))}})}),function(e){function $(e,n){if(e instanceof Q)return e;if(typeof e!="string")return null;if(e.length>t)return null;var i=n?r[E]:r[y];if(!i.test(e))return null;try{return new Q(e,n)}catch(s){return null}}function J(e,t){var n=$(e,t);return n?n.version:null}function K(e,t){var n=$(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}function Q(e,i){if(e instanceof Q){if(e.loose===i)return e;e=e.version}else if(typeof e!="string")throw new TypeError("Invalid Version: "+e);if(e.length>t)throw new TypeError("version is longer than "+t+" characters");if(!(this instanceof Q))return new Q(e,i);this.loose=i;var s=e.trim().match(i?r[E]:r[y]);if(!s)throw new TypeError("Invalid Version: "+e);this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3];if(this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<n)return t}return e}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}function G(e,t,n,r){typeof n=="string"&&(r=n,n=undefined);try{return(new Q(e,n)).inc(t,r).version}catch(i){return null}}function Y(e,t){if(ht(e,t))return null;var n=$(e),r=$(t);if(n.prerelease.length||r.prerelease.length){for(var i in n)if(i==="major"||i==="minor"||i==="patch")if(n[i]!==r[i])return"pre"+i;return"prerelease"}for(var i in n)if(i==="major"||i==="minor"||i==="patch")if(n[i]!==r[i])return i}function et(e,t){var n=Z.test(e),r=Z.test(t);return n&&r&&(e=+e,t=+t),n&&!r?-1:r&&!n?1:e<t?-1:e>t?1:0}function tt(e,t){return et(t,e)}function nt(e,t){return(new Q(e,t)).major}function rt(e,t){return(new Q(e,t)).minor}function it(e,t){return(new Q(e,t)).patch}function st(e,t,n){return(new Q(e,n)).compare(t)}function ot(e,t){return st(e,t,!0)}function ut(e,t,n){return st(t,e,n)}function at(t,n){return t.sort(function(t,r){return e.compare(t,r,n)})}function ft(t,n){return t.sort(function(t,r){return e.rcompare(t,r,n)})}function lt(e,t,n){return st(e,t,n)>0}function ct(e,t,n){return st(e,t,n)<0}function ht(e,t,n){return st(e,t,n)===0}function pt(e,t,n){return st(e,t,n)!==0}function dt(e,t,n){return st(e,t,n)>=0}function vt(e,t,n){return st(e,t,n)<=0}function mt(e,t,n,r){var i;switch(t){case"===":typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),i=e===n;break;case"!==":typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),i=e!==n;break;case"":case"=":case"==":i=ht(e,n,r);break;case"!=":i=pt(e,n,r);break;case">":i=lt(e,n,r);break;case">=":i=dt(e,n,r);break;case"<":i=ct(e,n,r);break;case"<=":i=vt(e,n,r);break;default:throw new TypeError("Invalid operator: "+t)}return i}function gt(e,t){if(e instanceof gt){if(e.loose===t)return e;e=e.value}if(!(this instanceof gt))return new gt(e,t);this.loose=t,this.parse(e),this.semver===yt?this.value="":this.value=this.operator+this.semver.version}function bt(e,t){if(e instanceof bt&&e.loose===t)return e;if(!(this instanceof bt))return new bt(e,t);this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length});if(!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function wt(e,t){return(new bt(e,t)).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})}function Et(e,t){return e=Nt(e,t),e=xt(e,t),e=kt(e,t),e=At(e,t),e}function St(e){return!e||e.toLowerCase()==="x"||e==="*"}function xt(e,t){return e.trim().split(/\s+/).map(function(e){return Tt(e,t)}).join(" ")}function Tt(e,t){var n=t?r[D]:r[_];return e.replace(n,function(e,t,n,r,i){var s;return St(t)?s="":St(n)?s=">="+t+".0.0 <"+(+t+1)+".0.0":St(r)?s=">="+t+"."+n+".0 <"+t+"."+(+n+1)+".0":i?(i.charAt(0)!=="-"&&(i="-"+i),s=">="+t+"."+n+"."+r+i+" <"+t+"."+(+n+1)+".0"):s=">="+t+"."+n+"."+r+" <"+t+"."+(+n+1)+".0",s})}function Nt(e,t){return e.trim().split(/\s+/).map(function(e){return Ct(e,t)}).join(" ")}function Ct(e,t){var n=t?r[F]:r[j];return e.replace(n,function(e,t,n,r,i){var s;return St(t)?s="":St(n)?s=">="+t+".0.0 <"+(+t+1)+".0.0":St(r)?t==="0"?s=">="+t+"."+n+".0 <"+t+"."+(+n+1)+".0":s=">="+t+"."+n+".0 <"+(+t+1)+".0.0":i?(i.charAt(0)!=="-"&&(i="-"+i),t==="0"?n==="0"?s=">="+t+"."+n+"."+r+i+" <"+t+"."+n+"."+(+r+1):s=">="+t+"."+n+"."+r+i+" <"+t+"."+(+n+1)+".0":s=">="+t+"."+n+"."+r+i+" <"+(+t+1)+".0.0"):t==="0"?n==="0"?s=">="+t+"."+n+"."+r+" <"+t+"."+n+"."+(+r+1):s=">="+t+"."+n+"."+r+" <"+t+"."+(+n+1)+".0":s=">="+t+"."+n+"."+r+" <"+(+t+1)+".0.0",s})}function kt(e,t){return e.split(/\s+/).map(function(e){return Lt(e,t)}).join(" ")}function Lt(e,t){e=e.trim();var n=t?r[L]:r[k];return e.replace(n,function(e,t,n,r,i,s){var o=St(n),u=o||St(r),a=u||St(i),f=a;return t==="="&&f&&(t=""),o?t===">"||t==="<"?e="<0.0.0":e="*":t&&f?(u&&(r=0),a&&(i=0),t===">"?(t=">=",u?(n=+n+1,r=0,i=0):a&&(r=+r+1,i=0)):t==="<="&&(t="<",u?n=+n+1:r=+r+1),e=t+n+"."+r+"."+i):u?e=">="+n+".0.0 <"+(+n+1)+".0.0":a&&(e=">="+n+"."+r+".0 <"+n+"."+(+r+1)+".0"),e})}function At(e,t){return e.trim().replace(r[X],"")}function Ot(e,t,n,r,i,s,o,u,a,f,l,c,h){return St(n)?t="":St(r)?t=">="+n+".0.0":St(i)?t=">="+n+"."+r+".0":t=">="+t,St(a)?u="":St(f)?u="<"+(+a+1)+".0.0":St(l)?u="<"+a+"."+(+f+1)+".0":c?u="<="+a+"."+f+"."+l+"-"+c:u="<="+u,(t+" "+u).trim()}function Mt(e,t){for(var n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length){for(var n=0;n<e.length;n++){if(e[n].semver===yt)return!0;if(e[n].semver.prerelease.length>0){var r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}}return!1}return!0}function _t(e,t,n){try{t=new bt(t,n)}catch(r){return!1}return t.test(e)}function Dt(e,t,n){return e.filter(function(e){return _t(e,t,n)}).sort(function(e,t){return ut(e,t,n)})[0]||null}function Pt(e,t){try{return(new bt(e,t)).range||"*"}catch(n){return null}}function Ht(e,t,n){return jt(e,t,"<",n)}function Bt(e,t,n){return jt(e,t,">",n)}function jt(e,t,n,r){e=new Q(e,r),t=new bt(t,r);var i,s,o,u,a;switch(n){case">":i=lt,s=vt,o=ct,u=">",a=">=";break;case"<":i=ct,s=dt,o=lt,u="<",a="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(_t(e,t,r))return!1;for(var f=0;f<t.set.length;++f){var l=t.set[f],c=null,h=null;l.forEach(function(e){c=c||e,h=h||e,i(e.semver,c.semver,r)?c=e:o(e.semver,h.semver,r)&&(h=e)});if(c.operator===u||c.operator===a)return!1;if((!h.operator||h.operator===u)&&s(e,h.semver))return!1;if(h.operator===a&&o(e,h.semver))return!1}return!0}typeof module=="object"&&module.exports===e&&(e=module.exports=Q),e.SEMVER_SPEC_VERSION="2.0.0";var t=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,r=e.re=[],s=e.src=[],o=0,u=o++;s[u]="0|[1-9]\\d*";var a=o++;s[a]="[0-9]+";var f=o++;s[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var l=o++;s[l]="("+s[u]+")\\."+"("+s[u]+")\\."+"("+s[u]+")";var c=o++;s[c]="("+s[a]+")\\."+"("+s[a]+")\\."+"("+s[a]+")";var h=o++;s[h]="(?:"+s[u]+"|"+s[f]+")";var p=o++;s[p]="(?:"+s[a]+"|"+s[f]+")";var d=o++;s[d]="(?:-("+s[h]+"(?:\\."+s[h]+")*))";var v=o++;s[v]="(?:-?("+s[p]+"(?:\\."+s[p]+")*))";var m=o++;s[m]="[0-9A-Za-z-]+";var g=o++;s[g]="(?:\\+("+s[m]+"(?:\\."+s[m]+")*))";var y=o++,b="v?"+s[l]+s[d]+"?"+s[g]+"?";s[y]="^"+b+"$";var w="[v=\\s]*"+s[c]+s[v]+"?"+s[g]+"?",E=o++;s[E]="^"+w+"$";var S=o++;s[S]="((?:<|>)?=?)";var x=o++;s[x]=s[a]+"|x|X|\\*";var T=o++;s[T]=s[u]+"|x|X|\\*";var N=o++;s[N]="[v=\\s]*("+s[T]+")"+"(?:\\.("+s[T]+")"+"(?:\\.("+s[T]+")"+"(?:"+s[d]+")?"+s[g]+"?"+")?)?";var C=o++;s[C]="[v=\\s]*("+s[x]+")"+"(?:\\.("+s[x]+")"+"(?:\\.("+s[x]+")"+"(?:"+s[v]+")?"+s[g]+"?"+")?)?";var k=o++;s[k]="^"+s[S]+"\\s*"+s[N]+"$";var L=o++;s[L]="^"+s[S]+"\\s*"+s[C]+"$";var A=o++;s[A]="(?:~>?)";var O=o++;s[O]="(\\s*)"+s[A]+"\\s+",r[O]=new RegExp(s[O],"g");var M="$1~",_=o++;s[_]="^"+s[A]+s[N]+"$";var D=o++;s[D]="^"+s[A]+s[C]+"$";var P=o++;s[P]="(?:\\^)";var H=o++;s[H]="(\\s*)"+s[P]+"\\s+",r[H]=new RegExp(s[H],"g");var B="$1^",j=o++;s[j]="^"+s[P]+s[N]+"$";var F=o++;s[F]="^"+s[P]+s[C]+"$";var I=o++;s[I]="^"+s[S]+"\\s*("+w+")$|^$";var q=o++;s[q]="^"+s[S]+"\\s*("+b+")$|^$";var R=o++;s[R]="(\\s*)"+s[S]+"\\s*("+w+"|"+s[N]+")",r[R]=new RegExp(s[R],"g");var U="$1$2$3",z=o++;s[z]="^\\s*("+s[N]+")"+"\\s+-\\s+"+"("+s[N]+")"+"\\s*$";var W=o++;s[W]="^\\s*("+s[C]+")"+"\\s+-\\s+"+"("+s[C]+")"+"\\s*$";var X=o++;s[X]="(<|>)?=?\\s*\\*";for(var V=0;V<o;V++)r[V]||(r[V]=new RegExp(s[V]));e.parse=$,e.valid=J,e.clean=K,e.SemVer=Q,Q.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Q.prototype.inspect=function(){return'<SemVer "'+this+'">'},Q.prototype.toString=function(){return this.version},Q.prototype.compare=function(e){return e instanceof Q||(e=new Q(e,this.loose)),this.compareMain(e)||this.comparePre(e)},Q.prototype.compareMain=function(e){return e instanceof Q||(e=new Q(e,this.loose)),et(this.major,e.major)||et(this.minor,e.minor)||et(this.patch,e.patch)},Q.prototype.comparePre=function(e){e instanceof Q||(e=new Q(e,this.loose));if(this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var n=this.prerelease[t],r=e.prerelease[t];if(n===undefined&&r===undefined)return 0;if(r===undefined)return 1;if(n===undefined)return-1;if(n===r)continue;return et(n,r)}while(++t)},Q.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{var n=this.prerelease.length;while(--n>=0)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this},e.inc=G,e.diff=Y,e.compareIdentifiers=et;var Z=/^[0-9]+$/;e.rcompareIdentifiers=tt,e.major=nt,e.minor=rt,e.patch=it,e.compare=st,e.compareLoose=ot,e.rcompare=ut,e.sort=at,e.rsort=ft,e.gt=lt,e.lt=ct,e.eq=ht,e.neq=pt,e.gte=dt,e.lte=vt,e.cmp=mt,e.Comparator=gt;var yt={};gt.prototype.parse=function(e){var t=this.loose?r[I]:r[q],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=n[1],this.operator==="="&&(this.operator=""),n[2]?this.semver=new Q(n[2],this.loose):this.semver=yt},gt.prototype.inspect=function(){return'<SemVer Comparator "'+this+'">'},gt.prototype.toString=function(){return this.value},gt.prototype.test=function(e){return this.semver===yt?!0:(typeof e=="string"&&(e=new Q(e,this.loose)),mt(e,this.operator,this.semver,this.loose))},e.Range=bt,bt.prototype.inspect=function(){return'<SemVer Range "'+this.range+'">'},bt.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},bt.prototype.toString=function(){return this.range},bt.prototype.parseRange=function(e){var t=this.loose;e=e.trim();var n=t?r[W]:r[z];e=e.replace(n,Ot),e=e.replace(r[R],U),e=e.replace(r[O],M),e=e.replace(r[H],B),e=e.split(/\s+/).join(" ");var i=t?r[I]:r[q],s=e.split(" ").map(function(e){return Et(e,t)}).join(" ").split(/\s+/);return this.loose&&(s=s.filter(function(e){return!!e.match(i)})),s=s.map(function(e){return new gt(e,t)}),s},e.toComparators=wt,bt.prototype.test=function(e){if(!e)return!1;typeof e=="string"&&(e=new Q(e,this.loose));for(var t=0;t<this.set.length;t++)if(Mt(this.set[t],e))return!0;return!1},e.satisfies=_t,e.maxSatisfying=Dt,e.validRange=Pt,e.ltr=Ht,e.gtr=Bt,e.outside=jt,typeof i=="function"&&i.amd&&i("semver",e)}(typeof exports=="object"?exports:typeof i=="function"&&i.amd?{}:semver={}),i("ev-script/models/app-info",["require","underscore","semver","ev-script/models/base"],function(e){"use strict";var t=e("underscore"),n=e("semver"),r=e("ev-script/models/base");return r.extend({initialize:function(e,t){r.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/Info";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e},checkVersion:function(e){var t=this.get("ApplicationVersion");return t&&n.satisfies(t,e)}})}),i("ev-script/models/current-user",["require","underscore","ev-script/models/base"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/models/base");return n.extend({idAttribute:"ID",initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/CurrentUser";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e.Data[0]}})}),i("ev-script/auth/base/auth",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache","ev-script/models/current-user"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/events"),s=e("ev-script/util/cache"),o=e("ev-script/models/current-user"),u=function(e){n.bindAll(this,"getUser","login","logout","isAuthenticated","handleUnauthorized"),this.appId=e,this.config=s.getAppConfig(e),this.info=s.getAppInfo(e),this.globalEvents=i.getEvents("global"),this.appEvents=i.getEvents(e),this.user=null,this.appEvents.on("appLoaded",function(){this.fetchUser()},this)};return u.extend=r.Model.extend,n.extend(u.prototype,{fetchUser:function(){var e=new o({},{appId:this.appId});return e.fetch({success:n.bind(function(e,t,n){this.user=e,this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},getUser:function(){return this.user},login:function(e){return t.Deferred().reject().promise()},logout:function(){return t.Deferred().reject().promise()},isAuthenticated:function(){return this.user!=null},handleUnauthorized:function(e,t){}}),u}),function(e){typeof i=="function"&&i.amd?i("jquery.cookie",["jquery"],e):typeof exports=="object"?e(r("jquery")):e(jQuery)}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(t," ")),u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g,u=e.cookie=function(t,s,a){if(s!==undefined&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setTime(+l+f*864e5)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{},h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("="),m=r(v.shift()),g=v.join("=");if(t&&t===m){c=o(g,s);break}!t&&(g=o(g))!==undefined&&(c[m]=g)}return c};u.defaults={},e.removeCookie=function(t,n){return e.cookie(t)===undefined?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),i("text!ev-script/auth/basic/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text"type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text"type="password"/>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),i("ev-script/auth/basic/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/basic/template.html"],function(e,t){"use strict";var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/basic/template.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=this.template();this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),r=n("#username",t).val(),i=n("#password",t).val();r&&i&&(this.auth.login({username:r,password:i}).always(this.submitCallback),this.$dialog.dialog("destroy").remove()),e.preventDefault()},this))}})}),i("ev-script/auth/basic/auth",["require","jquery","underscore","backbone","ev-script/auth/base/auth","ev-script/auth/basic/view","ev-script/collections/organizations"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/auth/base/auth"),s=e("ev-script/auth/basic/view"),o=e("ev-script/collections/organizations"),u=i.extend({constructor:function(e){u.__super__.constructor.call(this,e)},fetchUser:function(){if(this.info.get("ApplicationVersion"))return u.__super__.fetchUser.call(this);var e=new o({},{appId:this.appId});return e.requiresAuth=!1,e.fetch({success:n.bind(function(e,t,n){this.user=new r.Model({id:Math.floor(Math.random()*1e16).toString(16)}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},login:function(e){var r={path:this.config.authPath};return t.cookie(this.config.ensembleUrl+"-user",e.username,n.extend({},r)),t.cookie(this.config.ensembleUrl+"-pass",e.password,n.extend({},r)),this.fetchUser()},logout:function(){var e=t.Deferred(),r={path:this.config.authPath};return t.removeCookie(this.config.ensembleUrl+"-user",n.extend({},r)),t.removeCookie(this.config.ensembleUrl+"-pass",n.extend({},r)),this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),e.resolve(),e.promise()},handleUnauthorized:function(e,t){this.logout();var n=new s({el:e,submitCallback:t,appId:this.appId,auth:this});n.render()}});return u}),i("text!ev-script/auth/forms/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text" type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text" type="password"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="provider">Identity Provider</label>\n            <select id="provider" name="provider" class="form-select"></select>\n        </div>\n        <div class="fieldWrap">\n            <label for="remember">Remember Me</label>\n            <input id="remember" name="remember" type="checkbox"></input>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n            <div class="loader"></div>\n        </div>\n    </fieldset>\n</form>\n'}),i("ev-script/auth/forms/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/forms/template.html","text!ev-script/templates/options.html"],function(e,t){"use strict";var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/forms/template.html")),optionsTemplate:r.template(e("text!ev-script/templates/options.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=n(this.template()),t=n("#provider",e).append(this.optionsTemplate({collection:this.collection,selectedId:this.config.defaultProvider}));this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog);var i=n("div.loader",e),s=r.bind(function(e,t,n){i.addClass("loading")},this),o=r.bind(function(e,t,n){i.removeClass("loading")},this);n(window.document).on("ajaxSend",s).on("ajaxComplete",o),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){n(window.document).off("ajaxSend",s).off("ajaxComplete",o),this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),i=n("#username",t).val(),s=n("#password",t).val();i&&s&&this.auth.login({username:i,password:s,authSourceId:n("#provider :selected",t).val(),persist:n("#remember",t).is(":checked")}).then(r.bind(function(){this.$dialog.dialog("destroy").remove(),this.submitCallback()},this)),e.preventDefault()},this))}})}),i("ev-script/collections/identity-providers",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache"),r=new n.Cache;return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.requiresAuth=!1},getCached:function(e){return r.get(this.config.ensembleUrl)},setCached:function(e,t){return r.set(this.config.ensembleUrl,t)},url:function(){var e=this.config.ensembleUrl+"/api/IdentityProviders";return this.config.urlCallback?this.config.urlCallback(e):e}})}),i("ev-script/auth/forms/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/models/current-user","ev-script/auth/forms/view","ev-script/collections/identity-providers"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/auth/base/auth"),i=e("ev-script/models/current-user"),s=e("ev-script/auth/forms/view"),o=e("ev-script/collections/identity-providers"),u=r.extend({constructor:function(e){r.prototype.constructor.call(this,e),this.identityProviders=new o({},{appId:e}),this.asPromise=this.identityProviders.fetch()},login:function(e){var r=this.config.ensembleUrl+"/api/Login";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(r):r,type:"POST",dataType:"json",data:{user:e.username,password:e.password,identityProviderId:e.authSourceId,persist:e.persist},xhrFields:{withCredentials:!0},success:n.bind(function(e,t,n){this.user=new i(e.Data[0],{appId:this.appId}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this)}).promise()},logout:function(){var e=this.config.ensembleUrl+"/api/Logout";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(e):e,type:"POST",xhrFields:{withCredentials:!0},success:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),this.asPromise.done(n.bind(function(){var n=new s({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()},this))}});return u}),i("text!ev-script/auth/none/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <h3>You are unauthorized to access this content.</h3>\n</form>\n'}),i("ev-script/auth/none/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery-ui","text!ev-script/auth/none/template.html"],function(e,t){"use strict";var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/none/template.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId)},render:function(){var e=n(this.template());this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)})}})}),i("ev-script/auth/none/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/auth/none/view"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/auth/base/auth"),i=e("ev-script/auth/none/view"),s=r.extend({constructor:function(e){r.prototype.constructor.call(this,e)},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl);var n=new i({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()}});return s}),i("ev-script",["require","backbone","underscore","jquery","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/field","ev-script/views/video-embed","ev-script/views/playlist-embed","ev-script/models/app-info","ev-script/auth/basic/auth","ev-script/auth/forms/auth","ev-script/auth/none/auth","ev-script/util/events","ev-script/util/cache"],function(e){"use strict";var t=e("backbone"),n=e("underscore"),r=e("jquery"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/field"),u=e("ev-script/views/video-embed"),a=e("ev-script/views/playlist-embed"),f=e("ev-script/models/app-info"),l=e("ev-script/auth/basic/auth"),c=e("ev-script/auth/forms/auth"),h=e("ev-script/auth/none/auth"),p=e("ev-script/util/events"),d=e("ev-script/util/cache"),v=function(e){var t=Math.floor(Math.random()*1e16).toString(16),s=d.caches.get(e.ensembleUrl);s||(s=d.caches.set(e.ensembleUrl,new d.Cache));var v={ensembleUrl:"",authPath:"",urlCallback:function(e){return e},pageSize:100,scrollHeight:null,fitToParent:!1,hidePickers:!0,dialogMargin:40,authType:"basic",defaultProvider:"",pluploadFlashPath:""},m=d.setAppConfig(t,n.extend({},v,e));p.initEvents(t),this.appEvents=p.getEvents(t),this.globalEvents=p.getEvents();var g=r.Deferred();n.extend(this,g.promise());var y=new f({},{appId:t});d.setAppInfo(t,y),y.fetch({}).always(n.bind(function(){if(!y.get("ApplicationVersion")&&m.authType==="forms")g.reject("Configured to use forms authentication against a pre-3.6 API.");else{var e;switch(m.authType){case"forms":e=new c(t);break;case"none":e=new h(t);break;default:e=new l(t)}d.setAppAuth(t,e),this.handleField=function(e,n,i){var s=r(i,e),u=new o({id:e.id||t,el:e,model:n,$field:s,appId:t})},this.handleEmbed=function(e,n){if(n instanceof i)var r=new u({el:e,model:n,appId:t});else var s=new a({el:e,model:n,appId:t})},this.appEvents.trigger("appLoaded"),g.resolve()}},this))};return{VideoSettings:i,PlaylistSettings:s,EnsembleApp:v}}),i("jquery",function(){return e||jQuery}),i("jquery-ui",["jquery"],function(){}),i("plupload",function(){return t}),i("jquery.plupload.queue",["jquery","plupload"],function(){}),r("ev-script")});