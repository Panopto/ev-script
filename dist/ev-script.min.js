/**
 * ev-script 0.3.1 2015-03-04
 * Ensemble Video Integration Library
 * https://github.com/jmpease/ev-script
 * Copyright (c) 2015 Symphony Video, Inc.
 * Licensed MIT, GPL-2.0
 */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * ev-scroll-loader 0.1.0 2013-01-31
 * Ensemble Video jQuery Scroll Loader Plugin
 * https://github.com/jmpease/ev-scroll-loader
 * Copyright (c) 2013 Symphony Video, Inc.
 * Licensed MIT, GPL-2.0
 */

(function(e,t){typeof define=="function"&&define.amd?define(["jquery","underscore","backbone","jquery-ui","jquery.plupload.queue","jquery.cookie","plupload"],t):e.EV=t(e.$,e._,e.Backbone)})(this,function(e,t,n){var r,i,s;return function(e){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(t,r){return function(){return n.apply(e,p.call(arguments,0).concat([t,r]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(n){if(v(f,n)){var r=f[n];delete f[n],c[n]=!0,t.apply(e,r)}if(!v(a,n)&&!v(c,n))throw new Error("No "+n);return a[n]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var t,n,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},t=function(t,n,r,i){var s,l,h,p,d,m=[],y=typeof r,E;i=i||t;if(y==="undefined"||y==="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(d=0;d<n.length;d+=1){p=o(n[d],i),l=p.f;if(l==="require")m[d]=u.require(t);else if(l==="exports")m[d]=u.exports(t),E=!0;else if(l==="module")s=m[d]=u.module(t);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=r?r.apply(a[t],m):undefined;if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!E)a[t]=h}else t&&(a[t]=r)},r=i=n=function(r,i,s,a,f){if(typeof r=="string")return u[r]?u[r](i):w(o(r,i).f);if(!r.splice){l=r,l.deps&&n(l.deps,l.callback);if(!i)return;i.splice?(r=i,i=s,s=null):r=e}return i=i||function(){},typeof s=="function"&&(s=a,a=f),a?t(e,r,i,s):setTimeout(function(){t(e,r,i,s)},4),n},n.config=function(e){return n(e)},r._defined=a,s=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},s.amd={jQuery:!0}}(),s("almond",function(){}),s("ev-script/models/video-settings",["backbone"],function(e){return e.Model.extend({defaults:{type:"video",showtitle:!1,autoplay:!1,showcaptions:!1,hidecontrols:!1,search:"",sourceId:"content"}})}),s("ev-script/models/playlist-settings",["backbone"],function(e){return e.Model.extend({defaults:{type:"playlist",search:""}})}),s("ev-script/util/events",["require","underscore","backbone"],function(e){var t=[],n=e("underscore"),r=e("backbone");return t.global=n.extend({},r.Events),{initEvents:function(e){return t[e]=n.extend({},r.Events)},getEvents:function(e){var n;return e?n=t[e]:n=t.global,n}}}),s("ev-script/util/cache",["require","jquery","underscore","backbone"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=function(){return this.cache=[],this.get=function(e){return e?this.cache[e]:null},this.set=function(e,t){return e?this.cache[e]=t:null},this},s=new i,o=function(e){var t=s.get(e);return t||(t=s.set(e,new i)),t},u=function(e,t){return o(e).set("config",t)},a=function(e){return o(e).get("config")},f=function(e,t){return o(e).set("auth",t)},l=function(e){return o(e).get("auth")},c=function(e,t){return o(e).set("info",t)},h=function(e){return o(e).get("info")},p=function(e,t){var n=s.get(e);n||(n=s.set(e,new i));var r=n.get(t);return r||(r=n.set(t,new i)),r};return{Cache:i,caches:s,setAppConfig:u,getAppConfig:a,setAppAuth:f,getAppAuth:l,setAppInfo:c,getAppInfo:h,getUserCache:p}}),s("ev-script/views/base",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=this,s=e("ev-script/util/events"),o=e("ev-script/util/cache");return r.View.extend({initialize:function(e){this.appId=e.appId,this.config=o.getAppConfig(this.appId),this.auth=o.getAppAuth(this.appId),this.info=o.getAppInfo(this.appId),this.appEvents=s.getEvents(this.appId),this.globalEvents=s.getEvents("global")},ajaxError:function(e,t){e.status===401?this.auth.handleUnauthorized(this.el,t):e.status===500?i.alert("It appears there is an issue with the Ensemble Video installation."):e.status===404?i.alert("Could not find requested resource.  This is likely a problem with the configured Ensemble Video base url."):e.status!==0&&i.alert("An unexpected error occurred.  Check the server log for more details.")}})}),s("text",["module"],function(e){var t,n,r,s,o,u=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l=typeof location!="undefined"&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,p=l&&(location.port||undefined),d={},v=e.config&&e.config()||{};t={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(f);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=u[t];try{e=new ActiveXObject(n)}catch(r){}if(e){u=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,v.isBuild&&(d[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}v.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=v.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!l||a(u,c,h,p)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(d.hasOwnProperty(n)){var s=t.jsEscape(d[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(v.env==="node"||!v.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])n=i.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="ï»¿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(v.env==="xhr"||!v.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);v.onXhr&&v.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),v.onXhrComplete&&v.onXhrComplete(s,e))},s.send(null)};else if(v.env==="rhino"||!v.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(v.env==="xpconnect"||!v.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,i,u,a={};o&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(u,1,0,!1),i=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),i.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),a),i.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),s("text!ev-script/templates/hider.html",[],function(){return'<a class="action-hide" href="#" title="Hide Picker">Hide</a>\n<% if (showLogout) { %>\n    <a class="action-logout" href="#" title="Logout <%= username %>">Logout</a>\n<% } %>\n'}),s("ev-script/views/hider",["require","underscore","ev-script/views/base","text!ev-script/templates/hider.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/hider.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"hideHandler","logoutHandler","authHandler","render"),this.globalEvents.on("loggedIn",this.authHandler),this.globalEvents.on("loggedOut",this.authHandler),this.field=e.field},events:{"click a.action-hide":"hideHandler","click a.action-logout":"logoutHandler"},authHandler:function(e){e===this.config.ensembleUrl&&this.render()},render:function(){var e="";this.info.get("ApplicationVersion")&&this.auth.isAuthenticated()&&(e=this.auth.getUser().get("UserName")),this.$el.html(this.template({showLogout:this.auth.isAuthenticated()&&this.config.authType!=="none",username:e}))},hideHandler:function(e){this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},logoutHandler:function(e){this.auth.logout().always(this.appEvents.trigger("hidePickers")),e.preventDefault()}})}),s("text!ev-script/templates/picker.html",[],function(){return'<div id="<%= id %>-hider" class="ev-hider"></div>\n<div id="<%= id %>-filter-block" class="ev-filter-block">\n    <div class="loader"></div>\n    <div class="ev-poweredby">\n        <a tabindex="-1" target="_blank" href="http://ensemblevideo.com"><span>Powered by Ensemble</span></a>\n    </div>\n</div>\n<div id="<%= id %>-results" class="ev-results clearfix"></div>\n'}),s("ev-script/views/picker",["require","jquery","underscore","ev-script/views/base","ev-script/views/hider","text!ev-script/templates/picker.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/hider");return r.extend({template:n.template(e("text!ev-script/templates/picker.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseItem","hidePicker","showPicker"),this.$el.hide(),this.$el.html(this.template({id:this.id})),this.field=e.field,this.hider=new i({el:this.$("div.ev-hider"),field:this.field,appId:this.appId});var s=this.$("div.loader");t(window.document).on("ajaxSend",n.bind(function(e,t,n){this===n.picker&&s.addClass("loading")},this)).on("ajaxComplete",n.bind(function(e,t,n){this===n.picker&&s.removeClass("loading")},this)),this.appEvents.on("hidePickers",function(e){(!e||this.field.id!==e)&&this.hidePicker()},this),this.appEvents.on("showPicker",function(e){this.field.id===e&&this.$el.is(":hidden")&&this.showPicker()},this),this.appEvents.on("hidePicker",function(e){this.field.id===e&&this.hidePicker()},this),this.hider.render()},chooseItem:function(e){var n=t(e.target).attr("rel"),r=this.resultsView.collection.get(n);this.model.set({id:n,content:r.toJSON()}),this.field.model.set(this.model.attributes),this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},hidePicker:function(){this.$el.fadeOut("fast")},showPicker:function(){this.hider.render(),this.$el.fadeIn("fast")}})}),s("text!ev-script/templates/search.html",[],function(){return'<form>\n    <label for="<%= id %>">Search:</label>\n    <input id="<%= id %>" type="text" class="form-text search" value="<%- searchVal %>" title="Search Media" />\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),s("ev-script/views/search",["require","underscore","ev-script/views/base","text!ev-script/templates/search.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/search.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"searchHandler","doSearch","autoSearch"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"submit form":"searchHandler","keyup .search":"autoSearch"},render:function(){this.$el.html(this.template({id:this.id+"-input",searchVal:this.picker.model.get("search")}))},doSearch:function(){this.picker.model.set({search:this.$(".search").val()}),this.callback()},searchHandler:function(e){this.doSearch(),e.preventDefault()},autoSearch:function(e){var n=e.target.value;n!==this.lastValue&&(this.lastValue=n,this.submitTimeout&&clearTimeout(this.submitTimeout),this.submitTimeout=setTimeout(t.bind(function(){this.doSearch()},this),1e3))}})}),s("text!ev-script/templates/library-type-select.html",[],function(){return'<form>\n    <label for="<%= id %>">Type:</label>\n    <select id="<%= id %>" class="form-select source" title="Select Library Type">\n      <option value="content" <% if (sourceId === \'content\') { print(\'selected="selected"\'); } %>>Media Library</option>\n      <option value="shared" <% if (sourceId === \'shared\') { print(\'selected="selected"\'); } %>>Shared Library</option>\n    </select>\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),s("ev-script/views/library-type-select",["require","underscore","ev-script/views/base","text!ev-script/templates/library-type-select.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/library-type-select.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"changeHandler"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"change .source":"changeHandler"},render:function(){this.$el.html(this.template({id:this.id+"-select",sourceId:this.picker.model.get("sourceId")}))},changeHandler:function(e){this.picker.model.set({sourceId:this.$(".source").val()}),this.callback(),e.preventDefault()}})}),s("text!ev-script/templates/options.html",[],function(){return"<% collection.each(function(item) { %>\n    <option value=\"<%= item.id %>\" <% if (selectedId === item.id) { print('selected=\"selected\"'); } %>><%- item.get('Name') %></option>\n<% }); %>\n"}),s("ev-script/views/organization-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("organizationId")||this.auth.getUser().get("OrganizationID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),s("ev-script/collections/base",["require","jquery","underscore","backbone","ev-script/util/cache"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/cache");return r.Collection.extend({initialize:function(e,t){this.requiresAuth=!0,this.appId=t.appId,this.config=i.getAppConfig(this.appId),this.auth=i.getAppAuth(this.appId),this.info=i.getAppInfo(this.appId)},model:r.Model.extend({idAttribute:"ID"}),getCached:function(e){},setCached:function(e,t){},clearCache:function(e){},parse:function(e){return e.Data},fetch:function(e){return e&&e.success&&(e.success=n.wrap(e.success,n.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),r.Collection.prototype.fetch.call(this,e)},sync:function(e,i,s){n.defaults(s||(s={}),{xhrFields:{withCredentials:!0}});if(e==="read"){var o=this.getCached(s.cacheKey);if(o){var u=t.Deferred();return s.success&&u.done(s.success),u.resolve(o).promise()}return s.success=s.success||function(e,t,n){},s.success=n.wrap(s.success,n.bind(function(e){this.setCached(s.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),r.Collection.prototype.sync.call(this,e,i,s)}return r.Collection.prototype.sync.call(this,e,i,s)}})}),s("ev-script/collections/organizations",["require","ev-script/collections/base","ev-script/util/cache"],function(e){var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n)},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;return s?s[t?"set":"get"](e,t):null},getCached:function(e){return this._cache("orgs")},setCached:function(e,t){return this._cache("orgs",t)},url:function(){var e=this.config.ensembleUrl+"/api/Organizations",t="PageSize=9999",n="PageIndex=1",r=e+"?"+t+"&"+n;return this.config.urlCallback?this.config.urlCallback(r):r}})}),s("ev-script/views/library-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("libraryId")||this.auth.getUser().get("LibraryID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),s("ev-script/collections/libraries",["require","ev-script/collections/base","ev-script/util/cache"],function(e){var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.organizationId||""},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("libs");o||s.set("libs",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Libraries",t="PageSize=9999",n="PageIndex=1",r="FilterOn=OrganizationId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),s("text!ev-script/templates/unit-selects.html",[],function(){return'<form id="<%= formId %>" class="unit-selects">\n    <label for="<%= orgSelectId %>">Organization:</label>\n    <select id="<%= orgSelectId %>" class="form-select organizations" title="Select Organization"></select>\n    <label for="<%= libSelectId %>">Library:</label>\n    <select id="<%= libSelectId %>" class="form-select libraries" title="Select Library"></select>\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),s("ev-script/views/unit-selects",["require","jquery","underscore","ev-script/views/base","ev-script/views/organization-select","ev-script/collections/organizations","ev-script/views/library-select","ev-script/collections/libraries","text!ev-script/templates/unit-selects.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/organization-select"),s=e("ev-script/collections/organizations"),o=e("ev-script/views/library-select"),u=e("ev-script/collections/libraries");return r.extend({template:n.template(e("text!ev-script/templates/unit-selects.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadOrgs","loadLibraries","changeOrganization","changeLibrary"),this.picker=e.picker,this.id=e.id,this.$el.html(this.template({formId:this.id+"-unit-selects",orgSelectId:this.id+"-org-select",libSelectId:this.id+"-lib-select"})),this.orgSelect=new i({el:this.$(".organizations"),picker:this.picker,appId:this.appId,collection:new s({},{appId:this.appId})}),this.libSelect=new o({el:this.$(".libraries"),picker:this.picker,appId:this.appId,collection:new u({},{appId:this.appId})})},events:{"change select.organizations":"changeOrganization","change select.libraries":"changeLibrary"},changeOrganization:function(e){this.picker.model.set({organizationId:e.target.value}),this.loadLibraries()},changeLibrary:function(e){this.picker.model.set({libraryId:e.target.value})},loadOrgs:function(){var e=new s({},{appId:this.appId});e.fetch({picker:this.picker,success:n.bind(function(e,t,n){this.orgSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadOrgs()},this))},this)})},loadLibraries:function(){var e=this.picker.model.get("organizationId"),t=new u({},{organizationId:e,appId:this.appId});t.fetch({picker:this.picker,cacheKey:e,success:n.bind(function(e,t,n){this.libSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadLibraries()},this))},this)})}})}),function(e){var t={callback:function(){}},n={init:function(n){var r=e.extend({},t,n);return this.each(function(){var t=e(this);t.addClass("scroll-content");var n=t.wrap('<div class="scrollWrap"/>').closest(".scrollWrap");n.append('<div class="loader"></div>');var i=this.scrollHeight,s=r.height||i,o=Math.min(s,i)-10;n.css({position:"relative",height:o+"px","overflow-y":"scroll"}).scroll(function(){n.scrollTop()===n[0].scrollHeight-o&&r.callback.apply(t[0])})})},showLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).show(),this},hideLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).hide(),this}};e.fn.evScrollLoader=function(e){if(n[e])return n[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return n.init.apply(this,arguments)}}(jQuery),s("ev-scroll-loader",function(){}),s("text!ev-script/templates/results.html",[],function(){return'<div class="total">Search returned <%= totalResults %> results.</div>\n<div class="results">\n    <table class="content-list"></table>\n</div>\n'}),s("text!ev-script/templates/no-results.html",[],function(){return'<tr class="odd"><td colspan="2">No results available.</td></tr>\n'}),s("ev-script/views/results",["require","jquery","underscore","ev-script/views/base","ev-scroll-loader","text!ev-script/templates/results.html","text!ev-script/templates/no-results.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base");return e("ev-scroll-loader"),r.extend({resultsTemplate:n.template(e("text!ev-script/templates/results.html")),emptyTemplate:n.template(e("text!ev-script/templates/no-results.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"render","loadMore","addHandler","previewItem"),this.picker=e.picker,this.appId=e.appId,this.loadLock=!1},events:{"click a.action-preview":"previewItem"},getItemHtml:function(e,t){if(this.resultTemplate)return this.resultTemplate({item:e,index:t})},previewItem:function(e){var n=e.currentTarget,r=t(n).attr("rel"),i=this.collection.get(r),s={id:r,content:i.toJSON(),appId:this.appId},o=new this.previewClass({el:n,model:new this.modelClass(s),appId:this.appId,picker:this.picker});e.stopPropagation(),e.preventDefault()},loadMore:function(){this.collection.hasMore&&!this.loadLock&&(this.loadLock=!0,this.collection.fetch({remove:!1,picker:this.picker,success:n.bind(function(e,t,r){n.size(t.Data)<this.config.pageSize?(e.hasMore=!1,this.$scrollLoader.evScrollLoader("hideLoader")):(e.hasMore=!0,e.pageIndex+=1),this.loadLock=!1},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadMore()},this)),this.loadLock=!1},this)}))},addHandler:function(e,n,r){var i=t(this.getItemHtml(e,r.index));this.decorate(i),this.$(".content-list").append(i)},decorate:function(e){},render:function(){this.$el.html(this.resultsTemplate({totalResults:this.collection.totalResults}));var e=this.$(".content-list");this.collection.isEmpty()?e.append(this.emptyTemplate()):this.collection.each(function(n,r){var i=t(this.getItemHtml(n,r));this.decorate(i),e.append(i)},this);var n=this.config.scrollHeight;if(this.collection.size()>=this.config.pageSize||e[0].scrollHeight>n)this.$scrollLoader=e.evScrollLoader({height:n,callback:this.loadMore}),this.collection.hasMore||this.$scrollLoader.evScrollLoader("hideLoader");this.collection.off("add",this.addHandler).on("add",this.addHandler)}})}),s("ev-script/views/preview",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","jquery-ui"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings");return e("jquery-ui"),r.extend({initialize:function(e){r.prototype.initialize.call(this,e);var s=t('<div class="dialogWrap"></div>'),o=this.model.get("content")||{Title:this.model.get("id")},u=new this.model.constructor(this.model.toJSON()),a={width:this.model.get("width")||(this.model instanceof i?640:800),height:this.model.get("height")||(this.model instanceof i?360:850)},f={},l=50,c=140,h,p,d;this.$el.after(s),f.width=Math.min(a.width+l,t(window).width()-this.config.dialogMargin),f.height=Math.min(a.height+c,t(window).height()-this.config.dialogMargin),p=f.width-l,this.model instanceof i&&a.width>p&&(h=p/a.width,a.width=a.width*h,a.height=a.height*h),u.set("width",a.width),u.set("height",a.height),d=s.dialog({title:o.Title||o.Name,modal:!0,width:f.width,height:f.height,draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(e,t){var n=new this.embedClass({model:u,appId:this.appId});s.html(n.$el)},this),close:function(e,t){s.dialog("destroy").remove()}})}})}),s("text!ev-script/templates/video-embed.html",[],function(){return'<iframe src="<%= src %>"\n        frameborder="0"\n        style="width: <%= width %>px;height:<%= (parseInt(height, 10) + 56) %>px;"\n        allowfullscreen>\n</iframe>\n'}),s("ev-script/views/video-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/video-embed.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/video-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e);var t=this.model.get("width")?this.model.get("width"):"640",r=this.model.get("height")?this.model.get("height"):"360",i=this.model.get("showtitle"),s=this.config.ensembleUrl+"/app/plugin/embed.aspx?ID="+this.model.get("id")+"&autoPlay="+this.model.get("autoplay")+"&displayTitle="+i+"&hideControls="+this.model.get("hidecontrols")+"&showCaptions="+this.model.get("showcaptions")+"&width="+t+"&height="+r;this.$el.html(this.template({src:s,width:t,height:i?r+25:r}))}})}),s("ev-script/models/base",["require","jquery","underscore","backbone","ev-script/util/cache","ev-script/collections/base"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/cache"),s=e("ev-script/collections/base");return r.Model.extend({initialize:function(e,t){this.appId=t.appId,this.config=i.getAppConfig(this.appId)},getCached:function(){},setCached:function(){},fetch:function(e){return e&&e.success&&(e.success=n.wrap(e.success,n.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),r.Model.prototype.fetch.call(this,e)},sync:function(e,i,s){n.defaults(s||(s={}),{xhrFields:{withCredentials:!0}});if(e==="read"){var o=this.getCached(s.cacheKey);if(o){var u=t.Deferred();return s.success&&u.done(s.success),u.resolve(o).promise()}return s.success=s.success||function(e,t,n){},s.success=n.wrap(s.success,n.bind(function(e){this.setCached(s.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),r.Model.prototype.sync.call(this,e,i,s)}return r.Model.prototype.sync.call(this,e,i,s)}})}),s("ev-script/models/video-encoding",["require","backbone","ev-script/models/base","underscore","ev-script/util/cache"],function(e){var t=e("backbone"),n=e("ev-script/models/base"),r=e("underscore"),i=e("ev-script/util/cache");return n.extend({idAttribute:"videoID",initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},getCached:function(e){},setCached:function(e,t){},url:function(){var e=this.config.ensembleUrl+"/app/api/content/show.json/"+this.get("fetchId");return this.config.urlCallback?this.config.urlCallback(e):e},getDims:function(){var e=this.get("dimensions")||"640x360",t=e.split("x"),n=[];return n[0]=this.isAudio()?400:parseInt(t[0],10)||640,n[1]=this.isAudio()?26:parseInt(t[1],10)||360,n},getRatio:function(){var e=this.getDims();return e[0]/e[1]},getWidth:function(){return this.getDims()[0]},getHeight:function(){return this.getDims()[1]},isAudio:function(){return/^audio/i.test(this.get("contentType")||"")},parse:function(e){return r.isArray(e.dataSet.encodings)?r.max(e.dataSet.encodings,function(e,t,n){return parseInt(e.bitRate,10)}):e.dataSet.encodings},sync:function(e,n,i){return r.extend(i,{dataFilter:function(e){var t=e.match(/\{[\s\S]*\}/);return t?t[0]:e}}),t.sync.call(this,e,n,i)}})}),s("ev-script/views/video-preview",["require","underscore","ev-script/views/preview","ev-script/views/video-embed","ev-script/models/video-encoding"],function(e){var t=e("underscore"),n=e("ev-script/views/preview"),r=e("ev-script/views/video-embed"),i=e("ev-script/models/video-encoding");return n.extend({embedClass:r,initialize:function(e){this.appId=e.appId,this.encoding=e.encoding||new i({fetchId:this.model.id},{appId:this.appId}),this.picker=e.picker;var r=t.bind(function(){(!this.model.get("width")||!this.model.get("height"))&&this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()}),n.prototype.initialize.call(this,e)},this);this.encoding.isNew()?this.encoding.fetch({success:r,picker:this.picker}):r()}})}),s("text!ev-script/templates/video-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <img src="<%= item.get(\'ThumbnailUrl\').replace(/width=100/, \'width=150\') %>" alt="<%- item.get(\'Title\') %> thumbnail image"/>\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><span>Choose</span></a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><span>Preview:  item.get(\'Title\') %></span></a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <table class="content-item">\n            <tbody>\n                <tr class="title">\n                    <td colspan="2">\n                        <a class="action-preview" title="Preview: <%-item.get(\'Title\') %>" href="#" rel="<%= item.get(\'ID\') %>"><%- item.get(\'Title\') %></a>\n                    </td>\n                </tr>\n                <tr class="desc"><td class="label">Description</td><td class="value"><%- item.get(\'Description\') %></td></tr>\n                <tr><td class="label">Date Added</td><td class="value"><%- new Date(item.get(\'AddedOn\')).toLocaleString() %></td></tr>\n                <tr><td class="label">Keywords</td><td class="value"><%- item.get(\'Keywords\') %></td></tr>\n                <tr><td class="label">Library</td><td class="value"><%- item.get(\'LibraryName\') %></td></tr>\n            </tbody>\n        </table>\n    </td>\n</tr>\n'}),s("ev-script/views/video-results",["require","jquery","underscore","ev-script/views/results","ev-script/models/video-settings","ev-script/views/video-preview","text!ev-script/templates/video-result.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/results"),i=e("ev-script/models/video-settings"),s=e("ev-script/views/video-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:n.template(e("text!ev-script/templates/video-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)},decorate:function(e){t(".desc .value",e).each(function(e){var n=t(this),r,i,s=100,o=t(this).html();if(o.length>s){n.empty(),r=t("<span>"+o+"</span>"),i=t("<span>"+o.substring(0,s)+"...</span>");var u=t('<a href="#">Less</a>').click(function(e){r.hide(),i.show(),e.preventDefault()}),a=t('<a href="#">More</a>').click(function(e){i.hide(),r.show(),e.preventDefault()});r.hide().append(u),i.append(a),n.append(i).append(r)}})}})}),s("ev-script/collections/videos",["require","ev-script/collections/base","ev-script/util/cache"],function(e){var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.libraryId=n.libraryId||"",this.filterOn=n.filterOn||"",this.filterValue=n.filterValue||"",this.sourceUrl=n.sourceId==="shared"?"/api/SharedContent":"/api/Content",this.pageIndex=1},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("videos");o||s.set("videos",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},clearCache:function(){var e=this.auth.getUser(),t=e?n.getUserCache(this.config.ensembleUrl,e.id):null;t&&t.set("videos",null)},url:function(){var e=this.config.ensembleUrl+this.sourceUrl,t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r="FilterOn="+encodeURIComponent(this.filterOn),i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"/"+this.libraryId+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),s("ev-script/collections/media-workflows",["require","ev-script/collections/base","ev-script/util/cache"],function(e){var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.libraryId||""},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("workflows");o||s.set("workflows",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/MediaWorkflows",t="PageSize=9999",n="PageIndex=1",r="FilterOn=LibraryId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s},parse:function(e){return this.settings=e.Settings,e.Data}})}),s("ev-script/views/workflow-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.$el.html('<option value="-1">Loading...</option>'),this.render()},render:function(){var e=this.collection.findWhere({IsDefault:!0})||this.collection.at(0);this.$el.html(this.template({selectedId:e.id,collection:this.collection}))},getSelected:function(){return this.collection.get(this.$("option:selected").val())}})}),s("text!ev-script/templates/upload.html",[],function(){return'<form class="upload-form" method="POST" action="">\n    <select class="form-select" name="MediaWorkflowID"></select>\n    <div class="fieldWrap">\n        <label for="Title">Title *</label>\n        <input class="form-text" type="text" name="Title" id="Title" />\n    </div>\n    <div class="fieldWrap">\n        <label for="Description">Description</label>\n        <textarea class="form-text" name="Description" id="Description" />\n    </div>\n    <div class="upload"></div>\n</form>\n'}),s("ev-script/views/upload",["require","jquery","underscore","ev-script/views/base","backbone","ev-script/views/workflow-select","ev-script/models/video-settings","plupload","jquery.plupload.queue","text!ev-script/templates/upload.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("backbone"),s=e("ev-script/views/workflow-select"),o=e("ev-script/models/video-settings");return e("plupload"),e("jquery.plupload.queue"),r.extend({template:n.template(e("text!ev-script/templates/upload.html")),events:{"change select":"handleSelect"},initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"render","decorateUploader","closeDialog","handleSelect"),this.field=e.field,this.$anchor=this.$el,this.setElement(this.template()),this.$upload=this.$(".upload"),this.workflows=e.workflows,this.workflowSelect=new s({appId:this.appId,el:this.$("select")[0],collection:this.workflows}),this.render(),this.decorateUploader(),this.appEvents.on("hidePickers",this.closeDialog)},getWidth:function(){return Math.min(600,t(window).width()-this.config.dialogMargin)},getHeight:function(){return Math.min(400,t(window).height()-this.config.dialogMargin)},decorateUploader:function(){var e="",r=this.workflowSelect.getSelected(),i=parseInt(r.get("MaxUploadSize"),10);this.workflows.settings.SupportedVideo&&(e+=this.workflows.settings.SupportedVideo.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.workflows.settings.SupportedAudio&&(e+=this.workflows.settings.SupportedAudio.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.$upload.pluploadQueue()&&this.$upload.pluploadQueue().destroy(),this.$upload.pluploadQueue({url:this.workflows.settings.SubmitUrl,runtimes:"html5,html4,flash",max_file_size:i>0?i+"gb":"12gb",max_file_count:1,max_retries:5,chunk_size:"2mb",unique_names:!1,multiple_queues:!1,multi_selection:!1,drag_drop:!0,multipart:!0,flash_swf_url:this.config.pluploadFlashPath,preinit:{Init:n.bind(function(e,n){t(".plupload_container",this.$upload).removeAttr("title"),t(".plupload_add",this.$upload).text("Add file")},this),PostInit:n.bind(function(e,n){t(".plupload_droptext",this.$upload).text("Drag file here.")},this),UploadFile:n.bind(function(e,t){e.settings.multipart_params={Title:this.$("#Title").val(),Description:this.$("#Description").val(),MediaWorkflowID:this.$("select").val()}},this)},init:{StateChanged:n.bind(function(e){switch(e.state){case plupload.STARTED:e.state===plupload.STARTED&&(t(".plupload_cancel",this.$upload).length===0&&(this.$cancel=t('<a class="plupload_button plupload_cancel" href="#">Cancel upload</a>').insertBefore(t(".plupload_filelist_footer .plupload_clearer",this.$upload)).click(n.bind(function(){e.stop(),this.decorateUploader()},this))),this.$cancel&&this.$cancel.show());break;case plupload.STOPPED:this.$cancel&&this.$cancel.hide()}},this),BeforeUpload:n.bind(function(e,n){var r=this.$("#Title"),i=r.val();if(!i||i.trim()==="")r.focus(),e.stop(),t(".plupload_upload_status",this.$upload).hide(),t(".plupload_buttons",this.$upload).show()},this),FilesAdded:n.bind(function(t,r){var i=e.split(",");n.each(r,function(e){var r=e.name.split("."),s=r[r.length-1];n.contains(i,s.toLowerCase())||(t.removeFile(e),t.trigger("Error",{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate("File extension error."),file:e}))}),t.files.length>1&&t.splice(0,t.files.length-1)},this),UploadComplete:n.bind(function(){this.closeDialog()},this),FileUploaded:n.bind(function(e,t,n){this.appEvents.trigger("fileUploaded")},this)}}),this.$upload.pluploadQueue().bind("refresh",function(){t("div.upload > div.plupload").css({"z-index":"0"}),t(".plupload_button").css({"z-index":"1"})}),this.$upload.pluploadQueue().refresh()},closeDialog:function(){this.$dialog&&this.$dialog.dialog("close")},handleSelect:function(e){this.decorateUploader()},render:function(){var e=t('<div class="dialogWrap"></div>'),r;this.$anchor.after(e),this.$dialog=e.dialog({title:"Upload Media to Ensemble",modal:!0,width:this.getWidth(),height:this.getHeight(),draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(t,n){e.html(this.$el)},this),close:n.bind(function(t,n){this.$upload.pluploadQueue().destroy(),e.dialog("destroy").remove(),this.appEvents.off("hidePickers",this.closeDialog),this.$dialog=null},this)})}})}),s("ev-script/views/video-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/search","ev-script/views/library-type-select","ev-script/views/unit-selects","ev-script/views/video-results","ev-script/collections/videos","ev-script/collections/media-workflows","ev-script/views/upload"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/search"),s=e("ev-script/views/library-type-select"),o=e("ev-script/views/unit-selects"),u=e("ev-script/views/video-results"),a=e("ev-script/collections/videos"),f=e("ev-script/collections/media-workflows"),l=e("ev-script/views/upload");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadVideos","loadWorkflows","changeLibrary","handleSubmit","uploadHandler");var a=n.bind(function(){this.loadVideos()},this);this.info.get("ApplicationVersion")&&(this.$upload=t('<div class="ev-field-actions"><div class="action-upload"><div class="upload-icon"></div><a href="#" class="upload-link" title="Upload"><span>Upload<span></a></div></div>').css("display","none"),this.$("div.ev-filter-block").prepend(this.$upload)),this.searchView=new i({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:a}),this.$("div.ev-filter-block").prepend(this.searchView.$el),this.searchView.render(),this.typeSelectView=new s({id:this.id+"-type-select",tagName:"div",className:"ev-type-select",picker:this,appId:this.appId,callback:a}),this.$("div.ev-filter-block").prepend(this.typeSelectView.$el),this.typeSelectView.render(),this.info.get("ApplicationVersion")&&(this.unitSelects=new o({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$("div.ev-filter-block").prepend(this.unitSelects.$el)),this.resultsView=new u({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click .action-add":"chooseItem","click .action-upload":"uploadHandler","change form.unit-selects select.libraries":"changeLibrary","submit form.unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadVideos(),this.loadWorkflows()},handleSubmit:function(e){this.loadVideos(),e.preventDefault()},uploadHandler:function(e){var t=new l({appId:this.appId,field:this.field,workflows:this.workflows});e.preventDefault()},showPicker:function(){r.prototype.showPicker.call(this),this.info.get("ApplicationVersion")?(this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()):(this.searchView.$('input[type="text"]').focus(),this.loadVideos())},loadVideos:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("sourceId"),i=this.model.get("libraryId"),s=r+i+e,o=new a({},{sourceId:r,libraryId:i,filterOn:"",filterValue:e,appId:this.appId}),u=n.bind(function(){o.clearCache(),this.loadVideos()},this);o.fetch({picker:this,cacheKey:s,success:n.bind(function(e,t,r){var i=e.totalResults=parseInt(t.Pager.TotalRecords,10),s=n.size(t.Data);s===i?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadVideos()},this))},this)}),this.appEvents.off("fileUploaded").on("fileUploaded",u)},loadWorkflows:function(){this.workflows=new f({},{appId:this.appId}),this.workflows.filterValue=this.model.get("libraryId"),this.workflows.fetch({cacheKey:this.workflows.filterValue,success:n.bind(function(e,t,n){e.isEmpty()?this.$upload.css("display","none"):this.$upload.css("display","inline-block")},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadWorkflows()},this))},this),reset:!0})}})}),s("ev-script/views/settings",["require","underscore","ev-script/views/base","jquery-ui"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return e("jquery-ui"),n.extend({initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"show","cancelHandler","submitHandler"),this.field=e.field},events:{submit:"submitHandler","click input.action-cancel":"cancelHandler"},show:function(){this.render(),this.$el.dialog("open")},cancelHandler:function(e){this.$el.dialog("close"),e.preventDefault()},submitHandler:function(e){this.updateModel(),this.$el.dialog("close"),e.preventDefault()},updateModel:function(){}})}),s("text!ev-script/templates/video-settings.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size" <% if (isAudio) { print(\'disabled\'); } %> >\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div class="fieldWrap">\n            <label for="showtitle">Show Title</label>\n            <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="autoplay">Auto Play</label>\n            <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="showcaptions">Show Captions</label>\n            <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="fieldWrap">\n            <label for="hidecontrols">Hide Controls</label>\n            <input id="hidecontrols" class="form-checkbox" <% if (model.get(\'hidecontrols\')) { print(\'checked="checked"\'); } %>  name="hidecontrols" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="form-actions">\n            <input type="button" class="form-submit action-cancel" value="Cancel"/>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),s("text!ev-script/templates/sizes.html",[],function(){return'<% _.each(sizes, function(size) { %>\n    <option value="<%= size %>" <% if (size === target) { print(\'selected="selected"\'); } %>><%= size %></option>\n<% }); %>\n'}),s("ev-script/views/video-settings",["require","jquery","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/video-settings.html","text!ev-script/templates/sizes.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/settings");return e("jquery-ui"),r.extend({template:n.template(e("text!ev-script/templates/video-settings.html")),sizesTemplate:n.template(e("text!ev-script/templates/sizes.html")),initialize:function(e){r.prototype.initialize.call(this,e),this.encoding=e.encoding,this.encoding.on("change:id",n.bind(function(){this.render()},this))},updateModel:function(){var e={showtitle:this.$("#showtitle").is(":checked"),autoplay:this.$("#autoplay").is(":checked"),showcaptions:this.$("#showcaptions").is(":checked"),hidecontrols:this.$("#hidecontrols").is(":checked")},t=this.$("#size").val();if(!t||t==="original")this.encoding&&!this.encoding.isNew()&&n.extend(e,{width:this.encoding.getWidth(),height:this.encoding.getHeight()});else{var r=t.split("x");n.extend(e,{width:parseInt(r[0],10),height:parseInt(r[1],10)})}this.field.model.set(e)},renderSize:function(){var e=this.field.model.get("width"),t=this.field.model.get("height"),n=16/9,r=["1280x720","1024x576","848x480","720x405","640x360","610x344","560x315","480x270","400x225","320x180","240x135","160x90"];e&&t?n=e/t:this.encoding.id&&(e=this.encoding.getWidth(),t=this.encoding.getHeight(),n=this.encoding.getRatio()),Math.ceil(n*10)/10===Math.ceil(4/3*10)/10&&(r=["1280x960","1024x770","848x636","720x540","640x480","610x460","560x420","480x360","400x300","320x240","240x180","160x120"]);var i=e+"x"+t;this.$(".size").append(this.sizesTemplate({sizes:r,target:i}))},render:function(){this.$el.html(this.template({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio()})),this.encoding&&!this.encoding.isAudio()&&this.renderSize();var e=this.field.model.get("content");this.$el.dialog({title:e?e.Title:this.field.model.get("id"),modal:!0,autoOpen:!1,draggable:!1,resizable:!1,dialogClass:"ev-dialog",width:Math.min(340,t(window).width()-this.config.dialogMargin),height:Math.min(320,t(window).height()-this.config.dialogMargin)})}})}),s("text!ev-script/templates/playlist-embed.html",[],function(){return'<iframe src="<%= ensembleUrl %>/app/plugin/embed.aspx?DestinationID=<%= modelId %>"\n        frameborder="0"\n        style="width:800px;height:850px;"\n        allowfullscreen>\n</iframe>\n'}),s("ev-script/views/playlist-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/playlist-embed.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/playlist-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e),this.$el.html(this.template({modelId:this.model.get("id"),ensembleUrl:this.config.ensembleUrl}))}})}),s("ev-script/views/playlist-preview",["require","ev-script/views/preview","ev-script/views/playlist-embed"],function(e){var t=e("ev-script/views/preview"),n=e("ev-script/views/playlist-embed");return t.extend({initialize:function(e){t.prototype.initialize.call(this,e)},embedClass:n})}),s("text!ev-script/templates/playlist-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <span>Choose</span>\n            </a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <span>Preview: <%- item.get(\'Name\') %></span>\n            </a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <span><%- item.get(\'Name\') %></span>\n    </td>\n</tr>\n'}),s("ev-script/views/playlist-results",["require","underscore","jquery","ev-script/views/results","ev-script/models/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/playlist-result.html"],function(e){var t=e("underscore"),n=e("jquery"),r=e("ev-script/views/results"),i=e("ev-script/models/playlist-settings"),s=e("ev-script/views/playlist-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:t.template(e("text!ev-script/templates/playlist-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)}})}),s("ev-script/collections/playlists",["require","ev-script/collections/base","ev-script/util/cache"],function(e){var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.libraryId=n.libraryId||"",this.filterValue=n.filterValue||"",this.pageIndex=1},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("playlists");o||s.set("playlists",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Playlists",t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r,i,s;return this.info.get("ApplicationVersion")?(i="FilterOn=Name",s="FilterValue="+encodeURIComponent(this.filterValue),r=e+"/"+encodeURIComponent(this.libraryId)+"?"+t+"&"+n+(this.filterValue?"&"+i+"&"+s:"")):(i="FilterOn=LibraryId",s="FilterValue="+encodeURIComponent(this.libraryId),r=e+"?"+t+"&"+n+"&"+i+"&"+s),this.config.urlCallback?this.config.urlCallback(r):r}})}),s("ev-script/views/playlist-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/unit-selects","ev-script/views/search","ev-script/views/playlist-results","ev-script/collections/playlists"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/unit-selects"),s=e("ev-script/views/search"),o=e("ev-script/views/playlist-results"),u=e("ev-script/collections/playlists");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadPlaylists","changeLibrary","handleSubmit"),this.info.get("ApplicationVersion")&&(this.searchView=new s({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:n.bind(function(){this.loadPlaylists()},this)}),this.$("div.ev-filter-block").prepend(this.searchView.$el),this.searchView.render()),this.unitSelects=new i({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$("div.ev-filter-block").prepend(this.unitSelects.$el),this.resultsView=new o({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click a.action-add":"chooseItem","change form.unit-selects select.libraries":"changeLibrary","submit form.unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadPlaylists()},handleSubmit:function(e){this.loadPlaylists(),e.preventDefault()},showPicker:function(){r.prototype.showPicker.call(this),this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()},loadPlaylists:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("libraryId"),i=new u({},{libraryId:r,filterValue:e,appId:this.appId});i.fetch({picker:this,cacheKey:r+e,success:n.bind(function(e,t,r){var i=e.totalResults=parseInt(t.Pager.TotalRecords,10),s=n.size(t.Data);s===i?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadPlaylists()},this))},this)})}})}),s("text!ev-script/templates/playlist-settings.html",[],function(){return"<h3>TODO</h3>\n<p>\n    <%- json %>\n</p>\n"}),s("ev-script/views/playlist-settings",["require","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/playlist-settings.html"],function(e){var t=e("underscore"),n=e("ev-script/views/settings");return e("jquery-ui"),n.extend({template:t.template(e("text!ev-script/templates/playlist-settings.html")),initialize:function(e){n.prototype.initialize.call(this,e)},render:function(){this.$el.html(this.template({json:JSON.stringify(this.field.model.toJSON())})),this.$el.dialog({title:"Playlist Embed Settings",modal:!0,autoOpen:!1,dialogClass:"ev-dialog"})}})}),s("text!ev-script/templates/field.html",[],function(){return'<div class="logo">\n    <a target="_blank" href="<%= ensembleUrl %>"><span>Ensemble Logo</span></a>\n</div>\n<% if (modelId) { %>\n    <% if (thumbnailUrl) { %>\n        <div class="thumbnail">\n            <img alt="Media thumbnail" src="<%= thumbnailUrl %>"/>\n        </div>\n    <% } %>\n    <div class="title"><%- name %></div>\n    <div class="ev-field-actions">\n        <a href="#" class="action-choose" title="Change <%= label %>"><span>Change <%= label %><span></a>\n        <a href="#" class="action-preview" title="Preview: <%- name %>"><span>Preview: <%- name %><span></a>\n        <!-- TODO - temporarily disabled playlist settings until it is implemented -->\n        <% if (type === \'video\') { %>\n            <a href="#" class="action-options" title="<%= label %> Embed Options"><span><%= label %> Embed Options<span></a>\n        <% } %>\n        <a href="#" class="action-remove" title="Remove <%= label %>"><span>Remove <%= label %><span></a>\n    </div>\n<% } else { %>\n    <div class="title"><em>Add <%= label %></em></div>\n    <div class="ev-field-actions">\n        <a href="#" class="action-choose" title="Choose <%= label %>"><span>Choose <%= label %><span></a>\n    </div>\n<% } %>\n'}),s("ev-script/views/field",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/video-picker","ev-script/views/video-settings","ev-script/views/video-preview","ev-script/models/video-encoding","ev-script/views/playlist-picker","ev-script/views/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/field.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/video-picker"),u=e("ev-script/views/video-settings"),a=e("ev-script/views/video-preview"),f=e("ev-script/models/video-encoding"),l=e("ev-script/views/playlist-picker"),c=e("ev-script/views/playlist-settings"),h=e("ev-script/views/playlist-preview");return r.extend({template:n.template(e("text!ev-script/templates/field.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseHandler","optionsHandler","removeHandler","previewHandler"),this.$field=e.$field,this.showChoose=!0;var t={id:this.id+"-picker",tagName:"div",className:"ev-"+this.model.get("type")+"-picker",field:this,appId:this.appId},p={id:this.id+"-settings",tagName:"div",className:"ev-settings",field:this,appId:this.appId};this.model instanceof i?(this.modelClass=i,this.pickerClass=o,this.settingsClass=u,this.previewClass=a,this.encoding=new f({},{appId:this.appId}),this.model.isNew()||(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch()),this.model.on("change:id",n.bind(function(){this.model.id?(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch({success:n.bind(function(e){this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()})},this)})):this.encoding.clear()},this)),n.extend(p,{encoding:this.encoding})):this.model instanceof s&&(this.modelClass=s,this.pickerClass=l,this.settingsClass=c,this.previewClass=h),this.picker=new this.pickerClass(n.extend({},t,{model:new this.modelClass(this.model.toJSON())})),this.settings=new this.settingsClass(p),this.$field.after(this.picker.$el),this.renderActions(),this.model.on("change",n.bind(function(){if(!this.model.isNew()){var e=this.model.toJSON();this.$field.val(JSON.stringify(e)),this.appEvents.trigger("fieldUpdated",this.$field,e),this.renderActions()}},this)),this.appEvents.on("showPicker",function(e){this.id===e&&(this.$(".action-choose").hide(),this.showChoose=!1,this.config.hidePickers&&this.appEvents.trigger("hidePickers",this.id))},this),this.appEvents.on("hidePicker",function(e){this.id===e&&(this.$(".action-choose").show(),this.showChoose=!0)},this),this.appEvents.on("hidePickers",function(e){if(!e||this.id!==e)this.$(".action-choose").show(),this.showChoose=!0},this)},events:{"click .action-choose":"chooseHandler","click .action-preview":"previewHandler","click .action-options":"optionsHandler","click .action-remove":"removeHandler"},chooseHandler:function(e){this.appEvents.trigger("showPicker",this.id),e.preventDefault()},optionsHandler:function(e){this.settings.show(),e.preventDefault()},removeHandler:function(e){this.model.clear(),this.$field.val(""),this.model.set(this.model.defaults,{silent:!0}),this.appEvents.trigger("fieldUpdated",this.$field),this.renderActions(),e.preventDefault()},previewHandler:function(e){var t=e.currentTarget,n=new this.previewClass({el:t,encoding:this.encoding,model:this.model,appId:this.appId});e.preventDefault()},renderActions:function(){var e=this.config.ensembleUrl,n,r,s,o;this.model instanceof i?(r="Media",s="video"):(r="Playlist",s="playlist");if(this.model.id){n=this.model.id;var u=this.model.get("content");if(u){n=u.Name||u.Title;var a=new RegExp("^"+e.toLocaleLowerCase()+"/app/assets/");u.ThumbnailUrl&&a.test(u.ThumbnailUrl.toLocaleLowerCase())&&(o=u.ThumbnailUrl)}}this.$actions||(this.$actions=t('<div class="ev-field"/>'),this.$field.after(this.$actions)),this.$actions.html(this.template({ensembleUrl:e,modelId:this.model.id,label:r,type:s,name:n,thumbnailUrl:o})),this.showChoose||this.$(".action-choose").hide()}})}),s("ev-script/models/app-info",["require","underscore","ev-script/models/base"],function(e){var t=e("underscore"),n=e("ev-script/models/base");return n.extend({initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/Info";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e}})}),s("ev-script/models/current-user",["require","underscore","ev-script/models/base"],function(e){var t=e("underscore"),n=e("ev-script/models/base");return n.extend({idAttribute:"ID",initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/CurrentUser";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e.Data[0]}})}),s("ev-script/auth/base/auth",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache","ev-script/models/current-user"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/events"),s=e("ev-script/util/cache"),o=e("ev-script/models/current-user"),u=function(e){n.bindAll(this,"getUser","login","logout","isAuthenticated","handleUnauthorized"),this.appId=e,this.config=s.getAppConfig(e),this.info=s.getAppInfo(e),this.globalEvents=i.getEvents("global"),this.appEvents=i.getEvents(e),this.user=null,this.appEvents.on("appLoaded",function(){this.fetchUser()},this)};return u.extend=r.Model.extend,n.extend(u.prototype,{fetchUser:function(){var e=new o({},{appId:this.appId});return e.fetch({success:n.bind(function(e,t,n){this.user=e,this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},getUser:function(){return this.user},login:function(e){return t.Deferred().reject().promise()},logout:function(){return t.Deferred().reject().promise()},isAuthenticated:function(){return this.user!=null},handleUnauthorized:function(e,t){}}),u}),s("text!ev-script/auth/basic/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text"type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text"type="password"/>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),s("ev-script/auth/basic/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/basic/template.html"],function(e,t){var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/basic/template.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=this.template();this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),r=n("#username",t).val(),i=n("#password",t).val();r&&i&&(this.auth.login({username:r,password:i}).always(this.submitCallback),this.$dialog.dialog("destroy").remove()),e.preventDefault()},this))}})}),s("ev-script/auth/basic/auth",["require","jquery","underscore","backbone","ev-script/auth/base/auth","ev-script/auth/basic/view","ev-script/collections/organizations"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/auth/base/auth"),s=e("ev-script/auth/basic/view"),o=e("ev-script/collections/organizations"),u=i.extend({constructor:function(e){u.__super__.constructor.call(this,e)},fetchUser:function(){if(this.info.get("ApplicationVersion"))return u.__super__.fetchUser.call(this);var e=new o({},{appId:this.appId});return e.requiresAuth=!1,e.fetch({success:n.bind(function(e,t,n){this.user=new r.Model({id:Math.floor(Math.random()*1e16).toString(16)}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},login:function(e){var r={path:this.config.authPath};return t.cookie(this.config.ensembleUrl+"-user",e.username,n.extend({},r)),t.cookie(this.config.ensembleUrl+"-pass",e.password,n.extend({},r)),this.fetchUser()},logout:function(){var e=t.Deferred(),r={path:this.config.authPath};return t.removeCookie(this.config.ensembleUrl+"-user",n.extend({},r)),t.removeCookie(this.config.ensembleUrl+"-pass",n.extend({},r)),this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),e.resolve(),e.promise()},handleUnauthorized:function(e,t){this.logout();var n=new s({el:e,submitCallback:t,appId:this.appId,auth:this});n.render()}});return u}),s("text!ev-script/auth/forms/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text" type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text" type="password"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="provider">Identity Provider</label>\n            <select id="provider" name="provider" class="form-select"></select>\n        </div>\n        <div class="fieldWrap">\n            <label for="remember">Remember Me</label>\n            <input id="remember" name="remember" type="checkbox"></input>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n            <div class="loader"></div>\n        </div>\n    </fieldset>\n</form>\n'}),s("ev-script/auth/forms/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/forms/template.html","text!ev-script/templates/options.html"],function(e,t){var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/forms/template.html")),optionsTemplate:r.template(e("text!ev-script/templates/options.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=n(this.template()),t=n("#provider",e).append(this.optionsTemplate({collection:this.collection,selectedId:this.config.defaultProvider}));this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog);var i=n("div.loader",e),s=r.bind(function(e,t,n){i.addClass("loading")},this),o=r.bind(function(e,t,n){i.removeClass("loading")},this);n(window.document).on("ajaxSend",s).on("ajaxComplete",o),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){n(window.document).off("ajaxSend",s).off("ajaxComplete",o),this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),i=n("#username",t).val(),s=n("#password",t).val();i&&s&&this.auth.login({username:i,password:s,authSourceId:n("#provider :selected",t).val(),persist:n("#remember",t).is(":checked")}).then(r.bind(function(){this.$dialog.dialog("destroy").remove(),this.submitCallback()},this)),e.preventDefault()},this))}})}),s("ev-script/collections/identity-providers",["require","ev-script/collections/base","ev-script/util/cache"],function(e){var t=e("ev-script/collections/base"),n=e("ev-script/util/cache"),r=new n.Cache;return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.requiresAuth=!1},getCached:function(e){return r.get(this.config.ensembleUrl)},setCached:function(e,t){return r.set(this.config.ensembleUrl,t)},url:function(){var e=this.config.ensembleUrl+"/api/IdentityProviders";return this.config.urlCallback?this.config.urlCallback(e):e}})}),s("ev-script/auth/forms/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/models/current-user","ev-script/auth/forms/view","ev-script/collections/identity-providers"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/auth/base/auth"),i=e("ev-script/models/current-user"),s=e("ev-script/auth/forms/view"),o=e("ev-script/collections/identity-providers"),u=r.extend({constructor:function(e){r.prototype.constructor.call(this,e),this.identityProviders=new o({},{appId:e}),this.asPromise=this.identityProviders.fetch()},login:function(e){var r=this.config.ensembleUrl+"/api/Login";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(r):r,type:"POST",dataType:"json",data:{user:e.username,password:e.password,identityProviderId:e.authSourceId,persist:e.persist},xhrFields:{withCredentials:!0},success:n.bind(function(e,t,n){this.user=new i(e.Data[0],{appId:this.appId}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this)}).promise()},logout:function(){var e=this.config.ensembleUrl+"/api/Logout";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(e):e,type:"POST",xhrFields:{withCredentials:!0},success:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),this.asPromise.done(n.bind(function(){var n=new s({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()},this))}});return u}),s("text!ev-script/auth/none/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <h3>You are unauthorized to access this content.</h3>\n</form>\n'}),s("ev-script/auth/none/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery-ui","text!ev-script/auth/none/template.html"],function(e,t){var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/none/template.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId)},render:function(){var e=n(this.template());this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)})}})}),s("ev-script/auth/none/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/auth/none/view"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/auth/base/auth"),i=e("ev-script/auth/none/view"),s=r.extend({constructor:function(e){r.prototype.constructor.call(this,e)},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl);var n=new i({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()}});return s}),s("ev-script",["require","backbone","underscore","jquery","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/field","ev-script/views/video-embed","ev-script/views/playlist-embed","ev-script/models/app-info","ev-script/auth/basic/auth","ev-script/auth/forms/auth","ev-script/auth/none/auth","ev-script/util/events","ev-script/util/cache"],function(e){var t=e("backbone"),n=e("underscore"),r=e("jquery"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/field"),u=e("ev-script/views/video-embed"),a=e("ev-script/views/playlist-embed"),f=e("ev-script/models/app-info"),l=e("ev-script/auth/basic/auth"),c=e("ev-script/auth/forms/auth"),h=e("ev-script/auth/none/auth"),p=e("ev-script/util/events"),d=e("ev-script/util/cache"),v=function(e){var t=Math.floor(Math.random()*1e16).toString(16),s=d.caches.get(e.ensembleUrl);s||(s=d.caches.set(e.ensembleUrl,new d.Cache));var v={ensembleUrl:"",authPath:"",urlCallback:function(e){return e},pageSize:100,scrollHeight:600,hidePickers:!0,dialogMargin:40,authType:"basic",defaultProvider:"",pluploadFlashPath:""},m=d.setAppConfig(t,n.extend({},v,e));p.initEvents(t),this.appEvents=p.getEvents(t),this.globalEvents=p.getEvents();var g=r.Deferred();n.extend(this,g.promise());var y=new f({},{appId:t});d.setAppInfo(t,y),y.fetch({}).always(n.bind(function(){if(!y.get("ApplicationVersion")&&m.authType==="forms")g.reject("Configured to use forms authentication against a pre-3.6 API.");else{var e;switch(m.authType){case"forms":e=new c(t);break;case"none":e=new h(t);break;default:e=new l(t)}d.setAppAuth(t,e),this.handleField=function(e,n,i){var s=r(i,e),u=new o({id:e.id||t,el:e,model:n,$field:s,appId:t})},this.handleEmbed=function(e,n){if(n instanceof i)var r=new u({el:e,model:n,appId:t});else var s=new a({el:e,model:n,appId:t})},this.appEvents.trigger("appLoaded"),g.resolve()}},this))};return{VideoSettings:i,PlaylistSettings:s,EnsembleApp:v}}),s("jquery",function(){return e||jQuery}),s("underscore",function(){return t}),s("backbone",["jquery","underscore"],function(){return n}),s("jquery-ui",["jquery"],function(){}),s("jquery.cookie",["jquery"],function(){}),s("plupload",function(){}),s("jquery.plupload.queue",["jquery","plupload"],function(){}),i("ev-script")});