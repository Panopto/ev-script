/**
 * ev-script 1.0.0 2016-01-20
 * Ensemble Video Integration Library
 * https://github.com/ensembleVideo/ev-script
 * Copyright (c) 2016 Symphony Video, Inc.
 * Licensed (MIT AND GPL-2.0)
 */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license
 * lodash 3.3.1 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

//     (c) 2010-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * ev-scroll-loader 1.0.0 2016-01-20
 * Ensemble Video jQuery Scroll Loader Plugin
 * https://github.com/ensembleVideo/ev-scroll-loader
 * Copyright (c) 2016 Symphony Video, Inc.
 * Licensed (MIT AND GPL-2.0)
 */

/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

(function(e,t){typeof define=="function"&&define.amd?define(["jquery","plupload","jquery-ui","jquery.plupload.queue"],t):e.EV=t(e.$,e.plupload)})(this,function(e,t){var n,r,i;return function(e){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(n){if(v(f,n)){var r=f[n];delete f[n],c[n]=!0,t.apply(e,r)}if(!v(a,n)&&!v(c,n))throw new Error("No "+n);return a[n]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var t,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},t=function(t,n,r,i){var s,l,h,p,d,m=[],y=typeof r,E;i=i||t;if(y==="undefined"||y==="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(d=0;d<n.length;d+=1){p=o(n[d],i),l=p.f;if(l==="require")m[d]=u.require(t);else if(l==="exports")m[d]=u.exports(t),E=!0;else if(l==="module")s=m[d]=u.module(t);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=r?r.apply(a[t],m):undefined;if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!E)a[t]=h}else t&&(a[t]=r)},n=r=s=function(n,r,i,a,f){if(typeof n=="string")return u[n]?u[n](r):w(o(n,r).f);if(!n.splice){l=n,l.deps&&s(l.deps,l.callback);if(!r)return;r.splice?(n=r,r=i,i=null):n=e}return r=r||function(){},typeof i=="function"&&(i=a,a=f),a?t(e,n,r,i):setTimeout(function(){t(e,n,r,i)},4),s},s.config=function(e){return s(e)},n._defined=a,i=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},i.amd={jQuery:!0}}(),i("almond",function(){}),function(){function Lt(e,t){if(e!==t){var n=e===e,r=t===t;if(e>t||!n||typeof e=="undefined"&&r)return 1;if(e<t||!r||typeof t=="undefined"&&n)return-1}return 0}function At(e,t,n){if(t!==t)return Rt(e,n);var r=(n||0)-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}function Ot(e){return typeof e=="function"||!1}function Mt(e,t){var n=e.length;e.sort(t);while(n--)e[n]=e[n].value;return e}function _t(e){return typeof e=="string"?e:e==null?"":e+""}function Dt(e){return e.charCodeAt(0)}function Pt(e,t){var n=-1,r=e.length;while(++n<r&&t.indexOf(e.charAt(n))>-1);return n}function Ht(e,t){var n=e.length;while(n--&&t.indexOf(e.charAt(n))>-1);return n}function Bt(e,t){return Lt(e.criteria,t.criteria)||e.index-t.index}function jt(e,t){var n=-1,r=e.criteria,i=t.criteria,s=r.length;while(++n<s){var o=Lt(r[n],i[n]);if(o)return o}return e.index-t.index}function Ft(e){return yt[e]}function It(e){return bt[e]}function qt(e){return"\\"+St[e]}function Rt(e,t,n){var r=e.length,i=n?t||r:(t||0)-1;while(n?i--:++i<r){var s=e[i];if(s!==s)return i}return-1}function Ut(e){return e&&typeof e=="object"||!1}function zt(e){return e<=160&&e>=9&&e<=13||e==32||e==160||e==5760||e==6158||e>=8192&&(e<=8202||e==8232||e==8233||e==8239||e==8287||e==12288||e==65279)}function Wt(e,t){var n=-1,r=e.length,i=-1,s=[];while(++n<r)e[n]===t&&(e[n]=w,s[++i]=n);return s}function Xt(e,t){var n,r=-1,i=e.length,s=-1,o=[];while(++r<i){var u=e[r],a=t?t(u,r,e):u;if(!r||n!==a)n=a,o[++s]=u}return o}function Vt(e){var t=-1,n=e.length;while(++t<n&&zt(e.charCodeAt(t)));return t}function $t(e){var t=e.length;while(t--&&zt(e.charCodeAt(t)));return t}function Jt(e){return wt[e]}function Kt(i){function jn(e){if(Ut(e)&&!Po(e)&&!(e instanceof Rn)){if(e instanceof In)return e;if(Zt.call(e,"__chain__")&&Zt.call(e,"__wrapped__"))return Ri(e)}return new In(e)}function Fn(){}function In(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function Rn(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=On,this.__views__=null}function Un(){var e=this.__actions__,t=this.__iteratees__,n=this.__views__,r=new Rn(this.__wrapped__);return r.__actions__=e?Zn(e):null,r.__dir__=this.__dir__,r.__dropCount__=this.__dropCount__,r.__filtered__=this.__filtered__,r.__iteratees__=t?Zn(t):null,r.__takeCount__=this.__takeCount__,r.__views__=n?Zn(n):null,r}function zn(){if(this.__filtered__){var e=new Rn(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wn(){var e=this.__wrapped__.value();if(!Po(e))return Yr(e,this.__actions__);var t=this.__dir__,n=t<0,r=xi(0,e.length,this.__views__),i=r.start,s=r.end,o=s-i,u=this.__dropCount__,a=Tn(o,this.__takeCount__),f=n?s:i-1,l=this.__iteratees__,c=l?l.length:0,h=0,p=[];e:while(o--&&h<a){f+=t;var d=-1,v=e[f];while(++d<c){var y=l[d],b=y.iteratee,w=b(v,f,e),E=y.type;if(E==g)v=w;else if(!w){if(E==m)continue e;break e}}u?u--:p[h++]=v}return p}function Xn(){this.__data__={}}function Vn(e){return this.has(e)&&delete this.__data__[e]}function $n(t){return t=="__proto__"?e:this.__data__[t]}function Jn(e){return e!="__proto__"&&Zt.call(this.__data__,e)}function Kn(e,t){return e!="__proto__"&&(this.__data__[e]=t),this}function Qn(e){var t=e?e.length:0;this.data={hash:wn(null),set:new pn};while(t--)this.push(e[t])}function Gn(e,t){var n=e.data,r=typeof t=="string"||zo(t)?n.set.has(t):n.hash[t];return r?0:-1}function Yn(e){var t=this.data;typeof e=="string"||zo(e)?t.set.add(e):t.hash[e]=!0}function Zn(e,t){var n=-1,r=e.length;t||(t=k(r));while(++n<r)t[n]=e[n];return t}function er(e,t){var n=-1,r=e.length;while(++n<r)if(t(e[n],n,e)===!1)break;return e}function tr(e,t){var n=e.length;while(n--)if(t(e[n],n,e)===!1)break;return e}function nr(e,t){var n=-1,r=e.length;while(++n<r)if(!t(e[n],n,e))return!1;return!0}function rr(e,t){var n=-1,r=e.length,i=-1,s=[];while(++n<r){var o=e[n];t(o,n,e)&&(s[++i]=o)}return s}function ir(e,t){var n=-1,r=e.length,i=k(r);while(++n<r)i[n]=t(e[n],n,e);return i}function sr(e){var t=-1,n=e.length,r=An;while(++t<n){var i=e[t];i>r&&(r=i)}return r}function or(e){var t=-1,n=e.length,r=On;while(++t<n){var i=e[t];i<r&&(r=i)}return r}function ur(e,t,n,r){var i=-1,s=e.length;r&&s&&(n=e[++i]);while(++i<s)n=t(n,e[i],i,e);return n}function ar(e,t,n,r){var i=e.length;r&&i&&(n=e[--i]);while(i--)n=t(n,e[i],i,e);return n}function fr(e,t){var n=-1,r=e.length;while(++n<r)if(t(e[n],n,e))return!0;return!1}function lr(e,t){return typeof e=="undefined"?t:e}function cr(e,t,n,r){return typeof e=="undefined"||!Zt.call(r,n)?t:e}function hr(e,t,n){var r=du(t);if(!n)return dr(t,e,r);var i=-1,s=r.length;while(++i<s){var o=r[i],u=e[o],a=n(u,t[o],o,e,t);if((a===a?a!==u:u===u)||typeof u=="undefined"&&!(o in e))e[o]=a}return e}function pr(t,n){var r=-1,i=t.length,s=Oi(i),o=n.length,u=k(o);while(++r<o){var a=n[r];s?(a=parseFloat(a),u[r]=Li(a,i)?t[a]:e):u[r]=t[a]}return u}function dr(e,t,n){n||(n=t,t={});var r=-1,i=n.length;while(++r<i){var s=n[r];t[s]=e[s]}return t}function vr(e,t){var r=-1,i=t.length;while(++r<i){var s=t[r];e[s]=vi(e[s],n,e)}return e}function mr(e,t,n){var r=typeof e;return r=="function"?typeof t!="undefined"&&ki(e)?ti(e,t,n):e:e==null?Yu:r=="object"?Ir(e):typeof t=="undefined"?zr(e+""):qr(e+"",t)}function gr(e,t,n,r,i,s,o){var u;n&&(u=i?n(e,r,i):n(e));if(typeof u!="undefined")return u;if(!zo(e))return e;var a=Po(e);if(a){u=Ti(e);if(!t)return Zn(e,u)}else{var f=tn.call(e),l=f==C;if(!(f==A||f==E||l&&!i))return mt[f]?Ci(e,f,t):i?e:{};u=Ni(l?{}:e);if(!t)return dr(e,u,du(e))}s||(s=[]),o||(o=[]);var c=s.length;while(c--)if(s[c]==e)return o[c];return s.push(e),o.push(u),(a?er:Mr)(e,function(r,i){u[i]=gr(r,t,n,i,e,s,o)}),u}function br(t,n,r,i){if(typeof t!="function")throw new Nt(b);return dn(function(){t.apply(e,Jr(r,i))},n)}function wr(e,t){var n=e?e.length:0,r=[];if(!n)return r;var i=-1,s=Si(),o=s==At,u=o&&t.length>=200?ai(t):null,a=t.length;u&&(s=Gn,o=!1,t=u);e:while(++i<n){var f=e[i];if(o&&f===f){var l=a;while(l--)if(t[l]===f)continue e;r.push(f)}else s(t,f)<0&&r.push(f)}return r}function Er(e,t){var n=e?e.length:0;if(!Oi(n))return Mr(e,t);var r=-1,i=qi(e);while(++r<n)if(t(i[r],r,i)===!1)break;return e}function Sr(e,t){var n=e?e.length:0;if(!Oi(n))return _r(e,t);var r=qi(e);while(n--)if(t(r[n],n,r)===!1)break;return e}function xr(e,t){var n=!0;return Er(e,function(e,r,i){return n=!!t(e,r,i),n}),n}function Tr(e,t,n,r){var i=e.length;n=n==null?0:+n||0,n<0&&(n=-n>i?0:i+n),r=typeof r=="undefined"||r>i?i:+r||0,r<0&&(r+=i),i=n>r?0:r>>>0,n>>>=0;while(n<i)e[n++]=t;return e}function Nr(e,t){var n=[];return Er(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function Cr(e,t,n,r){var i;return n(e,function(e,n,s){if(t(e,n,s))return i=r?n:e,!1}),i}function kr(e,t,n,r){var i=(r||0)-1,s=e.length,o=-1,u=[];while(++i<s){var a=e[i];if(Ut(a)&&Oi(a.length)&&(Po(a)||Do(a))){t&&(a=kr(a,t,n));var f=-1,l=a.length;u.length+=l;while(++f<l)u[++o]=a[f]}else n||(u[++o]=a)}return u}function Lr(e,t,n){var r=-1,i=qi(e),s=n(e),o=s.length;while(++r<o){var u=s[r];if(t(i[u],u,i)===!1)break}return e}function Ar(e,t,n){var r=qi(e),i=n(e),s=i.length;while(s--){var o=i[s];if(t(r[o],o,r)===!1)break}return e}function Or(e,t){return Lr(e,t,vu)}function Mr(e,t){return Lr(e,t,du)}function _r(e,t){return Ar(e,t,du)}function Dr(e,t){var n=-1,r=t.length,i=-1,s=[];while(++n<r){var o=t[n];Uo(e[o])&&(s[++i]=o)}return s}function Pr(t,n,r){var i=-1,s=typeof n=="function",o=t?t.length:0,u=Oi(o)?k(o):[];return Er(t,function(t){var o=s?n:t!=null&&t[n];u[++i]=o?o.apply(t,r):e}),u}function Hr(e,t,n,r,i,s){if(e===t)return e!==0||1/e==1/t;var o=typeof e,u=typeof t;return o!="function"&&o!="object"&&u!="function"&&u!="object"||e==null||t==null?e!==e&&t!==t:Br(e,t,Hr,n,r,i,s)}function Br(e,t,n,r,i,s,o){var u=Po(e),a=Po(t),f=S,l=S;u||(f=tn.call(e),f==E?f=A:f!=A&&(u=Yo(e))),a||(l=tn.call(t),l==E?l=A:l!=A&&(a=Yo(t)));var c=f==A,h=l==A,p=f==l;if(p&&!u&&!c)return gi(e,t,f);var d=c&&Zt.call(e,"__wrapped__"),v=h&&Zt.call(t,"__wrapped__");if(d||v)return n(d?e.value():e,v?t.value():t,r,i,s,o);if(!p)return!1;s||(s=[]),o||(o=[]);var m=s.length;while(m--)if(s[m]==e)return o[m]==t;s.push(e),o.push(t);var g=(u?mi:yi)(e,t,n,r,i,s,o);return s.pop(),o.pop(),g}function jr(t,n,r,i,s){var o=n.length;if(t==null)return!o;var u=-1,a=!s;while(++u<o)if(a&&i[u]?r[u]!==t[n[u]]:!Zt.call(t,n[u]))return!1;u=-1;while(++u<o){var f=n[u];if(a&&i[u])var l=Zt.call(t,f);else{var c=t[f],h=r[u];l=s?s(c,h,f):e,typeof l=="undefined"&&(l=Hr(h,c,s,!0))}if(!l)return!1}return!0}function Fr(e,t){var n=[];return Er(e,function(e,r,i){n.push(t(e,r,i))}),n}function Ir(e){var t=du(e),n=t.length;if(n==1){var r=t[0],i=e[r];if(Mi(i))return function(e){return e!=null&&e[r]===i&&Zt.call(e,r)}}var s=k(n),o=k(n);while(n--)i=e[t[n]],s[n]=i,o[n]=Mi(i);return function(e){return jr(e,t,s,o)}}function qr(e,t){return Mi(t)?function(n){return n!=null&&n[e]===t}:function(n){return n!=null&&Hr(t,n[e],null,!0)}}function Rr(t,n,r,i,s){if(!zo(t))return t;var o=Oi(n.length)&&(Po(n)||Yo(n));return(o?er:Mr)(n,function(n,u,a){if(Ut(n))return i||(i=[]),s||(s=[]),Ur(t,a,u,Rr,r,i,s);var f=t[u],l=r?r(f,n,u,t,a):e,c=typeof l=="undefined";c&&(l=n),(o||typeof l!="undefined")&&(c||(l===l?l!==f:f===f))&&(t[u]=l)}),t}function Ur(t,n,r,i,s,o,u){var a=o.length,f=n[r];while(a--)if(o[a]==f){t[r]=u[a];return}var l=t[r],c=s?s(l,f,r,t,n):e,h=typeof c=="undefined";h&&(c=f,Oi(f.length)&&(Po(f)||Yo(f))?c=Po(l)?l:l?Zn(l):[]:Ko(f)||Do(f)?c=Do(l)?tu(l):Ko(l)?l:{}:h=!1),o.push(f),u.push(c);if(h)t[r]=i(c,f,s,o,u);else if(c===c?c!==l:l===l)t[r]=c}function zr(t){return function(n){return n==null?e:n[t]}}function Wr(e,t){var n=t.length,r=pr(e,t);t.sort(Lt);while(n--){var i=parseFloat(t[n]);if(i!=s&&Li(i)){var s=i;vn.call(e,i,1)}}return r}function Xr(e,t){return e+fn(Ln()*(t-e+1))}function Vr(e,t,n,r,i){return i(e,function(e,i,s){n=r?(r=!1,e):t(n,e,i,s)}),n}function Jr(e,t,n){var r=-1,i=e.length;t=t==null?0:+t||0,t<0&&(t=-t>i?0:i+t),n=typeof n=="undefined"||n>i?i:+n||0,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;var s=k(i);while(++r<i)s[r]=e[r+t];return s}function Kr(e,t){var n;return Er(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}function Qr(e,t){var n=-1,r=Si(),i=e.length,s=r==At,o=s&&i>=200,u=o?ai():null,a=[];u?(r=Gn,s=!1):(o=!1,u=t?[]:a);e:while(++n<i){var f=e[n],l=t?t(f,n,e):f;if(s&&f===f){var c=u.length;while(c--)if(u[c]===l)continue e;t&&u.push(l),a.push(f)}else r(u,l)<0&&((t||o)&&u.push(l),a.push(f))}return a}function Gr(e,t){var n=-1,r=t.length,i=k(r);while(++n<r)i[n]=e[t[n]];return i}function Yr(e,t){var n=e;n instanceof Rn&&(n=n.value());var r=-1,i=t.length;while(++r<i){var s=[n],o=t[r];cn.apply(s,o.args),n=o.func.apply(o.thisArg,s)}return n}function Zr(e,t,n){var r=0,i=e?e.length:r;if(typeof t=="number"&&t===t&&i<=Dn){while(r<i){var s=r+i>>>1,o=e[s];(n?o<=t:o<t)?r=s+1:i=s}return i}return ei(e,t,Yu,n)}function ei(e,t,n,r){t=n(t);var i=0,s=e?e.length:0,o=t!==t,u=typeof t=="undefined";while(i<s){var a=fn((i+s)/2),f=n(e[a]),l=f===f;if(o)var c=l||r;else u?c=l&&(r||typeof f!="undefined"):c=r?f<=t:f<t;c?i=a+1:s=a}return Tn(s,_n)}function ti(e,t,n){if(typeof e!="function")return Yu;if(typeof t=="undefined")return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)};case 5:return function(n,r,i,s,o){return e.call(t,n,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function ni(e){return on.call(e,0)}function ri(e,t,n){var r=n.length,i=-1,s=xn(e.length-r,0),o=-1,u=t.length,a=k(s+u);while(++o<u)a[o]=t[o];while(++i<r)a[n[i]]=e[i];while(s--)a[o++]=e[i++];return a}function ii(e,t,n){var r=-1,i=n.length,s=-1,o=xn(e.length-i,0),u=-1,a=t.length,f=k(o+a);while(++s<o)f[s]=e[s];var l=s;while(++u<a)f[l+u]=t[u];while(++r<i)f[l+n[r]]=e[s++];return f}function si(e,t){return function(n,r,i){var s=t?t():{};r=wi(r,i,3);if(Po(n)){var o=-1,u=n.length;while(++o<u){var a=n[o];e(s,a,r(a,o,n),n)}}else Er(n,function(t,n,i){e(s,t,r(t,n,i),i)});return s}}function oi(e){return function(){var t=arguments.length,n=arguments[0];if(t<2||n==null)return n;t>3&&Ai(arguments[1],arguments[2],arguments[3])&&(t=2);if(t>3&&typeof arguments[t-2]=="function")var r=ti(arguments[--t-1],arguments[t--],5);else t>2&&typeof arguments[t-1]=="function"&&(r=arguments[--t]);var i=0;while(++i<t){var s=arguments[i];s&&e(n,s,r)}return n}}function ui(e,t){function r(){return(this instanceof r?n:e).apply(t,arguments)}var n=li(e);return r}function fi(e){return function(t){var n=-1,r=Ju(Au(t)),i=r.length,s="";while(++n<i)s=e(s,r[n],n);return s}}function li(e){return function(){var t=yr(e.prototype),n=e.apply(t,arguments);return zo(n)?n:t}}function ci(e,t){return function(n,r,i){i&&Ai(n,r,i)&&(r=null);var s=wi(),o=r==null;if(s!==mr||!o)o=!1,r=s(r,i,3);if(o){var u=Po(n);if(!!u||!Go(n))return e(u?n:Ii(n));r=Dt}return bi(n,r,t)}}function hi(e,t,i,l,h,p,d,v,m,g){function C(){var s=arguments.length,o=s,u=k(s);while(o--)u[o]=arguments[o];l&&(u=ri(u,l,h)),p&&(u=ii(u,p,d));if(E||x){var c=C.placeholder,L=Wt(u,c);s-=L.length;if(s<g){var A=v?Zn(v):null,O=xn(g-s,0),M=E?L:null,_=E?null:L,D=E?u:null,P=E?null:u;t|=E?a:f,t&=~(E?f:a),S||(t&=~(n|r));var H=hi(e,t,i,D,M,P,_,A,m,O);return H.placeholder=c,H}}var B=b?i:this;return w&&(e=B[N]),v&&(u=Hi(u,v)),y&&m<u.length&&(u.length=m),(this instanceof C?T||li(e):e).apply(B,u)}var y=t&c,b=t&n,w=t&r,E=t&o,S=t&s,x=t&u,T=!w&&li(e),N=e;return C}function pi(e,t,n){var r=e.length;t=+t;if(r>=t||!En(t))return"";var i=t-r;return n=n==null?" ":n+"",Fu(n,un(i/n.length)).slice(0,i)}function di(e,t,r,i){function u(){var t=-1,n=arguments.length,a=-1,f=i.length,l=k(n+f);while(++a<f)l[a]=i[a];while(n--)l[a++]=arguments[++t];return(this instanceof u?o:e).apply(s?r:this,l)}var s=t&n,o=li(e);return u}function vi(t,i,s,o,u,l,c,h){var p=i&r;if(!p&&typeof t!="function")throw new Nt(b);var d=o?o.length:0;d||(i&=~(a|f),o=u=null),d-=u?u.length:0;if(i&f){var v=o,m=u;o=u=null}var g=!p&&Ei(t),y=[t,i,s,o,u,v,m,l,c,h];g&&g!==!0&&(_i(y,g),i=y[1],h=y[9]),y[9]=h==null?p?0:t.length:xn(h-d,0)||0;if(i==n)var w=ui(y[0],y[2]);else i!=a&&i!=(n|a)||!!y[4].length?w=hi.apply(e,y):w=di.apply(e,y);var E=g?$r:Bi;return E(w,y)}function mi(t,n,r,i,s,o,u){var a=-1,f=t.length,l=n.length,c=!0;if(f!=l&&!(s&&l>f))return!1;while(c&&++a<f){var h=t[a],p=n[a];c=e,i&&(c=s?i(p,h,a):i(h,p,a));if(typeof c=="undefined")if(s){var d=l;while(d--){p=n[d],c=h&&h===p||r(h,p,i,s,o,u);if(c)break}}else c=h&&h===p||r(h,p,i,s,o,u)}return!!c}function gi(e,t,n){switch(n){case x:case T:return+e==+t;case N:return e.name==t.name&&e.message==t.message;case L:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case O:case _:return e==t+""}return!1}function yi(t,n,r,i,s,o,u){var a=du(t),f=a.length,l=du(n),c=l.length;if(f!=c&&!s)return!1;var h,p=-1;while(++p<f){var d=a[p],v=Zt.call(n,d);if(v){var m=t[d],g=n[d];v=e,i&&(v=s?i(g,m,d):i(m,g,d)),typeof v=="undefined"&&(v=m&&m===g||r(m,g,i,s,o,u))}if(!v)return!1;h||(h=d=="constructor")}if(!h){var y=t.constructor,b=n.constructor;if(y!=b&&"constructor"in t&&"constructor"in n&&!(typeof y=="function"&&y instanceof y&&typeof b=="function"&&b instanceof b))return!1}return!0}function bi(e,t,n){var r=n?On:An,i=r,s=i;return Er(e,function(e,o,u){var a=t(e,o,u);if((n?a<i:a>i)||a===r&&a===s)i=a,s=e}),s}function wi(e,t,n){var r=jn.callback||Qu;return r=r===Qu?mr:r,n?r(e,t,n):r}function Si(e,t,n){var r=jn.indexOf||ts;return r=r===ts?At:r,e?r(e,t,n):r}function xi(e,t,n){var r=-1,i=n?n.length:0;while(++r<i){var s=n[r],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=Tn(t,e+o);break;case"takeRight":e=xn(e,t-o)}}return{start:e,end:t}}function Ti(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&Zt.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Ni(e){var t=e.constructor;return typeof t=="function"&&t instanceof t||(t=Et),new t}function Ci(e,t,n){var r=e.constructor;switch(t){case P:return ni(e);case x:case T:return new r(+e);case H:case B:case j:case F:case I:case q:case R:case U:case z:var i=e.buffer;return new r(n?ni(i):i,e.byteOffset,e.length);case L:case _:return new r(e);case O:var s=new r(e.source,tt.exec(e));s.lastIndex=e.lastIndex}return s}function ki(e){var t=jn.support,n=t.funcNames?!e.name:!t.funcDecomp;if(!n){var r=Gt.call(e);t.funcNames||(n=!nt.test(r)),n||(n=ft.test(r)||Vo(e),$r(e,n))}return n}function Li(e,t){return e=+e,t=t==null?Hn:t,e>-1&&e%1==0&&e<t}function Ai(e,t,n){if(!zo(n))return!1;var r=typeof t;if(r=="number")var i=n.length,s=Oi(i)&&Li(t,i);else s=r=="string"&&t in n;if(s){var o=n[t];return e===e?e===o:o!==o}return!1}function Oi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Hn}function Mi(e){return e===e&&(e===0?1/e>0:!zo(e))}function _i(e,t){var i=e[1],o=t[1],a=i|o,f=c|l,h=n|r,p=f|h|s|u,d=i&c&&!(o&c),v=i&l&&!(o&l),m=(v?e:t)[7],g=(d?e:t)[8],y=!(i>=l&&o>h)&&!(i>h&&o>=l),b=a>=f&&a<=p&&(i<l||(v||d)&&m.length<=g);if(!y&&!b)return e;o&n&&(e[2]=t[2],a|=i&n?0:s);var E=t[3];if(E){var S=e[3];e[3]=S?ri(S,E,t[4]):Zn(E),e[4]=S?Wt(e[3],w):Zn(t[4])}return E=t[5],E&&(S=e[5],e[5]=S?ii(S,E,t[6]):Zn(E),e[6]=S?Wt(e[5],w):Zn(t[6])),E=t[7],E&&(e[7]=Zn(E)),o&c&&(e[8]=e[8]==null?t[8]:Tn(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=a,e}function Di(e,t){e=qi(e);var n=-1,r=t.length,i={};while(++n<r){var s=t[n];s in e&&(i[s]=e[s])}return i}function Pi(e,t){var n={};return Or(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n}function Hi(t,n){var r=t.length,i=Tn(n.length,r),s=Zn(t);while(i--){var o=n[i];t[i]=Li(o,r)?s[o]:e}return t}function ji(e){var t,n=jn.support;if(!Ut(e)||tn.call(e)!=A||!Zt.call(e,"constructor")&&(t=e.constructor,typeof t=="function"&&!(t instanceof t)))return!1;var r;return Or(e,function(e,t){r=t}),typeof r=="undefined"||Zt.call(e,r)}function Fi(e){var t=vu(e),n=t.length,r=n&&e.length,i=jn.support,s=r&&Oi(r)&&(Po(e)||i.nonEnumArgs&&Do(e)),o=-1,u=[];while(++o<n){var a=t[o];(s&&Li(a,r)||Zt.call(e,a))&&u.push(a)}return u}function Ii(e){return e==null?[]:Oi(e.length)?zo(e)?e:Et(e):xu(e)}function qi(e){return zo(e)?e:Et(e)}function Ri(e){return e instanceof Rn?e.clone():new In(e.__wrapped__,e.__chain__,Zn(e.__actions__))}function Ui(e,t,n){(n?Ai(e,t,n):t==null)?t=1:t=xn(+t||1,1);var r=0,i=e?e.length:0,s=-1,o=k(un(i/t));while(r<i)o[++s]=Jr(e,r,r+=t);return o}function zi(e){var t=-1,n=e?e.length:0,r=-1,i=[];while(++t<n){var s=e[t];s&&(i[++r]=s)}return i}function Wi(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if(Po(n)||Do(n))break}return wr(n,kr(arguments,!1,!0,++e))}function Xi(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Ai(e,t,n):t==null)t=1;return Jr(e,t<0?0:t)}function Vi(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Ai(e,t,n):t==null)t=1;return t=r-(+t||0),Jr(e,0,t<0?0:t)}function $i(e,t,n){var r=e?e.length:0;if(!r)return[];t=wi(t,n,3);while(r--&&t(e[r],r,e));return Jr(e,0,r+1)}function Ji(e,t,n){var r=e?e.length:0;if(!r)return[];var i=-1;t=wi(t,n,3);while(++i<r&&t(e[i],i,e));return Jr(e,i)}function Ki(e,t,n,r){var i=e?e.length:0;return i?(n&&typeof n!="number"&&Ai(e,t,n)&&(n=0,r=i),Tr(e,t,n,r)):[]}function Qi(e,t,n){var r=-1,i=e?e.length:0;t=wi(t,n,3);while(++r<i)if(t(e[r],r,e))return r;return-1}function Gi(e,t,n){var r=e?e.length:0;t=wi(t,n,3);while(r--)if(t(e[r],r,e))return r;return-1}function Yi(t){return t?t[0]:e}function Zi(e,t,n){var r=e?e.length:0;return n&&Ai(e,t,n)&&(t=!1),r?kr(e,t):[]}function es(e){var t=e?e.length:0;return t?kr(e,!0):[]}function ts(e,t,n){var r=e?e.length:0;if(!r)return-1;if(typeof n=="number")n=n<0?xn(r+n,0):n||0;else if(n){var i=Zr(e,t),s=e[i];return(t===t?t===s:s!==s)?i:-1}return At(e,t,n)}function ns(e){return Vi(e,1)}function rs(){var e=[],t=-1,n=arguments.length,r=[],i=Si(),s=i==At;while(++t<n){var o=arguments[t];if(Po(o)||Do(o))e.push(o),r.push(s&&o.length>=120?ai(t&&o):null)}n=e.length;var u=e[0],a=-1,f=u?u.length:0,l=[],c=r[0];e:while(++a<f){o=u[a];if((c?Gn(c,o):i(l,o))<0){t=n;while(--t){var h=r[t];if((h?Gn(h,o):i(e[t],o))<0)continue e}c&&c.push(o),l.push(o)}}return l}function is(t){var n=t?t.length:0;return n?t[n-1]:e}function ss(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if(typeof n=="number")i=(n<0?xn(r+n,0):Tn(n||0,r-1))+1;else if(n){i=Zr(e,t,!0)-1;var s=e[i];return(t===t?t===s:s!==s)?i:-1}if(t!==t)return Rt(e,i,!0);while(i--)if(e[i]===t)return i;return-1}function os(){var e=arguments[0];if(!e||!e.length)return e;var t=0,n=Si(),r=arguments.length;while(++t<r){var i=0,s=arguments[t];while((i=n(e,s,i))>-1)vn.call(e,i,1)}return e}function us(e){return Wr(e||[],kr(arguments,!1,!1,1))}function as(e,t,n){var r=-1,i=e?e.length:0,s=[];t=wi(t,n,3);while(++r<i){var o=e[r];t(o,r,e)&&(s.push(o),vn.call(e,r--,1),i--)}return s}function fs(e){return Xi(e,1)}function ls(e,t,n){var r=e?e.length:0;return r?(n&&typeof n!="number"&&Ai(e,t,n)&&(t=0,n=r),Jr(e,t,n)):[]}function cs(e,t,n,r){var i=wi(n);return i===mr&&n==null?Zr(e,t):ei(e,t,i(n,r,1))}function hs(e,t,n,r){var i=wi(n);return i===mr&&n==null?Zr(e,t,!0):ei(e,t,i(n,r,1),!0)}function ps(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Ai(e,t,n):t==null)t=1;return Jr(e,0,t<0?0:t)}function ds(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Ai(e,t,n):t==null)t=1;return t=r-(+t||0),Jr(e,t<0?0:t)}function vs(e,t,n){var r=e?e.length:0;if(!r)return[];t=wi(t,n,3);while(r--&&t(e[r],r,e));return Jr(e,r+1)}function ms(e,t,n){var r=e?e.length:0;if(!r)return[];var i=-1;t=wi(t,n,3);while(++i<r&&t(e[i],i,e));return Jr(e,0,i)}function gs(){return Qr(kr(arguments,!1,!0))}function ys(e,t,n,r){var i=e?e.length:0;if(!i)return[];t!=null&&typeof t!="boolean"&&(r=n,n=Ai(e,t,r)?null:t,t=!1);var s=wi();if(s!==mr||n!=null)n=s(n,r,3);return t&&Si()==At?Xt(e,n):Qr(e,n)}function bs(e){var t=-1,n=(e&&e.length&&sr(ir(e,Yt)))>>>0,r=k(n);while(++t<n)r[t]=ir(e,zr(t));return r}function ws(e){return wr(e,Jr(arguments,1))}function Es(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if(Po(n)||Do(n))var r=r?wr(r,n).concat(wr(n,r)):n}return r?Qr(r):[]}function Ss(){var e=arguments.length,t=k(e);while(e--)t[e]=arguments[e];return bs(t)}function xs(e,t){var n=-1,r=e?e.length:0,i={};r&&!t&&!Po(e[0])&&(t=[]);while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function Ts(e){var t=jn(e);return t.__chain__=!0,t}function Ns(e,t,n){return t.call(n,e),e}function Cs(e,t,n){return t.call(n,e)}function ks(){return Ts(this)}function Ls(){return new In(this.value(),this.__chain__)}function As(e){var t,n=this;while(n instanceof Fn){var r=Ri(n);t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t}function Os(){var e=this.__wrapped__;return e instanceof Rn?(this.__actions__.length&&(e=new Rn(this)),new In(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})}function Ms(){return this.value()+""}function _s(){return Yr(this.__wrapped__,this.__actions__)}function Ds(e){var t=e?e.length:0;return Oi(t)&&(e=Ii(e)),pr(e,kr(arguments,!1,!1,1))}function Hs(e,t,n){var r=Po(e)?nr:xr;if(typeof t!="function"||typeof n!="undefined")t=wi(t,n,3);return r(e,t)}function Bs(e,t,n){var r=Po(e)?rr:Nr;return t=wi(t,n,3),r(e,t)}function js(t,n,r){if(Po(t)){var i=Qi(t,n,r);return i>-1?t[i]:e}return n=wi(n,r,3),Cr(t,n,Er)}function Fs(e,t,n){return t=wi(t,n,3),Cr(e,t,Sr)}function Is(e,t){return js(e,Ir(t))}function qs(e,t,n){return typeof t=="function"&&typeof n=="undefined"&&Po(e)?er(e,t):Er(e,ti(t,n,3))}function Rs(e,t,n){return typeof t=="function"&&typeof n=="undefined"&&Po(e)?tr(e,t):Sr(e,ti(t,n,3))}function zs(e,t,n){var r=e?e.length:0;return Oi(r)||(e=xu(e),r=e.length),r?(typeof n=="number"?n=n<0?xn(r+n,0):n||0:n=0,typeof e=="string"||!Po(e)&&Go(e)?n<r&&e.indexOf(t,n)>-1:Si(e,t,n)>-1):!1}function Xs(e,t){return Pr(e,t,Jr(arguments,2))}function Vs(e,t,n){var r=Po(e)?ir:Fr;return t=wi(t,n,3),r(e,t)}function Qs(e,t){return Vs(e,zr(t))}function Gs(e,t,n,r){var i=Po(e)?ur:Vr;return i(e,wi(t,r,4),n,arguments.length<3,Er)}function Ys(e,t,n,r){var i=Po(e)?ar:Vr;return i(e,wi(t,r,4),n,arguments.length<3,Sr)}function Zs(e,t,n){var r=Po(e)?rr:Nr;return t=wi(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})}function eo(t,n,r){if(r?Ai(t,n,r):n==null){t=Ii(t);var i=t.length;return i>0?t[Xr(0,i-1)]:e}var s=to(t);return s.length=Tn(n<0?0:+n||0,s.length),s}function to(e){e=Ii(e);var t=-1,n=e.length,r=k(n);while(++t<n){var i=Xr(0,t);t!=i&&(r[t]=r[i]),r[i]=e[t]}return r}function no(e){var t=e?e.length:0;return Oi(t)?t:du(e).length}function ro(e,t,n){var r=Po(e)?fr:Kr;if(typeof t!="function"||typeof n!="undefined")t=wi(t,n,3);return r(e,t)}function io(e,t,n){var r=-1,i=e?e.length:0,s=Oi(i)?k(i):[];return n&&Ai(e,t,n)&&(t=null),t=wi(t,n,3),Er(e,function(e,n,i){s[++r]={criteria:t(e,n,i),index:r,value:e}}),Mt(s,Bt)}function so(t){var n=arguments;n.length>3&&Ai(n[1],n[2],n[3])&&(n=[t,n[1]]);var r=-1,i=t?t.length:0,s=kr(n,!1,!1,1),o=Oi(i)?k(i):[];return Er(t,function(t){var n=s.length,i=k(n);while(n--)i[n]=t==null?e:t[s[n]];o[++r]={criteria:i,index:r,value:t}}),Mt(o,jt)}function oo(e,t){return Bs(e,Ir(t))}function ao(e,t){if(typeof t!="function"){if(typeof e!="function")throw new Nt(b);var n=e;e=t,t=n}return e=En(e=+e)?e:0,function(){if(--e<1)return t.apply(this,arguments)}}function fo(e,t,n){return n&&Ai(e,t,n)&&(t=null),t=e&&t==null?e.length:xn(+t||0,0),vi(e,c,null,null,null,null,t)}function lo(e,t){var n;if(typeof t!="function"){if(typeof e!="function")throw new Nt(b);var r=e;e=t,t=r}return function(){return--e>0?n=t.apply(this,arguments):t=null,n}}function co(e,t){var r=n;if(arguments.length>2){var i=Jr(arguments,2),s=Wt(i,co.placeholder);r|=a}return vi(e,r,t,i,s)}function ho(e){return vr(e,arguments.length>1?kr(arguments,!1,!1,1):cu(e))}function po(e,t){var i=n|r;if(arguments.length>2){var s=Jr(arguments,2),o=Wt(s,po.placeholder);i|=a}return vi(t,i,e,s,o)}function vo(e,t,n){n&&Ai(e,t,n)&&(t=null);var r=vi(e,o,null,null,null,null,null,t);return r.placeholder=vo.placeholder,r}function mo(e,t,n){n&&Ai(e,t,n)&&(t=null);var r=vi(e,u,null,null,null,null,null,t);return r.placeholder=mo.placeholder,r}function go(t,n,r){function v(){f&&an(f),s&&an(s),s=f=l=e}function m(){var r=n-(uo()-u);if(r<=0||r>n){s&&an(s);var h=l;s=f=l=e,h&&(c=uo(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=dn(m,r)}function g(){f&&an(f),s=f=l=e;if(p||h!==n)c=uo(),o=t.apply(a,i),!f&&!s&&(i=a=null)}function y(){i=arguments,u=uo(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c),v=r<=0||r>h;v?(s&&(s=an(s)),c=u,o=t.apply(a,i)):s||(s=dn(g,r))}return v&&f?f=an(f):!f&&n!==h&&(f=dn(m,n)),e&&(v=!0,o=t.apply(a,i)),v&&!f&&!s&&(i=a=null),o}var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(typeof t!="function")throw new Nt(b);n=n<0?0:+n||0;if(r===!0){var d=!0;p=!1}else zo(r)&&(d=r.leading,h="maxWait"in r&&xn(+r.maxWait||0,n),p="trailing"in r?r.trailing:p);return y.cancel=v,y}function yo(e){return br(e,1,arguments,1)}function bo(e,t){return br(e,t,arguments,2)}function wo(){var e=arguments,t=e.length;if(!t)return function(){return arguments[0]};if(!nr(e,Ot))throw new Nt(b);return function(){var n=0,r=e[n].apply(this,arguments);while(++n<t)r=e[n].call(this,r);return r}}function Eo(){var e=arguments,t=e.length-1;if(t<0)return function(){return arguments[0]};if(!nr(e,Ot))throw new Nt(b);return function(){var n=t,r=e[n].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}}function So(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new Nt(b);var n=function(){var r=n.cache,i=t?t.apply(this,arguments):arguments[0];if(r.has(i))return r.get(i);var s=e.apply(this,arguments);return r.set(i,s),s};return n.cache=new So.Cache,n}function xo(e){if(typeof e!="function")throw new Nt(b);return function(){return!e.apply(this,arguments)}}function To(e){return lo(e,2)}function No(e){var t=Jr(arguments,1),n=Wt(t,No.placeholder);return vi(e,a,null,t,n)}function Co(e){var t=Jr(arguments,1),n=Wt(t,Co.placeholder);return vi(e,f,null,t,n)}function ko(e){var t=kr(arguments,!1,!1,1);return vi(e,l,null,null,null,t)}function Lo(e){if(typeof e!="function")throw new Nt(b);return function(t){return e.apply(this,t)}}function Ao(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new Nt(b);return n===!1?r=!1:zo(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),gt.leading=r,gt.maxWait=+t,gt.trailing=i,go(e,t,gt)}function Oo(e,t){return t=t==null?Yu:t,vi(t,a,null,[e],[])}function Mo(e,t,n,r){return t&&typeof t!="boolean"&&Ai(e,t,n)?t=!1:typeof t=="function"&&(r=n,n=t,t=!1),n=typeof n=="function"&&ti(n,r,1),gr(e,t,n)}function _o(e,t,n){return t=typeof t=="function"&&ti(t,n,1),gr(e,!0,t)}function Do(t){var n=Ut(t)?t.length:e;return Oi(n)&&tn.call(t)==E||!1}function Ho(e){return e===!0||e===!1||Ut(e)&&tn.call(e)==x||!1}function Bo(e){return Ut(e)&&tn.call(e)==T||!1}function jo(e){return e&&e.nodeType===1&&Ut(e)&&tn.call(e).indexOf("Element")>-1||!1}function Fo(e){if(e==null)return!0;var t=e.length;return Oi(t)&&(Po(e)||Go(e)||Do(e)||Ut(e)&&Uo(e.splice))?!t:!du(e).length}function Io(t,n,r,i){r=typeof r=="function"&&ti(r,i,3);if(!r&&Mi(t)&&Mi(n))return t===n;var s=r?r(t,n):e;return typeof s=="undefined"?Hr(t,n,r):!!s}function qo(e){return Ut(e)&&typeof e.message=="string"&&tn.call(e)==N||!1}function zo(e){var t=typeof e;return t=="function"||e&&t=="object"||!1}function Wo(e,t,n,r){var i=du(t),s=i.length;n=typeof n=="function"&&ti(n,r,3);if(!n&&s==1){var o=i[0],u=t[o];if(Mi(u))return e!=null&&u===e[o]&&Zt.call(e,o)}var a=k(s),f=k(s);while(s--)u=a[s]=t[i[s]],f[s]=Mi(u);return jr(e,i,a,f,n)}function Xo(e){return Jo(e)&&e!=+e}function Vo(e){return e==null?!1:tn.call(e)==C?rn.test(Gt.call(e)):Ut(e)&&it.test(e)||!1}function $o(e){return e===null}function Jo(e){return typeof e=="number"||Ut(e)&&tn.call(e)==L||!1}function Qo(e){return Ut(e)&&tn.call(e)==O||!1}function Go(e){return typeof e=="string"||Ut(e)&&tn.call(e)==_||!1}function Yo(e){return Ut(e)&&Oi(e.length)&&vt[tn.call(e)]||!1}function Zo(e){return typeof e=="undefined"}function eu(e){var t=e?e.length:0;return Oi(t)?t?Zn(e):[]:xu(e)}function tu(e){return dr(e,vu(e))}function ru(e,t,n){var r=yr(e);return n&&Ai(e,t,n)&&(t=null),t?dr(t,r,du(t)):r}function iu(t){if(t==null)return t;var n=Zn(arguments);return n.push(lr),nu.apply(e,n)}function su(e,t,n){return t=wi(t,n,3),Cr(e,t,Mr,!0)}function ou(e,t,n){return t=wi(t,n,3),Cr(e,t,_r,!0)}function uu(e,t,n){if(typeof t!="function"||typeof n!="undefined")t=ti(t,n,3);return Lr(e,t,vu)}function au(e,t,n){return t=ti(t,n,3),Ar(e,t,vu)}function fu(e,t,n){if(typeof t!="function"||typeof n!="undefined")t=ti(t,n,3);return Mr(e,t)}function lu(e,t,n){return t=ti(t,n,3),Ar(e,t,du)}function cu(e){return Dr(e,vu(e))}function hu(e,t){return e?Zt.call(e,t):!1}function pu(e,t,n){n&&Ai(e,t,n)&&(t=null);var r=-1,i=du(e),s=i.length,o={};while(++r<s){var u=i[r],a=e[u];t?Zt.call(o,a)?o[a].push(u):o[a]=[u]:o[a]=u}return o}function vu(e){if(e==null)return[];zo(e)||(e=Et(e));var t=e.length;t=t&&Oi(t)&&(Po(e)||qn.nonEnumArgs&&Do(e))&&t||0;var n=e.constructor,r=-1,i=typeof n=="function"&&n.prototype===e,s=k(t),o=t>0;while(++r<t)s[r]=r+"";for(var u in e)(!o||!Li(u,t))&&(u!="constructor"||!i&&!!Zt.call(e,u))&&s.push(u);return s}function mu(e,t,n){var r={};return t=wi(t,n,3),Mr(e,function(e,n,i){r[n]=t(e,n,i)}),r}function yu(e,t,n){if(e==null)return{};if(typeof t!="function"){var r=ir(kr(arguments,!1,!1,1),Tt);return Di(e,wr(vu(e),r))}return t=ti(t,n,3),Pi(e,function(e,n,r){return!t(e,n,r)})}function bu(e){var t=-1,n=du(e),r=n.length,i=k(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function wu(e,t,n){return e==null?{}:typeof t=="function"?Pi(e,ti(t,n,3)):Di(e,kr(arguments,!1,!1,1))}function Eu(t,n,r){var i=t==null?e:t[n];return typeof i=="undefined"&&(i=r),Uo(i)?i.call(t):i}function Su(e,t,n,r){var i=Po(e)||Yo(e);t=wi(t,r,4);if(n==null)if(i||zo(e)){var s=e.constructor;i?n=Po(e)?new s:[]:n=yr(Uo(s)&&s.prototype)}else n={};return(i?er:Mr)(e,function(e,r,i){return t(n,e,r,i)}),n}function xu(e){return Gr(e,du(e))}function Tu(e){return Gr(e,vu(e))}function Nu(e,t,n){return t=+t||0,typeof n=="undefined"?(n=t,t=0):n=+n||0,e>=t&&e<n}function Cu(e,t,n){n&&Ai(e,t,n)&&(t=n=null);var r=e==null,i=t==null;n==null&&(i&&typeof e=="boolean"?(n=e,e=1):typeof t=="boolean"&&(n=t,i=!0)),r&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0;if(n||e%1||t%1){var s=Ln();return Tn(e+s*(t-e+parseFloat("1e-"+((s+"").length-1))),t)}return Xr(e,t)}function Lu(e){return e=_t(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function Au(e){return e=_t(e),e&&e.replace(st,Ft)}function Ou(e,t,n){e=_t(e),t+="";var r=e.length;return n=(typeof n=="undefined"?r:Tn(n<0?0:+n||0,r))-t.length,n>=0&&e.indexOf(t,n)==n}function Mu(e){return e=_t(e),e&&Q.test(e)?e.replace(J,It):e}function _u(e){return e=_t(e),e&&at.test(e)?e.replace(ut,"\\$&"):e}function Pu(e,t,n){e=_t(e),t=+t;var r=e.length;if(r>=t||!En(t))return e;var i=(t-r)/2,s=fn(i),o=un(i);return n=pi("",o,n),n.slice(0,s)+e+n}function Hu(e,t,n){return e=_t(e),e&&pi(e,t,n)+e}function Bu(e,t,n){return e=_t(e),e&&e+pi(e,t,n)}function ju(e,t,n){return n&&Ai(e,t,n)&&(t=0),kn(e,t)}function Fu(e,t){var n="";e=_t(e),t=+t;if(t<1||!e||!En(t))return n;do t%2&&(n+=e),t=fn(t/2),e+=e;while(t);return n}function Ru(e,t,n){return e=_t(e),n=n==null?0:Tn(n<0?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function Uu(t,n,r){var i=jn.templateSettings;r&&Ai(t,n,r)&&(n=r=null),t=_t(t),n=hr(hr({},r||n),i,cr);var s=hr(hr({},n.imports),i.imports,cr),o=du(s),u=Gr(s,o),a,f,l=0,c=n.interpolate||ot,h="__p += '",p=St((n.escape||ot).source+"|"+c.source+"|"+(c===Z?et:ot).source+"|"+(n.evaluate||ot).source+"|$","g"),d="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++dt+"]")+"\n";t.replace(p,function(e,n,r,i,s,o){return r||(r=i),h+=t.slice(l,o).replace(lt,qt),n&&(a=!0,h+="' +\n__e("+n+") +\n'"),s&&(f=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=o+e.length,e}),h+="';\n";var v=n.variable;v||(h="with (obj) {\n"+h+"\n}\n"),h=(f?h.replace(W,""):h).replace(X,"$1").replace(V,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=Ku(function(){return yt(o,d+"return "+h).apply(e,u)});m.source=h;if(qo(m))throw m;return m}function zu(e,t,n){var r=e;return e=_t(e),e?(n?Ai(r,t,n):t==null)?e.slice(Vt(e),$t(e)+1):(t+="",e.slice(Pt(e,t),Ht(e,t)+1)):e}function Wu(e,t,n){var r=e;return e=_t(e),e?(n?Ai(r,t,n):t==null)?e.slice(Vt(e)):e.slice(Pt(e,t+"")):e}function Xu(e,t,n){var r=e;return e=_t(e),e?(n?Ai(r,t,n):t==null)?e.slice(0,$t(e)+1):e.slice(0,Ht(e,t+"")+1):e}function Vu(e,t,n){n&&Ai(e,t,n)&&(t=null);var r=h,i=p;if(t!=null)if(zo(t)){var s="separator"in t?t.separator:s;r="length"in t?+t.length||0:r,i="omission"in t?_t(t.omission):i}else r=+t||0;e=_t(e);if(r>=e.length)return e;var o=r-i.length;if(o<1)return i;var u=e.slice(0,o);if(s==null)return u+i;if(Qo(s)){if(e.slice(o).search(s)){var a,f,l=e.slice(0,o);s.global||(s=St(s.source,(tt.exec(s)||"")+"g")),s.lastIndex=0;while(a=s.exec(l))f=a.index;u=u.slice(0,f==null?o:f)}}else if(e.indexOf(s,o)!=o){var c=u.lastIndexOf(s);c>-1&&(u=u.slice(0,c))}return u+i}function $u(e){return e=_t(e),e&&K.test(e)?e.replace($,Jt):e}function Ju(e,t,n){return n&&Ai(e,t,n)&&(t=null),e=_t(e),e.match(t||ct)||[]}function Ku(){var t=arguments.length,n=arguments[0];try{var r=k(t?t-1:0);while(--t>0)r[t-1]=arguments[t];return n.apply(e,r)}catch(i){return qo(i)?i:new D(i)}}function Qu(e,t,n){return n&&Ai(e,t,n)&&(t=null),Ut(e)?Zu(e):mr(e,t)}function Gu(e){return function(){return e}}function Yu(e){return e}function Zu(e){return Ir(gr(e,!0))}function ea(e,t){return qr(e+"",gr(t,!0))}function ta(e,t,n){if(n==null){var r=zo(t),i=r&&du(t),s=i&&i.length&&Dr(t,i);if(s?!s.length:!r)s=!1,n=t,t=e,e=this}s||(s=Dr(t,du(t)));var o=!0,u=-1,a=Uo(e),f=s.length;n===!1?o=!1:zo(n)&&"chain"in n&&(o=n.chain);while(++u<f){var l=s[u],c=t[l];e[l]=c,a&&(e.prototype[l]=function(t){return function(){var n=this.__chain__;if(o||n){var r=e(this.__wrapped__);return(r.__actions__=Zn(this.__actions__)).push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}var i=[this.value()];return cn.apply(i,arguments),t.apply(e,i)}}(c))}return e}function na(){return i._=nn,this}function ra(){}function ia(e){return zr(e+"")}function sa(t){return function(n){return t==null?e:t[n]}}function oa(e,t,n){n&&Ai(e,t,n)&&(t=n=null),e=+e||0,n=n==null?1:+n||0,t==null?(t=e,e=0):t=+t||0;var r=-1,i=xn(un((t-e)/(n||1)),0),s=k(i);while(++r<i)s[r]=e,e+=n;return s}function ua(e,t,n){e=+e;if(e<1||!En(e))return[];var r=-1,i=k(Tn(e,Mn));t=ti(t,n,1);while(++r<e)r<Mn?i[r]=t(r):t(r);return i}function aa(e){var t=++en;return _t(e)+t}i=i?Qt.defaults(xt.Object(),i,Qt.pick(xt,pt)):xt;var k=i.Array,M=i.Date,D=i.Error,yt=i.Function,bt=i.Math,wt=i.Number,Et=i.Object,St=i.RegExp,Tt=i.String,Nt=i.TypeError,Ct=k.prototype,kt=Et.prototype,zt=(zt=i.window)&&zt.document,Gt=yt.prototype.toString,Yt=zr("length"),Zt=kt.hasOwnProperty,en=0,tn=kt.toString,nn=i._,rn=St("^"+_u(tn).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sn=Vo(sn=i.ArrayBuffer)&&sn,on=Vo(on=sn&&(new sn(0)).slice)&&on,un=bt.ceil,an=i.clearTimeout,fn=bt.floor,ln=Vo(ln=Et.getPrototypeOf)&&ln,cn=Ct.push,hn=kt.propertyIsEnumerable,pn=Vo(pn=i.Set)&&pn,dn=i.setTimeout,vn=Ct.splice,mn=Vo(mn=i.Uint8Array)&&mn,gn=Vo(gn=i.WeakMap)&&gn,yn=function(){try{var e=Vo(e=i.Float64Array)&&e,t=new e(new sn(10),0,1)&&e}catch(n){}return t}(),bn=Vo(bn=k.isArray)&&bn,wn=Vo(wn=Et.create)&&wn,En=i.isFinite,Sn=Vo(Sn=Et.keys)&&Sn,xn=bt.max,Tn=bt.min,Nn=Vo(Nn=M.now)&&Nn,Cn=Vo(Cn=wt.isFinite)&&Cn,kn=i.parseInt,Ln=bt.random,An=wt.NEGATIVE_INFINITY,On=wt.POSITIVE_INFINITY,Mn=bt.pow(2,32)-1,_n=Mn-1,Dn=Mn>>>1,Pn=yn?yn.BYTES_PER_ELEMENT:0,Hn=bt.pow(2,53)-1,Bn=gn&&new gn,qn=jn.support={};(function(e){qn.funcDecomp=!Vo(i.WinRTError)&&ft.test(Kt),qn.funcNames=typeof yt.name=="string";try{qn.dom=zt.createDocumentFragment().nodeType===11}catch(t){qn.dom=!1}try{qn.nonEnumArgs=!hn.call(arguments,1)}catch(t){qn.nonEnumArgs=!0}})(0,0),jn.templateSettings={escape:G,evaluate:Y,interpolate:Z,variable:"",imports:{_:jn}};var yr=function(){function e(){}return function(t){if(zo(t)){e.prototype=t;var n=new e;e.prototype=null}return n||i.Object()}}(),$r=Bn?function(e,t){return Bn.set(e,t),e}:Yu;on||(ni=!sn||!mn?Gu(null):function(e){var t=e.byteLength,n=yn?fn(t/Pn):0,r=n*Pn,i=new sn(t);if(n){var s=new yn(i,0,n);s.set(new yn(e,0,n))}return t!=r&&(s=new mn(i,r),s.set(new mn(e,r))),i});var ai=!wn||!pn?Gu(null):function(e){return new Qn(e)},Ei=Bn?function(e){return Bn.get(e)}:ra,Bi=function(){var e=0,t=0;return function(n,r){var i=uo(),s=v-(i-t);t=i;if(s>0){if(++e>=d)return n}else e=0;return $r(n,r)}}(),Ps=si(function(e,t,n){Zt.call(e,n)?++e[n]:e[n]=1}),Us=si(function(e,t,n){Zt.call(e,n)?e[n].push(t):e[n]=[t]}),Ws=si(function(e,t,n){e[n]=t}),$s=ci(sr),Js=ci(or,!0),Ks=si(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),uo=Nn||function(){return(new M).getTime()},Po=bn||function(e){return Ut(e)&&Oi(e.length)&&tn.call(e)==S||!1};qn.dom||(jo=function(e){return e&&e.nodeType===1&&Ut(e)&&!Ko(e)||!1});var Ro=Cn||function(e){return typeof e=="number"&&En(e)},Uo=Ot(/x/)||mn&&!Ot(mn)?function(e){return tn.call(e)==C}:Ot,Ko=ln?function(e){if(!e||tn.call(e)!=A)return!1;var t=e.valueOf,n=Vo(t)&&(n=ln(t))&&ln(n);return n?e==n||ln(e)==n:ji(e)}:ji,nu=oi(hr),du=Sn?function(e){if(e)var t=e.constructor,n=e.length;return typeof t=="function"&&t.prototype===e||typeof e!="function"&&n&&Oi(n)?Fi(e):zo(e)?Sn(e):[]}:Fi,gu=oi(Rr),ku=fi(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),Du=fi(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()});kn(ht+"08")!=8&&(ju=function(e,t,n){return(n?Ai(e,t,n):t==null)?t=0:t&&(t=+t),e=zu(e),kn(e,t||(rt.test(e)?16:10))});var Iu=fi(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),qu=fi(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))});return jn.prototype=Fn.prototype,In.prototype=yr(Fn.prototype),In.prototype.constructor=In,Rn.prototype=yr(Fn.prototype),Rn.prototype.constructor=Rn,Xn.prototype["delete"]=Vn,Xn.prototype.get=$n,Xn.prototype.has=Jn,Xn.prototype.set=Kn,Qn.prototype.push=Yn,So.Cache=Xn,jn.after=ao,jn.ary=fo,jn.assign=nu,jn.at=Ds,jn.before=lo,jn.bind=co,jn.bindAll=ho,jn.bindKey=po,jn.callback=Qu,jn.chain=Ts,jn.chunk=Ui,jn.compact=zi,jn.constant=Gu,jn.countBy=Ps,jn.create=ru,jn.curry=vo,jn.curryRight=mo,jn.debounce=go,jn.defaults=iu,jn.defer=yo,jn.delay=bo,jn.difference=Wi,jn.drop=Xi,jn.dropRight=Vi,jn.dropRightWhile=$i,jn.dropWhile=Ji,jn.fill=Ki,jn.filter=Bs,jn.flatten=Zi,jn.flattenDeep=es,jn.flow=wo,jn.flowRight=Eo,jn.forEach=qs,jn.forEachRight=Rs,jn.forIn=uu,jn.forInRight=au,jn.forOwn=fu,jn.forOwnRight=lu,jn.functions=cu,jn.groupBy=Us,jn.indexBy=Ws,jn.initial=ns,jn.intersection=rs,jn.invert=pu,jn.invoke=Xs,jn.keys=du,jn.keysIn=vu,jn.map=Vs,jn.mapValues=mu,jn.matches=Zu,jn.matchesProperty=ea,jn.memoize=So,jn.merge=gu,jn.mixin=ta,jn.negate=xo,jn.omit=yu,jn.once=To,jn.pairs=bu,jn.partial=No,jn.partialRight=Co,jn.partition=Ks,jn.pick=wu,jn.pluck=Qs,jn.property=ia,jn.propertyOf=sa,jn.pull=os,jn.pullAt=us,jn.range=oa,jn.rearg=ko,jn.reject=Zs,jn.remove=as,jn.rest=fs,jn.shuffle=to,jn.slice=ls,jn.sortBy=io,jn.sortByAll=so,jn.spread=Lo,jn.take=ps,jn.takeRight=ds,jn.takeRightWhile=vs,jn.takeWhile=ms,jn.tap=Ns,jn.throttle=Ao,jn.thru=Cs,jn.times=ua,jn.toArray=eu,jn.toPlainObject=tu,jn.transform=Su,jn.union=gs,jn.uniq=ys,jn.unzip=bs,jn.values=xu,jn.valuesIn=Tu,jn.where=oo,jn.without=ws,jn.wrap=Oo,jn.xor=Es,jn.zip=Ss,jn.zipObject=xs,jn.backflow=Eo,jn.collect=Vs,jn.compose=Eo,jn.each=qs,jn.eachRight=Rs,jn.extend=nu,jn.iteratee=Qu,jn.methods=cu,jn.object=xs,jn.select=Bs,jn.tail=fs,jn.unique=ys,ta(jn,jn),jn.attempt=Ku,jn.camelCase=ku,jn.capitalize=Lu,jn.clone=Mo,jn.cloneDeep=_o,jn.deburr=Au,jn.endsWith=Ou,jn.escape=Mu,jn.escapeRegExp=_u,jn.every=Hs,jn.find=js,jn.findIndex=Qi,jn.findKey=su,jn.findLast=Fs,jn.findLastIndex=Gi,jn.findLastKey=ou,jn.findWhere=Is,jn.first=Yi,jn.has=hu,jn.identity=Yu,jn.includes=zs,jn.indexOf=ts,jn.inRange=Nu,jn.isArguments=Do,jn.isArray=Po,jn.isBoolean=Ho,jn.isDate=Bo,jn.isElement=jo,jn.isEmpty=Fo,jn.isEqual=Io,jn.isError=qo,jn.isFinite=Ro,jn.isFunction=Uo,jn.isMatch=Wo,jn.isNaN=Xo,jn.isNative=Vo,jn.isNull=$o,jn.isNumber=Jo,jn.isObject=zo,jn.isPlainObject=Ko,jn.isRegExp=Qo,jn.isString=Go,jn.isTypedArray=Yo,jn.isUndefined=Zo,jn.kebabCase=Du,jn.last=is,jn.lastIndexOf=ss,jn.max=$s,jn.min=Js,jn.noConflict=na,jn.noop=ra,jn.now=uo,jn.pad=Pu,jn.padLeft=Hu,jn.padRight=Bu,jn.parseInt=ju,jn.random=Cu,jn.reduce=Gs,jn.reduceRight=Ys,jn.repeat=Fu,jn.result=Eu,jn.runInContext=Kt,jn.size=no,jn.snakeCase=Iu,jn.some=ro,jn.sortedIndex=cs,jn.sortedLastIndex=hs,jn.startCase=qu,jn.startsWith=Ru,jn.template=Uu,jn.trim=zu,jn.trimLeft=Wu,jn.trimRight=Xu,jn.trunc=Vu,jn.unescape=$u,jn.uniqueId=aa,jn.words=Ju,jn.all=Hs,jn.any=ro,jn.contains=zs,jn.detect=js,jn.foldl=Gs,jn.foldr=Ys,jn.head=Yi,jn.include=zs,jn.inject=Gs,ta(jn,function(){var e={};return Mr(jn,function(t,n){jn.prototype[n]||(e[n]=t)}),e}(),!1),jn.sample=eo,jn.prototype.sample=function(e){return!this.__chain__&&e==null?eo(this.value()):this.thru(function(t){return eo(t,e)})},jn.VERSION=t,er(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){jn[e].placeholder=jn}),er(["filter","map","takeWhile"],function(e,t){var n=t==m||t==y;Rn.prototype[e]=function(e,r){var i=this.clone(),s=i.__iteratees__||(i.__iteratees__=[]);return i.__filtered__=i.__filtered__||n,s.push({iteratee:wi(e,r,3),type:t}),i}}),er(["drop","take"],function(e,t){var n="__"+e+"Count__",r=e+"While";Rn.prototype[e]=function(r){r=r==null?1:xn(fn(r)||0,0);var i=this.clone();if(i.__filtered__){var s=i[n];i[n]=t?Tn(s,r):s+r}else{var o=i.__views__||(i.__views__=[]);o.push({size:r,type:e+(i.__dir__<0?"Right":"")})}return i},Rn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},Rn.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[r](e,t).reverse()}}),er(["first","last"],function(e,t){var n="take"+(t?"Right":"");Rn.prototype[e]=function(){return this[n](1).value()[0]}}),er(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");Rn.prototype[e]=function(){return this[n](1)}}),er(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?Ir:zr;Rn.prototype[e]=function(e){return this[n](r(e))}}),Rn.prototype.compact=function(){return this.filter(Yu)},Rn.prototype.dropWhile=function(e,t){var n,r,i=this.__dir__<0;return e=wi(e,t,3),this.filter(function(t,s,o){return n=n&&(i?s<r:s>r),r=s,n||(n=!e(t,s,o))})},Rn.prototype.reject=function(e,t){return e=wi(e,t,3),this.filter(function(t,n,r){return!e(t,n,r)})},Rn.prototype.slice=function(e,t){e=e==null?0:+e||0;var n=e<0?this.takeRight(-e):this.drop(e);return typeof t!="undefined"&&(t=+t||0,n=t<0?n.dropRight(-t):n.take(t-e)),n},Rn.prototype.toArray=function(){return this.drop(0)},Mr(Rn.prototype,function(e,t){var n=jn[t],r=/^(?:first|last)$/.test(t);jn.prototype[t]=function(){var t=this.__wrapped__,i=arguments,s=this.__chain__,o=!!this.__actions__.length,u=t instanceof Rn,a=u&&!o;if(r&&!s)return a?e.call(t):n.call(jn,this.value());var f=function(e){var t=[e];return cn.apply(t,i),n.apply(jn,t)};if(u||Po(t)){var l=a?t:new Rn(this),c=e.apply(l,i);if(!r&&(o||c.__actions__)){var h=c.__actions__||(c.__actions__=[]);h.push({func:Cs,args:[f],thisArg:jn})}return new In(c,s)}return this.thru(f)}}),er(["concat","join","pop","push","shift","sort","splice","unshift"],function(e){var t=Ct[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:join|pop|shift)$/.test(e);jn.prototype[e]=function(){var e=arguments;return r&&!this.__chain__?t.apply(this.value(),e):this[n](function(n){return t.apply(n,e)})}}),Rn.prototype.clone=Un,Rn.prototype.reverse=zn,Rn.prototype.value=Wn,jn.prototype.chain=ks,jn.prototype.commit=Ls,jn.prototype.plant=As,jn.prototype.reverse=Os,jn.prototype.toString=Ms,jn.prototype.run=jn.prototype.toJSON=jn.prototype.valueOf=jn.prototype.value=_s,jn.prototype.collect=jn.prototype.map,jn.prototype.head=jn.prototype.first,jn.prototype.select=jn.prototype.filter,jn.prototype.tail=jn.prototype.rest,jn}var e,t="3.3.1",n=1,r=2,s=4,o=8,u=16,a=32,f=64,l=128,c=256,h=30,p="...",d=150,v=16,m=0,g=1,y=2,b="Expected a function",w="__lodash_placeholder__",E="[object Arguments]",S="[object Array]",x="[object Boolean]",T="[object Date]",N="[object Error]",C="[object Function]",k="[object Map]",L="[object Number]",A="[object Object]",O="[object RegExp]",M="[object Set]",_="[object String]",D="[object WeakMap]",P="[object ArrayBuffer]",H="[object Float32Array]",B="[object Float64Array]",j="[object Int8Array]",F="[object Int16Array]",I="[object Int32Array]",q="[object Uint8Array]",R="[object Uint8ClampedArray]",U="[object Uint16Array]",z="[object Uint32Array]",W=/\b__p \+= '';/g,X=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,$=/&(?:amp|lt|gt|quot|#39|#96);/g,J=/[&<>"'`]/g,K=RegExp($.source),Q=RegExp(J.source),G=/<%-([\s\S]+?)%>/g,Y=/<%([\s\S]+?)%>/g,Z=/<%=([\s\S]+?)%>/g,et=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,tt=/\w*$/,nt=/^\s*function[ \n\r\t]+\w/,rt=/^0[xX]/,it=/^\[object .+?Constructor\]$/,st=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,ot=/($^)/,ut=/[.*+?^${}()|[\]\/\\]/g,at=RegExp(ut.source),ft=/\bthis\b/,lt=/['\n\r\u2028\u2029\\]/g,ct=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"{2,}(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),ht=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",pt=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"],dt=-1,vt={};vt[H]=vt[B]=vt[j]=vt[F]=vt[I]=vt[q]=vt[R]=vt[U]=vt[z]=!0,vt[E]=vt[S]=vt[P]=vt[x]=vt[T]=vt[N]=vt[C]=vt[k]=vt[L]=vt[A]=vt[O]=vt[M]=vt[_]=vt[D]=!1;var mt={};mt[E]=mt[S]=mt[P]=mt[x]=mt[T]=mt[H]=mt[B]=mt[j]=mt[F]=mt[I]=mt[L]=mt[A]=mt[O]=mt[_]=mt[q]=mt[R]=mt[U]=mt[z]=!0,mt[N]=mt[C]=mt[k]=mt[M]=mt[D]=!1;var gt={leading:!1,maxWait:0,trailing:!1},yt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},wt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Et={"function":!0,object:!0},St={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xt=Et[typeof window]&&window!==(this&&this.window)?window:this,Tt=Et[typeof exports]&&exports&&!exports.nodeType&&exports,Nt=Et[typeof module]&&module&&!module.nodeType&&module,Ct=Tt&&Nt&&typeof global=="object"&&global;Ct&&(Ct.global===Ct||Ct.window===Ct||Ct.self===Ct)&&(xt=Ct);var kt=Nt&&Nt.exports===Tt&&Tt,Qt=Kt();typeof i=="function"&&typeof i.amd=="object"&&i.amd?(xt._=Qt,i("underscore",[],function(){return Qt})):Tt&&Nt?kt?(Nt.exports=Qt)._=Qt:Tt._=Qt:xt._=Qt}.call(this),function(e){var t=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof i=="function"&&i.amd)i("backbone",["underscore","jquery","exports"],function(n,r,i){t.Backbone=e(t,i,n,r)});else if(typeof exports!="undefined"){var n=r("underscore"),s;try{s=r("jquery")}catch(o){}e(t,exports,n,s)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice;t.VERSION="1.2.3",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=function(e,t,r){switch(e){case 1:return function(){return n[t](this[r])};case 2:return function(e){return n[t](this[r],e)};case 3:return function(e,i){return n[t](this[r],a(e,this),i)};case 4:return function(e,i,s){return n[t](this[r],a(e,this),i,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[r]),n[t].apply(n,e)}}},u=function(e,t,r){n.each(t,function(t,i){n[i]&&(e.prototype[i]=o(t,i,r))})},a=function(e,t){return n.isFunction(e)?e:n.isObject(e)&&!t._isModel(e)?f(e):n.isString(e)?function(t){return t.get(e)}:e},f=function(e){var t=n.matches(e);return function(e){return t(e.attributes)}},l=t.Events={},c=/\s+/,h=function(e,t,r,i,s){var o=0,u;if(r&&typeof r=="object"){i!==void 0&&"context"in s&&s.context===void 0&&(s.context=i);for(u=n.keys(r);o<u.length;o++)t=h(e,t,u[o],r[u[o]],s)}else if(r&&c.test(r))for(u=r.split(c);o<u.length;o++)t=e(t,u[o],i,s);else t=e(t,r,i,s);return t};l.on=function(e,t,n){return p(this,e,t,n)};var p=function(e,t,n,r,i){e._events=h(d,e._events||{},t,n,{context:r,ctx:e,listening:i});if(i){var s=e._listeners||(e._listeners={});s[i.id]=i}return e};l.listenTo=function(e,t,r){if(!e)return this;var i=e._listenId||(e._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[i];if(!o){var u=this._listenId||(this._listenId=n.uniqueId("l"));o=s[i]={obj:e,objId:i,id:u,listeningTo:s,count:0}}return p(e,t,r,this,o),this};var d=function(e,t,n,r){if(n){var i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,u=r.listening;u&&u.count++,i.push({callback:n,context:s,ctx:s||o,listening:u})}return e};l.off=function(e,t,n){return this._events?(this._events=h(v,this._events,e,t,{context:n,listeners:this._listeners}),this):this},l.stopListening=function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=e?[e._listenId]:n.keys(i);for(var o=0;o<s.length;o++){var u=i[s[o]];if(!u)break;u.obj.off(t,r,this)}return n.isEmpty(i)&&(this._listeningTo=void 0),this};var v=function(e,t,r,i){if(!e)return;var s=0,o,u=i.context,a=i.listeners;if(!t&&!r&&!u){var f=n.keys(a);for(;s<f.length;s++)o=a[f[s]],delete a[o.id],delete o.listeningTo[o.objId];return}var l=t?[t]:n.keys(e);for(;s<l.length;s++){t=l[s];var c=e[t];if(!c)break;var h=[];for(var p=0;p<c.length;p++){var d=c[p];r&&r!==d.callback&&r!==d.callback._callback||u&&u!==d.context?h.push(d):(o=d.listening,o&&--o.count===0&&(delete a[o.id],delete o.listeningTo[o.objId]))}h.length?e[t]=h:delete e[t]}if(n.size(e))return e};l.once=function(e,t,r){var i=h(m,{},e,t,n.bind(this.off,this));return this.on(i,void 0,r)},l.listenToOnce=function(e,t,r){var i=h(m,{},t,r,n.bind(this.stopListening,this,e));return this.listenTo(e,i)};var m=function(e,t,r,i){if(r){var s=e[t]=n.once(function(){i(t,s),r.apply(this,arguments)});s._callback=r}return e};l.trigger=function(e){if(!this._events)return this;var t=Math.max(0,arguments.length-1),n=Array(t);for(var r=0;r<t;r++)n[r]=arguments[r+1];return h(g,this._events,e,void 0,n),this};var g=function(e,t,n,r){if(e){var i=e[t],s=e.all;i&&s&&(s=s.slice()),i&&y(i,r),s&&y(s,[t].concat(r))}return e},y=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}};l.bind=l.on,l.unbind=l.off,n.extend(t,l);var b=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(b.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,r){if(e==null)return this;var i;typeof e=="object"?(i=e,r=t):(i={})[e]=t,r||(r={});if(!this._validate(i,r))return!1;var s=r.unset,o=r.silent,u=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=n.clone(this.attributes),this.changed={});var f=this.attributes,l=this.changed,c=this._previousAttributes;for(var h in i)t=i[h],n.isEqual(f[h],t)||u.push(h),n.isEqual(c[h],t)?delete l[h]:l[h]=t,s?delete f[h]:f[h]=t;this.id=this.get(this.idAttribute);if(!o){u.length&&(this._pending=r);for(var p=0;p<u.length;p++)this.trigger("change:"+u[p],this,f[u[p]],r)}if(a)return this;if(!o)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t=this._changing?this._previousAttributes:this.attributes,r={};for(var i in e){var s=e[i];if(n.isEqual(t[i],s))continue;r[i]=s}return n.size(r)?r:!1},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=n.extend({parse:!0},e);var t=this,r=e.success;return e.success=function(n){var i=e.parse?t.parse(n,e):n;if(!t.set(i,e))return!1;r&&r.call(e.context,t,n,e),t.trigger("sync",t,n,e)},R(this,e),this.sync("read",this,e)},save:function(e,t,r){var i;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0,parse:!0},r);var s=r.wait;if(i&&!s){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;var o=this,u=r.success,a=this.attributes;r.success=function(e){o.attributes=a;var t=r.parse?o.parse(e,r):e;s&&(t=n.extend({},i,t));if(t&&!o.set(t,r))return!1;u&&u.call(r.context,o,e,r),o.trigger("sync",o,e,r)},R(this,r),i&&s&&(this.attributes=n.extend({},a,i));var f=this.isNew()?"create":r.patch?"patch":"update";f==="patch"&&!r.attrs&&(r.attrs=i);var l=this.sync(f,this,r);return this.attributes=a,l},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){i&&s(),r&&r.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var o=!1;return this.isNew()?n.defer(e.success):(R(this,e),o=this.sync("delete",this,e)),i||s(),o},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||q();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.defaults({validate:!0},e))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};u(b,w,"attributes");var E=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},S={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},T=function(e,t,n){n=Math.min(Math.max(n,0),e.length);var r=Array(e.length-n),i=t.length;for(var s=0;s<r.length;s++)r[s]=e[s+n];for(s=0;s<i;s++)e[s+n]=t[s];for(s=0;s<r.length;s++)e[s+i+n]=r[s]};n.extend(E.prototype,l,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,x))},remove:function(e,t){t=n.extend({},t);var r=!n.isArray(e);e=r?[e]:n.clone(e);var i=this._removeModels(e,t);return!t.silent&&i&&this.trigger("update",this,t),r?i[0]:i},set:function(e,t){if(e==null)return;t=n.defaults({},t,S),t.parse&&!this._isModel(e)&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?[e]:e.slice();var i=t.at;i!=null&&(i=+i),i<0&&(i+=this.length+1);var s=[],o=[],u=[],a={},f=t.add,l=t.merge,c=t.remove,h=!1,p=this.comparator&&i==null&&t.sort!==!1,d=n.isString(this.comparator)?this.comparator:null,v;for(var m=0;m<e.length;m++){v=e[m];var g=this.get(v);if(g){if(l&&v!==g){var y=this._isModel(v)?v.attributes:v;t.parse&&(y=g.parse(y,t)),g.set(y,t),p&&!h&&(h=g.hasChanged(d))}a[g.cid]||(a[g.cid]=!0,s.push(g)),e[m]=g}else f&&(v=e[m]=this._prepareModel(v,t),v&&(o.push(v),this._addReference(v,t),a[v.cid]=!0,s.push(v)))}if(c){for(m=0;m<this.length;m++)v=this.models[m],a[v.cid]||u.push(v);u.length&&this._removeModels(u,t)}var b=!1,w=!p&&f&&c;s.length&&w?(b=this.length!=s.length||n.some(this.models,function(e,t){return e!==s[t]}),this.models.length=0,T(this.models,s,0),this.length=this.models.length):o.length&&(p&&(h=!0),T(this.models,o,i==null?this.length:i),this.length=this.models.length),h&&this.sort({silent:!0});if(!t.silent){for(m=0;m<o.length;m++)i!=null&&(t.index=i+m),v=o[m],v.trigger("add",v,this,t);(h||b)&&this.trigger("sort",this,t),(o.length||u.length)&&this.trigger("update",this,t)}return r?e[0]:e},reset:function(e,t){t=t?n.clone(t):{};for(var r=0;r<this.models.length;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(e==null)return void 0;var t=this.modelId(this._isModel(e)?e.attributes:e);return this._byId[e]||this._byId[t]||this._byId[e.cid]},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var r=t.length;return n.isFunction(t)&&(t=n.bind(t,this)),r===1||n.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=n.extend({parse:!0},e);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t.call(e.context,r,n,e),r.trigger("sync",r,n,e)},R(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};var r=t.wait;e=this._prepareModel(e,t);if(!e)return!1;r||this.add(e,t);var i=this,s=t.success;return t.success=function(e,t,n){r&&i.add(e,n),s&&s.call(n.context,e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_removeModels:function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=this.get(e[r]);if(!i)continue;var s=this.indexOf(i);this.models.splice(s,1),this.length--,t.silent||(t.index=s,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n.length?n:!1},_isModel:function(e){return e instanceof b},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes);n!=null&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var n=this.modelId(e.attributes);n!=null&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r);if(e==="change"){var i=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);i!==s&&(i!=null&&delete this._byId[i],s!=null&&(this._byId[s]=t))}this.trigger.apply(this,arguments)}});var N={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};u(E,N,"models");var C=t.View=function(e){this.cid=n.uniqueId("view"),n.extend(this,n.pick(e,L)),this._ensureElement(),this.initialize.apply(this,arguments)},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];n.extend(C.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){e||(e=n.result(this,"events"));if(!e)return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[r]);if(!r)continue;var i=t.match(k);this.delegate(i[1],i[2],n.bind(r,this))}return this},delegate:function(e,t,n){return this.$el.on(e+".delegateEvents"+this.cid,t,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){return this.$el.off(e+".delegateEvents"+this.cid,t,n),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}else this.setElement(n.result(this,"el"))},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,r,i){var s=A[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||q()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1);var a=i.error;i.error=function(e,t,n){i.textStatus=t,i.errorThrown=n,a&&a.call(i.context,e,t,n)};var f=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,f,i),f};var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var O=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},M=/\((.*?)\)/g,_=/(\(\?)?:\w+/g,D=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(O.prototype,l,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o,r)!==!1&&(s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o))}),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(P,"\\$&").replace(M,"(?:$1)?").replace(_,function(e,t){return t?e:"([^/?]+)"}).replace(D,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var H=t.History=function(){this.handlers=[],this.checkUrl=n.bind(this.checkUrl,this),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},B=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,F=/#.*$/;H.started=!1,n.extend(H.prototype,l,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return e.charAt(0)==="/"?e.slice(1):e},getFragment:function(e){return e==null&&(this._usePushState||!this._wantsHashChange?e=this.getPath():e=this.getHash()),e.replace(B,"")},start:function(e){if(H.started)throw new Error("Backbone.history has already been started");H.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(document.documentMode===void 0||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!this.history&&!!this.history.pushState,this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(j,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var r=document.body,i=r.insertBefore(this.iframe,r.firstChild).contentWindow;i.document.open(),i.document.close(),i.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));if(!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),H.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),n.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})):!1},navigate:function(e,t){if(!H.started)return!1;if(!t||t===!0)t={trigger:!!t};e=this.getFragment(e||"");var n=this.root;if(e===""||e.charAt(0)==="?")n=n.slice(0,-1)||"/";var r=n+e;e=this.decodeFragment(e.replace(F,""));if(this.fragment===e)return;this.fragment=e;if(this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,e,t.replace);if(this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var i=this.iframe.contentWindow;t.replace||(i.document.open(),i.document.close()),this._updateHash(i.location,e,t.replace)}}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new H;var I=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};b.extend=E.extend=O.extend=C.extend=H.extend=I;var q=function(){throw new Error('A "url" property or function must be specified')},R=function(e,t){var n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}};return t}),i("ev-script/models/video-settings",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"video",showtitle:!1,autoplay:!1,showcaptions:!1,hidecontrols:!1,search:"",sourceId:"content"}})}),i("ev-script/models/playlist-settings",["backbone"],function(e){"use strict";return e.Model.extend({defaults:{type:"playlist",search:""}})}),i("ev-script/util/events",["require","underscore","backbone"],function(e){"use strict";var t=[],n=e("underscore"),r=e("backbone");return t.global=n.extend({},r.Events),{initEvents:function(e){return t[e]=n.extend({},r.Events)},getEvents:function(e){var n;return e?n=t[e]:n=t.global,n}}}),i("ev-script/util/cache",["require","jquery","underscore","backbone"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=function(){return this.cache=[],this.get=function(e){return e?this.cache[e]:null},this.set=function(e,t){return e?this.cache[e]=t:null},this},s=new i,o=function(e){var t=s.get(e);return t||(t=s.set(e,new i)),t},u=function(e,t){return o(e).set("config",t)},a=function(e){return o(e).get("config")},f=function(e,t){return o(e).set("auth",t)},l=function(e){return o(e).get("auth")},c=function(e,t){return o(e).set("info",t)},h=function(e){return o(e).get("info")},p=function(e,t){var n=s.get(e);n||(n=s.set(e,new i));var r=n.get(t);return r||(r=n.set(t,new i)),r};return{Cache:i,caches:s,setAppConfig:u,getAppConfig:a,setAppAuth:f,getAppAuth:l,setAppInfo:c,getAppInfo:h,getUserCache:p}}),i("ev-script/views/base",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=this,s=e("ev-script/util/events"),o=e("ev-script/util/cache");return r.View.extend({initialize:function(e){this.appId=e.appId,this.config=o.getAppConfig(this.appId),this.auth=o.getAppAuth(this.appId),this.info=o.getAppInfo(this.appId),this.appEvents=s.getEvents(this.appId),this.globalEvents=s.getEvents("global")},ajaxError:function(e,t){e.status===401?this.auth.handleUnauthorized(this.el,t):e.status===500?i.alert("It appears there is an issue with the Ensemble Video installation."):e.status===404?i.alert("Could not find requested resource.  This is likely a problem with the configured Ensemble Video base url."):e.status!==0&&i.alert("An unexpected error occurred.  Check the server log for more details.")}})}),i("text",["module"],function(e){"use strict";var t,n,i,s,o,u=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l=typeof location!="undefined"&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,p=l&&(location.port||undefined),d={},v=e.config&&e.config()||{};t={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(f);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=u[t];try{e=new ActiveXObject(n)}catch(r){}if(e){u=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,v.isBuild&&(d[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}v.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=v.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!l||a(u,c,h,p)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(d.hasOwnProperty(n)){var s=t.jsEscape(d[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(v.env==="node"||!v.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])n=r.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="﻿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(v.env==="xhr"||!v.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);v.onXhr&&v.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),v.onXhrComplete&&v.onXhrComplete(s,e))},s.send(null)};else if(v.env==="rhino"||!v.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(v.env==="xpconnect"||!v.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)i=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,r,u,a={};o&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(u,1,0,!1),r=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(n.available(),a),r.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),i("text!ev-script/templates/hider.html",[],function(){return'<a class="action-hide" href="#" title="Hide Picker">Hide</a>\n<% if (showLogout) { %>\n    <a class="action-logout" href="#" title="Logout <%= username %>">Logout</a>\n<% } %>\n'}),i("ev-script/views/hider",["require","underscore","ev-script/views/base","text!ev-script/templates/hider.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/hider.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"hideHandler","logoutHandler","authHandler","render"),this.globalEvents.on("loggedIn",this.authHandler),this.globalEvents.on("loggedOut",this.authHandler),this.field=e.field},events:{"click a.action-hide":"hideHandler","click a.action-logout":"logoutHandler"},authHandler:function(e){e===this.config.ensembleUrl&&this.render()},render:function(){var e="";this.info.get("ApplicationVersion")&&this.auth.isAuthenticated()&&(e=this.auth.getUser().get("UserName")),this.$el.html(this.template({showLogout:this.auth.isAuthenticated()&&this.config.authType!=="none",username:e}))},hideHandler:function(e){this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},logoutHandler:function(e){this.auth.logout().always(this.appEvents.trigger("hidePickers")),e.preventDefault()}})}),i("text!ev-script/templates/picker.html",[],function(){return'<div id="<%= id %>-hider" class="ev-hider"></div>\n<div id="<%= id %>-filter-block" class="ev-filter-block">\n    <div class="loader"></div>\n</div>\n<div id="<%= id %>-results" class="ev-results clearfix"></div>\n'}),i("ev-script/views/picker",["require","jquery","underscore","ev-script/views/base","ev-script/views/hider","text!ev-script/templates/picker.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/hider");return r.extend({template:n.template(e("text!ev-script/templates/picker.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseItem","hidePicker","showPicker"),this.$el.hide(),this.$el.html(this.template({id:this.id})),this.field=e.field,this.hider=new i({el:this.$("div.ev-hider"),field:this.field,appId:this.appId});var s=this.$("div.loader");t(window.document).on("ajaxSend",n.bind(function(e,t,n){this===n.picker&&s.addClass("loading")},this)).on("ajaxComplete",n.bind(function(e,t,n){this===n.picker&&s.removeClass("loading")},this)),this.appEvents.on("hidePickers",function(e){(!e||this.field.id!==e)&&this.hidePicker()},this),this.appEvents.on("showPicker",function(e){this.field.id===e&&this.$el.is(":hidden")&&this.showPicker()},this),this.appEvents.on("hidePicker",function(e){this.field.id===e&&this.hidePicker()},this),this.hider.render()},chooseItem:function(e){var n=t(e.target).attr("rel"),r=this.resultsView.collection.get(n);this.model.set({id:n,content:r.toJSON()}),this.field.model.set(this.model.attributes),this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},hidePicker:function(){this.$el.fadeOut("fast")},showPicker:function(){this.hider.render(),this.$el.fadeIn("fast")}})}),i("text!ev-script/templates/search.html",[],function(){return'<form>\n    <label for="<%= id %>">Search:</label>\n    <input id="<%= id %>" type="text" class="form-text search" value="<%- searchVal %>" title="Search Media" />\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),i("ev-script/views/search",["require","underscore","ev-script/views/base","text!ev-script/templates/search.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/search.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"searchHandler","doSearch","autoSearch"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"submit form":"searchHandler","keyup .search":"autoSearch"},render:function(){this.$el.html(this.template({id:this.id+"-input",searchVal:this.picker.model.get("search")}))},doSearch:function(){this.picker.model.set({search:this.$(".search").val()}),this.callback()},searchHandler:function(e){this.doSearch(),e.preventDefault()},autoSearch:function(e){var n=e.target.value;n!==this.lastValue&&(this.lastValue=n,this.submitTimeout&&clearTimeout(this.submitTimeout),this.submitTimeout=setTimeout(t.bind(function(){this.doSearch()},this),1e3))}})}),i("text!ev-script/templates/library-type-select.html",[],function(){return'<form>\n    <label for="<%= id %>">Type:</label>\n    <select id="<%= id %>" class="form-select source" title="Select Library Type">\n      <option value="content" <% if (sourceId === \'content\') { print(\'selected="selected"\'); } %>>Media Library</option>\n      <option value="shared" <% if (sourceId === \'shared\') { print(\'selected="selected"\'); } %>>Shared Library</option>\n    </select>\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),i("ev-script/views/library-type-select",["require","underscore","ev-script/views/base","text!ev-script/templates/library-type-select.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/library-type-select.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"changeHandler"),this.picker=e.picker,this.callback=e.callback||function(){}},events:{"change .source":"changeHandler"},render:function(){this.$el.html(this.template({id:this.id+"-select",sourceId:this.picker.model.get("sourceId")}))},changeHandler:function(e){this.picker.model.set({sourceId:this.$(".source").val()}),this.callback(),e.preventDefault()}})}),i("text!ev-script/templates/options.html",[],function(){return"<% collection.each(function(item) { %>\n    <option value=\"<%= item.id %>\" <% if (selectedId === item.id) { print('selected=\"selected\"'); } %>><%- item.get('Name') %></option>\n<% }); %>\n"}),i("ev-script/views/organization-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("organizationId")||this.auth.getUser().get("OrganizationID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),i("ev-script/collections/base",["require","jquery","underscore","backbone","ev-script/util/cache"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/cache");return r.Collection.extend({initialize:function(e,t){this.requiresAuth=!0,this.appId=t.appId,this.config=i.getAppConfig(this.appId),this.auth=i.getAppAuth(this.appId),this.info=i.getAppInfo(this.appId)},model:r.Model.extend({idAttribute:"ID"}),getCached:function(e){},setCached:function(e,t){},clearCache:function(e){},parse:function(e){return e.Data},fetch:function(e){return e&&e.success&&(e.success=n.wrap(e.success,n.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),r.Collection.prototype.fetch.call(this,e)},sync:function(e,i,s){n.defaults(s||(s={}),{xhrFields:{withCredentials:!0}});if(e==="read"){var o=this.getCached(s.cacheKey);if(o){var u=t.Deferred();return s.success&&u.done(s.success),u.resolve(o).promise()}return s.success=s.success||function(e,t,n){},s.success=n.wrap(s.success,n.bind(function(e){this.setCached(s.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),r.Collection.prototype.sync.call(this,e,i,s)}return r.Collection.prototype.sync.call(this,e,i,s)}})}),i("ev-script/collections/organizations",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n)},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;return s?s[t?"set":"get"](e,t):null},getCached:function(e){return this._cache("orgs")},setCached:function(e,t){return this._cache("orgs",t)},url:function(){var e=this.config.ensembleUrl+"/api/Organizations",t="PageSize=9999",n="PageIndex=1",r=e+"?"+t+"&"+n;return this.config.urlCallback?this.config.urlCallback(r):r}})}),i("ev-script/views/library-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){var e=this.picker.model.get("libraryId")||this.auth.getUser().get("LibraryID");this.$el.html(this.template({selectedId:e,collection:this.collection})),this.$el.trigger("change")}})}),i("ev-script/collections/libraries",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.organizationId||""},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("libs");o||s.set("libs",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Libraries",t="PageSize=9999",n="PageIndex=1",r="FilterOn=OrganizationId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),i("text!ev-script/templates/unit-selects.html",[],function(){return'<form id="<%= formId %>" class="unit-selects">\n    <label for="<%= orgSelectId %>">Organization:</label>\n    <select id="<%= orgSelectId %>" class="form-select organizations" title="Select Organization"></select>\n    <label for="<%= libSelectId %>">Library:</label>\n    <select id="<%= libSelectId %>" class="form-select libraries" title="Select Library"></select>\n    <input type="submit" value="Go" class="form-submit" />\n</form>\n'}),i("ev-script/views/unit-selects",["require","jquery","underscore","ev-script/views/base","ev-script/views/organization-select","ev-script/collections/organizations","ev-script/views/library-select","ev-script/collections/libraries","text!ev-script/templates/unit-selects.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/organization-select"),s=e("ev-script/collections/organizations"),o=e("ev-script/views/library-select"),u=e("ev-script/collections/libraries");return r.extend({template:n.template(e("text!ev-script/templates/unit-selects.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadOrgs","loadLibraries","changeOrganization","changeLibrary"),this.picker=e.picker,this.id=e.id,this.$el.html(this.template({formId:this.id+"-unit-selects",orgSelectId:this.id+"-org-select",libSelectId:this.id+"-lib-select"})),this.orgSelect=new i({el:this.$(".organizations"),picker:this.picker,appId:this.appId,collection:new s({},{appId:this.appId})}),this.libSelect=new o({el:this.$(".libraries"),picker:this.picker,appId:this.appId,collection:new u({},{appId:this.appId})})},events:{"change select.organizations":"changeOrganization","change select.libraries":"changeLibrary"},changeOrganization:function(e){this.picker.model.set({organizationId:e.target.value}),this.loadLibraries()},changeLibrary:function(e){this.picker.model.set({libraryId:e.target.value})},loadOrgs:function(){var e=new s({},{appId:this.appId});e.fetch({picker:this.picker,success:n.bind(function(e,t,n){this.orgSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadOrgs()},this))},this)})},loadLibraries:function(){var e=this.picker.model.get("organizationId"),t=new u({},{organizationId:e,appId:this.appId});t.fetch({picker:this.picker,cacheKey:e,success:n.bind(function(e,t,n){this.libSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadLibraries()},this))},this)})}})}),function(e){typeof i=="function"&&i.amd?i("ev-scroll-loader",["jquery"],e):typeof module=="object"&&typeof module.exports=="object"?e(r("jquery")):e(jQuery)}(function(e){"use strict";var t={callback:function(){}},n={init:function(n){var r=e.extend({},t,n);return this.each(function(){var t=e(this);t.addClass("scroll-content");var n=t.wrap('<div class="scrollWrap"/>').closest(".scrollWrap");n.append('<div class="loader"></div>');var i=this.scrollHeight,s=r.height||i,o=Math.min(s,i)-10;n.css({position:"relative",height:o+"px","overflow-y":"scroll"}).scroll(function(){n.scrollTop()===n[0].scrollHeight-o&&r.callback.apply(t[0])})})},showLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).show(),this},hideLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).hide(),this}};e.fn.evScrollLoader=function(e){if(n[e])return n[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return n.init.apply(this,arguments)}}),i("text!ev-script/templates/results.html",[],function(){return'<div class="total">Search returned <%= totalResults %> results.</div>\n<div class="results">\n    <table class="content-list"></table>\n</div>\n'}),i("text!ev-script/templates/no-results.html",[],function(){return'<tr class="odd"><td colspan="2">No results available.</td></tr>\n'}),i("ev-script/views/results",["require","jquery","underscore","ev-script/views/base","ev-scroll-loader","text!ev-script/templates/results.html","text!ev-script/templates/no-results.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base");return e("ev-scroll-loader"),r.extend({resultsTemplate:n.template(e("text!ev-script/templates/results.html")),emptyTemplate:n.template(e("text!ev-script/templates/no-results.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"render","loadMore","addHandler","previewItem"),this.picker=e.picker,this.appId=e.appId,this.loadLock=!1},events:{"click a.action-preview":"previewItem"},getItemHtml:function(e,t){if(this.resultTemplate)return this.resultTemplate({item:e,index:t})},previewItem:function(e){var n=e.currentTarget,r=t(n).attr("rel"),i=this.collection.get(r),s={id:r,content:i.toJSON(),appId:this.appId},o=new this.previewClass({el:n,model:new this.modelClass(s),appId:this.appId,picker:this.picker});e.stopPropagation(),e.preventDefault()},loadMore:function(){this.collection.hasMore&&!this.loadLock&&(this.loadLock=!0,this.collection.fetch({remove:!1,picker:this.picker,success:n.bind(function(e,t,r){n.size(t.Data)<this.config.pageSize?(e.hasMore=!1,this.$scrollLoader.evScrollLoader("hideLoader")):(e.hasMore=!0,e.pageIndex+=1),this.loadLock=!1},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadMore()},this)),this.loadLock=!1},this)}))},addHandler:function(e,n,r){var i=t(this.getItemHtml(e,r.index));this.decorate(i),this.$(".content-list").append(i)},decorate:function(e){},render:function(){this.$el.html(this.resultsTemplate({totalResults:this.collection.totalResults}));var e=this.$(".content-list");this.collection.isEmpty()?e.append(this.emptyTemplate()):this.collection.each(function(n,r){var i=t(this.getItemHtml(n,r));this.decorate(i),e.append(i)},this);var n=this.config.scrollHeight;if(this.collection.size()>=this.config.pageSize||e[0].scrollHeight>n)this.$scrollLoader=e.evScrollLoader({height:n,callback:this.loadMore}),this.collection.hasMore||this.$scrollLoader.evScrollLoader("hideLoader");this.collection.off("add",this.addHandler).on("add",this.addHandler)}})}),i("ev-script/views/preview",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","jquery-ui"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings");return e("jquery-ui"),r.extend({initialize:function(e){r.prototype.initialize.call(this,e);var s=t('<div class="dialogWrap"></div>'),o=this.model.get("content")||{Title:this.model.get("id")},u=new this.model.constructor(this.model.toJSON()),a={width:this.model.get("width")||(this.model instanceof i?640:800),height:this.model.get("height")||(this.model instanceof i?360:850)},f={},l=50,c=140,h,p,d;this.$el.after(s),f.width=Math.min(a.width+l,t(window).width()-this.config.dialogMargin),f.height=Math.min(a.height+c,t(window).height()-this.config.dialogMargin),p=f.width-l,this.model instanceof i&&a.width>p&&(h=p/a.width,a.width=a.width*h,a.height=a.height*h),u.set("width",a.width),u.set("height",a.height),d=s.dialog({title:o.Title||o.Name,modal:!0,width:f.width,height:f.height,draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(e,t){var n=new this.embedClass({model:u,appId:this.appId});s.html(n.$el)},this),close:function(e,t){s.dialog("destroy").remove()}})}})}),i("text!ev-script/templates/video-embed.html",[],function(){return'<iframe src="<%= src %>"\n        frameborder="0"\n        style="width: <%= width %>px;height:<%= (parseInt(height, 10) + 56) %>px;"\n        allowfullscreen>\n</iframe>\n'}),i("ev-script/views/video-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/video-embed.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/video-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e);var t=this.model.get("width")?this.model.get("width"):"640",r=this.model.get("height")?this.model.get("height"):"360",i=this.model.get("showtitle"),s=this.config.ensembleUrl+"/app/plugin/embed.aspx?ID="+this.model.get("id")+"&autoPlay="+this.model.get("autoplay")+"&displayTitle="+i+"&hideControls="+this.model.get("hidecontrols")+"&showCaptions="+this.model.get("showcaptions")+"&width="+t+"&height="+r;this.$el.html(this.template({src:s,width:t,height:i?r+25:r}))}})}),i("ev-script/models/base",["require","jquery","underscore","backbone","ev-script/util/cache","ev-script/collections/base"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/cache"),s=e("ev-script/collections/base");return r.Model.extend({initialize:function(e,t){this.appId=t.appId,this.config=i.getAppConfig(this.appId)},getCached:function(){},setCached:function(){},fetch:function(e){return e&&e.success&&(e.success=n.wrap(e.success,n.bind(function(e){var t=Array.prototype.slice.call(arguments,1);this.requiresAuth&&!this.auth.isAuthenticated()?this.auth.fetchUser().always(function(){e.apply(this,t)}):e.apply(this,t)},this))),r.Model.prototype.fetch.call(this,e)},sync:function(e,i,s){n.defaults(s||(s={}),{xhrFields:{withCredentials:!0}});if(e==="read"){var o=this.getCached(s.cacheKey);if(o){var u=t.Deferred();return s.success&&u.done(s.success),u.resolve(o).promise()}return s.success=s.success||function(e,t,n){},s.success=n.wrap(s.success,n.bind(function(e){this.setCached(s.cacheKey,arguments[1]),e.apply(this,Array.prototype.slice.call(arguments,1))},this)),r.Model.prototype.sync.call(this,e,i,s)}return r.Model.prototype.sync.call(this,e,i,s)}})}),i("ev-script/models/video-encoding",["require","backbone","ev-script/models/base","underscore","ev-script/util/cache"],function(e){"use strict";var t=e("backbone"),n=e("ev-script/models/base"),r=e("underscore"),i=e("ev-script/util/cache");return n.extend({idAttribute:"videoID",initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},getCached:function(e){},setCached:function(e,t){},url:function(){var e=this.config.ensembleUrl+"/app/api/content/show.json/"+this.get("fetchId");return this.config.urlCallback?this.config.urlCallback(e):e},getDims:function(){var e=this.get("dimensions")||"640x360",t=e.split("x"),n=[];return n[0]=this.isAudio()?400:parseInt(t[0],10)||640,n[1]=this.isAudio()?26:parseInt(t[1],10)||360,n},getRatio:function(){var e=this.getDims();return e[0]/e[1]},getWidth:function(){return this.getDims()[0]},getHeight:function(){return this.getDims()[1]},isAudio:function(){return/^audio/i.test(this.get("contentType")||"")},parse:function(e){return r.isArray(e.dataSet.encodings)?r.max(e.dataSet.encodings,function(e,t,n){return parseInt(e.bitRate,10)}):e.dataSet.encodings},sync:function(e,n,i){return r.extend(i,{dataFilter:function(e){var t=e.match(/\{[\s\S]*\}/);return t?t[0]:e}}),t.sync.call(this,e,n,i)}})}),i("ev-script/views/video-preview",["require","underscore","ev-script/views/preview","ev-script/views/video-embed","ev-script/models/video-encoding"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/preview"),r=e("ev-script/views/video-embed"),i=e("ev-script/models/video-encoding");return n.extend({embedClass:r,initialize:function(e){this.appId=e.appId,this.encoding=e.encoding||new i({fetchId:this.model.id},{appId:this.appId}),this.picker=e.picker;var r=t.bind(function(){(!this.model.get("width")||!this.model.get("height"))&&this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()}),n.prototype.initialize.call(this,e)},this);this.encoding.isNew()?this.encoding.fetch({success:r,picker:this.picker}):r()}})}),i("text!ev-script/templates/video-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <img src="<%= item.get(\'ThumbnailUrl\').replace(/width=100/, \'width=150\') %>" alt="<%- item.get(\'Title\') %> thumbnail image"/>\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><span>Choose</span></a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><span>Preview:  item.get(\'Title\') %></span></a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <table class="content-item">\n            <tbody>\n                <tr class="title">\n                    <td colspan="2">\n                        <a class="action-preview" title="Preview: <%-item.get(\'Title\') %>" href="#" rel="<%= item.get(\'ID\') %>"><%- item.get(\'Title\') %></a>\n                    </td>\n                </tr>\n                <tr class="desc"><td class="label">Description</td><td class="value"><%- item.get(\'Description\') %></td></tr>\n                <tr><td class="label">Date Added</td><td class="value"><%- new Date(item.get(\'AddedOn\')).toLocaleString() %></td></tr>\n                <tr><td class="label">Keywords</td><td class="value"><%- item.get(\'Keywords\') %></td></tr>\n                <tr><td class="label">Library</td><td class="value"><%- item.get(\'LibraryName\') %></td></tr>\n            </tbody>\n        </table>\n    </td>\n</tr>\n'}),i("ev-script/views/video-results",["require","jquery","underscore","ev-script/views/results","ev-script/models/video-settings","ev-script/views/video-preview","text!ev-script/templates/video-result.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/results"),i=e("ev-script/models/video-settings"),s=e("ev-script/views/video-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:n.template(e("text!ev-script/templates/video-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)},decorate:function(e){t(".desc .value",e).each(function(e){var n=t(this),r,i,s=100,o=t(this).html();if(o.length>s){n.empty(),r=t("<span>"+o+"</span>"),i=t("<span>"+o.substring(0,s)+"...</span>");var u=t('<a href="#">Less</a>').click(function(e){r.hide(),i.show(),e.preventDefault()}),a=t('<a href="#">More</a>').click(function(e){i.hide(),r.show(),e.preventDefault()});r.hide().append(u),i.append(a),n.append(i).append(r)}})}})}),i("ev-script/collections/videos",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.libraryId=n.libraryId||"",this.filterOn=n.filterOn||"",this.filterValue=n.filterValue||"",this.sourceUrl=n.sourceId==="shared"?"/api/SharedContent":"/api/Content",this.pageIndex=1},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("videos");o||s.set("videos",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},clearCache:function(){var e=this.auth.getUser(),t=e?n.getUserCache(this.config.ensembleUrl,e.id):null;t&&t.set("videos",null)},url:function(){var e=this.config.ensembleUrl+this.sourceUrl,t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r="FilterOn="+encodeURIComponent(this.filterOn),i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"/"+this.libraryId+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),i("ev-script/collections/media-workflows",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.libraryId||""},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("workflows");o||s.set("workflows",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/MediaWorkflows",t="PageSize=9999",n="PageIndex=1",r="FilterOn=LibraryId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s},parse:function(e){return this.settings=e.Settings,e.Data}})}),i("ev-script/views/workflow-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.$el.html('<option value="-1">Loading...</option>'),this.render()},render:function(){var e=this.collection.findWhere({IsDefault:!0})||this.collection.at(0);this.$el.html(this.template({selectedId:e.id,collection:this.collection}))},getSelected:function(){return this.collection.get(this.$("option:selected").val())}})}),i("text!ev-script/templates/upload.html",[],function(){return'<form class="upload-form" method="POST" action="">\n    <select class="form-select" name="MediaWorkflowID"></select>\n    <div class="fieldWrap">\n        <label for="Title">Title *</label>\n        <input class="form-text" type="text" name="Title" id="Title" />\n    </div>\n    <div class="fieldWrap">\n        <label for="Description">Description</label>\n        <textarea class="form-text" name="Description" id="Description" />\n    </div>\n    <div class="upload"></div>\n</form>\n'}),i("ev-script/views/upload",["require","jquery","underscore","plupload","ev-script/views/base","backbone","ev-script/views/workflow-select","ev-script/models/video-settings","jquery.plupload.queue","text!ev-script/templates/upload.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("plupload"),i=e("ev-script/views/base"),s=e("backbone"),o=e("ev-script/views/workflow-select"),u=e("ev-script/models/video-settings");return e("jquery.plupload.queue"),i.extend({template:n.template(e("text!ev-script/templates/upload.html")),events:{"change select":"handleSelect"},initialize:function(e){i.prototype.initialize.call(this,e),n.bindAll(this,"render","decorateUploader","closeDialog","handleSelect"),this.field=e.field,this.$anchor=this.$el,this.setElement(this.template()),this.$upload=this.$(".upload"),this.workflows=e.workflows,this.workflowSelect=new o({appId:this.appId,el:this.$("select")[0],collection:this.workflows}),this.render(),this.decorateUploader(),this.appEvents.on("hidePickers",this.closeDialog)},getWidth:function(){return Math.min(600,t(window).width()-this.config.dialogMargin)},getHeight:function(){return Math.min(400,t(window).height()-this.config.dialogMargin)},decorateUploader:function(){var e="",i=this.workflowSelect.getSelected(),s=parseInt(i.get("MaxUploadSize"),10);this.workflows.settings.SupportedVideo&&(e+=this.workflows.settings.SupportedVideo.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.workflows.settings.SupportedAudio&&(e+=this.workflows.settings.SupportedAudio.replace(/\*\./g,"").replace(/;/g,",").replace(/\s/g,"")),this.$upload.pluploadQueue()&&this.$upload.pluploadQueue().destroy(),this.$upload.pluploadQueue({url:this.workflows.settings.SubmitUrl,runtimes:"html5,html4,flash",max_file_size:s>0?s+"gb":"12gb",max_file_count:1,max_retries:5,chunk_size:"2mb",unique_names:!1,multiple_queues:!1,multi_selection:!1,drag_drop:!0,multipart:!0,flash_swf_url:this.config.pluploadFlashPath,preinit:{Init:n.bind(function(e,n){t(".plupload_container",this.$upload).removeAttr("title"),t(".plupload_add",this.$upload).text("Add file")},this),PostInit:n.bind(function(e,n){t(".plupload_droptext",this.$upload).text("Drag file here.")},this),UploadFile:n.bind(function(e,t){e.settings.multipart_params={Title:this.$("#Title").val(),Description:this.$("#Description").val(),MediaWorkflowID:this.$("select").val()}},this)},init:{StateChanged:n.bind(function(e){switch(e.state){case r.STARTED:e.state===r.STARTED&&(t(".plupload_cancel",this.$upload).length===0&&(this.$cancel=t('<a class="plupload_button plupload_cancel" href="#">Cancel upload</a>').insertBefore(t(".plupload_filelist_footer .plupload_clearer",this.$upload)).click(n.bind(function(){e.stop(),this.decorateUploader()},this))),this.$cancel&&this.$cancel.show());break;case r.STOPPED:this.$cancel&&this.$cancel.hide()}},this),BeforeUpload:n.bind(function(e,n){var r=this.$("#Title"),i=r.val();if(!i||i.trim()==="")r.focus(),e.stop(),t(".plupload_upload_status",this.$upload).hide(),t(".plupload_buttons",this.$upload).show()},this),FilesAdded:n.bind(function(t,i){var s=e.split(",");n.each(i,function(e){var i=e.name.split("."),o=i[i.length-1];n.contains(s,o.toLowerCase())||(t.removeFile(e),t.trigger("Error",{code:r.FILE_EXTENSION_ERROR,message:r.translate("File extension error."),file:e}))}),t.files.length>1&&t.splice(0,t.files.length-1)},this),UploadComplete:n.bind(function(){this.closeDialog()},this),FileUploaded:n.bind(function(e,t,n){this.appEvents.trigger("fileUploaded")},this)}}),this.$upload.pluploadQueue().bind("refresh",function(){t("div.upload > div.plupload").css({"z-index":"0"}),t(".plupload_button").css({"z-index":"1"})}),this.$upload.pluploadQueue().refresh()},closeDialog:function(){this.$dialog&&this.$dialog.dialog("close")},handleSelect:function(e){this.decorateUploader()},render:function(){var e=t('<div class="dialogWrap"></div>'),r;this.$anchor.after(e),this.$dialog=e.dialog({title:"Upload Media to Ensemble",modal:!0,width:this.getWidth(),height:this.getHeight(),draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(t,n){e.html(this.$el)},this),close:n.bind(function(t,n){this.$upload.pluploadQueue().destroy(),e.dialog("destroy").remove(),this.appEvents.off("hidePickers",this.closeDialog),this.$dialog=null},this)})}})}),i("ev-script/views/video-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/search","ev-script/views/library-type-select","ev-script/views/unit-selects","ev-script/views/video-results","ev-script/collections/videos","ev-script/collections/media-workflows","ev-script/views/upload"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/search"),s=e("ev-script/views/library-type-select"),o=e("ev-script/views/unit-selects"),u=e("ev-script/views/video-results"),a=e("ev-script/collections/videos"),f=e("ev-script/collections/media-workflows"),l=e("ev-script/views/upload");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadVideos","loadWorkflows","changeLibrary","handleSubmit","uploadHandler");var a=n.bind(function(){this.loadVideos()},this);this.info.get("ApplicationVersion")&&(this.$upload=t('<div class="ev-field-actions"><div class="action-upload"><div class="upload-icon"></div><a href="#" class="upload-link" title="Upload"><span>Upload<span></a></div></div>').css("display","none"),this.$("div.ev-filter-block").prepend(this.$upload)),this.searchView=new i({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:a}),this.$("div.ev-filter-block").prepend(this.searchView.$el),this.searchView.render(),this.typeSelectView=new s({id:this.id+"-type-select",tagName:"div",className:"ev-type-select",picker:this,appId:this.appId,callback:a}),this.$("div.ev-filter-block").prepend(this.typeSelectView.$el),this.typeSelectView.render(),this.info.get("ApplicationVersion")&&(this.unitSelects=new o({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$("div.ev-filter-block").prepend(this.unitSelects.$el)),this.resultsView=new u({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click .action-add":"chooseItem","click .action-upload":"uploadHandler","change form.unit-selects select.libraries":"changeLibrary","submit form.unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadVideos(),this.loadWorkflows()},handleSubmit:function(e){this.loadVideos(),e.preventDefault()},uploadHandler:function(e){var t=new l({appId:this.appId,field:this.field,workflows:this.workflows});e.preventDefault()},showPicker:function(){r.prototype.showPicker.call(this),this.info.get("ApplicationVersion")?(this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()):(this.searchView.$('input[type="text"]').focus(),this.loadVideos())},loadVideos:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("sourceId"),i=this.model.get("libraryId"),s=r+i+e,o=new a({},{sourceId:r,libraryId:i,filterOn:"",filterValue:e,appId:this.appId}),u=n.bind(function(){o.clearCache(),this.loadVideos()},this);o.fetch({picker:this,cacheKey:s,success:n.bind(function(e,t,r){var i=e.totalResults=parseInt(t.Pager.TotalRecords,10),s=n.size(t.Data);s===i?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadVideos()},this))},this)}),this.appEvents.off("fileUploaded").on("fileUploaded",u)},loadWorkflows:function(){this.workflows=new f({},{appId:this.appId}),this.workflows.filterValue=this.model.get("libraryId"),this.workflows.fetch({cacheKey:this.workflows.filterValue,success:n.bind(function(e,t,n){e.isEmpty()?this.$upload.css("display","none"):this.$upload.css("display","inline-block")},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadWorkflows()},this))},this),reset:!0})}})}),i("ev-script/views/settings",["require","underscore","ev-script/views/base","jquery-ui"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return e("jquery-ui"),n.extend({initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"show","cancelHandler","submitHandler"),this.field=e.field},events:{submit:"submitHandler","click input.action-cancel":"cancelHandler"},show:function(){this.render(),this.$el.dialog("open")},cancelHandler:function(e){this.$el.dialog("close"),e.preventDefault()},submitHandler:function(e){this.updateModel(),this.$el.dialog("close"),e.preventDefault()},updateModel:function(){}})}),i("text!ev-script/templates/video-settings.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size" <% if (isAudio) { print(\'disabled\'); } %> >\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div class="fieldWrap">\n            <label for="showtitle">Show Title</label>\n            <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="autoplay">Auto Play</label>\n            <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="showcaptions">Show Captions</label>\n            <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="fieldWrap">\n            <label for="hidecontrols">Hide Controls</label>\n            <input id="hidecontrols" class="form-checkbox" <% if (model.get(\'hidecontrols\')) { print(\'checked="checked"\'); } %>  name="hidecontrols" type="checkbox" <% if (isAudio) { print(\'disabled\'); } %> />\n        </div>\n        <div class="form-actions">\n            <input type="button" class="form-submit action-cancel" value="Cancel"/>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),i("text!ev-script/templates/sizes.html",[],function(){return'<% _.each(sizes, function(size) { %>\n    <option value="<%= size %>" <% if (size === target) { print(\'selected="selected"\'); } %>><%= size %></option>\n<% }); %>\n'}),i("ev-script/views/video-settings",["require","jquery","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/video-settings.html","text!ev-script/templates/sizes.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/settings");return e("jquery-ui"),r.extend({template:n.template(e("text!ev-script/templates/video-settings.html")),sizesTemplate:n.template(e("text!ev-script/templates/sizes.html")),initialize:function(e){r.prototype.initialize.call(this,e),this.encoding=e.encoding,this.encoding.on("change:id",n.bind(function(){this.render()},this))},updateModel:function(){var e={showtitle:this.$("#showtitle").is(":checked"),autoplay:this.$("#autoplay").is(":checked"),showcaptions:this.$("#showcaptions").is(":checked"),hidecontrols:this.$("#hidecontrols").is(":checked")},t=this.$("#size").val();if(!t||t==="original")this.encoding&&!this.encoding.isNew()&&n.extend(e,{width:this.encoding.getWidth(),height:this.encoding.getHeight()});else{var r=t.split("x");n.extend(e,{width:parseInt(r[0],10),height:parseInt(r[1],10)})}this.field.model.set(e)},renderSize:function(){var e=this.field.model.get("width"),t=this.field.model.get("height"),n=16/9,r=["1280x720","1024x576","848x480","720x405","640x360","610x344","560x315","480x270","400x225","320x180","240x135","160x90"];e&&t?n=e/t:this.encoding.id&&(e=this.encoding.getWidth(),t=this.encoding.getHeight(),n=this.encoding.getRatio()),Math.ceil(n*10)/10===Math.ceil(4/3*10)/10&&(r=["1280x960","1024x770","848x636","720x540","640x480","610x460","560x420","480x360","400x300","320x240","240x180","160x120"]);var i=e+"x"+t;this.$(".size").append(this.sizesTemplate({sizes:r,target:i}))},render:function(){this.$el.html(this.template({model:this.field.model,isAudio:this.encoding&&this.encoding.isAudio()})),this.encoding&&!this.encoding.isAudio()&&this.renderSize();var e=this.field.model.get("content");this.$el.dialog({title:e?e.Title:this.field.model.get("id"),modal:!0,autoOpen:!1,draggable:!1,resizable:!1,dialogClass:"ev-dialog",width:Math.min(340,t(window).width()-this.config.dialogMargin),height:Math.min(320,t(window).height()-this.config.dialogMargin)})}})}),i("text!ev-script/templates/playlist-embed.html",[],function(){return'<iframe src="<%= ensembleUrl %>/app/plugin/embed.aspx?DestinationID=<%= modelId %>"\n        frameborder="0"\n        style="width:800px;height:850px;"\n        allowfullscreen>\n</iframe>\n'}),i("ev-script/views/playlist-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/playlist-embed.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/playlist-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e),this.$el.html(this.template({modelId:this.model.get("id"),ensembleUrl:this.config.ensembleUrl}))}})}),i("ev-script/views/playlist-preview",["require","ev-script/views/preview","ev-script/views/playlist-embed"],function(e){"use strict";var t=e("ev-script/views/preview"),n=e("ev-script/views/playlist-embed");return t.extend({initialize:function(e){t.prototype.initialize.call(this,e)},embedClass:n})}),i("text!ev-script/templates/playlist-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <span>Choose</span>\n            </a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <span>Preview: <%- item.get(\'Name\') %></span>\n            </a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <span><%- item.get(\'Name\') %></span>\n    </td>\n</tr>\n'}),i("ev-script/views/playlist-results",["require","underscore","jquery","ev-script/views/results","ev-script/models/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/playlist-result.html"],function(e){"use strict";var t=e("underscore"),n=e("jquery"),r=e("ev-script/views/results"),i=e("ev-script/models/playlist-settings"),s=e("ev-script/views/playlist-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:t.template(e("text!ev-script/templates/playlist-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)}})}),i("ev-script/collections/playlists",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.libraryId=n.libraryId||"",this.filterValue=n.filterValue||"",this.pageIndex=1},_cache:function(e,t){var r=null,i=this.auth.getUser(),s=i?n.getUserCache(this.config.ensembleUrl,i.id):null;if(s){var o=s.get("playlists");o||s.set("playlists",o=new n.Cache),r=o[t?"set":"get"](e,t)}return r},getCached:function(e){return this._cache(e)},setCached:function(e,t){return this._cache(e,t)},url:function(){var e=this.config.ensembleUrl+"/api/Playlists",t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r,i,s;return this.info.get("ApplicationVersion")?(i="FilterOn=Name",s="FilterValue="+encodeURIComponent(this.filterValue),r=e+"/"+encodeURIComponent(this.libraryId)+"?"+t+"&"+n+(this.filterValue?"&"+i+"&"+s:"")):(i="FilterOn=LibraryId",s="FilterValue="+encodeURIComponent(this.libraryId),r=e+"?"+t+"&"+n+"&"+i+"&"+s),this.config.urlCallback?this.config.urlCallback(r):r}})}),i("ev-script/views/playlist-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/unit-selects","ev-script/views/search","ev-script/views/playlist-results","ev-script/collections/playlists"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/unit-selects"),s=e("ev-script/views/search"),o=e("ev-script/views/playlist-results"),u=e("ev-script/collections/playlists");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadPlaylists","changeLibrary","handleSubmit"),this.info.get("ApplicationVersion")&&(this.searchView=new s({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId,callback:n.bind(function(){this.loadPlaylists()},this)}),this.$("div.ev-filter-block").prepend(this.searchView.$el),this.searchView.render()),this.unitSelects=new i({id:this.id+"-unit-selects",tagName:"div",className:"ev-unit-selects",picker:this,appId:this.appId}),this.$("div.ev-filter-block").prepend(this.unitSelects.$el),this.resultsView=new o({el:this.$("div.ev-results"),picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},events:{"click a.action-add":"chooseItem","change form.unit-selects select.libraries":"changeLibrary","submit form.unit-selects":"handleSubmit"},changeLibrary:function(e){this.loadPlaylists()},handleSubmit:function(e){this.loadPlaylists(),e.preventDefault()},showPicker:function(){r.prototype.showPicker.call(this),this.unitSelects.loadOrgs(),this.unitSelects.$("select").filter(":visible").first().focus()},loadPlaylists:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("libraryId"),i=new u({},{libraryId:r,filterValue:e,appId:this.appId});i.fetch({picker:this,cacheKey:r+e,success:n.bind(function(e,t,r){var i=e.totalResults=parseInt(t.Pager.TotalRecords,10),s=n.size(t.Data);s===i?e.hasMore=!1:(e.hasMore=!0,e.pageIndex+=1),this.resultsView.collection=e,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadPlaylists()},this))},this)})}})}),i("text!ev-script/templates/playlist-settings.html",[],function(){return"<h3>TODO</h3>\n<p>\n    <%- json %>\n</p>\n"}),i("ev-script/views/playlist-settings",["require","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/playlist-settings.html"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/views/settings");return e("jquery-ui"),n.extend({template:t.template(e("text!ev-script/templates/playlist-settings.html")),initialize:function(e){n.prototype.initialize.call(this,e)},render:function(){this.$el.html(this.template({json:JSON.stringify(this.field.model.toJSON())})),this.$el.dialog({title:"Playlist Embed Settings",modal:!0,autoOpen:!1,dialogClass:"ev-dialog"})}})}),i("text!ev-script/templates/field.html",[],function(){return'<div class="logo">\n    <a target="_blank" href="<%= ensembleUrl %>"><span>Ensemble Logo</span></a>\n</div>\n<% if (modelId) { %>\n    <% if (thumbnailUrl) { %>\n        <div class="thumbnail">\n            <img alt="Media thumbnail" src="<%= thumbnailUrl %>"/>\n        </div>\n    <% } %>\n    <div class="title"><%- name %></div>\n    <div class="ev-field-actions">\n        <a href="#" class="action-choose" title="Change <%= label %>"><span>Change <%= label %><span></a>\n        <a href="#" class="action-preview" title="Preview: <%- name %>"><span>Preview: <%- name %><span></a>\n        <!-- TODO - temporarily disabled playlist settings until it is implemented -->\n        <% if (type === \'video\') { %>\n            <a href="#" class="action-options" title="<%= label %> Embed Options"><span><%= label %> Embed Options<span></a>\n        <% } %>\n        <a href="#" class="action-remove" title="Remove <%= label %>"><span>Remove <%= label %><span></a>\n    </div>\n<% } else { %>\n    <div class="title"><em>Add <%= label %></em></div>\n    <div class="ev-field-actions">\n        <a href="#" class="action-choose" title="Choose <%= label %>"><span>Choose <%= label %><span></a>\n    </div>\n<% } %>\n'}),i("ev-script/views/field",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/video-picker","ev-script/views/video-settings","ev-script/views/video-preview","ev-script/models/video-encoding","ev-script/views/playlist-picker","ev-script/views/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/field.html"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/video-picker"),u=e("ev-script/views/video-settings"),a=e("ev-script/views/video-preview"),f=e("ev-script/models/video-encoding"),l=e("ev-script/views/playlist-picker"),c=e("ev-script/views/playlist-settings"),h=e("ev-script/views/playlist-preview");return r.extend({template:n.template(e("text!ev-script/templates/field.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseHandler","optionsHandler","removeHandler","previewHandler"),this.$field=e.$field,this.showChoose=!0;var t={id:this.id+"-picker",tagName:"div",className:"ev-"+this.model.get("type")+"-picker",field:this,appId:this.appId},p={id:this.id+"-settings",tagName:"div",className:"ev-settings",field:this,appId:this.appId};this.model instanceof i?(this.modelClass=i,this.pickerClass=o,this.settingsClass=u,this.previewClass=a,this.encoding=new f({},{appId:this.appId}),this.model.isNew()||(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch()),this.model.on("change:id",n.bind(function(){this.model.id?(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch({success:n.bind(function(e){this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()})},this)})):this.encoding.clear()},this)),n.extend(p,{encoding:this.encoding})):this.model instanceof s&&(this.modelClass=s,this.pickerClass=l,this.settingsClass=c,this.previewClass=h),this.picker=new this.pickerClass(n.extend({},t,{model:new this.modelClass(this.model.toJSON())})),this.settings=new this.settingsClass(p),this.$field.after(this.picker.$el),this.renderActions(),this.model.on("change",n.bind(function(){if(!this.model.isNew()){var e=this.model.toJSON();this.$field.val(JSON.stringify(e)),this.appEvents.trigger("fieldUpdated",this.$field,e),this.renderActions()}},this)),this.appEvents.on("showPicker",function(e){this.id===e&&(this.$(".action-choose").hide(),this.showChoose=!1,this.config.hidePickers&&this.appEvents.trigger("hidePickers",this.id))},this),this.appEvents.on("hidePicker",function(e){this.id===e&&(this.$(".action-choose").show(),this.showChoose=!0)},this),this.appEvents.on("hidePickers",function(e){if(!e||this.id!==e)this.$(".action-choose").show(),this.showChoose=!0},this)},events:{"click .action-choose":"chooseHandler","click .action-preview":"previewHandler","click .action-options":"optionsHandler","click .action-remove":"removeHandler"},chooseHandler:function(e){this.appEvents.trigger("showPicker",this.id),e.preventDefault()},optionsHandler:function(e){this.settings.show(),e.preventDefault()},removeHandler:function(e){this.model.clear(),this.$field.val(""),this.model.set(this.model.defaults,{silent:!0}),this.appEvents.trigger("fieldUpdated",this.$field),this.renderActions(),e.preventDefault()},previewHandler:function(e){var t=e.currentTarget,n=new this.previewClass({el:t,encoding:this.encoding,model:this.model,appId:this.appId});e.preventDefault()},renderActions:function(){var e=this.config.ensembleUrl,n,r,s,o;this.model instanceof i?(r="Media",s="video"):(r="Playlist",s="playlist");if(this.model.id){n=this.model.id;var u=this.model.get("content");if(u){n=u.Name||u.Title;var a=new RegExp("^"+e.toLocaleLowerCase()+"/app/assets/");u.ThumbnailUrl&&a.test(u.ThumbnailUrl.toLocaleLowerCase())&&(o=u.ThumbnailUrl)}}this.$actions||(this.$actions=t('<div class="ev-field"/>'),this.$field.after(this.$actions)),this.$actions.html(this.template({ensembleUrl:e,modelId:this.model.id,label:r,type:s,name:n,thumbnailUrl:o})),this.showChoose||this.$(".action-choose").hide()}})}),i("ev-script/models/app-info",["require","underscore","ev-script/models/base"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/models/base");return n.extend({initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/Info";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e}})}),i("ev-script/models/current-user",["require","underscore","ev-script/models/base"],function(e){"use strict";var t=e("underscore"),n=e("ev-script/models/base");return n.extend({idAttribute:"ID",initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.requiresAuth=!1},url:function(){var e=this.config.ensembleUrl+"/api/CurrentUser";return this.config.urlCallback?this.config.urlCallback(e):e},parse:function(e){return e.Data[0]}})}),i("ev-script/auth/base/auth",["require","jquery","underscore","backbone","ev-script/util/events","ev-script/util/cache","ev-script/models/current-user"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/util/events"),s=e("ev-script/util/cache"),o=e("ev-script/models/current-user"),u=function(e){n.bindAll(this,"getUser","login","logout","isAuthenticated","handleUnauthorized"),this.appId=e,this.config=s.getAppConfig(e),this.info=s.getAppInfo(e),this.globalEvents=i.getEvents("global"),this.appEvents=i.getEvents(e),this.user=null,this.appEvents.on("appLoaded",function(){this.fetchUser()},this)};return u.extend=r.Model.extend,n.extend(u.prototype,{fetchUser:function(){var e=new o({},{appId:this.appId});return e.fetch({success:n.bind(function(e,t,n){this.user=e,this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},getUser:function(){return this.user},login:function(e){return t.Deferred().reject().promise()},logout:function(){return t.Deferred().reject().promise()},isAuthenticated:function(){return this.user!=null},handleUnauthorized:function(e,t){}}),u}),function(e){typeof i=="function"&&i.amd?i("jquery.cookie",["jquery"],e):typeof exports=="object"?e(r("jquery")):e(jQuery)}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(t," ")),u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g,u=e.cookie=function(t,s,a){if(s!==undefined&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setTime(+l+f*864e5)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{},h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("="),m=r(v.shift()),g=v.join("=");if(t&&t===m){c=o(g,s);break}!t&&(g=o(g))!==undefined&&(c[m]=g)}return c};u.defaults={},e.removeCookie=function(t,n){return e.cookie(t)===undefined?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),i("text!ev-script/auth/basic/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text"type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text"type="password"/>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),i("ev-script/auth/basic/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/basic/template.html"],function(e,t){"use strict";var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/basic/template.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=this.template();this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),r=n("#username",t).val(),i=n("#password",t).val();r&&i&&(this.auth.login({username:r,password:i}).always(this.submitCallback),this.$dialog.dialog("destroy").remove()),e.preventDefault()},this))}})}),i("ev-script/auth/basic/auth",["require","jquery","underscore","backbone","ev-script/auth/base/auth","ev-script/auth/basic/view","ev-script/collections/organizations"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("ev-script/auth/base/auth"),s=e("ev-script/auth/basic/view"),o=e("ev-script/collections/organizations"),u=i.extend({constructor:function(e){u.__super__.constructor.call(this,e)},fetchUser:function(){if(this.info.get("ApplicationVersion"))return u.__super__.fetchUser.call(this);var e=new o({},{appId:this.appId});return e.requiresAuth=!1,e.fetch({success:n.bind(function(e,t,n){this.user=new r.Model({id:Math.floor(Math.random()*1e16).toString(16)}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this),error:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},login:function(e){var r={path:this.config.authPath};return t.cookie(this.config.ensembleUrl+"-user",e.username,n.extend({},r)),t.cookie(this.config.ensembleUrl+"-pass",e.password,n.extend({},r)),this.fetchUser()},logout:function(){var e=t.Deferred(),r={path:this.config.authPath};return t.removeCookie(this.config.ensembleUrl+"-user",n.extend({},r)),t.removeCookie(this.config.ensembleUrl+"-pass",n.extend({},r)),this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),e.resolve(),e.promise()},handleUnauthorized:function(e,t){this.logout();var n=new s({el:e,submitCallback:t,appId:this.appId,auth:this});n.render()}});return u}),i("text!ev-script/auth/forms/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text" type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text" type="password"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="provider">Identity Provider</label>\n            <select id="provider" name="provider" class="form-select"></select>\n        </div>\n        <div class="fieldWrap">\n            <label for="remember">Remember Me</label>\n            <input id="remember" name="remember" type="checkbox"></input>\n        </div>\n        <div class="form-actions">\n            <label></label>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n            <div class="loader"></div>\n        </div>\n    </fieldset>\n</form>\n'}),i("ev-script/auth/forms/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery.cookie","jquery-ui","text!ev-script/auth/forms/template.html","text!ev-script/templates/options.html"],function(e,t){"use strict";var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/forms/template.html")),optionsTemplate:r.template(e("text!ev-script/templates/options.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){},this.auth=e.auth},render:function(){var e=n(this.template()),t=n("#provider",e).append(this.optionsTemplate({collection:this.collection,selectedId:this.config.defaultProvider}));this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog);var i=n("div.loader",e),s=r.bind(function(e,t,n){i.addClass("loading")},this),o=r.bind(function(e,t,n){i.removeClass("loading")},this);n(window.document).on("ajaxSend",s).on("ajaxComplete",o),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){n(window.document).off("ajaxSend",s).off("ajaxComplete",o),this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),i=n("#username",t).val(),s=n("#password",t).val();i&&s&&this.auth.login({username:i,password:s,authSourceId:n("#provider :selected",t).val(),persist:n("#remember",t).is(":checked")}).then(r.bind(function(){this.$dialog.dialog("destroy").remove(),this.submitCallback()},this)),e.preventDefault()},this))}})}),i("ev-script/collections/identity-providers",["require","ev-script/collections/base","ev-script/util/cache"],function(e){"use strict";var t=e("ev-script/collections/base"),n=e("ev-script/util/cache"),r=new n.Cache;return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.requiresAuth=!1},getCached:function(e){return r.get(this.config.ensembleUrl)},setCached:function(e,t){return r.set(this.config.ensembleUrl,t)},url:function(){var e=this.config.ensembleUrl+"/api/IdentityProviders";return this.config.urlCallback?this.config.urlCallback(e):e}})}),i("ev-script/auth/forms/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/models/current-user","ev-script/auth/forms/view","ev-script/collections/identity-providers"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/auth/base/auth"),i=e("ev-script/models/current-user"),s=e("ev-script/auth/forms/view"),o=e("ev-script/collections/identity-providers"),u=r.extend({constructor:function(e){r.prototype.constructor.call(this,e),this.identityProviders=new o({},{appId:e}),this.asPromise=this.identityProviders.fetch()},login:function(e){var r=this.config.ensembleUrl+"/api/Login";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(r):r,type:"POST",dataType:"json",data:{user:e.username,password:e.password,identityProviderId:e.authSourceId,persist:e.persist},xhrFields:{withCredentials:!0},success:n.bind(function(e,t,n){this.user=new i(e.Data[0],{appId:this.appId}),this.globalEvents.trigger("loggedIn",this.config.ensembleUrl)},this)}).promise()},logout:function(){var e=this.config.ensembleUrl+"/api/Logout";return t.ajax({url:this.config.urlCallback?this.config.urlCallback(e):e,type:"POST",xhrFields:{withCredentials:!0},success:n.bind(function(e,t,n){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl)},this)}).promise()},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl),this.asPromise.done(n.bind(function(){var n=new s({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()},this))}});return u}),i("text!ev-script/auth/none/template.html",[],function(){return'<div class="logo"></div>\n<form>\n    <h3>You are unauthorized to access this content.</h3>\n</form>\n'}),i("ev-script/auth/none/view",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","jquery-ui","text!ev-script/auth/none/template.html"],function(e,t){"use strict";var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events");return e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/auth/none/template.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId)},render:function(){var e=n(this.template());this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)})}})}),i("ev-script/auth/none/auth",["require","jquery","underscore","ev-script/auth/base/auth","ev-script/auth/none/view"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("ev-script/auth/base/auth"),i=e("ev-script/auth/none/view"),s=r.extend({constructor:function(e){r.prototype.constructor.call(this,e)},handleUnauthorized:function(e,t){this.user=null,this.globalEvents.trigger("loggedOut",this.config.ensembleUrl);var n=new i({el:e,submitCallback:t,appId:this.appId,auth:this,collection:this.identityProviders});n.render()}});return s}),i("ev-script",["require","backbone","underscore","jquery","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/field","ev-script/views/video-embed","ev-script/views/playlist-embed","ev-script/models/app-info","ev-script/auth/basic/auth","ev-script/auth/forms/auth","ev-script/auth/none/auth","ev-script/util/events","ev-script/util/cache"],function(e){"use strict";var t=e("backbone"),n=e("underscore"),r=e("jquery"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/field"),u=e("ev-script/views/video-embed"),a=e("ev-script/views/playlist-embed"),f=e("ev-script/models/app-info"),l=e("ev-script/auth/basic/auth"),c=e("ev-script/auth/forms/auth"),h=e("ev-script/auth/none/auth"),p=e("ev-script/util/events"),d=e("ev-script/util/cache"),v=function(e){var t=Math.floor(Math.random()*1e16).toString(16),s=d.caches.get(e.ensembleUrl);s||(s=d.caches.set(e.ensembleUrl,new d.Cache));var v={ensembleUrl:"",authPath:"",urlCallback:function(e){return e},pageSize:100,scrollHeight:600,hidePickers:!0,dialogMargin:40,authType:"basic",defaultProvider:"",pluploadFlashPath:""},m=d.setAppConfig(t,n.extend({},v,e));p.initEvents(t),this.appEvents=p.getEvents(t),this.globalEvents=p.getEvents();var g=r.Deferred();n.extend(this,g.promise());var y=new f({},{appId:t});d.setAppInfo(t,y),y.fetch({}).always(n.bind(function(){if(!y.get("ApplicationVersion")&&m.authType==="forms")g.reject("Configured to use forms authentication against a pre-3.6 API.");else{var e;switch(m.authType){case"forms":e=new c(t);break;case"none":e=new h(t);break;default:e=new l(t)}d.setAppAuth(t,e),this.handleField=function(e,n,i){var s=r(i,e),u=new o({id:e.id||t,el:e,model:n,$field:s,appId:t})},this.handleEmbed=function(e,n){if(n instanceof i)var r=new u({el:e,model:n,appId:t});else var s=new a({el:e,model:n,appId:t})},this.appEvents.trigger("appLoaded"),g.resolve()}},this))};return{VideoSettings:i,PlaylistSettings:s,EnsembleApp:v}}),i("jquery",function(){return e||jQuery}),i("jquery-ui",["jquery"],function(){}),i("plupload",function(){return t}),i("jquery.plupload.queue",["jquery","plupload"],function(){}),r("ev-script")});