/**
 * ev-script 0.2.1 2013-06-11
 * Ensemble Video Integration Library
 * https://github.com/jmpease/ev-script
 * Copyright (c) 2013 Symphony Video, Inc.
 * Licensed MIT, GPL-2.0
 */

/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * ev-scroll-loader 0.1.0 2013-01-31
 * Ensemble Video jQuery Scroll Loader Plugin
 * https://github.com/jmpease/ev-scroll-loader
 * Copyright (c) 2013 Symphony Video, Inc.
 * Licensed MIT, GPL-2.0
 */

(function(e,t){typeof define=="function"&&define.amd?define(["jquery","underscore","backbone","jquery-ui","jquery.cookie"],t):e.EV=t(e.$,e._,e.Backbone)})(this,function(e,t,n){var r,i,s;return function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,r){return function(){return n.apply(e,p.call(arguments,0).concat([t,r]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(n){if(d(f,n)){var r=f[n];delete f[n],c[n]=!0,t.apply(e,r)}if(!d(a,n)&&!d(c,n))throw new Error("No "+n);return a[n]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var t,n,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},t=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},r=i=n=function(r,i,s,a,f){return typeof r=="string"?u[r]?u[r](i):b(o(r,i).f):(r.splice||(l=r,i.splice?(r=i,i=s,s=null):r=e),i=i||function(){},typeof s=="function"&&(s=a,a=f),a?t(e,r,i,s):setTimeout(function(){t(e,r,i,s)},4),n)},n.config=function(e){return l=e,l.deps&&n(l.deps,l.callback),n},s=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},s.amd={jQuery:!0}}(),s("almond",function(){}),s("ev-script/models/video-settings",["backbone"],function(e){return e.Model.extend({defaults:{type:"video",showtitle:!1,autoplay:!1,showcaptions:!1,hidecontrols:!1,search:"",sourceId:"content"}})}),s("ev-script/models/playlist-settings",["backbone"],function(e){return e.Model.extend({defaults:{type:"playlist"}})}),s("ev-script/util/events",["require","underscore","backbone"],function(e){var t=[],n=e("underscore"),r=e("backbone");return t.global=n.extend({},r.Events),{initEvents:function(e){return t[e]=n.extend({},r.Events)},getEvents:function(e){var n;return e?n=t[e]:n=t.global,n}}}),s("ev-script/util/auth",["require","jquery","underscore","ev-script/util/events"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/util/events").getEvents("global");return{getUser:function(e){return t.cookie(e+"-user")},login:function(e,i,s,o,u){o+=i?"@"+i:"";var a={path:s};t.cookie(e+"-user",o,n.extend({},a)),t.cookie(e+"-pass",u,n.extend({},a)),r.trigger("loggedIn",e)},logout:function(e,i){var s={path:i};t.cookie(e+"-user",null,n.extend({},s)),t.cookie(e+"-pass",null,n.extend({},s)),r.trigger("loggedOut",e)},isAuthenticated:function(e){return t.cookie(e+"-user")&&t.cookie(e+"-pass")}}}),s("ev-script/util/cache",["require","jquery","underscore","backbone"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=function(){return this.cache=[],this.get=function(e){return this.cache[e]},this.set=function(e,t){return this.cache[e]=t},this},s=new i,o=function(e,t){return s.set(e,new i).set("config",t)},u=function(e){return s.get(e).get("config")},a=function(){var e=new i;return e.set("videos",new i),e.set("playlists",new i),e.set("orgs",null),e.set("libs",new i),e},f=function(e,t){var n=s.get(e);n||(n=s.set(e,new i));var r=n.get(t);return r||(r=n.set(t,a())),r};return{Cache:i,caches:s,setAppConfig:o,getAppConfig:u,getUserCache:f}}),s("text",["module"],function(e){var t,n,r,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p=[],d=e.config&&e.config()||{};t={version:"2.0.6",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=i.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("ï»¿")===0&&(r=r.substring(1)),t(r)};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,i,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(u,1,0,!1),i=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),i.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),o),i.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),s("text!ev-script/templates/auth.html",[],function(){return'<div class="logo"></div>\n<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="username">Username</label>\n            <input id="username" name="username" class="form-text"type="text"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="password">Password</label>\n            <input id="password" name="password" class="form-text"type="password"/>\n        </div>\n        <div class="form-actions">\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),s("ev-script/views/auth",["require","exports","module","jquery","underscore","backbone","ev-script/util/cache","ev-script/util/events","ev-script/util/auth","jquery.cookie","jquery-ui","text!ev-script/templates/auth.html"],function(e,t){var n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("ev-script/util/cache"),o=e("ev-script/util/events"),u=e("ev-script/util/auth");return e("jquery.cookie"),e("jquery-ui"),i.View.extend({template:r.template(e("text!ev-script/templates/auth.html")),initialize:function(e){this.appId=e.appId,this.config=s.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.submitCallback=e.submitCallback||function(){}},render:function(){var e=this.template();this.$dialog=n('<div class="ev-auth"></div>'),this.$el.after(this.$dialog),this.$dialog.dialog({title:"Ensemble Video Login - "+this.config.ensembleUrl,modal:!0,draggable:!1,resizable:!1,width:Math.min(540,n(window).width()-this.config.dialogMargin),height:Math.min(250,n(window).height()-this.config.dialogMargin),dialogClass:"ev-dialog",create:r.bind(function(t,n){this.$dialog.html(e)},this),close:r.bind(function(e,t){this.$dialog.dialog("destroy").remove(),this.appEvents.trigger("hidePickers")},this)}),n("form",this.$dialog).submit(r.bind(function(e){var t=n(e.target),r=n("#username",t).val(),i=n("#password",t).val();r&&i&&(u.login(this.config.ensembleUrl,this.config.authDomain,this.config.authPath,r,i),this.$dialog.dialog("destroy").remove(),this.submitCallback()),e.preventDefault()},this))}})}),s("ev-script/views/base",["require","jquery","underscore","backbone","ev-script/util/auth","ev-script/util/events","ev-script/util/cache","ev-script/views/auth"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=this,s=e("ev-script/util/auth"),o=e("ev-script/util/events"),u=e("ev-script/util/cache"),a=e("ev-script/views/auth"),f=function(e,t,n,r){return u.getUserCache(e,t).get(n).get(r)},l=function(e,t,n,r,i){return u.getUserCache(e,t).get(n).set(r,i)};return r.View.extend({initialize:function(e){this.appId=e.appId,this.config=u.getAppConfig(this.appId),this.appEvents=o.getEvents(this.appId),this.globalEvents=o.getEvents("global")},ajaxError:function(e,t){if(e.status===401){this.logout();var n=new a({el:this.el,submitCallback:t,appId:this.appId});n.render()}else e.status===500?i.alert("It appears there is an issue with the Ensemble Video installation."):e.status===404?i.alert("Could not find requested resource.  This is likely a problem with the configured Ensemble Video base url."):e.status!==0&&i.alert("An unexpected error occurred.  Check the server log for more details.")},getUser:function(){return s.getUser(this.config.ensembleUrl)},login:function(e,t){s.login(this.config.ensembleUrl,this.config.authDomain,this.config.authPath,e,t)},logout:function(){s.logout(this.config.ensembleUrl,this.config.authPath)},isAuthenticated:function(){return s.isAuthenticated(this.config.ensembleUrl)},getCachedVideos:function(e,t){return f(this.config.ensembleUrl,e,"videos",t)},setCachedVideos:function(e,t,n){return l(this.config.ensembleUrl,e,"videos",t,n)},getCachedPlaylists:function(e,t){return f(this.config.ensembleUrl,e,"playlists",t)},setCachedPlaylists:function(e,t,n){return l(this.config.ensembleUrl,e,"playlists",t,n)},getCachedLibs:function(e,t){return f(this.config.ensembleUrl,e,"libs",t)},setCachedLibs:function(e,t,n){return l(this.config.ensembleUrl,e,"libs",t,n)},getCachedOrgs:function(e){return u.getUserCache(this.config.ensembleUrl,e).get("orgs")},setCachedOrgs:function(e,t){return u.getUserCache(this.config.ensembleUrl,e).set("orgs",t)}})}),s("text!ev-script/templates/hider.html",[],function(){return'<a class="action-hide" href="#" title="Hide Picker">Hide</a>\n<% if (isAuthenticated) { %>\n    <a class="action-logout" href="#" title="Logout">Logout</a>\n<% } %>\n'}),s("ev-script/views/hider",["require","underscore","ev-script/views/base","text!ev-script/templates/hider.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/hider.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"hideHandler","logoutHandler","authHandler","render"),this.globalEvents.on("loggedIn",this.authHandler),this.globalEvents.on("loggedOut",this.authHandler),this.field=e.field},events:{"click a.action-hide":"hideHandler","click a.action-logout":"logoutHandler"},authHandler:function(e){e===this.config.ensembleUrl&&this.render()},render:function(){this.$el.html(this.template({isAuthenticated:this.isAuthenticated()}))},hideHandler:function(e){this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},logoutHandler:function(e){this.logout(),this.appEvents.trigger("hidePickers"),e.preventDefault()}})}),s("ev-script/views/picker",["require","jquery","underscore","ev-script/views/base","ev-script/views/hider"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/hider");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseItem","hidePicker","showPicker"),this.$el.hide(),this.field=e.field,this.hider=new i({id:this.id+"-hider",tagName:"div",className:"ev-hider",field:this.field,appId:this.appId}),this.$el.append(this.hider.$el),this.appEvents.on("hidePickers",function(e){(!e||this.field.id!==e)&&this.hidePicker()},this),this.appEvents.on("showPicker",function(e){this.field.id===e&&this.$el.is(":hidden")&&this.showPicker()},this),this.appEvents.on("hidePicker",function(e){this.field.id===e&&this.hidePicker()},this),this.hider.render()},events:{"click a.action-add":"chooseItem"},chooseItem:function(e){var n=t(e.target).attr("rel"),r=this.resultsView.collection.get(n);this.model.set({id:n,content:r.toJSON()}),this.field.model.set(this.model.attributes),this.appEvents.trigger("hidePicker",this.field.id),e.preventDefault()},hidePicker:function(){this.$el.fadeOut("fast")},showPicker:function(){this.hider.render(),this.$el.fadeIn("fast")}})}),s("text!ev-script/templates/video-search.html",[],function(){return'<form>\n    <label for="<%= id %>">Search Ensemble:</label>\n    <input id="<%= id %>" type="text" class="form-text search" value="<%- searchVal %>" />\n    <select class="form-select source">\n      <option value="content" <% if (sourceId === \'content\') { print(\'selected="selected"\'); } %>>Media Library</option>\n      <option value="shared" <% if (sourceId === \'shared\') { print(\'selected="selected"\'); } %>>Shared Library</option>\n    </select>\n    <input type="submit" value="Go" class="form-submit" />\n    <div class="loader"></div>\n    <div class="ev-poweredby"><a tabindex="-1" target="_blank" href="http://ensemblevideo.com"><span>Powered by Ensemble</span></a></div>\n</form>\n'}),s("ev-script/views/search",["require","underscore","ev-script/views/base","text!ev-script/templates/video-search.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/video-search.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"searchHandler","doSearch","autoSearch"),this.picker=e.picker},events:{"submit form":"searchHandler","change .source":"searchHandler","keyup .search":"autoSearch"},render:function(){this.$el.html(this.template({id:this.id+"-input",searchVal:this.picker.model.get("search"),sourceId:this.picker.model.get("sourceId")}));var e=this.$("div.loader");e.on("ajaxSend",t.bind(function(t,n,r){this.picker===r.picker&&e.addClass("loading")},this)).on("ajaxComplete",t.bind(function(t,n,r){this.picker===r.picker&&e.removeClass("loading")},this))},doSearch:function(){this.picker.model.set({search:this.$(".search").val(),sourceId:this.$(".source").val()}),this.picker.loadVideos()},searchHandler:function(e){this.doSearch(),e.preventDefault()},autoSearch:function(e){var n=e.target.value;n!==this.lastValue&&(this.lastValue=n,this.submitTimeout&&clearTimeout(this.submitTimeout),this.submitTimeout=setTimeout(t.bind(function(){this.doSearch()},this),1e3))}})}),function(e){var t={callback:function(){}},n={init:function(n){var r=e.extend({},t,n);return this.each(function(){var t=e(this);t.addClass("scroll-content");var n=t.wrap('<div class="scrollWrap"/>').closest(".scrollWrap");n.append('<div class="loader"></div>');var i=this.scrollHeight,s=r.height||i,o=Math.min(s,i)-10;n.css({position:"relative",height:o+"px","overflow-y":"scroll"}).scroll(function(){n.scrollTop()===n[0].scrollHeight-o&&r.callback.apply(t[0])})})},showLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).show(),this},hideLoader:function(){var t=e(this).closest(".scrollWrap");return e(".loader",t).hide(),this}};e.fn.evScrollLoader=function(e){if(n[e])return n[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return n.init.apply(this,arguments)}}(jQuery),s("ev-scroll-loader",function(){}),s("text!ev-script/templates/results.html",[],function(){return'<div class="total">Search returned <%= totalResults %> results.</div>\n<div class="results">\n    <table class="content-list"></table>\n</div>\n'}),s("text!ev-script/templates/no-results.html",[],function(){return'<tr class="odd"><td colspan="2">No results available.</td></tr>\n'}),s("ev-script/views/results",["require","jquery","underscore","ev-script/views/base","ev-scroll-loader","text!ev-script/templates/results.html","text!ev-script/templates/no-results.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base");return e("ev-scroll-loader"),r.extend({resultsTemplate:n.template(e("text!ev-script/templates/results.html")),emptyTemplate:n.template(e("text!ev-script/templates/no-results.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"render","loadMore","addHandler","previewItem"),this.picker=e.picker,this.appId=e.appId,this.loadLock=!1},events:{"click a.action-preview":"previewItem"},getItemHtml:function(e,t){if(this.resultTemplate)return this.resultTemplate({item:e,index:t})},previewItem:function(e){var n=e.currentTarget,r=t(n).attr("rel"),i=this.collection.get(r),s={id:r,content:i.toJSON(),appId:this.appId},o=new this.previewClass({el:n,model:new this.modelClass(s),appId:this.appId,picker:this.picker});e.stopPropagation(),e.preventDefault()},loadMore:function(){this.collection.hasMore&&!this.loadLock&&(this.loadLock=!0,this.collection.fetch({remove:!1,picker:this.picker,success:n.bind(function(e,t,r){n.size(t.Data)<this.config.pageSize?(e.hasMore=!1,this.$scrollLoader.evScrollLoader("hideLoader")):(e.hasMore=!0,e.pageIndex+=1),this.loadLock=!1},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadMore()},this)),this.loadLock=!1},this)}))},addHandler:function(e,n,r){var i=t(this.getItemHtml(e,r.index));this.decorate(i),this.$(".content-list").append(i)},decorate:function(e){},render:function(){this.$el.html(this.resultsTemplate({totalResults:this.collection.totalResults}));var e=this.$(".content-list");this.collection.isEmpty()?e.append(this.emptyTemplate()):this.collection.each(function(n,r){var i=t(this.getItemHtml(n,r));this.decorate(i),e.append(i)},this);var n=this.config.scrollHeight;if(this.collection.size()>=this.config.pageSize||e[0].scrollHeight>n)this.$scrollLoader=e.evScrollLoader({height:n,callback:this.loadMore}),this.collection.hasMore||this.$scrollLoader.evScrollLoader("hideLoader");this.collection.off("add",this.addHandler).on("add",this.addHandler)}})}),s("ev-script/views/preview",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","jquery-ui"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings");return e("jquery-ui"),r.extend({initialize:function(e){r.prototype.initialize.call(this,e);var s=t('<div class="dialogWrap"></div>'),o=this.model.get("content"),u=new this.model.constructor(this.model.toJSON()),a={width:this.model.get("width")||(this.model instanceof i?640:800),height:this.model.get("height")||(this.model instanceof i?360:850)},f={},l=50,c=140,h,p,d;this.$el.after(s),f.width=Math.min(a.width+l,t(window).width()-this.config.dialogMargin),f.height=Math.min(a.height+c,t(window).height()-this.config.dialogMargin),p=f.width-l,this.model instanceof i&&a.width>p&&(h=p/a.width,a.width=a.width*h,a.height=a.height*h),u.set("width",a.width),u.set("height",a.height),d=s.dialog({title:o.Title||o.Name,modal:!0,width:f.width,height:f.height,draggable:!1,resizable:!1,dialogClass:"ev-dialog",create:n.bind(function(e,t){var n=new this.embedClass({model:u,appId:this.appId});s.html(n.$el)},this),close:function(e,t){s.dialog("destroy").remove()}})}})}),s("text!ev-script/templates/video-embed.html",[],function(){return'<iframe src="<%= src %>"\n        frameborder="0"\n        style="width: <%= width %>px;height:<%= (parseInt(height, 10) + 56) %>px;"\n        allowfullscreen>\n</iframe>\n'}),s("ev-script/views/video-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/video-embed.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/video-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e);var t=this.model.get("width")?this.model.get("width"):"640",r=this.model.get("height")?this.model.get("height"):"360",i=this.config.ensembleUrl+"/app/plugin/embed.aspx?ID="+this.model.get("id")+"&autoPlay="+this.model.get("autoplay")+"&displayTitle="+this.model.get("showtitle")+"&hideControls="+this.model.get("hidecontrols")+"&showCaptions="+this.model.get("showcaptions")+"&width="+t+"&height="+r;this.$el.html(this.template({src:i,width:t,height:r}))}})}),s("ev-script/models/video-encoding",["require","backbone","underscore","ev-script/util/cache"],function(e){var t=e("backbone"),n=e("underscore"),r=e("ev-script/util/cache");return t.Model.extend({idAttribute:"videoID",initialize:function(e,t){this.appId=t.appId,this.config=r.getAppConfig(this.appId)},url:function(){var e=this.config.ensembleUrl+"/app/simpleapi/video/show.jsonp/"+this.get("fetchId");return this.config.urlCallback?this.config.urlCallback(e):e},getDims:function(){var e=this.get("dimensions")||"640x360",t=e.split("x"),n=[];return n[0]=parseInt(t[0],10)||640,n[1]=parseInt(t[1],10)||360,n},getRatio:function(){var e=this.getDims();return e[0]/e[1]},getWidth:function(){return this.getDims()[0]},getHeight:function(){return this.getDims()[1]},parse:function(e){return n.isArray(e.videos.videoEncodings)?n.max(e.videos.videoEncodings,function(e,t,n){return parseInt(e.bitrate,10)}):e.videos.videoEncodings},sync:function(e,r,i){return n.extend(i,{dataFilter:function(e){var t=e.match(/\{[\s\S]*\}/);return t[0]}}),t.sync.call(this,e,r,i)}})}),s("ev-script/views/video-preview",["require","underscore","ev-script/views/preview","ev-script/views/video-embed","ev-script/models/video-encoding"],function(e){var t=e("underscore"),n=e("ev-script/views/preview"),r=e("ev-script/views/video-embed"),i=e("ev-script/models/video-encoding");return n.extend({embedClass:r,initialize:function(e){this.appId=e.appId,this.encoding=e.encoding||new i({fetchId:this.model.id},{appId:this.appId}),this.picker=e.picker;var r=t.bind(function(){(!this.model.get("width")||!this.model.get("height"))&&this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()}),n.prototype.initialize.call(this,e)},this);this.encoding.isNew()?this.encoding.fetch({success:r,picker:this.picker}):r()}})}),s("text!ev-script/templates/video-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <img src="<%= item.get(\'ThumbnailUrl\').replace(/width=100/, \'width=150\') %>" alt="<%- item.get(\'Title\') %> thumbnail image"/>\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><span>Choose</span></a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Title\') %>" rel="<%= item.get(\'ID\') %>"><span>Preview:  item.get(\'Title\') %></span></a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <table class="content-item">\n            <tbody>\n                <tr class="title">\n                    <td colspan="2">\n                        <a class="action-preview" title="Preview: <%-item.get(\'Title\') %>" href="#" rel="<%= item.get(\'ID\') %>"><%- item.get(\'Title\') %></a>\n                    </td>\n                </tr>\n                <tr class="desc"><td class="label">Description</td><td class="value"><%- item.get(\'Description\') %></td></tr>\n                <tr><td class="label">Date Added</td><td class="value"><%- new Date(item.get(\'AddedOn\')).toLocaleString() %></td></tr>\n                <tr><td class="label">Keywords</td><td class="value"><%- item.get(\'Keywords\') %></td></tr>\n                <tr><td class="label">Library</td><td class="value"><%- item.get(\'LibraryName\') %></td></tr>\n            </tbody>\n        </table>\n    </td>\n</tr>\n'}),s("ev-script/views/video-results",["require","jquery","underscore","ev-script/views/results","ev-script/models/video-settings","ev-script/views/video-preview","text!ev-script/templates/video-result.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/results"),i=e("ev-script/models/video-settings"),s=e("ev-script/views/video-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:n.template(e("text!ev-script/templates/video-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)},decorate:function(e){t(".desc .value",e).each(function(e){var n=t(this),r,i,s=100,o=t(this).html();if(o.length>s){n.empty(),r=t("<span>"+o+"</span>"),i=t("<span>"+o.substring(0,s)+"...</span>");var u=t('<a href="#">Less</a>').click(function(e){r.hide(),i.show(),e.preventDefault()}),a=t('<a href="#">More</a>').click(function(e){i.hide(),r.show(),e.preventDefault()});r.hide().append(u),i.append(a),n.append(i).append(r)}})}})}),s("ev-script/collections/base",["require","underscore","backbone","ev-script/util/cache"],function(e){var t=e("underscore"),n=e("backbone"),r=e("ev-script/util/cache");return n.Collection.extend({initialize:function(e,t){this.appId=t.appId,this.config=r.getAppConfig(this.appId)},model:n.Model.extend({idAttribute:"ID"}),parse:function(e){return e.Data}})}),s("ev-script/collections/videos",["require","ev-script/collections/base"],function(e){var t=e("ev-script/collections/base");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterOn=n.filterOn||"",this.filterValue=n.filterValue||"",this.sourceUrl=n.sourceId==="shared"?"/api/SharedContent":"/api/Content",this.pageIndex=1},url:function(){var e=this.config.ensembleUrl+this.sourceUrl,t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r="FilterOn="+encodeURIComponent(this.filterOn),i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),s("ev-script/views/video-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/search","ev-script/views/video-results","ev-script/collections/videos"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/search"),s=e("ev-script/views/video-results"),o=e("ev-script/collections/videos");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadVideos"),this.searchView=new i({id:this.id+"-search",tagName:"div",className:"ev-search",picker:this,appId:this.appId}),this.$el.append(this.searchView.$el),this.searchView.render(),this.resultsView=new s({id:this.id+"-results",tagName:"div",className:"ev-results clearfix",picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},showPicker:function(){r.prototype.showPicker.call(this),this.searchView.$('input[type="text"]').focus(),this.loadVideos()},loadVideos:function(){var e=t.trim(this.model.get("search").toLowerCase()),r=this.model.get("sourceId"),i=this.getCachedVideos(this.getUser(),r+e);i?(this.resultsView.collection=i,this.resultsView.render()):(i=new o({},{sourceId:r,filterOn:"",filterValue:e,appId:this.appId}),i.fetch({picker:this,success:n.bind(function(t,i,s){var o=t.totalResults=parseInt(i.Pager.TotalRecords,10),u=n.size(i.Data);u===o?t.hasMore=!1:(t.hasMore=!0,t.pageIndex+=1),this.setCachedVideos(this.getUser(),r+e,t),this.resultsView.collection=t,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadVideos()},this))},this)}))}})}),s("ev-script/views/settings",["require","underscore","ev-script/views/base","jquery-ui"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return e("jquery-ui"),n.extend({initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"show","cancelHandler","submitHandler"),this.field=e.field},events:{submit:"submitHandler","click input.action-cancel":"cancelHandler"},show:function(){this.render(),this.$el.dialog("open")},cancelHandler:function(e){this.$el.dialog("close"),e.preventDefault()},submitHandler:function(e){this.updateModel(),this.$el.dialog("close"),e.preventDefault()},updateModel:function(){}})}),s("text!ev-script/templates/video-settings.html",[],function(){return'<form>\n    <fieldset>\n        <div class="fieldWrap">\n            <label for="size">Size</label>\n            <select class="form-select size" id="size" name="size">\n                <option value="original">Original</option>\n            </select>\n        </div>\n        <div class="fieldWrap">\n            <label for="showtitle">Show Title</label>\n            <input id="showtitle" class="form-checkbox" <% if (model.get(\'showtitle\')) { print(\'checked="checked"\'); } %> name="showtitle" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="autoplay">Auto Play</label>\n            <input id="autoplay" class="form-checkbox" <% if (model.get(\'autoplay\')) { print(\'checked="checked"\'); } %>  name="autoplay" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="showcaptions">Show Captions</label>\n            <input id="showcaptions" class="form-checkbox" <% if (model.get(\'showcaptions\')) { print(\'checked="checked"\'); } %>  name="showcaptions" type="checkbox"/>\n        </div>\n        <div class="fieldWrap">\n            <label for="hidecontrols">Hide Controls</label>\n            <input id="hidecontrols" class="form-checkbox" <% if (model.get(\'hidecontrols\')) { print(\'checked="checked"\'); } %>  name="hidecontrols" type="checkbox"/>\n        </div>\n        <div class="form-actions">\n            <input type="button" class="form-submit action-cancel" value="Cancel"/>\n            <input type="submit" class="form-submit action-submit" value="Submit"/>\n        </div>\n    </fieldset>\n</form>\n'}),s("text!ev-script/templates/sizes.html",[],function(){return'<% _.each(sizes, function(size) { %>\n    <option value="<%= size %>" <% if (size === target) { print(\'selected="selected"\'); } %>><%= size %></option>\n<% }); %>\n'}),s("ev-script/views/video-settings",["require","jquery","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/video-settings.html","text!ev-script/templates/sizes.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/settings");return e("jquery-ui"),r.extend({template:n.template(e("text!ev-script/templates/video-settings.html")),sizesTemplate:n.template(e("text!ev-script/templates/sizes.html")),initialize:function(e){r.prototype.initialize.call(this,e),this.encoding=e.encoding,this.encoding.on("change:id",n.bind(function(){this.render()},this))},updateModel:function(){var e={showtitle:this.$("#showtitle").is(":checked"),autoplay:this.$("#autoplay").is(":checked"),showcaptions:this.$("#showcaptions").is(":checked"),hidecontrols:this.$("#hidecontrols").is(":checked")},t=this.$("#size").val();if(t==="original")this.encoding&&!this.encoding.isNew()&&n.extend(e,{width:this.encoding.getWidth(),height:this.encoding.getHeight()});else{var r=t.split("x");n.extend(e,{width:parseInt(r[0],10),height:parseInt(r[1],10)})}this.field.model.set(e)},renderSize:function(){var e=this.field.model.get("width"),t=this.field.model.get("height"),n=16/9,r=["1280x720","1024x576","848x480","720x405","640x360","610x344","560x315","480x270","400x225","320x180","240x135","160x90"];e&&t?n=e/t:this.encoding.id&&(e=this.encoding.getWidth(),t=this.encoding.getHeight(),n=this.encoding.getRatio()),Math.ceil(n*10)/10===Math.ceil(4/3*10)/10&&(r=["1280x960","1024x770","848x636","720x540","640x480","610x460","560x420","480x360","400x300","320x240","240x180","160x120"]);var i=e+"x"+t;this.$(".size").append(this.sizesTemplate({sizes:r,target:i}))},render:function(){this.$el.html(this.template({model:this.field.model})),this.renderSize(),this.$el.dialog({title:this.field.model.get("content").Title,modal:!0,autoOpen:!1,draggable:!1,resizable:!1,dialogClass:"ev-dialog",width:Math.min(340,t(window).width()-this.config.dialogMargin),height:Math.min(320,t(window).height()-this.config.dialogMargin)})}})}),s("text!ev-script/templates/options.html",[],function(){return"<% collection.each(function(item) { %>\n    <option value=\"<%= item.id %>\" <% if (selectedId === item.id) { print('selected=\"selected\"'); } %>><%- item.get('Name') %></option>\n<% }); %>\n"}),s("ev-script/views/organization-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){this.$el.html(this.template({selectedId:this.picker.model.get("organizationId"),collection:this.collection})),this.$el.trigger("change")}})}),s("ev-script/collections/organizations",["require","ev-script/collections/base"],function(e){var t=e("ev-script/collections/base");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n)},url:function(){var e=this.config.ensembleUrl+"/api/Organizations",t="PageSize=9999",n="PageIndex=1",r=e+"?"+t+"&"+n;return this.config.urlCallback?this.config.urlCallback(r):r}})}),s("ev-script/views/library-select",["require","underscore","ev-script/views/base","text!ev-script/templates/options.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/options.html")),initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"render"),this.picker=e.picker,this.$el.html('<option value="-1">Loading...</option>'),this.collection.on("reset",this.render)},render:function(){this.$el.html(this.template({selectedId:this.picker.model.get("libraryId"),collection:this.collection})),this.$el.trigger("change")}})}),s("ev-script/collections/libraries",["require","ev-script/collections/base"],function(e){var t=e("ev-script/collections/base");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.organizationId||""},url:function(){var e=this.config.ensembleUrl+"/api/Libraries",t="PageSize=9999",n="PageIndex=1",r="FilterOn=OrganizationId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),s("text!ev-script/templates/playlist-select.html",[],function(){return'<form>\n    <label for="<%= orgSelectId %>">Organization:</label>\n    <select id="<%= orgSelectId %>" class="form-select organizations"></select>\n    <label for="<%= libSelectId %>">Library:</label>\n    <select id="<%= libSelectId %>" class="form-select libraries"></select>\n    <input type="submit" value="Go" class="form-submit" />\n    <div class="loader"></div>\n    <div class="ev-poweredby">\n        <a tabindex="-1" target="_blank" href="http://ensemblevideo.com"><span>Powered by Ensemble</span></a>\n    </div>\n</form>\n'}),s("ev-script/views/playlist-select",["require","jquery","underscore","ev-script/views/base","ev-script/views/organization-select","ev-script/collections/organizations","ev-script/views/library-select","ev-script/collections/libraries","text!ev-script/templates/playlist-select.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/views/organization-select"),s=e("ev-script/collections/organizations"),o=e("ev-script/views/library-select"),u=e("ev-script/collections/libraries");return r.extend({template:n.template(e("text!ev-script/templates/playlist-select.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadOrgs","loadLibraries","changeOrganization","changeLibrary","handleSubmit"),this.picker=e.picker,this.id=e.id;var t=this.id+"-org-select",a=this.id+"-lib-select";this.$el.html(this.template({orgSelectId:t,libSelectId:a})),this.orgSelect=new i({el:this.$(".organizations"),picker:this.picker,appId:this.appId,collection:new s({},{appId:this.appId})}),this.libSelect=new o({el:this.$(".libraries"),picker:this.picker,appId:this.appId,collection:new u({},{appId:this.appId})});var f=this.$("div.loader");f.on("ajaxSend",n.bind(function(e,t,n){this.picker===n.picker&&f.addClass("loading")},this)).on("ajaxComplete",n.bind(function(e,t,n){this.picker===n.picker&&f.removeClass("loading")},this))},events:{"change select.organizations":"changeOrganization","change select.libraries":"changeLibrary","submit form":"handleSubmit"},changeOrganization:function(e){this.picker.model.set({organizationId:e.target.value}),this.loadLibraries()},changeLibrary:function(e){this.picker.model.set({libraryId:e.target.value}),this.picker.loadPlaylists()},handleSubmit:function(e){this.picker.loadPlaylists(),e.preventDefault()},loadOrgs:function(){var e=this.getCachedOrgs(this.getUser());e?this.orgSelect.collection.reset(e.models):(e=new s({},{appId:this.appId}),e.fetch({picker:this.picker,success:n.bind(function(e,t,n){this.setCachedOrgs(this.getUser(),e),this.orgSelect.collection.reset(e.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadOrgs()},this))},this)}))},loadLibraries:function(){var e=this.picker.model.get("organizationId"),t=this.getCachedLibs(this.getUser(),e);t?this.libSelect.collection.reset(t.models):(t=new u({},{organizationId:e,appId:this.appId}),t.fetch({picker:this.picker,success:n.bind(function(t,n,r){this.setCachedLibs(this.getUser(),e,t),this.libSelect.collection.reset(t.models)},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadLibraries()},this))},this)}))}})}),s("text!ev-script/templates/playlist-embed.html",[],function(){return'<iframe src="<%= ensembleUrl %>/app/plugin/embed.aspx?DestinationID=<%= modelId %>"\n        frameborder="0"\n        style="width:800px;height:850px;"\n        allowfullscreen>\n</iframe>\n'}),s("ev-script/views/playlist-embed",["require","underscore","ev-script/views/base","text!ev-script/templates/playlist-embed.html"],function(e){var t=e("underscore"),n=e("ev-script/views/base");return n.extend({template:t.template(e("text!ev-script/templates/playlist-embed.html")),initialize:function(e){n.prototype.initialize.call(this,e),this.$el.html(this.template({modelId:this.model.get("id"),ensembleUrl:this.config.ensembleUrl}))}})}),s("ev-script/views/playlist-preview",["require","ev-script/views/preview","ev-script/views/playlist-embed"],function(e){var t=e("ev-script/views/preview"),n=e("ev-script/views/playlist-embed");return t.extend({initialize:function(e){t.prototype.initialize.call(this,e)},embedClass:n})}),s("text!ev-script/templates/playlist-result.html",[],function(){return'<tr class="<%= (index % 2 ? \'odd\' : \'even\') %>">\n    <td class="content-actions">\n        <div class="action-links">\n            <a class="action-add" href="#" title="Choose <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <span>Choose</span>\n            </a>\n            <a class="action-preview" href="#" title="Preview: <%- item.get(\'Name\') %>" rel="<%= item.get(\'ID\') %>">\n                <span>Preview: <%- item.get(\'Name\') %></span>\n            </a>\n        </div>\n    </td>\n    <td class="content-meta">\n        <span><%- item.get(\'Name\') %></span>\n    </td>\n</tr>\n'}),s("ev-script/views/playlist-results",["require","underscore","jquery","ev-script/views/results","ev-script/models/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/playlist-result.html"],function(e){var t=e("underscore"),n=e("jquery"),r=e("ev-script/views/results"),i=e("ev-script/models/playlist-settings"),s=e("ev-script/views/playlist-preview");return r.extend({modelClass:i,previewClass:s,resultTemplate:t.template(e("text!ev-script/templates/playlist-result.html")),initialize:function(e){r.prototype.initialize.call(this,e)}})}),s("ev-script/collections/playlists",["require","ev-script/collections/base"],function(e){var t=e("ev-script/collections/base");return t.extend({initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.filterValue=n.filterValue||"",this.pageIndex=1},url:function(){var e=this.config.ensembleUrl+"/api/Playlists",t="PageSize="+this.config.pageSize,n="PageIndex="+this.pageIndex,r="FilterOn=LibraryId",i="FilterValue="+encodeURIComponent(this.filterValue),s=e+"?"+t+"&"+n+"&"+r+"&"+i;return this.config.urlCallback?this.config.urlCallback(s):s}})}),s("ev-script/views/playlist-picker",["require","jquery","underscore","ev-script/views/picker","ev-script/views/playlist-select","ev-script/views/playlist-results","ev-script/collections/playlists"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/picker"),i=e("ev-script/views/playlist-select"),s=e("ev-script/views/playlist-results"),o=e("ev-script/collections/playlists");return r.extend({initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"loadPlaylists"),this.playlistSelect=new i({id:this.id+"-playlist-select",tagName:"div",className:"ev-playlist-select",picker:this,appId:this.appId}),this.$el.append(this.playlistSelect.$el),this.resultsView=new s({id:this.id+"-results",tagName:"div",className:"ev-results clearfix",picker:this,appId:this.appId}),this.$el.append(this.resultsView.$el)},showPicker:function(){r.prototype.showPicker.call(this),this.playlistSelect.loadOrgs(),this.playlistSelect.$("select").filter(":visible").first().focus()},loadPlaylists:function(){var e=this.model.get("libraryId"),t=this.getCachedPlaylists(this.getUser(),e);t?(this.resultsView.collection=t,this.resultsView.render()):(t=new o({},{filterValue:e,appId:this.appId}),t.fetch({picker:this,success:n.bind(function(t,r,i){var s=t.totalResults=parseInt(r.Pager.TotalRecords,10),o=n.size(r.Data);o===s?t.hasMore=!1:(t.hasMore=!0,t.pageIndex+=1),this.setCachedPlaylists(this.getUser(),e,t),this.resultsView.collection=t,this.resultsView.render()},this),error:n.bind(function(e,t,r){this.ajaxError(t,n.bind(function(){this.loadPlaylists()},this))},this)}))}})}),s("text!ev-script/templates/playlist-settings.html",[],function(){return"<h3>TODO</h3>\n<p>\n    <%- json %>\n</p>\n"}),s("ev-script/views/playlist-settings",["require","underscore","ev-script/views/settings","jquery-ui","text!ev-script/templates/playlist-settings.html"],function(e){var t=e("underscore"),n=e("ev-script/views/settings");return e("jquery-ui"),n.extend({template:t.template(e("text!ev-script/templates/playlist-settings.html")),initialize:function(e){n.prototype.initialize.call(this,e)},render:function(){this.$el.html(this.template({json:JSON.stringify(this.field.model.toJSON())})),this.$el.dialog({title:"Playlist Embed Settings",modal:!0,autoOpen:!1,dialogClass:"ev-dialog"})}})}),s("text!ev-script/templates/field.html",[],function(){return'<div class="logo">\n    <a target="_blank" href="<%= ensembleUrl %>"><span>Ensemble Logo</span></a>\n</div>\n<% if (modelId) { %>\n    <% if (thumbnailUrl) { %>\n        <div class="thumbnail">\n            <img alt="Video thumbnail" src="<%= thumbnailUrl %>"/>\n        </div>\n    <% } %>\n    <div class="title"><%- name %></div>\n    <div class="ev-field-actions">\n        <a href="#" class="action-choose" title="Change <%= label %>"><span>Change <%= label %><span></a>\n        <a href="#" class="action-preview" title="Preview: <%- name %>"><span>Preview: <%- name %><span></a>\n        <!-- TODO - temporarily disabled playlist settings until it is implemented -->\n        <% if (type === \'video\') { %>\n            <a href="#" class="action-options" title="<%= label %> Embed Options"><span><%= label %> Embed Options<span></a>\n        <% } %>\n        <a href="#" class="action-remove" title="Remove <%= label %>"><span>Remove <%= label %><span></a>\n    </div>\n<% } else { %>\n    <div class="title"><em>Add <%= type %>.</em></div>\n    <div class="ev-field-actions">\n        <a href="#" class="action-choose" title="Choose <%= label %>"><span>Choose <%= label %><span></a>\n    </div>\n<% } %>\n'}),s("ev-script/views/field",["require","jquery","underscore","ev-script/views/base","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/video-picker","ev-script/views/video-settings","ev-script/views/video-preview","ev-script/models/video-encoding","ev-script/views/playlist-picker","ev-script/views/playlist-settings","ev-script/views/playlist-preview","text!ev-script/templates/field.html"],function(e){var t=e("jquery"),n=e("underscore"),r=e("ev-script/views/base"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/video-picker"),u=e("ev-script/views/video-settings"),a=e("ev-script/views/video-preview"),f=e("ev-script/models/video-encoding"),l=e("ev-script/views/playlist-picker"),c=e("ev-script/views/playlist-settings"),h=e("ev-script/views/playlist-preview");return r.extend({template:n.template(e("text!ev-script/templates/field.html")),initialize:function(e){r.prototype.initialize.call(this,e),n.bindAll(this,"chooseHandler","optionsHandler","removeHandler","previewHandler"),this.$field=e.$field,this.showChoose=!0;var t={id:this.id+"-picker",tagName:"div",className:"ev-"+this.model.get("type")+"-picker",field:this,appId:this.appId},p={id:this.id+"-settings",tagName:"div",className:"ev-settings",field:this,appId:this.appId};this.model instanceof i?(this.modelClass=i,this.pickerClass=o,this.settingsClass=u,this.previewClass=a,this.encoding=new f({},{appId:this.appId}),this.model.isNew()||(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch()),this.model.on("change:id",n.bind(function(){this.model.id?(this.encoding.set({fetchId:this.model.id}),this.encoding.fetch({success:n.bind(function(e){this.model.set({width:this.encoding.getWidth(),height:this.encoding.getHeight()})},this)})):this.encoding.clear()},this)),n.extend(p,{encoding:this.encoding})):this.model instanceof s&&(this.modelClass=s,this.pickerClass=l,this.settingsClass=c,this.previewClass=h),this.picker=new this.pickerClass(n.extend({},t,{model:new this.modelClass(this.model.toJSON())})),this.settings=new this.settingsClass(p),this.$field.after(this.picker.$el),this.renderActions(),this.model.on("change",n.bind(function(){if(!this.model.isNew()){var e=this.model.toJSON();this.$field.val(JSON.stringify(e)),this.appEvents.trigger("fieldUpdated",this.$field,e),this.renderActions()}},this)),this.appEvents.on("showPicker",function(e){this.id===e&&(this.$(".action-choose").hide(),this.showChoose=!1,this.config.hidePickers&&this.appEvents.trigger("hidePickers",this.id))},this),this.appEvents.on("hidePicker",function(e){this.id===e&&(this.$(".action-choose").show(),this.showChoose=!0)},this),this.appEvents.on("hidePickers",function(e){if(!e||this.id!==e)this.$(".action-choose").show(),this.showChoose=!0},this)},events:{"click .action-choose":"chooseHandler","click .action-preview":"previewHandler","click .action-options":"optionsHandler","click .action-remove":"removeHandler"},chooseHandler:function(e){this.appEvents.trigger("showPicker",this.id),e.preventDefault()},optionsHandler:function(e){this.settings.show(),e.preventDefault()},removeHandler:function(e){this.model.clear(),this.$field.val(""),this.model.set(this.model.defaults,{silent:!0}),this.appEvents.trigger("fieldUpdated",this.$field),this.renderActions(),e.preventDefault()},previewHandler:function(e){var t=e.currentTarget,n=new this.previewClass({el:t,encoding:this.encoding,model:this.model,appId:this.appId});e.preventDefault()},renderActions:function(){var e=this.config.ensembleUrl,n,r,s,o;this.model instanceof i?(r="Video",s="video"):(r="Playlist",s="playlist");if(this.model.id){n=this.model.id;var u=this.model.get("content");if(u){n=u.Name||u.Title;var a=new RegExp("^"+e.toLocaleLowerCase()+"/app/assets/");u.ThumbnailUrl&&a.test(u.ThumbnailUrl.toLocaleLowerCase())&&(o=u.ThumbnailUrl)}}this.$actions||(this.$actions=t('<div class="ev-field"/>'),this.$field.after(this.$actions)),this.$actions.html(this.template({ensembleUrl:e,modelId:this.model.id,label:r,type:s,name:n,thumbnailUrl:o})),this.showChoose||this.$(".action-choose").hide()}})}),s("ev-script",["require","backbone","underscore","jquery","ev-script/models/video-settings","ev-script/models/playlist-settings","ev-script/views/field","ev-script/views/video-embed","ev-script/views/playlist-embed","ev-script/util/events","ev-script/util/cache"],function(e){var t=e("backbone"),n=e("underscore"),r=e("jquery"),i=e("ev-script/models/video-settings"),s=e("ev-script/models/playlist-settings"),o=e("ev-script/views/field"),u=e("ev-script/views/video-embed"),a=e("ev-script/views/playlist-embed"),f=e("ev-script/util/events"),l=e("ev-script/util/cache"),c=function(e){var t=Math.floor(Math.random()*1e16).toString(16),s=l.caches.get(e.ensembleUrl);s||(s=l.caches.set(e.ensembleUrl,new l.Cache));var c={ensembleUrl:"",authPath:"",authDomain:"",urlCallback:function(e){return e},pageSize:100,scrollHeight:600,hidePickers:!0,dialogMargin:40},h=l.setAppConfig(t,n.extend({},c,e));f.initEvents(t),this.appEvents=f.getEvents(t),this.globalEvents=f.getEvents(),this.handleField=function(e,n,i){var s=r(i,e),u=new o({id:e.id||t,el:e,model:n,$field:s,appId:t})},this.handleEmbed=function(e,n){if(n instanceof i)var r=new u({el:e,model:n,appId:t});else var s=new a({el:e,model:n,appId:t})}};return{VideoSettings:i,PlaylistSettings:s,EnsembleApp:c}}),s("jquery",function(){return e||jQuery}),s("underscore",function(){return t}),s("backbone",["jquery","underscore"],function(){return n}),s("jquery-ui",["jquery"],function(){}),s("jquery.cookie",["jquery"],function(){}),i("ev-script")});